const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/secp256k1-DoZbTr1c.js","assets/index-C02IaVR4.js","assets/index-QmXjbERJ.css","assets/index-xF4Q8uYu.js"])))=>i.map(i=>d[i]);
import{g as Io,a as Xu,_ as eh,c as vt}from"./index-C02IaVR4.js";var qi={exports:{}},ta;function xd(){if(ta)return qi.exports;ta=1;var r=typeof Reflect=="object"?Reflect:null,e=r&&typeof r.apply=="function"?r.apply:function(I,m,_){return Function.prototype.apply.call(I,m,_)},t;r&&typeof r.ownKeys=="function"?t=r.ownKeys:Object.getOwnPropertySymbols?t=function(I){return Object.getOwnPropertyNames(I).concat(Object.getOwnPropertySymbols(I))}:t=function(I){return Object.getOwnPropertyNames(I)};function i(E){console&&console.warn&&console.warn(E)}var s=Number.isNaN||function(I){return I!==I};function n(){n.init.call(this)}qi.exports=n,qi.exports.once=$,n.EventEmitter=n,n.prototype._events=void 0,n.prototype._eventsCount=0,n.prototype._maxListeners=void 0;var o=10;function a(E){if(typeof E!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof E)}Object.defineProperty(n,"defaultMaxListeners",{enumerable:!0,get:function(){return o},set:function(E){if(typeof E!="number"||E<0||s(E))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+E+".");o=E}}),n.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},n.prototype.setMaxListeners=function(I){if(typeof I!="number"||I<0||s(I))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+I+".");return this._maxListeners=I,this};function c(E){return E._maxListeners===void 0?n.defaultMaxListeners:E._maxListeners}n.prototype.getMaxListeners=function(){return c(this)},n.prototype.emit=function(I){for(var m=[],_=1;_<arguments.length;_++)m.push(arguments[_]);var D=I==="error",O=this._events;if(O!==void 0)D=D&&O.error===void 0;else if(!D)return!1;if(D){var R;if(m.length>0&&(R=m[0]),R instanceof Error)throw R;var N=new Error("Unhandled error."+(R?" ("+R.message+")":""));throw N.context=R,N}var j=O[I];if(j===void 0)return!1;if(typeof j=="function")e(j,this,m);else for(var k=j.length,x=p(j,k),_=0;_<k;++_)e(x[_],this,m);return!0};function u(E,I,m,_){var D,O,R;if(a(m),O=E._events,O===void 0?(O=E._events=Object.create(null),E._eventsCount=0):(O.newListener!==void 0&&(E.emit("newListener",I,m.listener?m.listener:m),O=E._events),R=O[I]),R===void 0)R=O[I]=m,++E._eventsCount;else if(typeof R=="function"?R=O[I]=_?[m,R]:[R,m]:_?R.unshift(m):R.push(m),D=c(E),D>0&&R.length>D&&!R.warned){R.warned=!0;var N=new Error("Possible EventEmitter memory leak detected. "+R.length+" "+String(I)+" listeners added. Use emitter.setMaxListeners() to increase limit");N.name="MaxListenersExceededWarning",N.emitter=E,N.type=I,N.count=R.length,i(N)}return E}n.prototype.addListener=function(I,m){return u(this,I,m,!1)},n.prototype.on=n.prototype.addListener,n.prototype.prependListener=function(I,m){return u(this,I,m,!0)};function h(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function l(E,I,m){var _={fired:!1,wrapFn:void 0,target:E,type:I,listener:m},D=h.bind(_);return D.listener=m,_.wrapFn=D,D}n.prototype.once=function(I,m){return a(m),this.on(I,l(this,I,m)),this},n.prototype.prependOnceListener=function(I,m){return a(m),this.prependListener(I,l(this,I,m)),this},n.prototype.removeListener=function(I,m){var _,D,O,R,N;if(a(m),D=this._events,D===void 0)return this;if(_=D[I],_===void 0)return this;if(_===m||_.listener===m)--this._eventsCount===0?this._events=Object.create(null):(delete D[I],D.removeListener&&this.emit("removeListener",I,_.listener||m));else if(typeof _!="function"){for(O=-1,R=_.length-1;R>=0;R--)if(_[R]===m||_[R].listener===m){N=_[R].listener,O=R;break}if(O<0)return this;O===0?_.shift():g(_,O),_.length===1&&(D[I]=_[0]),D.removeListener!==void 0&&this.emit("removeListener",I,N||m)}return this},n.prototype.off=n.prototype.removeListener,n.prototype.removeAllListeners=function(I){var m,_,D;if(_=this._events,_===void 0)return this;if(_.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):_[I]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete _[I]),this;if(arguments.length===0){var O=Object.keys(_),R;for(D=0;D<O.length;++D)R=O[D],R!=="removeListener"&&this.removeAllListeners(R);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(m=_[I],typeof m=="function")this.removeListener(I,m);else if(m!==void 0)for(D=m.length-1;D>=0;D--)this.removeListener(I,m[D]);return this};function d(E,I,m){var _=E._events;if(_===void 0)return[];var D=_[I];return D===void 0?[]:typeof D=="function"?m?[D.listener||D]:[D]:m?b(D):p(D,D.length)}n.prototype.listeners=function(I){return d(this,I,!0)},n.prototype.rawListeners=function(I){return d(this,I,!1)},n.listenerCount=function(E,I){return typeof E.listenerCount=="function"?E.listenerCount(I):f.call(E,I)},n.prototype.listenerCount=f;function f(E){var I=this._events;if(I!==void 0){var m=I[E];if(typeof m=="function")return 1;if(m!==void 0)return m.length}return 0}n.prototype.eventNames=function(){return this._eventsCount>0?t(this._events):[]};function p(E,I){for(var m=new Array(I),_=0;_<I;++_)m[_]=E[_];return m}function g(E,I){for(;I+1<E.length;I++)E[I]=E[I+1];E.pop()}function b(E){for(var I=new Array(E.length),m=0;m<I.length;++m)I[m]=E[m].listener||E[m];return I}function $(E,I){return new Promise(function(m,_){function D(R){E.removeListener(I,O),_(R)}function O(){typeof E.removeListener=="function"&&E.removeListener("error",D),m([].slice.call(arguments))}S(E,I,O,{once:!0}),I!=="error"&&v(E,D,{once:!0})})}function v(E,I,m){typeof E.on=="function"&&S(E,"error",I,m)}function S(E,I,m,_){if(typeof E.on=="function")_.once?E.once(I,m):E.on(I,m);else if(typeof E.addEventListener=="function")E.addEventListener(I,function D(O){_.once&&E.removeEventListener(I,D),m(O)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof E)}return qi.exports}var Ye=xd();const $o=Io(Ye);var ra=function(r,e,t){if(t||arguments.length===2)for(var i=0,s=e.length,n;i<s;i++)(n||!(i in e))&&(n||(n=Array.prototype.slice.call(e,0,i)),n[i]=e[i]);return r.concat(n||Array.prototype.slice.call(e))},Cd=function(){function r(e,t,i){this.name=e,this.version=t,this.os=i,this.type="browser"}return r}(),Td=function(){function r(e){this.version=e,this.type="node",this.name="node",this.os=process.platform}return r}(),Rd=function(){function r(e,t,i,s){this.name=e,this.version=t,this.os=i,this.bot=s,this.type="bot-device"}return r}(),Nd=function(){function r(){this.type="bot",this.bot=!0,this.name="bot",this.version=null,this.os=null}return r}(),jd=function(){function r(){this.type="react-native",this.name="react-native",this.version=null,this.os=null}return r}(),Bd=/alexa|bot|crawl(er|ing)|facebookexternalhit|feedburner|google web preview|nagios|postrank|pingdom|slurp|spider|yahoo!|yandex/,Ld=/(nuhk|curl|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask\ Jeeves\/Teoma|ia_archiver)/,ia=3,Ud=[["aol",/AOLShield\/([0-9\._]+)/],["edge",/Edge\/([0-9\._]+)/],["edge-ios",/EdgiOS\/([0-9\._]+)/],["yandexbrowser",/YaBrowser\/([0-9\._]+)/],["kakaotalk",/KAKAOTALK\s([0-9\.]+)/],["samsung",/SamsungBrowser\/([0-9\.]+)/],["silk",/\bSilk\/([0-9._-]+)\b/],["miui",/MiuiBrowser\/([0-9\.]+)$/],["beaker",/BeakerBrowser\/([0-9\.]+)/],["edge-chromium",/EdgA?\/([0-9\.]+)/],["chromium-webview",/(?!Chrom.*OPR)wv\).*Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["chrome",/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["phantomjs",/PhantomJS\/([0-9\.]+)(:?\s|$)/],["crios",/CriOS\/([0-9\.]+)(:?\s|$)/],["firefox",/Firefox\/([0-9\.]+)(?:\s|$)/],["fxios",/FxiOS\/([0-9\.]+)/],["opera-mini",/Opera Mini.*Version\/([0-9\.]+)/],["opera",/Opera\/([0-9\.]+)(?:\s|$)/],["opera",/OPR\/([0-9\.]+)(:?\s|$)/],["pie",/^Microsoft Pocket Internet Explorer\/(\d+\.\d+)$/],["pie",/^Mozilla\/\d\.\d+\s\(compatible;\s(?:MSP?IE|MSInternet Explorer) (\d+\.\d+);.*Windows CE.*\)$/],["netfront",/^Mozilla\/\d\.\d+.*NetFront\/(\d.\d)/],["ie",/Trident\/7\.0.*rv\:([0-9\.]+).*\).*Gecko$/],["ie",/MSIE\s([0-9\.]+);.*Trident\/[4-7].0/],["ie",/MSIE\s(7\.0)/],["bb10",/BB10;\sTouch.*Version\/([0-9\.]+)/],["android",/Android\s([0-9\.]+)/],["ios",/Version\/([0-9\._]+).*Mobile.*Safari.*/],["safari",/Version\/([0-9\._]+).*Safari/],["facebook",/FB[AS]V\/([0-9\.]+)/],["instagram",/Instagram\s([0-9\.]+)/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Mobile/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Gecko\)$/],["curl",/^curl\/([0-9\.]+)$/],["searchbot",Bd]],sa=[["iOS",/iP(hone|od|ad)/],["Android OS",/Android/],["BlackBerry OS",/BlackBerry|BB10/],["Windows Mobile",/IEMobile/],["Amazon OS",/Kindle/],["Windows 3.11",/Win16/],["Windows 95",/(Windows 95)|(Win95)|(Windows_95)/],["Windows 98",/(Windows 98)|(Win98)/],["Windows 2000",/(Windows NT 5.0)|(Windows 2000)/],["Windows XP",/(Windows NT 5.1)|(Windows XP)/],["Windows Server 2003",/(Windows NT 5.2)/],["Windows Vista",/(Windows NT 6.0)/],["Windows 7",/(Windows NT 6.1)/],["Windows 8",/(Windows NT 6.2)/],["Windows 8.1",/(Windows NT 6.3)/],["Windows 10",/(Windows NT 10.0)/],["Windows ME",/Windows ME/],["Windows CE",/Windows CE|WinCE|Microsoft Pocket Internet Explorer/],["Open BSD",/OpenBSD/],["Sun OS",/SunOS/],["Chrome OS",/CrOS/],["Linux",/(Linux)|(X11)/],["Mac OS",/(Mac_PowerPC)|(Macintosh)/],["QNX",/QNX/],["BeOS",/BeOS/],["OS/2",/OS\/2/]];function Fd(r){return typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"?new jd:typeof navigator<"u"?Md(navigator.userAgent):zd()}function qd(r){return r!==""&&Ud.reduce(function(e,t){var i=t[0],s=t[1];if(e)return e;var n=s.exec(r);return!!n&&[i,n]},!1)}function Md(r){var e=qd(r);if(!e)return null;var t=e[0],i=e[1];if(t==="searchbot")return new Nd;var s=i[1]&&i[1].split(".").join("_").split("_").slice(0,3);s?s.length<ia&&(s=ra(ra([],s,!0),Hd(ia-s.length),!0)):s=[];var n=s.join("."),o=kd(r),a=Ld.exec(r);return a&&a[1]?new Rd(t,n,o,a[1]):new Cd(t,n,o)}function kd(r){for(var e=0,t=sa.length;e<t;e++){var i=sa[e],s=i[0],n=i[1],o=n.exec(r);if(o)return s}return null}function zd(){var r=typeof process<"u"&&process.version;return r?new Td(process.version.slice(1)):null}function Hd(r){for(var e=[],t=0;t<r;t++)e.push("0");return e}var ks={};/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var Rn=function(r,e){return Rn=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var s in i)i.hasOwnProperty(s)&&(t[s]=i[s])},Rn(r,e)};function Vd(r,e){Rn(r,e);function t(){this.constructor=r}r.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}var Nn=function(){return Nn=Object.assign||function(e){for(var t,i=1,s=arguments.length;i<s;i++){t=arguments[i];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e},Nn.apply(this,arguments)};function Kd(r,e){var t={};for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&e.indexOf(i)<0&&(t[i]=r[i]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,i=Object.getOwnPropertySymbols(r);s<i.length;s++)e.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(r,i[s])&&(t[i[s]]=r[i[s]]);return t}function Wd(r,e,t,i){var s=arguments.length,n=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")n=Reflect.decorate(r,e,t,i);else for(var a=r.length-1;a>=0;a--)(o=r[a])&&(n=(s<3?o(n):s>3?o(e,t,n):o(e,t))||n);return s>3&&n&&Object.defineProperty(e,t,n),n}function Gd(r,e){return function(t,i){e(t,i,r)}}function Yd(r,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(r,e)}function Jd(r,e,t,i){function s(n){return n instanceof t?n:new t(function(o){o(n)})}return new(t||(t=Promise))(function(n,o){function a(h){try{u(i.next(h))}catch(l){o(l)}}function c(h){try{u(i.throw(h))}catch(l){o(l)}}function u(h){h.done?n(h.value):s(h.value).then(a,c)}u((i=i.apply(r,e||[])).next())})}function Zd(r,e){var t={label:0,sent:function(){if(n[0]&1)throw n[1];return n[1]},trys:[],ops:[]},i,s,n,o;return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(u){return function(h){return c([u,h])}}function c(u){if(i)throw new TypeError("Generator is already executing.");for(;t;)try{if(i=1,s&&(n=u[0]&2?s.return:u[0]?s.throw||((n=s.return)&&n.call(s),0):s.next)&&!(n=n.call(s,u[1])).done)return n;switch(s=0,n&&(u=[u[0]&2,n.value]),u[0]){case 0:case 1:n=u;break;case 4:return t.label++,{value:u[1],done:!1};case 5:t.label++,s=u[1],u=[0];continue;case 7:u=t.ops.pop(),t.trys.pop();continue;default:if(n=t.trys,!(n=n.length>0&&n[n.length-1])&&(u[0]===6||u[0]===2)){t=0;continue}if(u[0]===3&&(!n||u[1]>n[0]&&u[1]<n[3])){t.label=u[1];break}if(u[0]===6&&t.label<n[1]){t.label=n[1],n=u;break}if(n&&t.label<n[2]){t.label=n[2],t.ops.push(u);break}n[2]&&t.ops.pop(),t.trys.pop();continue}u=e.call(r,t)}catch(h){u=[6,h],s=0}finally{i=n=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}function Qd(r,e,t,i){i===void 0&&(i=t),r[i]=e[t]}function Xd(r,e){for(var t in r)t!=="default"&&!e.hasOwnProperty(t)&&(e[t]=r[t])}function jn(r){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&r[e],i=0;if(t)return t.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&i>=r.length&&(r=void 0),{value:r&&r[i++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function th(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var i=t.call(r),s,n=[],o;try{for(;(e===void 0||e-- >0)&&!(s=i.next()).done;)n.push(s.value)}catch(a){o={error:a}}finally{try{s&&!s.done&&(t=i.return)&&t.call(i)}finally{if(o)throw o.error}}return n}function ep(){for(var r=[],e=0;e<arguments.length;e++)r=r.concat(th(arguments[e]));return r}function tp(){for(var r=0,e=0,t=arguments.length;e<t;e++)r+=arguments[e].length;for(var i=Array(r),s=0,e=0;e<t;e++)for(var n=arguments[e],o=0,a=n.length;o<a;o++,s++)i[s]=n[o];return i}function wi(r){return this instanceof wi?(this.v=r,this):new wi(r)}function rp(r,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i=t.apply(r,e||[]),s,n=[];return s={},o("next"),o("throw"),o("return"),s[Symbol.asyncIterator]=function(){return this},s;function o(d){i[d]&&(s[d]=function(f){return new Promise(function(p,g){n.push([d,f,p,g])>1||a(d,f)})})}function a(d,f){try{c(i[d](f))}catch(p){l(n[0][3],p)}}function c(d){d.value instanceof wi?Promise.resolve(d.value.v).then(u,h):l(n[0][2],d)}function u(d){a("next",d)}function h(d){a("throw",d)}function l(d,f){d(f),n.shift(),n.length&&a(n[0][0],n[0][1])}}function ip(r){var e,t;return e={},i("next"),i("throw",function(s){throw s}),i("return"),e[Symbol.iterator]=function(){return this},e;function i(s,n){e[s]=r[s]?function(o){return(t=!t)?{value:wi(r[s](o)),done:s==="return"}:n?n(o):o}:n}}function sp(r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=r[Symbol.asyncIterator],t;return e?e.call(r):(r=typeof jn=="function"?jn(r):r[Symbol.iterator](),t={},i("next"),i("throw"),i("return"),t[Symbol.asyncIterator]=function(){return this},t);function i(n){t[n]=r[n]&&function(o){return new Promise(function(a,c){o=r[n](o),s(a,c,o.done,o.value)})}}function s(n,o,a,c){Promise.resolve(c).then(function(u){n({value:u,done:a})},o)}}function np(r,e){return Object.defineProperty?Object.defineProperty(r,"raw",{value:e}):r.raw=e,r}function op(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)Object.hasOwnProperty.call(r,t)&&(e[t]=r[t]);return e.default=r,e}function ap(r){return r&&r.__esModule?r:{default:r}}function cp(r,e){if(!e.has(r))throw new TypeError("attempted to get private field on non-instance");return e.get(r)}function up(r,e,t){if(!e.has(r))throw new TypeError("attempted to set private field on non-instance");return e.set(r,t),t}const hp=Object.freeze(Object.defineProperty({__proto__:null,get __assign(){return Nn},__asyncDelegator:ip,__asyncGenerator:rp,__asyncValues:sp,__await:wi,__awaiter:Jd,__classPrivateFieldGet:cp,__classPrivateFieldSet:up,__createBinding:Qd,__decorate:Wd,__exportStar:Xd,__extends:Vd,__generator:Zd,__importDefault:ap,__importStar:op,__makeTemplateObject:np,__metadata:Yd,__param:Gd,__read:th,__rest:Kd,__spread:ep,__spreadArrays:tp,__values:jn},Symbol.toStringTag,{value:"Module"})),Is=Xu(hp);var zs={},Qr={},na;function lp(){if(na)return Qr;na=1,Object.defineProperty(Qr,"__esModule",{value:!0}),Qr.delay=void 0;function r(e){return new Promise(t=>{setTimeout(()=>{t(!0)},e)})}return Qr.delay=r,Qr}var Vt={},Hs={},Kt={},oa;function dp(){return oa||(oa=1,Object.defineProperty(Kt,"__esModule",{value:!0}),Kt.ONE_THOUSAND=Kt.ONE_HUNDRED=void 0,Kt.ONE_HUNDRED=100,Kt.ONE_THOUSAND=1e3),Kt}var Vs={},aa;function pp(){return aa||(aa=1,function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.ONE_YEAR=r.FOUR_WEEKS=r.THREE_WEEKS=r.TWO_WEEKS=r.ONE_WEEK=r.THIRTY_DAYS=r.SEVEN_DAYS=r.FIVE_DAYS=r.THREE_DAYS=r.ONE_DAY=r.TWENTY_FOUR_HOURS=r.TWELVE_HOURS=r.SIX_HOURS=r.THREE_HOURS=r.ONE_HOUR=r.SIXTY_MINUTES=r.THIRTY_MINUTES=r.TEN_MINUTES=r.FIVE_MINUTES=r.ONE_MINUTE=r.SIXTY_SECONDS=r.THIRTY_SECONDS=r.TEN_SECONDS=r.FIVE_SECONDS=r.ONE_SECOND=void 0,r.ONE_SECOND=1,r.FIVE_SECONDS=5,r.TEN_SECONDS=10,r.THIRTY_SECONDS=30,r.SIXTY_SECONDS=60,r.ONE_MINUTE=r.SIXTY_SECONDS,r.FIVE_MINUTES=r.ONE_MINUTE*5,r.TEN_MINUTES=r.ONE_MINUTE*10,r.THIRTY_MINUTES=r.ONE_MINUTE*30,r.SIXTY_MINUTES=r.ONE_MINUTE*60,r.ONE_HOUR=r.SIXTY_MINUTES,r.THREE_HOURS=r.ONE_HOUR*3,r.SIX_HOURS=r.ONE_HOUR*6,r.TWELVE_HOURS=r.ONE_HOUR*12,r.TWENTY_FOUR_HOURS=r.ONE_HOUR*24,r.ONE_DAY=r.TWENTY_FOUR_HOURS,r.THREE_DAYS=r.ONE_DAY*3,r.FIVE_DAYS=r.ONE_DAY*5,r.SEVEN_DAYS=r.ONE_DAY*7,r.THIRTY_DAYS=r.ONE_DAY*30,r.ONE_WEEK=r.SEVEN_DAYS,r.TWO_WEEKS=r.ONE_WEEK*2,r.THREE_WEEKS=r.ONE_WEEK*3,r.FOUR_WEEKS=r.ONE_WEEK*4,r.ONE_YEAR=r.ONE_DAY*365}(Vs)),Vs}var ca;function rh(){return ca||(ca=1,function(r){Object.defineProperty(r,"__esModule",{value:!0});const e=Is;e.__exportStar(dp(),r),e.__exportStar(pp(),r)}(Hs)),Hs}var ua;function fp(){if(ua)return Vt;ua=1,Object.defineProperty(Vt,"__esModule",{value:!0}),Vt.fromMiliseconds=Vt.toMiliseconds=void 0;const r=rh();function e(i){return i*r.ONE_THOUSAND}Vt.toMiliseconds=e;function t(i){return Math.floor(i/r.ONE_THOUSAND)}return Vt.fromMiliseconds=t,Vt}var ha;function gp(){return ha||(ha=1,function(r){Object.defineProperty(r,"__esModule",{value:!0});const e=Is;e.__exportStar(lp(),r),e.__exportStar(fp(),r)}(zs)),zs}var fr={},la;function yp(){if(la)return fr;la=1,Object.defineProperty(fr,"__esModule",{value:!0}),fr.Watch=void 0;class r{constructor(){this.timestamps=new Map}start(t){if(this.timestamps.has(t))throw new Error(`Watch already started for label: ${t}`);this.timestamps.set(t,{started:Date.now()})}stop(t){const i=this.get(t);if(typeof i.elapsed<"u")throw new Error(`Watch already stopped for label: ${t}`);const s=Date.now()-i.started;this.timestamps.set(t,{started:i.started,elapsed:s})}get(t){const i=this.timestamps.get(t);if(typeof i>"u")throw new Error(`No timestamp found for label: ${t}`);return i}elapsed(t){const i=this.get(t);return i.elapsed||Date.now()-i.started}}return fr.Watch=r,fr.default=r,fr}var Ks={},Xr={},da;function mp(){if(da)return Xr;da=1,Object.defineProperty(Xr,"__esModule",{value:!0}),Xr.IWatch=void 0;class r{}return Xr.IWatch=r,Xr}var pa;function wp(){return pa||(pa=1,function(r){Object.defineProperty(r,"__esModule",{value:!0}),Is.__exportStar(mp(),r)}(Ks)),Ks}var fa;function bp(){return fa||(fa=1,function(r){Object.defineProperty(r,"__esModule",{value:!0});const e=Is;e.__exportStar(gp(),r),e.__exportStar(yp(),r),e.__exportStar(wp(),r),e.__exportStar(rh(),r)}(ks)),ks}var L=bp(),re={},ga;function ih(){if(ga)return re;ga=1,Object.defineProperty(re,"__esModule",{value:!0}),re.getLocalStorage=re.getLocalStorageOrThrow=re.getCrypto=re.getCryptoOrThrow=re.getLocation=re.getLocationOrThrow=re.getNavigator=re.getNavigatorOrThrow=re.getDocument=re.getDocumentOrThrow=re.getFromWindowOrThrow=re.getFromWindow=void 0;function r(d){let f;return typeof window<"u"&&typeof window[d]<"u"&&(f=window[d]),f}re.getFromWindow=r;function e(d){const f=r(d);if(!f)throw new Error(`${d} is not defined in Window`);return f}re.getFromWindowOrThrow=e;function t(){return e("document")}re.getDocumentOrThrow=t;function i(){return r("document")}re.getDocument=i;function s(){return e("navigator")}re.getNavigatorOrThrow=s;function n(){return r("navigator")}re.getNavigator=n;function o(){return e("location")}re.getLocationOrThrow=o;function a(){return r("location")}re.getLocation=a;function c(){return e("crypto")}re.getCryptoOrThrow=c;function u(){return r("crypto")}re.getCrypto=u;function h(){return e("localStorage")}re.getLocalStorageOrThrow=h;function l(){return r("localStorage")}return re.getLocalStorage=l,re}var ir=ih(),ei={},ya;function vp(){if(ya)return ei;ya=1,Object.defineProperty(ei,"__esModule",{value:!0}),ei.getWindowMetadata=void 0;const r=ih();function e(){let t,i;try{t=r.getDocumentOrThrow(),i=r.getLocationOrThrow()}catch{return null}function s(){const f=t.getElementsByTagName("link"),p=[];for(let g=0;g<f.length;g++){const b=f[g],$=b.getAttribute("rel");if($&&$.toLowerCase().indexOf("icon")>-1){const v=b.getAttribute("href");if(v)if(v.toLowerCase().indexOf("https:")===-1&&v.toLowerCase().indexOf("http:")===-1&&v.indexOf("//")!==0){let S=i.protocol+"//"+i.host;if(v.indexOf("/")===0)S+=v;else{const E=i.pathname.split("/");E.pop();const I=E.join("/");S+=I+"/"+v}p.push(S)}else if(v.indexOf("//")===0){const S=i.protocol+v;p.push(S)}else p.push(v)}}return p}function n(...f){const p=t.getElementsByTagName("meta");for(let g=0;g<p.length;g++){const b=p[g],$=["itemprop","property","name"].map(v=>b.getAttribute(v)).filter(v=>v?f.includes(v):!1);if($.length&&$){const v=b.getAttribute("content");if(v)return v}}return""}function o(){let f=n("name","og:site_name","og:title","twitter:title");return f||(f=t.title),f}function a(){return n("description","og:description","twitter:description","keywords")}const c=o(),u=a(),h=i.origin,l=s();return{description:u,url:h,icons:l,name:c}}return ei.getWindowMetadata=e,ei}var Ep=vp();function bi(r,{strict:e=!0}={}){return!r||typeof r!="string"?!1:e?/^0x[0-9a-fA-F]*$/.test(r):r.startsWith("0x")}function ma(r){return bi(r,{strict:!1})?Math.ceil((r.length-2)/2):r.length}const sh="2.23.2";let ti={getDocsUrl:({docsBaseUrl:r,docsPath:e="",docsSlug:t})=>e?`${r??"https://viem.sh"}${e}${t?`#${t}`:""}`:void 0,version:`viem@${sh}`};class sr extends Error{constructor(e,t={}){var a;const i=(()=>{var c;return t.cause instanceof sr?t.cause.details:(c=t.cause)!=null&&c.message?t.cause.message:t.details})(),s=t.cause instanceof sr&&t.cause.docsPath||t.docsPath,n=(a=ti.getDocsUrl)==null?void 0:a.call(ti,{...t,docsPath:s}),o=[e||"An error occurred.","",...t.metaMessages?[...t.metaMessages,""]:[],...n?[`Docs: ${n}`]:[],...i?[`Details: ${i}`]:[],...ti.version?[`Version: ${ti.version}`]:[]].join(`
`);super(o,t.cause?{cause:t.cause}:void 0),Object.defineProperty(this,"details",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"docsPath",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metaMessages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"shortMessage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"version",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"BaseError"}),this.details=i,this.docsPath=s,this.metaMessages=t.metaMessages,this.name=t.name??this.name,this.shortMessage=e,this.version=sh}walk(e){return nh(this,e)}}function nh(r,e){return e!=null&&e(r)?r:r&&typeof r=="object"&&"cause"in r&&r.cause!==void 0?nh(r.cause,e):e?null:r}class oh extends sr{constructor({size:e,targetSize:t,type:i}){super(`${i.charAt(0).toUpperCase()}${i.slice(1).toLowerCase()} size (${e}) exceeds padding size (${t}).`,{name:"SizeExceedsPaddingSizeError"})}}function Vr(r,{dir:e,size:t=32}={}){return typeof r=="string"?_p(r,{dir:e,size:t}):Ip(r,{dir:e,size:t})}function _p(r,{dir:e,size:t=32}={}){if(t===null)return r;const i=r.replace("0x","");if(i.length>t*2)throw new oh({size:Math.ceil(i.length/2),targetSize:t,type:"hex"});return`0x${i[e==="right"?"padEnd":"padStart"](t*2,"0")}`}function Ip(r,{dir:e,size:t=32}={}){if(t===null)return r;if(r.length>t)throw new oh({size:r.length,targetSize:t,type:"bytes"});const i=new Uint8Array(t);for(let s=0;s<t;s++){const n=e==="right";i[n?s:t-s-1]=r[n?s:r.length-s-1]}return i}class $p extends sr{constructor({max:e,min:t,signed:i,size:s,value:n}){super(`Number "${n}" is not in safe ${s?`${s*8}-bit ${i?"signed":"unsigned"} `:""}integer range ${e?`(${t} to ${e})`:`(above ${t})`}`,{name:"IntegerOutOfRangeError"})}}class Sp extends sr{constructor({givenSize:e,maxSize:t}){super(`Size cannot exceed ${t} bytes. Given size: ${e} bytes.`,{name:"SizeOverflowError"})}}function Kr(r,{size:e}){if(ma(r)>e)throw new Sp({givenSize:ma(r),maxSize:e})}function Bn(r,e={}){const{signed:t}=e;e.size&&Kr(r,{size:e.size});const i=BigInt(r);if(!t)return i;const s=(r.length-2)/2,n=(1n<<BigInt(s)*8n-1n)-1n;return i<=n?i:i-BigInt(`0x${"f".padStart(s*2,"f")}`)-1n}function Dp(r,e={}){return Number(Bn(r,e))}const Op=Array.from({length:256},(r,e)=>e.toString(16).padStart(2,"0"));function Ln(r,e={}){return typeof r=="number"||typeof r=="bigint"?ch(r,e):typeof r=="string"?xp(r,e):typeof r=="boolean"?Pp(r,e):ah(r,e)}function Pp(r,e={}){const t=`0x${Number(r)}`;return typeof e.size=="number"?(Kr(t,{size:e.size}),Vr(t,{size:e.size})):t}function ah(r,e={}){let t="";for(let s=0;s<r.length;s++)t+=Op[r[s]];const i=`0x${t}`;return typeof e.size=="number"?(Kr(i,{size:e.size}),Vr(i,{dir:"right",size:e.size})):i}function ch(r,e={}){const{signed:t,size:i}=e,s=BigInt(r);let n;i?t?n=(1n<<BigInt(i)*8n-1n)-1n:n=2n**(BigInt(i)*8n)-1n:typeof r=="number"&&(n=BigInt(Number.MAX_SAFE_INTEGER));const o=typeof n=="bigint"&&t?-n-1n:0;if(n&&s>n||s<o){const c=typeof r=="bigint"?"n":"";throw new $p({max:n?`${n}${c}`:void 0,min:`${o}${c}`,signed:t,size:i,value:`${r}${c}`})}const a=`0x${(t&&s<0?(1n<<BigInt(i*8))+BigInt(s):s).toString(16)}`;return i?Vr(a,{size:i}):a}const Ap=new TextEncoder;function xp(r,e={}){const t=Ap.encode(r);return ah(t,e)}const Cp=new TextEncoder;function Tp(r,e={}){return typeof r=="number"||typeof r=="bigint"?Np(r,e):typeof r=="boolean"?Rp(r,e):bi(r)?uh(r,e):hh(r,e)}function Rp(r,e={}){const t=new Uint8Array(1);return t[0]=Number(r),typeof e.size=="number"?(Kr(t,{size:e.size}),Vr(t,{size:e.size})):t}const It={zero:48,nine:57,A:65,F:70,a:97,f:102};function wa(r){if(r>=It.zero&&r<=It.nine)return r-It.zero;if(r>=It.A&&r<=It.F)return r-(It.A-10);if(r>=It.a&&r<=It.f)return r-(It.a-10)}function uh(r,e={}){let t=r;e.size&&(Kr(t,{size:e.size}),t=Vr(t,{dir:"right",size:e.size}));let i=t.slice(2);i.length%2&&(i=`0${i}`);const s=i.length/2,n=new Uint8Array(s);for(let o=0,a=0;o<s;o++){const c=wa(i.charCodeAt(a++)),u=wa(i.charCodeAt(a++));if(c===void 0||u===void 0)throw new sr(`Invalid byte sequence ("${i[a-2]}${i[a-1]}" in "${i}").`);n[o]=c*16+u}return n}function Np(r,e){const t=ch(r,e);return uh(t)}function hh(r,e={}){const t=Cp.encode(r);return typeof e.size=="number"?(Kr(t,{size:e.size}),Vr(t,{dir:"right",size:e.size})):t}function ls(r){if(!Number.isSafeInteger(r)||r<0)throw new Error("positive integer expected, got "+r)}function jp(r){return r instanceof Uint8Array||ArrayBuffer.isView(r)&&r.constructor.name==="Uint8Array"}function $s(r,...e){if(!jp(r))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(r.length))throw new Error("Uint8Array expected of length "+e+", got length="+r.length)}function YD(r){if(typeof r!="function"||typeof r.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");ls(r.outputLen),ls(r.blockLen)}function ba(r,e=!0){if(r.destroyed)throw new Error("Hash instance has been destroyed");if(e&&r.finished)throw new Error("Hash#digest() has already been called")}function Bp(r,e){$s(r);const t=e.outputLen;if(r.length<t)throw new Error("digestInto() expects output buffer of length at least "+t)}const Mi=BigInt(2**32-1),va=BigInt(32);function Lp(r,e=!1){return e?{h:Number(r&Mi),l:Number(r>>va&Mi)}:{h:Number(r>>va&Mi)|0,l:Number(r&Mi)|0}}function Up(r,e=!1){let t=new Uint32Array(r.length),i=new Uint32Array(r.length);for(let s=0;s<r.length;s++){const{h:n,l:o}=Lp(r[s],e);[t[s],i[s]]=[n,o]}return[t,i]}const Fp=(r,e,t)=>r<<t|e>>>32-t,qp=(r,e,t)=>e<<t|r>>>32-t,Mp=(r,e,t)=>e<<t-32|r>>>64-t,kp=(r,e,t)=>r<<t-32|e>>>64-t,gr=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */function zp(r){return new Uint32Array(r.buffer,r.byteOffset,Math.floor(r.byteLength/4))}function JD(r){return new DataView(r.buffer,r.byteOffset,r.byteLength)}function ZD(r,e){return r<<32-e|r>>>e}const Ea=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function Hp(r){return r<<24&4278190080|r<<8&16711680|r>>>8&65280|r>>>24&255}function _a(r){for(let e=0;e<r.length;e++)r[e]=Hp(r[e])}function Vp(r){if(typeof r!="string")throw new Error("utf8ToBytes expected string, got "+typeof r);return new Uint8Array(new TextEncoder().encode(r))}function lh(r){return typeof r=="string"&&(r=Vp(r)),$s(r),r}function QD(...r){let e=0;for(let i=0;i<r.length;i++){const s=r[i];$s(s),e+=s.length}const t=new Uint8Array(e);for(let i=0,s=0;i<r.length;i++){const n=r[i];t.set(n,s),s+=n.length}return t}class Kp{clone(){return this._cloneInto()}}function Wp(r){const e=i=>r().update(lh(i)).digest(),t=r();return e.outputLen=t.outputLen,e.blockLen=t.blockLen,e.create=()=>r(),e}function XD(r=32){if(gr&&typeof gr.getRandomValues=="function")return gr.getRandomValues(new Uint8Array(r));if(gr&&typeof gr.randomBytes=="function")return gr.randomBytes(r);throw new Error("crypto.getRandomValues must be defined")}const dh=[],ph=[],fh=[],Gp=BigInt(0),ri=BigInt(1),Yp=BigInt(2),Jp=BigInt(7),Zp=BigInt(256),Qp=BigInt(113);for(let r=0,e=ri,t=1,i=0;r<24;r++){[t,i]=[i,(2*t+3*i)%5],dh.push(2*(5*i+t)),ph.push((r+1)*(r+2)/2%64);let s=Gp;for(let n=0;n<7;n++)e=(e<<ri^(e>>Jp)*Qp)%Zp,e&Yp&&(s^=ri<<(ri<<BigInt(n))-ri);fh.push(s)}const[Xp,ef]=Up(fh,!0),Ia=(r,e,t)=>t>32?Mp(r,e,t):Fp(r,e,t),$a=(r,e,t)=>t>32?kp(r,e,t):qp(r,e,t);function tf(r,e=24){const t=new Uint32Array(10);for(let i=24-e;i<24;i++){for(let o=0;o<10;o++)t[o]=r[o]^r[o+10]^r[o+20]^r[o+30]^r[o+40];for(let o=0;o<10;o+=2){const a=(o+8)%10,c=(o+2)%10,u=t[c],h=t[c+1],l=Ia(u,h,1)^t[a],d=$a(u,h,1)^t[a+1];for(let f=0;f<50;f+=10)r[o+f]^=l,r[o+f+1]^=d}let s=r[2],n=r[3];for(let o=0;o<24;o++){const a=ph[o],c=Ia(s,n,a),u=$a(s,n,a),h=dh[o];s=r[h],n=r[h+1],r[h]=c,r[h+1]=u}for(let o=0;o<50;o+=10){for(let a=0;a<10;a++)t[a]=r[o+a];for(let a=0;a<10;a++)r[o+a]^=~t[(a+2)%10]&t[(a+4)%10]}r[0]^=Xp[i],r[1]^=ef[i]}t.fill(0)}class So extends Kp{constructor(e,t,i,s=!1,n=24){if(super(),this.blockLen=e,this.suffix=t,this.outputLen=i,this.enableXOF=s,this.rounds=n,this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,ls(i),0>=this.blockLen||this.blockLen>=200)throw new Error("Sha3 supports only keccak-f1600 function");this.state=new Uint8Array(200),this.state32=zp(this.state)}keccak(){Ea||_a(this.state32),tf(this.state32,this.rounds),Ea||_a(this.state32),this.posOut=0,this.pos=0}update(e){ba(this);const{blockLen:t,state:i}=this;e=lh(e);const s=e.length;for(let n=0;n<s;){const o=Math.min(t-this.pos,s-n);for(let a=0;a<o;a++)i[this.pos++]^=e[n++];this.pos===t&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;const{state:e,suffix:t,pos:i,blockLen:s}=this;e[i]^=t,(t&128)!==0&&i===s-1&&this.keccak(),e[s-1]^=128,this.keccak()}writeInto(e){ba(this,!1),$s(e),this.finish();const t=this.state,{blockLen:i}=this;for(let s=0,n=e.length;s<n;){this.posOut>=i&&this.keccak();const o=Math.min(i-this.posOut,n-s);e.set(t.subarray(this.posOut,this.posOut+o),s),this.posOut+=o,s+=o}return e}xofInto(e){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(e)}xof(e){return ls(e),this.xofInto(new Uint8Array(e))}digestInto(e){if(Bp(e,this),this.finished)throw new Error("digest() was already called");return this.writeInto(e),this.destroy(),e}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,this.state.fill(0)}_cloneInto(e){const{blockLen:t,suffix:i,outputLen:s,rounds:n,enableXOF:o}=this;return e||(e=new So(t,i,s,o,n)),e.state32.set(this.state32),e.pos=this.pos,e.posOut=this.posOut,e.finished=this.finished,e.rounds=n,e.suffix=i,e.outputLen=s,e.enableXOF=o,e.destroyed=this.destroyed,e}}const rf=(r,e,t)=>Wp(()=>new So(e,r,t)),sf=rf(1,136,256/8);function gh(r,e){const t=e||"hex",i=sf(bi(r,{strict:!1})?Tp(r):r);return t==="bytes"?i:Ln(i)}class nf extends Map{constructor(e){super(),Object.defineProperty(this,"maxSize",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxSize=e}get(e){const t=super.get(e);return super.has(e)&&t!==void 0&&(this.delete(e),super.set(e,t)),t}set(e,t){if(super.set(e,t),this.maxSize&&this.size>this.maxSize){const i=this.keys().next().value;i&&this.delete(i)}return this}}const Ws=new nf(8192);function of(r,e){if(Ws.has(`${r}.${e}`))return Ws.get(`${r}.${e}`);const t=r.substring(2).toLowerCase(),i=gh(hh(t),"bytes"),s=t.split("");for(let o=0;o<40;o+=2)i[o>>1]>>4>=8&&s[o]&&(s[o]=s[o].toUpperCase()),(i[o>>1]&15)>=8&&s[o+1]&&(s[o+1]=s[o+1].toUpperCase());const n=`0x${s.join("")}`;return Ws.set(`${r}.${e}`,n),n}function af(r){const e=gh(`0x${r.substring(4)}`).substring(26);return of(`0x${e}`)}async function cf({hash:r,signature:e}){const t=bi(r)?r:Ln(r),{secp256k1:i}=await eh(async()=>{const{secp256k1:o}=await import("./secp256k1-DoZbTr1c.js");return{secp256k1:o}},__vite__mapDeps([0,1,2]));return`0x${(()=>{if(typeof e=="object"&&"r"in e&&"s"in e){const{r:u,s:h,v:l,yParity:d}=e,f=Number(d??l),p=Sa(f);return new i.Signature(Bn(u),Bn(h)).addRecoveryBit(p)}const o=bi(e)?e:Ln(e),a=Dp(`0x${o.slice(130)}`),c=Sa(a);return i.Signature.fromCompact(o.substring(2,130)).addRecoveryBit(c)})().recoverPublicKey(t.substring(2)).toHex(!1)}`}function Sa(r){if(r===0||r===1)return r;if(r===27)return 0;if(r===28)return 1;throw new Error("Invalid yParityOrV value")}async function uf({hash:r,signature:e}){return af(await cf({hash:r,signature:e}))}function hf(r){if(r.length>=255)throw new TypeError("Alphabet too long");const e=new Uint8Array(256);for(let u=0;u<e.length;u++)e[u]=255;for(let u=0;u<r.length;u++){const h=r.charAt(u),l=h.charCodeAt(0);if(e[l]!==255)throw new TypeError(h+" is ambiguous");e[l]=u}const t=r.length,i=r.charAt(0),s=Math.log(t)/Math.log(256),n=Math.log(256)/Math.log(t);function o(u){if(u instanceof Uint8Array||(ArrayBuffer.isView(u)?u=new Uint8Array(u.buffer,u.byteOffset,u.byteLength):Array.isArray(u)&&(u=Uint8Array.from(u))),!(u instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(u.length===0)return"";let h=0,l=0,d=0;const f=u.length;for(;d!==f&&u[d]===0;)d++,h++;const p=(f-d)*n+1>>>0,g=new Uint8Array(p);for(;d!==f;){let v=u[d],S=0;for(let E=p-1;(v!==0||S<l)&&E!==-1;E--,S++)v+=256*g[E]>>>0,g[E]=v%t>>>0,v=v/t>>>0;if(v!==0)throw new Error("Non-zero carry");l=S,d++}let b=p-l;for(;b!==p&&g[b]===0;)b++;let $=i.repeat(h);for(;b<p;++b)$+=r.charAt(g[b]);return $}function a(u){if(typeof u!="string")throw new TypeError("Expected String");if(u.length===0)return new Uint8Array;let h=0,l=0,d=0;for(;u[h]===i;)l++,h++;const f=(u.length-h)*s+1>>>0,p=new Uint8Array(f);for(;h<u.length;){const v=u.charCodeAt(h);if(v>255)return;let S=e[v];if(S===255)return;let E=0;for(let I=f-1;(S!==0||E<d)&&I!==-1;I--,E++)S+=t*p[I]>>>0,p[I]=S%256>>>0,S=S/256>>>0;if(S!==0)throw new Error("Non-zero carry");d=E,h++}let g=f-d;for(;g!==f&&p[g]===0;)g++;const b=new Uint8Array(l+(f-g));let $=l;for(;g!==f;)b[$++]=p[g++];return b}function c(u){const h=a(u);if(h)return h;throw new Error("Non-base"+t+" character")}return{encode:o,decodeUnsafe:a,decode:c}}var lf="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz";const df=hf(lf),pf=r=>JSON.stringify(r,(e,t)=>typeof t=="bigint"?t.toString()+"n":t),ff=r=>{const e=/([\[:])?(\d{17,}|(?:[9](?:[1-9]07199254740991|0[1-9]7199254740991|00[8-9]199254740991|007[2-9]99254740991|007199[3-9]54740991|0071992[6-9]4740991|00719925[5-9]740991|007199254[8-9]40991|0071992547[5-9]0991|00719925474[1-9]991|00719925474099[2-9])))([,\}\]])/g,t=r.replace(e,'$1"$2n"$3');return JSON.parse(t,(i,s)=>typeof s=="string"&&s.match(/^\d+n$/)?BigInt(s.substring(0,s.length-1)):s)};function nr(r){if(typeof r!="string")throw new Error(`Cannot safe json parse value of type ${typeof r}`);try{return ff(r)}catch{return r}}function Nt(r){return typeof r=="string"?r:pf(r)||""}function gf(r){return r instanceof Uint8Array||ArrayBuffer.isView(r)&&r.constructor.name==="Uint8Array"}function yh(r,...e){if(!gf(r))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(r.length))throw new Error("Uint8Array expected of length "+e+", got length="+r.length)}function Da(r,e=!0){if(r.destroyed)throw new Error("Hash instance has been destroyed");if(e&&r.finished)throw new Error("Hash#digest() has already been called")}function yf(r,e){yh(r);const t=e.outputLen;if(r.length<t)throw new Error("digestInto() expects output buffer of length at least "+t)}const yr=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Gs=r=>new DataView(r.buffer,r.byteOffset,r.byteLength);function mf(r){if(typeof r!="string")throw new Error("utf8ToBytes expected string, got "+typeof r);return new Uint8Array(new TextEncoder().encode(r))}function mh(r){return typeof r=="string"&&(r=mf(r)),yh(r),r}let wf=class{clone(){return this._cloneInto()}};function bf(r){const e=i=>r().update(mh(i)).digest(),t=r();return e.outputLen=t.outputLen,e.blockLen=t.blockLen,e.create=()=>r(),e}function wh(r=32){if(yr&&typeof yr.getRandomValues=="function")return yr.getRandomValues(new Uint8Array(r));if(yr&&typeof yr.randomBytes=="function")return yr.randomBytes(r);throw new Error("crypto.getRandomValues must be defined")}function vf(r,e,t,i){if(typeof r.setBigUint64=="function")return r.setBigUint64(e,t,i);const s=BigInt(32),n=BigInt(4294967295),o=Number(t>>s&n),a=Number(t&n),c=i?4:0,u=i?0:4;r.setUint32(e+c,o,i),r.setUint32(e+u,a,i)}let Ef=class extends wf{constructor(e,t,i,s){super(),this.blockLen=e,this.outputLen=t,this.padOffset=i,this.isLE=s,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=Gs(this.buffer)}update(e){Da(this);const{view:t,buffer:i,blockLen:s}=this;e=mh(e);const n=e.length;for(let o=0;o<n;){const a=Math.min(s-this.pos,n-o);if(a===s){const c=Gs(e);for(;s<=n-o;o+=s)this.process(c,o);continue}i.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===s&&(this.process(t,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){Da(this),yf(e,this),this.finished=!0;const{buffer:t,view:i,blockLen:s,isLE:n}=this;let{pos:o}=this;t[o++]=128,this.buffer.subarray(o).fill(0),this.padOffset>s-o&&(this.process(i,0),o=0);for(let l=o;l<s;l++)t[l]=0;vf(i,s-8,BigInt(this.length*8),n),this.process(i,0);const a=Gs(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const u=c/4,h=this.get();if(u>h.length)throw new Error("_sha2: outputLen bigger than state");for(let l=0;l<u;l++)a.setUint32(4*l,h[l],n)}digest(){const{buffer:e,outputLen:t}=this;this.digestInto(e);const i=e.slice(0,t);return this.destroy(),i}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:t,buffer:i,length:s,finished:n,destroyed:o,pos:a}=this;return e.length=s,e.pos=a,e.finished=n,e.destroyed=o,s%t&&e.buffer.set(i),e}};const ki=BigInt(2**32-1),Un=BigInt(32);function bh(r,e=!1){return e?{h:Number(r&ki),l:Number(r>>Un&ki)}:{h:Number(r>>Un&ki)|0,l:Number(r&ki)|0}}function _f(r,e=!1){let t=new Uint32Array(r.length),i=new Uint32Array(r.length);for(let s=0;s<r.length;s++){const{h:n,l:o}=bh(r[s],e);[t[s],i[s]]=[n,o]}return[t,i]}const If=(r,e)=>BigInt(r>>>0)<<Un|BigInt(e>>>0),$f=(r,e,t)=>r>>>t,Sf=(r,e,t)=>r<<32-t|e>>>t,Df=(r,e,t)=>r>>>t|e<<32-t,Of=(r,e,t)=>r<<32-t|e>>>t,Pf=(r,e,t)=>r<<64-t|e>>>t-32,Af=(r,e,t)=>r>>>t-32|e<<64-t,xf=(r,e)=>e,Cf=(r,e)=>r,Tf=(r,e,t)=>r<<t|e>>>32-t,Rf=(r,e,t)=>e<<t|r>>>32-t,Nf=(r,e,t)=>e<<t-32|r>>>64-t,jf=(r,e,t)=>r<<t-32|e>>>64-t;function Bf(r,e,t,i){const s=(e>>>0)+(i>>>0);return{h:r+t+(s/2**32|0)|0,l:s|0}}const Lf=(r,e,t)=>(r>>>0)+(e>>>0)+(t>>>0),Uf=(r,e,t,i)=>e+t+i+(r/2**32|0)|0,Ff=(r,e,t,i)=>(r>>>0)+(e>>>0)+(t>>>0)+(i>>>0),qf=(r,e,t,i,s)=>e+t+i+s+(r/2**32|0)|0,Mf=(r,e,t,i,s)=>(r>>>0)+(e>>>0)+(t>>>0)+(i>>>0)+(s>>>0),kf=(r,e,t,i,s,n)=>e+t+i+s+n+(r/2**32|0)|0,K={fromBig:bh,split:_f,toBig:If,shrSH:$f,shrSL:Sf,rotrSH:Df,rotrSL:Of,rotrBH:Pf,rotrBL:Af,rotr32H:xf,rotr32L:Cf,rotlSH:Tf,rotlSL:Rf,rotlBH:Nf,rotlBL:jf,add:Bf,add3L:Lf,add3H:Uf,add4L:Ff,add4H:qf,add5H:kf,add5L:Mf},[zf,Hf]=K.split(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(r=>BigInt(r))),jt=new Uint32Array(80),Bt=new Uint32Array(80);let Vf=class extends Ef{constructor(){super(128,64,16,!1),this.Ah=1779033703,this.Al=-205731576,this.Bh=-1150833019,this.Bl=-2067093701,this.Ch=1013904242,this.Cl=-23791573,this.Dh=-1521486534,this.Dl=1595750129,this.Eh=1359893119,this.El=-1377402159,this.Fh=-1694144372,this.Fl=725511199,this.Gh=528734635,this.Gl=-79577749,this.Hh=1541459225,this.Hl=327033209}get(){const{Ah:e,Al:t,Bh:i,Bl:s,Ch:n,Cl:o,Dh:a,Dl:c,Eh:u,El:h,Fh:l,Fl:d,Gh:f,Gl:p,Hh:g,Hl:b}=this;return[e,t,i,s,n,o,a,c,u,h,l,d,f,p,g,b]}set(e,t,i,s,n,o,a,c,u,h,l,d,f,p,g,b){this.Ah=e|0,this.Al=t|0,this.Bh=i|0,this.Bl=s|0,this.Ch=n|0,this.Cl=o|0,this.Dh=a|0,this.Dl=c|0,this.Eh=u|0,this.El=h|0,this.Fh=l|0,this.Fl=d|0,this.Gh=f|0,this.Gl=p|0,this.Hh=g|0,this.Hl=b|0}process(e,t){for(let S=0;S<16;S++,t+=4)jt[S]=e.getUint32(t),Bt[S]=e.getUint32(t+=4);for(let S=16;S<80;S++){const E=jt[S-15]|0,I=Bt[S-15]|0,m=K.rotrSH(E,I,1)^K.rotrSH(E,I,8)^K.shrSH(E,I,7),_=K.rotrSL(E,I,1)^K.rotrSL(E,I,8)^K.shrSL(E,I,7),D=jt[S-2]|0,O=Bt[S-2]|0,R=K.rotrSH(D,O,19)^K.rotrBH(D,O,61)^K.shrSH(D,O,6),N=K.rotrSL(D,O,19)^K.rotrBL(D,O,61)^K.shrSL(D,O,6),j=K.add4L(_,N,Bt[S-7],Bt[S-16]),k=K.add4H(j,m,R,jt[S-7],jt[S-16]);jt[S]=k|0,Bt[S]=j|0}let{Ah:i,Al:s,Bh:n,Bl:o,Ch:a,Cl:c,Dh:u,Dl:h,Eh:l,El:d,Fh:f,Fl:p,Gh:g,Gl:b,Hh:$,Hl:v}=this;for(let S=0;S<80;S++){const E=K.rotrSH(l,d,14)^K.rotrSH(l,d,18)^K.rotrBH(l,d,41),I=K.rotrSL(l,d,14)^K.rotrSL(l,d,18)^K.rotrBL(l,d,41),m=l&f^~l&g,_=d&p^~d&b,D=K.add5L(v,I,_,Hf[S],Bt[S]),O=K.add5H(D,$,E,m,zf[S],jt[S]),R=D|0,N=K.rotrSH(i,s,28)^K.rotrBH(i,s,34)^K.rotrBH(i,s,39),j=K.rotrSL(i,s,28)^K.rotrBL(i,s,34)^K.rotrBL(i,s,39),k=i&n^i&a^n&a,x=s&o^s&c^o&c;$=g|0,v=b|0,g=f|0,b=p|0,f=l|0,p=d|0,{h:l,l:d}=K.add(u|0,h|0,O|0,R|0),u=a|0,h=c|0,a=n|0,c=o|0,n=i|0,o=s|0;const y=K.add3L(R,j,x);i=K.add3H(y,O,N,k),s=y|0}({h:i,l:s}=K.add(this.Ah|0,this.Al|0,i|0,s|0)),{h:n,l:o}=K.add(this.Bh|0,this.Bl|0,n|0,o|0),{h:a,l:c}=K.add(this.Ch|0,this.Cl|0,a|0,c|0),{h:u,l:h}=K.add(this.Dh|0,this.Dl|0,u|0,h|0),{h:l,l:d}=K.add(this.Eh|0,this.El|0,l|0,d|0),{h:f,l:p}=K.add(this.Fh|0,this.Fl|0,f|0,p|0),{h:g,l:b}=K.add(this.Gh|0,this.Gl|0,g|0,b|0),{h:$,l:v}=K.add(this.Hh|0,this.Hl|0,$|0,v|0),this.set(i,s,n,o,a,c,u,h,l,d,f,p,g,b,$,v)}roundClean(){jt.fill(0),Bt.fill(0)}destroy(){this.buffer.fill(0),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}};const Kf=bf(()=>new Vf);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Do=BigInt(0),vh=BigInt(1),Wf=BigInt(2);function Oo(r){return r instanceof Uint8Array||ArrayBuffer.isView(r)&&r.constructor.name==="Uint8Array"}function Po(r){if(!Oo(r))throw new Error("Uint8Array expected")}function Ys(r,e){if(typeof e!="boolean")throw new Error(r+" boolean expected, got "+e)}const Gf=Array.from({length:256},(r,e)=>e.toString(16).padStart(2,"0"));function Ao(r){Po(r);let e="";for(let t=0;t<r.length;t++)e+=Gf[r[t]];return e}function Eh(r){if(typeof r!="string")throw new Error("hex string expected, got "+typeof r);return r===""?Do:BigInt("0x"+r)}const $t={_0:48,_9:57,A:65,F:70,a:97,f:102};function Oa(r){if(r>=$t._0&&r<=$t._9)return r-$t._0;if(r>=$t.A&&r<=$t.F)return r-($t.A-10);if(r>=$t.a&&r<=$t.f)return r-($t.a-10)}function _h(r){if(typeof r!="string")throw new Error("hex string expected, got "+typeof r);const e=r.length,t=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const i=new Uint8Array(t);for(let s=0,n=0;s<t;s++,n+=2){const o=Oa(r.charCodeAt(n)),a=Oa(r.charCodeAt(n+1));if(o===void 0||a===void 0){const c=r[n]+r[n+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+n)}i[s]=o*16+a}return i}function Yf(r){return Eh(Ao(r))}function is(r){return Po(r),Eh(Ao(Uint8Array.from(r).reverse()))}function Ih(r,e){return _h(r.toString(16).padStart(e*2,"0"))}function Fn(r,e){return Ih(r,e).reverse()}function St(r,e,t){let i;if(typeof e=="string")try{i=_h(e)}catch(n){throw new Error(r+" must be hex string or Uint8Array, cause: "+n)}else if(Oo(e))i=Uint8Array.from(e);else throw new Error(r+" must be hex string or Uint8Array");const s=i.length;if(typeof t=="number"&&s!==t)throw new Error(r+" of length "+t+" expected, got "+s);return i}function Pa(...r){let e=0;for(let i=0;i<r.length;i++){const s=r[i];Po(s),e+=s.length}const t=new Uint8Array(e);for(let i=0,s=0;i<r.length;i++){const n=r[i];t.set(n,s),s+=n.length}return t}const Js=r=>typeof r=="bigint"&&Do<=r;function Jf(r,e,t){return Js(r)&&Js(e)&&Js(t)&&e<=r&&r<t}function ii(r,e,t,i){if(!Jf(e,t,i))throw new Error("expected valid "+r+": "+t+" <= n < "+i+", got "+e)}function Zf(r){let e;for(e=0;r>Do;r>>=vh,e+=1);return e}const Qf=r=>(Wf<<BigInt(r-1))-vh,Xf={bigint:r=>typeof r=="bigint",function:r=>typeof r=="function",boolean:r=>typeof r=="boolean",string:r=>typeof r=="string",stringOrUint8Array:r=>typeof r=="string"||Oo(r),isSafeInteger:r=>Number.isSafeInteger(r),array:r=>Array.isArray(r),field:(r,e)=>e.Fp.isValid(r),hash:r=>typeof r=="function"&&Number.isSafeInteger(r.outputLen)};function xo(r,e,t={}){const i=(s,n,o)=>{const a=Xf[n];if(typeof a!="function")throw new Error("invalid validator function");const c=r[s];if(!(o&&c===void 0)&&!a(c,r))throw new Error("param "+String(s)+" is invalid. Expected "+n+", got "+c)};for(const[s,n]of Object.entries(e))i(s,n,!1);for(const[s,n]of Object.entries(t))i(s,n,!0);return r}function Aa(r){const e=new WeakMap;return(t,...i)=>{const s=e.get(t);if(s!==void 0)return s;const n=r(t,...i);return e.set(t,n),n}}const be=BigInt(0),ce=BigInt(1),Jt=BigInt(2),eg=BigInt(3),qn=BigInt(4),xa=BigInt(5),Ca=BigInt(8);function pe(r,e){const t=r%e;return t>=be?t:e+t}function tg(r,e,t){if(e<be)throw new Error("invalid exponent, negatives unsupported");if(t<=be)throw new Error("invalid modulus");if(t===ce)return be;let i=ce;for(;e>be;)e&ce&&(i=i*r%t),r=r*r%t,e>>=ce;return i}function pt(r,e,t){let i=r;for(;e-- >be;)i*=i,i%=t;return i}function Ta(r,e){if(r===be)throw new Error("invert: expected non-zero number");if(e<=be)throw new Error("invert: expected positive modulus, got "+e);let t=pe(r,e),i=e,s=be,n=ce;for(;t!==be;){const o=i/t,a=i%t,c=s-n*o;i=t,t=a,s=n,n=c}if(i!==ce)throw new Error("invert: does not exist");return pe(s,e)}function rg(r){const e=(r-ce)/Jt;let t,i,s;for(t=r-ce,i=0;t%Jt===be;t/=Jt,i++);for(s=Jt;s<r&&tg(s,e,r)!==r-ce;s++)if(s>1e3)throw new Error("Cannot find square root: likely non-prime P");if(i===1){const o=(r+ce)/qn;return function(a,c){const u=a.pow(c,o);if(!a.eql(a.sqr(u),c))throw new Error("Cannot find square root");return u}}const n=(t+ce)/Jt;return function(o,a){if(o.pow(a,e)===o.neg(o.ONE))throw new Error("Cannot find square root");let c=i,u=o.pow(o.mul(o.ONE,s),t),h=o.pow(a,n),l=o.pow(a,t);for(;!o.eql(l,o.ONE);){if(o.eql(l,o.ZERO))return o.ZERO;let d=1;for(let p=o.sqr(l);d<c&&!o.eql(p,o.ONE);d++)p=o.sqr(p);const f=o.pow(u,ce<<BigInt(c-d-1));u=o.sqr(f),h=o.mul(h,f),l=o.mul(l,u),c=d}return h}}function ig(r){if(r%qn===eg){const e=(r+ce)/qn;return function(t,i){const s=t.pow(i,e);if(!t.eql(t.sqr(s),i))throw new Error("Cannot find square root");return s}}if(r%Ca===xa){const e=(r-xa)/Ca;return function(t,i){const s=t.mul(i,Jt),n=t.pow(s,e),o=t.mul(i,n),a=t.mul(t.mul(o,Jt),n),c=t.mul(o,t.sub(a,t.ONE));if(!t.eql(t.sqr(c),i))throw new Error("Cannot find square root");return c}}return rg(r)}const sg=(r,e)=>(pe(r,e)&ce)===ce,ng=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function og(r){const e={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},t=ng.reduce((i,s)=>(i[s]="function",i),e);return xo(r,t)}function ag(r,e,t){if(t<be)throw new Error("invalid exponent, negatives unsupported");if(t===be)return r.ONE;if(t===ce)return e;let i=r.ONE,s=e;for(;t>be;)t&ce&&(i=r.mul(i,s)),s=r.sqr(s),t>>=ce;return i}function cg(r,e){const t=new Array(e.length),i=e.reduce((n,o,a)=>r.is0(o)?n:(t[a]=n,r.mul(n,o)),r.ONE),s=r.inv(i);return e.reduceRight((n,o,a)=>r.is0(o)?n:(t[a]=r.mul(n,t[a]),r.mul(n,o)),s),t}function $h(r,e){const t=e!==void 0?e:r.toString(2).length,i=Math.ceil(t/8);return{nBitLength:t,nByteLength:i}}function Sh(r,e,t=!1,i={}){if(r<=be)throw new Error("invalid field: expected ORDER > 0, got "+r);const{nBitLength:s,nByteLength:n}=$h(r,e);if(n>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let o;const a=Object.freeze({ORDER:r,isLE:t,BITS:s,BYTES:n,MASK:Qf(s),ZERO:be,ONE:ce,create:c=>pe(c,r),isValid:c=>{if(typeof c!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof c);return be<=c&&c<r},is0:c=>c===be,isOdd:c=>(c&ce)===ce,neg:c=>pe(-c,r),eql:(c,u)=>c===u,sqr:c=>pe(c*c,r),add:(c,u)=>pe(c+u,r),sub:(c,u)=>pe(c-u,r),mul:(c,u)=>pe(c*u,r),pow:(c,u)=>ag(a,c,u),div:(c,u)=>pe(c*Ta(u,r),r),sqrN:c=>c*c,addN:(c,u)=>c+u,subN:(c,u)=>c-u,mulN:(c,u)=>c*u,inv:c=>Ta(c,r),sqrt:i.sqrt||(c=>(o||(o=ig(r)),o(a,c))),invertBatch:c=>cg(a,c),cmov:(c,u,h)=>h?u:c,toBytes:c=>t?Fn(c,n):Ih(c,n),fromBytes:c=>{if(c.length!==n)throw new Error("Field.fromBytes: expected "+n+" bytes, got "+c.length);return t?is(c):Yf(c)}});return Object.freeze(a)}const Ra=BigInt(0),zi=BigInt(1);function Zs(r,e){const t=e.negate();return r?t:e}function Dh(r,e){if(!Number.isSafeInteger(r)||r<=0||r>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+r)}function Qs(r,e){Dh(r,e);const t=Math.ceil(e/r)+1,i=2**(r-1);return{windows:t,windowSize:i}}function ug(r,e){if(!Array.isArray(r))throw new Error("array expected");r.forEach((t,i)=>{if(!(t instanceof e))throw new Error("invalid point at index "+i)})}function hg(r,e){if(!Array.isArray(r))throw new Error("array of scalars expected");r.forEach((t,i)=>{if(!e.isValid(t))throw new Error("invalid scalar at index "+i)})}const Xs=new WeakMap,Oh=new WeakMap;function en(r){return Oh.get(r)||1}function lg(r,e){return{constTimeNegate:Zs,hasPrecomputes(t){return en(t)!==1},unsafeLadder(t,i,s=r.ZERO){let n=t;for(;i>Ra;)i&zi&&(s=s.add(n)),n=n.double(),i>>=zi;return s},precomputeWindow(t,i){const{windows:s,windowSize:n}=Qs(i,e),o=[];let a=t,c=a;for(let u=0;u<s;u++){c=a,o.push(c);for(let h=1;h<n;h++)c=c.add(a),o.push(c);a=c.double()}return o},wNAF(t,i,s){const{windows:n,windowSize:o}=Qs(t,e);let a=r.ZERO,c=r.BASE;const u=BigInt(2**t-1),h=2**t,l=BigInt(t);for(let d=0;d<n;d++){const f=d*o;let p=Number(s&u);s>>=l,p>o&&(p-=h,s+=zi);const g=f,b=f+Math.abs(p)-1,$=d%2!==0,v=p<0;p===0?c=c.add(Zs($,i[g])):a=a.add(Zs(v,i[b]))}return{p:a,f:c}},wNAFUnsafe(t,i,s,n=r.ZERO){const{windows:o,windowSize:a}=Qs(t,e),c=BigInt(2**t-1),u=2**t,h=BigInt(t);for(let l=0;l<o;l++){const d=l*a;if(s===Ra)break;let f=Number(s&c);if(s>>=h,f>a&&(f-=u,s+=zi),f===0)continue;let p=i[d+Math.abs(f)-1];f<0&&(p=p.negate()),n=n.add(p)}return n},getPrecomputes(t,i,s){let n=Xs.get(i);return n||(n=this.precomputeWindow(i,t),t!==1&&Xs.set(i,s(n))),n},wNAFCached(t,i,s){const n=en(t);return this.wNAF(n,this.getPrecomputes(n,t,s),i)},wNAFCachedUnsafe(t,i,s,n){const o=en(t);return o===1?this.unsafeLadder(t,i,n):this.wNAFUnsafe(o,this.getPrecomputes(o,t,s),i,n)},setWindowSize(t,i){Dh(i,e),Oh.set(t,i),Xs.delete(t)}}}function dg(r,e,t,i){if(ug(t,r),hg(i,e),t.length!==i.length)throw new Error("arrays of points and scalars must have equal length");const s=r.ZERO,n=Zf(BigInt(t.length)),o=n>12?n-3:n>4?n-2:n?2:1,a=(1<<o)-1,c=new Array(a+1).fill(s),u=Math.floor((e.BITS-1)/o)*o;let h=s;for(let l=u;l>=0;l-=o){c.fill(s);for(let f=0;f<i.length;f++){const p=i[f],g=Number(p>>BigInt(l)&BigInt(a));c[g]=c[g].add(t[f])}let d=s;for(let f=c.length-1,p=s;f>0;f--)p=p.add(c[f]),d=d.add(p);if(h=h.add(d),l!==0)for(let f=0;f<o;f++)h=h.double()}return h}function pg(r){return og(r.Fp),xo(r,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...$h(r.n,r.nBitLength),...r,p:r.Fp.ORDER})}const nt=BigInt(0),je=BigInt(1),Hi=BigInt(2),fg=BigInt(8),gg={zip215:!0};function yg(r){const e=pg(r);return xo(r,{hash:"function",a:"bigint",d:"bigint",randomBytes:"function"},{adjustScalarBytes:"function",domain:"function",uvRatio:"function",mapToCurve:"function"}),Object.freeze({...e})}function mg(r){const e=yg(r),{Fp:t,n:i,prehash:s,hash:n,randomBytes:o,nByteLength:a,h:c}=e,u=Hi<<BigInt(a*8)-je,h=t.create,l=Sh(e.n,e.nBitLength),d=e.uvRatio||((y,w)=>{try{return{isValid:!0,value:t.sqrt(y*t.inv(w))}}catch{return{isValid:!1,value:nt}}}),f=e.adjustScalarBytes||(y=>y),p=e.domain||((y,w,P)=>{if(Ys("phflag",P),w.length||P)throw new Error("Contexts/pre-hash are not supported");return y});function g(y,w){ii("coordinate "+y,w,nt,u)}function b(y){if(!(y instanceof S))throw new Error("ExtendedPoint expected")}const $=Aa((y,w)=>{const{ex:P,ey:C,ez:A}=y,T=y.is0();w==null&&(w=T?fg:t.inv(A));const F=h(P*w),M=h(C*w),z=h(A*w);if(T)return{x:nt,y:je};if(z!==je)throw new Error("invZ was invalid");return{x:F,y:M}}),v=Aa(y=>{const{a:w,d:P}=e;if(y.is0())throw new Error("bad point: ZERO");const{ex:C,ey:A,ez:T,et:F}=y,M=h(C*C),z=h(A*A),q=h(T*T),H=h(q*q),V=h(M*w),ne=h(q*h(V+z)),ee=h(H+h(P*h(M*z)));if(ne!==ee)throw new Error("bad point: equation left != right (1)");const Y=h(C*A),Ae=h(T*F);if(Y!==Ae)throw new Error("bad point: equation left != right (2)");return!0});class S{constructor(w,P,C,A){this.ex=w,this.ey=P,this.ez=C,this.et=A,g("x",w),g("y",P),g("z",C),g("t",A),Object.freeze(this)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static fromAffine(w){if(w instanceof S)throw new Error("extended point not allowed");const{x:P,y:C}=w||{};return g("x",P),g("y",C),new S(P,C,je,h(P*C))}static normalizeZ(w){const P=t.invertBatch(w.map(C=>C.ez));return w.map((C,A)=>C.toAffine(P[A])).map(S.fromAffine)}static msm(w,P){return dg(S,l,w,P)}_setWindowSize(w){m.setWindowSize(this,w)}assertValidity(){v(this)}equals(w){b(w);const{ex:P,ey:C,ez:A}=this,{ex:T,ey:F,ez:M}=w,z=h(P*M),q=h(T*A),H=h(C*M),V=h(F*A);return z===q&&H===V}is0(){return this.equals(S.ZERO)}negate(){return new S(h(-this.ex),this.ey,this.ez,h(-this.et))}double(){const{a:w}=e,{ex:P,ey:C,ez:A}=this,T=h(P*P),F=h(C*C),M=h(Hi*h(A*A)),z=h(w*T),q=P+C,H=h(h(q*q)-T-F),V=z+F,ne=V-M,ee=z-F,Y=h(H*ne),Ae=h(V*ee),Ee=h(H*ee),Ce=h(ne*V);return new S(Y,Ae,Ce,Ee)}add(w){b(w);const{a:P,d:C}=e,{ex:A,ey:T,ez:F,et:M}=this,{ex:z,ey:q,ez:H,et:V}=w;if(P===BigInt(-1)){const Go=h((T-A)*(q+z)),Yo=h((T+A)*(q-z)),Ms=h(Yo-Go);if(Ms===nt)return this.double();const Jo=h(F*Hi*V),Zo=h(M*Hi*H),Qo=Zo+Jo,Xo=Yo+Go,ea=Zo-Jo,Dd=h(Qo*Ms),Od=h(Xo*ea),Pd=h(Qo*ea),Ad=h(Ms*Xo);return new S(Dd,Od,Ad,Pd)}const ne=h(A*z),ee=h(T*q),Y=h(M*C*V),Ae=h(F*H),Ee=h((A+T)*(z+q)-ne-ee),Ce=Ae-Y,Je=Ae+Y,Ze=h(ee-P*ne),pr=h(Ee*Ce),Id=h(Je*Ze),$d=h(Ee*Ze),Sd=h(Ce*Je);return new S(pr,Id,Sd,$d)}subtract(w){return this.add(w.negate())}wNAF(w){return m.wNAFCached(this,w,S.normalizeZ)}multiply(w){const P=w;ii("scalar",P,je,i);const{p:C,f:A}=this.wNAF(P);return S.normalizeZ([C,A])[0]}multiplyUnsafe(w,P=S.ZERO){const C=w;return ii("scalar",C,nt,i),C===nt?I:this.is0()||C===je?this:m.wNAFCachedUnsafe(this,C,S.normalizeZ,P)}isSmallOrder(){return this.multiplyUnsafe(c).is0()}isTorsionFree(){return m.unsafeLadder(this,i).is0()}toAffine(w){return $(this,w)}clearCofactor(){const{h:w}=e;return w===je?this:this.multiplyUnsafe(w)}static fromHex(w,P=!1){const{d:C,a:A}=e,T=t.BYTES;w=St("pointHex",w,T),Ys("zip215",P);const F=w.slice(),M=w[T-1];F[T-1]=M&-129;const z=is(F),q=P?u:t.ORDER;ii("pointHex.y",z,nt,q);const H=h(z*z),V=h(H-je),ne=h(C*H-A);let{isValid:ee,value:Y}=d(V,ne);if(!ee)throw new Error("Point.fromHex: invalid y coordinate");const Ae=(Y&je)===je,Ee=(M&128)!==0;if(!P&&Y===nt&&Ee)throw new Error("Point.fromHex: x=0 and x_0=1");return Ee!==Ae&&(Y=h(-Y)),S.fromAffine({x:Y,y:z})}static fromPrivateKey(w){return O(w).point}toRawBytes(){const{x:w,y:P}=this.toAffine(),C=Fn(P,t.BYTES);return C[C.length-1]|=w&je?128:0,C}toHex(){return Ao(this.toRawBytes())}}S.BASE=new S(e.Gx,e.Gy,je,h(e.Gx*e.Gy)),S.ZERO=new S(nt,je,je,nt);const{BASE:E,ZERO:I}=S,m=lg(S,a*8);function _(y){return pe(y,i)}function D(y){return _(is(y))}function O(y){const w=t.BYTES;y=St("private key",y,w);const P=St("hashed private key",n(y),2*w),C=f(P.slice(0,w)),A=P.slice(w,2*w),T=D(C),F=E.multiply(T),M=F.toRawBytes();return{head:C,prefix:A,scalar:T,point:F,pointBytes:M}}function R(y){return O(y).pointBytes}function N(y=new Uint8Array,...w){const P=Pa(...w);return D(n(p(P,St("context",y),!!s)))}function j(y,w,P={}){y=St("message",y),s&&(y=s(y));const{prefix:C,scalar:A,pointBytes:T}=O(w),F=N(P.context,C,y),M=E.multiply(F).toRawBytes(),z=N(P.context,M,T,y),q=_(F+z*A);ii("signature.s",q,nt,i);const H=Pa(M,Fn(q,t.BYTES));return St("result",H,t.BYTES*2)}const k=gg;function x(y,w,P,C=k){const{context:A,zip215:T}=C,F=t.BYTES;y=St("signature",y,2*F),w=St("message",w),P=St("publicKey",P,F),T!==void 0&&Ys("zip215",T),s&&(w=s(w));const M=is(y.slice(F,2*F));let z,q,H;try{z=S.fromHex(P,T),q=S.fromHex(y.slice(0,F),T),H=E.multiplyUnsafe(M)}catch{return!1}if(!T&&z.isSmallOrder())return!1;const V=N(A,q.toRawBytes(),z.toRawBytes(),w);return q.add(z.multiplyUnsafe(V)).subtract(H).clearCofactor().equals(S.ZERO)}return E._setWindowSize(8),{CURVE:e,getPublicKey:R,sign:j,verify:x,ExtendedPoint:S,utils:{getExtendedPublicKey:O,randomPrivateKey:()=>o(t.BYTES),precompute(y=8,w=S.BASE){return w._setWindowSize(y),w.multiply(BigInt(3)),w}}}}BigInt(0),BigInt(1);const Co=BigInt("57896044618658097711785492504343953926634992332820282019728792003956564819949"),Na=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752");BigInt(0);const wg=BigInt(1),ja=BigInt(2);BigInt(3);const bg=BigInt(5),vg=BigInt(8);function Eg(r){const e=BigInt(10),t=BigInt(20),i=BigInt(40),s=BigInt(80),n=Co,o=r*r%n*r%n,a=pt(o,ja,n)*o%n,c=pt(a,wg,n)*r%n,u=pt(c,bg,n)*c%n,h=pt(u,e,n)*u%n,l=pt(h,t,n)*h%n,d=pt(l,i,n)*l%n,f=pt(d,s,n)*d%n,p=pt(f,s,n)*d%n,g=pt(p,e,n)*u%n;return{pow_p_5_8:pt(g,ja,n)*r%n,b2:o}}function _g(r){return r[0]&=248,r[31]&=127,r[31]|=64,r}function Ig(r,e){const t=Co,i=pe(e*e*e,t),s=pe(i*i*e,t),n=Eg(r*s).pow_p_5_8;let o=pe(r*i*n,t);const a=pe(e*o*o,t),c=o,u=pe(o*Na,t),h=a===r,l=a===pe(-r,t),d=a===pe(-r*Na,t);return h&&(o=c),(l||d)&&(o=u),sg(o,t)&&(o=pe(-o,t)),{isValid:h||l,value:o}}const $g=Sh(Co,void 0,!0),Sg={a:BigInt(-1),d:BigInt("37095705934669439343138083508754565189542113879843219016388785533085940283555"),Fp:$g,n:BigInt("7237005577332262213973186563042994240857116359379907606001950938285454250989"),h:vg,Gx:BigInt("15112221349535400772501151409588531511454012693041857206046113283949847762202"),Gy:BigInt("46316835694926478169428394003475163141307993866256225615783033603165251855960"),hash:Kf,randomBytes:wh,adjustScalarBytes:_g,uvRatio:Ig},Ph=mg(Sg),Dg="EdDSA",Og="JWT",ds=".",Ss="base64url",Ah="utf8",xh="utf8",Pg=":",Ag="did",xg="key",Ba="base58btc",Cg="z",Tg="K36",Rg=32;function To(r){return globalThis.Buffer!=null?new Uint8Array(r.buffer,r.byteOffset,r.byteLength):r}function Ch(r=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?To(globalThis.Buffer.allocUnsafe(r)):new Uint8Array(r)}function Th(r,e){e||(e=r.reduce((s,n)=>s+n.length,0));const t=Ch(e);let i=0;for(const s of r)t.set(s,i),i+=s.length;return To(t)}function Ng(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),i=0;i<t.length;i++)t[i]=255;for(var s=0;s<r.length;s++){var n=r.charAt(s),o=n.charCodeAt(0);if(t[o]!==255)throw new TypeError(n+" is ambiguous");t[o]=s}var a=r.length,c=r.charAt(0),u=Math.log(a)/Math.log(256),h=Math.log(256)/Math.log(a);function l(p){if(p instanceof Uint8Array||(ArrayBuffer.isView(p)?p=new Uint8Array(p.buffer,p.byteOffset,p.byteLength):Array.isArray(p)&&(p=Uint8Array.from(p))),!(p instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(p.length===0)return"";for(var g=0,b=0,$=0,v=p.length;$!==v&&p[$]===0;)$++,g++;for(var S=(v-$)*h+1>>>0,E=new Uint8Array(S);$!==v;){for(var I=p[$],m=0,_=S-1;(I!==0||m<b)&&_!==-1;_--,m++)I+=256*E[_]>>>0,E[_]=I%a>>>0,I=I/a>>>0;if(I!==0)throw new Error("Non-zero carry");b=m,$++}for(var D=S-b;D!==S&&E[D]===0;)D++;for(var O=c.repeat(g);D<S;++D)O+=r.charAt(E[D]);return O}function d(p){if(typeof p!="string")throw new TypeError("Expected String");if(p.length===0)return new Uint8Array;var g=0;if(p[g]!==" "){for(var b=0,$=0;p[g]===c;)b++,g++;for(var v=(p.length-g)*u+1>>>0,S=new Uint8Array(v);p[g];){var E=t[p.charCodeAt(g)];if(E===255)return;for(var I=0,m=v-1;(E!==0||I<$)&&m!==-1;m--,I++)E+=a*S[m]>>>0,S[m]=E%256>>>0,E=E/256>>>0;if(E!==0)throw new Error("Non-zero carry");$=I,g++}if(p[g]!==" "){for(var _=v-$;_!==v&&S[_]===0;)_++;for(var D=new Uint8Array(b+(v-_)),O=b;_!==v;)D[O++]=S[_++];return D}}}function f(p){var g=d(p);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:l,decodeUnsafe:d,decode:f}}var jg=Ng,Bg=jg;const Rh=r=>{if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")},Lg=r=>new TextEncoder().encode(r),Ug=r=>new TextDecoder().decode(r);let Fg=class{constructor(e,t,i){this.name=e,this.prefix=t,this.baseEncode=i}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},qg=class{constructor(e,t,i){if(this.name=e,this.prefix=t,t.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=i}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return Nh(this,e)}},Mg=class{constructor(e){this.decoders=e}or(e){return Nh(this,e)}decode(e){const t=e[0],i=this.decoders[t];if(i)return i.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};const Nh=(r,e)=>new Mg({...r.decoders||{[r.prefix]:r},...e.decoders||{[e.prefix]:e}});let kg=class{constructor(e,t,i,s){this.name=e,this.prefix=t,this.baseEncode=i,this.baseDecode=s,this.encoder=new Fg(e,t,i),this.decoder=new qg(e,t,s)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};const Ds=({name:r,prefix:e,encode:t,decode:i})=>new kg(r,e,t,i),Oi=({prefix:r,name:e,alphabet:t})=>{const{encode:i,decode:s}=Bg(t,e);return Ds({prefix:r,name:e,encode:i,decode:n=>Rh(s(n))})},zg=(r,e,t,i)=>{const s={};for(let h=0;h<e.length;++h)s[e[h]]=h;let n=r.length;for(;r[n-1]==="=";)--n;const o=new Uint8Array(n*t/8|0);let a=0,c=0,u=0;for(let h=0;h<n;++h){const l=s[r[h]];if(l===void 0)throw new SyntaxError(`Non-${i} character`);c=c<<t|l,a+=t,a>=8&&(a-=8,o[u++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},Hg=(r,e,t)=>{const i=e[e.length-1]==="=",s=(1<<t)-1;let n="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,n+=e[s&a>>o];if(o&&(n+=e[s&a<<t-o]),i)for(;n.length*t&7;)n+="=";return n},De=({name:r,prefix:e,bitsPerChar:t,alphabet:i})=>Ds({prefix:e,name:r,encode(s){return Hg(s,i,t)},decode(s){return zg(s,i,t,r)}}),Vg=Ds({prefix:"\0",name:"identity",encode:r=>Ug(r),decode:r=>Lg(r)});var Kg=Object.freeze({__proto__:null,identity:Vg});const Wg=De({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var Gg=Object.freeze({__proto__:null,base2:Wg});const Yg=De({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var Jg=Object.freeze({__proto__:null,base8:Yg});const Zg=Oi({prefix:"9",name:"base10",alphabet:"0123456789"});var Qg=Object.freeze({__proto__:null,base10:Zg});const Xg=De({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),ey=De({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var ty=Object.freeze({__proto__:null,base16:Xg,base16upper:ey});const ry=De({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),iy=De({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),sy=De({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),ny=De({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),oy=De({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),ay=De({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),cy=De({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),uy=De({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),hy=De({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var ly=Object.freeze({__proto__:null,base32:ry,base32upper:iy,base32pad:sy,base32padupper:ny,base32hex:oy,base32hexupper:ay,base32hexpad:cy,base32hexpadupper:uy,base32z:hy});const dy=Oi({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),py=Oi({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var fy=Object.freeze({__proto__:null,base36:dy,base36upper:py});const gy=Oi({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),yy=Oi({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var my=Object.freeze({__proto__:null,base58btc:gy,base58flickr:yy});const wy=De({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),by=De({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),vy=De({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),Ey=De({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var _y=Object.freeze({__proto__:null,base64:wy,base64pad:by,base64url:vy,base64urlpad:Ey});const jh=Array.from(""),Iy=jh.reduce((r,e,t)=>(r[t]=e,r),[]),$y=jh.reduce((r,e,t)=>(r[e.codePointAt(0)]=t,r),[]);function Sy(r){return r.reduce((e,t)=>(e+=Iy[t],e),"")}function Dy(r){const e=[];for(const t of r){const i=$y[t.codePointAt(0)];if(i===void 0)throw new Error(`Non-base256emoji character: ${t}`);e.push(i)}return new Uint8Array(e)}const Oy=Ds({prefix:"",name:"base256emoji",encode:Sy,decode:Dy});var Py=Object.freeze({__proto__:null,base256emoji:Oy}),Ay=Bh,La=128,xy=-128,Cy=Math.pow(2,31);function Bh(r,e,t){e=e||[],t=t||0;for(var i=t;r>=Cy;)e[t++]=r&255|La,r/=128;for(;r&xy;)e[t++]=r&255|La,r>>>=7;return e[t]=r|0,Bh.bytes=t-i+1,e}var Ty=Mn,Ry=128,Ua=127;function Mn(r,i){var t=0,i=i||0,s=0,n=i,o,a=r.length;do{if(n>=a)throw Mn.bytes=0,new RangeError("Could not decode varint");o=r[n++],t+=s<28?(o&Ua)<<s:(o&Ua)*Math.pow(2,s),s+=7}while(o>=Ry);return Mn.bytes=n-i,t}var Ny=Math.pow(2,7),jy=Math.pow(2,14),By=Math.pow(2,21),Ly=Math.pow(2,28),Uy=Math.pow(2,35),Fy=Math.pow(2,42),qy=Math.pow(2,49),My=Math.pow(2,56),ky=Math.pow(2,63),zy=function(r){return r<Ny?1:r<jy?2:r<By?3:r<Ly?4:r<Uy?5:r<Fy?6:r<qy?7:r<My?8:r<ky?9:10},Hy={encode:Ay,decode:Ty,encodingLength:zy},Lh=Hy;const Fa=(r,e,t=0)=>(Lh.encode(r,e,t),e),qa=r=>Lh.encodingLength(r),kn=(r,e)=>{const t=e.byteLength,i=qa(r),s=i+qa(t),n=new Uint8Array(s+t);return Fa(r,n,0),Fa(t,n,i),n.set(e,s),new Vy(r,t,e,n)};let Vy=class{constructor(e,t,i,s){this.code=e,this.size=t,this.digest=i,this.bytes=s}};const Uh=({name:r,code:e,encode:t})=>new Ky(r,e,t);let Ky=class{constructor(e,t,i){this.name=e,this.code=t,this.encode=i}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?kn(this.code,t):t.then(i=>kn(this.code,i))}else throw Error("Unknown type, must be binary type")}};const Fh=r=>async e=>new Uint8Array(await crypto.subtle.digest(r,e)),Wy=Uh({name:"sha2-256",code:18,encode:Fh("SHA-256")}),Gy=Uh({name:"sha2-512",code:19,encode:Fh("SHA-512")});var Yy=Object.freeze({__proto__:null,sha256:Wy,sha512:Gy});const qh=0,Jy="identity",Mh=Rh,Zy=r=>kn(qh,Mh(r)),Qy={code:qh,name:Jy,encode:Mh,digest:Zy};var Xy=Object.freeze({__proto__:null,identity:Qy});new TextEncoder,new TextDecoder;const Ma={...Kg,...Gg,...Jg,...Qg,...ty,...ly,...fy,...my,..._y,...Py};({...Yy,...Xy});function kh(r,e,t,i){return{name:r,prefix:e,encoder:{name:r,prefix:e,encode:t},decoder:{decode:i}}}const ka=kh("utf8","u",r=>"u"+new TextDecoder("utf8").decode(r),r=>new TextEncoder().encode(r.substring(1))),tn=kh("ascii","a",r=>{let e="a";for(let t=0;t<r.length;t++)e+=String.fromCharCode(r[t]);return e},r=>{r=r.substring(1);const e=Ch(r.length);for(let t=0;t<r.length;t++)e[t]=r.charCodeAt(t);return e}),zh={utf8:ka,"utf-8":ka,hex:Ma.base16,latin1:tn,ascii:tn,binary:tn,...Ma};function Os(r,e="utf8"){const t=zh[e];if(!t)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(r.buffer,r.byteOffset,r.byteLength).toString("utf8"):t.encoder.encode(r).substring(1)}function Wr(r,e="utf8"){const t=zh[e];if(!t)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?To(globalThis.Buffer.from(r,"utf-8")):t.decoder.decode(`${t.prefix}${r}`)}function za(r){return nr(Os(Wr(r,Ss),Ah))}function ps(r){return Os(Wr(Nt(r),Ah),Ss)}function Hh(r){const e=Wr(Tg,Ba),t=Cg+Os(Th([e,r]),Ba);return[Ag,xg,t].join(Pg)}function em(r){return Os(r,Ss)}function tm(r){return Wr(r,Ss)}function rm(r){return Wr([ps(r.header),ps(r.payload)].join(ds),xh)}function im(r){return[ps(r.header),ps(r.payload),em(r.signature)].join(ds)}function zn(r){const e=r.split(ds),t=za(e[0]),i=za(e[1]),s=tm(e[2]),n=Wr(e.slice(0,2).join(ds),xh);return{header:t,payload:i,signature:s,data:n}}function Ha(r=wh(Rg)){const e=Ph.getPublicKey(r);return{secretKey:Th([r,e]),publicKey:e}}async function sm(r,e,t,i,s=L.fromMiliseconds(Date.now())){const n={alg:Dg,typ:Og},o=Hh(i.publicKey),a=s+t,c={iss:o,sub:r,aud:e,iat:s,exp:a},u=rm({header:n,payload:c}),h=Ph.sign(u,i.secretKey.slice(0,32));return im({header:n,payload:c,signature:h})}function Vh(r=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?globalThis.Buffer.allocUnsafe(r):new Uint8Array(r)}function pi(r,e){e||(e=r.reduce((s,n)=>s+n.length,0));const t=Vh(e);let i=0;for(const s of r)t.set(s,i),i+=s.length;return t}function nm(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),i=0;i<t.length;i++)t[i]=255;for(var s=0;s<r.length;s++){var n=r.charAt(s),o=n.charCodeAt(0);if(t[o]!==255)throw new TypeError(n+" is ambiguous");t[o]=s}var a=r.length,c=r.charAt(0),u=Math.log(a)/Math.log(256),h=Math.log(256)/Math.log(a);function l(p){if(p instanceof Uint8Array||(ArrayBuffer.isView(p)?p=new Uint8Array(p.buffer,p.byteOffset,p.byteLength):Array.isArray(p)&&(p=Uint8Array.from(p))),!(p instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(p.length===0)return"";for(var g=0,b=0,$=0,v=p.length;$!==v&&p[$]===0;)$++,g++;for(var S=(v-$)*h+1>>>0,E=new Uint8Array(S);$!==v;){for(var I=p[$],m=0,_=S-1;(I!==0||m<b)&&_!==-1;_--,m++)I+=256*E[_]>>>0,E[_]=I%a>>>0,I=I/a>>>0;if(I!==0)throw new Error("Non-zero carry");b=m,$++}for(var D=S-b;D!==S&&E[D]===0;)D++;for(var O=c.repeat(g);D<S;++D)O+=r.charAt(E[D]);return O}function d(p){if(typeof p!="string")throw new TypeError("Expected String");if(p.length===0)return new Uint8Array;var g=0;if(p[g]!==" "){for(var b=0,$=0;p[g]===c;)b++,g++;for(var v=(p.length-g)*u+1>>>0,S=new Uint8Array(v);p[g];){var E=t[p.charCodeAt(g)];if(E===255)return;for(var I=0,m=v-1;(E!==0||I<$)&&m!==-1;m--,I++)E+=a*S[m]>>>0,S[m]=E%256>>>0,E=E/256>>>0;if(E!==0)throw new Error("Non-zero carry");$=I,g++}if(p[g]!==" "){for(var _=v-$;_!==v&&S[_]===0;)_++;for(var D=new Uint8Array(b+(v-_)),O=b;_!==v;)D[O++]=S[_++];return D}}}function f(p){var g=d(p);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:l,decodeUnsafe:d,decode:f}}var om=nm,am=om;const cm=r=>{if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")},um=r=>new TextEncoder().encode(r),hm=r=>new TextDecoder().decode(r);class lm{constructor(e,t,i){this.name=e,this.prefix=t,this.baseEncode=i}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class dm{constructor(e,t,i){if(this.name=e,this.prefix=t,t.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=i}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return Kh(this,e)}}class pm{constructor(e){this.decoders=e}or(e){return Kh(this,e)}decode(e){const t=e[0],i=this.decoders[t];if(i)return i.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const Kh=(r,e)=>new pm({...r.decoders||{[r.prefix]:r},...e.decoders||{[e.prefix]:e}});class fm{constructor(e,t,i,s){this.name=e,this.prefix=t,this.baseEncode=i,this.baseDecode=s,this.encoder=new lm(e,t,i),this.decoder=new dm(e,t,s)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const Ps=({name:r,prefix:e,encode:t,decode:i})=>new fm(r,e,t,i),Pi=({prefix:r,name:e,alphabet:t})=>{const{encode:i,decode:s}=am(t,e);return Ps({prefix:r,name:e,encode:i,decode:n=>cm(s(n))})},gm=(r,e,t,i)=>{const s={};for(let h=0;h<e.length;++h)s[e[h]]=h;let n=r.length;for(;r[n-1]==="=";)--n;const o=new Uint8Array(n*t/8|0);let a=0,c=0,u=0;for(let h=0;h<n;++h){const l=s[r[h]];if(l===void 0)throw new SyntaxError(`Non-${i} character`);c=c<<t|l,a+=t,a>=8&&(a-=8,o[u++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},ym=(r,e,t)=>{const i=e[e.length-1]==="=",s=(1<<t)-1;let n="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,n+=e[s&a>>o];if(o&&(n+=e[s&a<<t-o]),i)for(;n.length*t&7;)n+="=";return n},Oe=({name:r,prefix:e,bitsPerChar:t,alphabet:i})=>Ps({prefix:e,name:r,encode(s){return ym(s,i,t)},decode(s){return gm(s,i,t,r)}}),mm=Ps({prefix:"\0",name:"identity",encode:r=>hm(r),decode:r=>um(r)}),wm=Object.freeze(Object.defineProperty({__proto__:null,identity:mm},Symbol.toStringTag,{value:"Module"})),bm=Oe({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),vm=Object.freeze(Object.defineProperty({__proto__:null,base2:bm},Symbol.toStringTag,{value:"Module"})),Em=Oe({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),_m=Object.freeze(Object.defineProperty({__proto__:null,base8:Em},Symbol.toStringTag,{value:"Module"})),Im=Pi({prefix:"9",name:"base10",alphabet:"0123456789"}),$m=Object.freeze(Object.defineProperty({__proto__:null,base10:Im},Symbol.toStringTag,{value:"Module"})),Sm=Oe({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),Dm=Oe({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),Om=Object.freeze(Object.defineProperty({__proto__:null,base16:Sm,base16upper:Dm},Symbol.toStringTag,{value:"Module"})),Pm=Oe({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),Am=Oe({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),xm=Oe({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),Cm=Oe({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),Tm=Oe({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),Rm=Oe({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),Nm=Oe({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),jm=Oe({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),Bm=Oe({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),Lm=Object.freeze(Object.defineProperty({__proto__:null,base32:Pm,base32hex:Tm,base32hexpad:Nm,base32hexpadupper:jm,base32hexupper:Rm,base32pad:xm,base32padupper:Cm,base32upper:Am,base32z:Bm},Symbol.toStringTag,{value:"Module"})),Um=Pi({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),Fm=Pi({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),qm=Object.freeze(Object.defineProperty({__proto__:null,base36:Um,base36upper:Fm},Symbol.toStringTag,{value:"Module"})),Mm=Pi({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),km=Pi({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),zm=Object.freeze(Object.defineProperty({__proto__:null,base58btc:Mm,base58flickr:km},Symbol.toStringTag,{value:"Module"})),Hm=Oe({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),Vm=Oe({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),Km=Oe({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),Wm=Oe({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),Gm=Object.freeze(Object.defineProperty({__proto__:null,base64:Hm,base64pad:Vm,base64url:Km,base64urlpad:Wm},Symbol.toStringTag,{value:"Module"})),Wh=Array.from(""),Ym=Wh.reduce((r,e,t)=>(r[t]=e,r),[]),Jm=Wh.reduce((r,e,t)=>(r[e.codePointAt(0)]=t,r),[]);function Zm(r){return r.reduce((e,t)=>(e+=Ym[t],e),"")}function Qm(r){const e=[];for(const t of r){const i=Jm[t.codePointAt(0)];if(i===void 0)throw new Error(`Non-base256emoji character: ${t}`);e.push(i)}return new Uint8Array(e)}const Xm=Ps({prefix:"",name:"base256emoji",encode:Zm,decode:Qm}),ew=Object.freeze(Object.defineProperty({__proto__:null,base256emoji:Xm},Symbol.toStringTag,{value:"Module"}));new TextEncoder;new TextDecoder;const Va={...wm,...vm,..._m,...$m,...Om,...Lm,...qm,...zm,...Gm,...ew};function Gh(r,e,t,i){return{name:r,prefix:e,encoder:{name:r,prefix:e,encode:t},decoder:{decode:i}}}const Ka=Gh("utf8","u",r=>"u"+new TextDecoder("utf8").decode(r),r=>new TextEncoder().encode(r.substring(1))),rn=Gh("ascii","a",r=>{let e="a";for(let t=0;t<r.length;t++)e+=String.fromCharCode(r[t]);return e},r=>{r=r.substring(1);const e=Vh(r.length);for(let t=0;t<r.length;t++)e[t]=r.charCodeAt(t);return e}),Yh={utf8:Ka,"utf-8":Ka,hex:Va.base16,latin1:rn,ascii:rn,binary:rn,...Va};function rt(r,e="utf8"){const t=Yh[e];if(!t)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(r,"utf8"):t.decoder.decode(`${t.prefix}${r}`)}function qe(r,e="utf8"){const t=Yh[e];if(!t)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(r.buffer,r.byteOffset,r.byteLength).toString("utf8"):t.encoder.encode(r).substring(1)}const tw={waku:{publish:"waku_publish",batchPublish:"waku_batchPublish",subscribe:"waku_subscribe",batchSubscribe:"waku_batchSubscribe",subscription:"waku_subscription",unsubscribe:"waku_unsubscribe",batchUnsubscribe:"waku_batchUnsubscribe",batchFetchMessages:"waku_batchFetchMessages"},irn:{publish:"irn_publish",batchPublish:"irn_batchPublish",subscribe:"irn_subscribe",batchSubscribe:"irn_batchSubscribe",subscription:"irn_subscription",unsubscribe:"irn_unsubscribe",batchUnsubscribe:"irn_batchUnsubscribe",batchFetchMessages:"irn_batchFetchMessages"},iridium:{publish:"iridium_publish",batchPublish:"iridium_batchPublish",subscribe:"iridium_subscribe",batchSubscribe:"iridium_batchSubscribe",subscription:"iridium_subscription",unsubscribe:"iridium_unsubscribe",batchUnsubscribe:"iridium_batchUnsubscribe",batchFetchMessages:"iridium_batchFetchMessages"}};var rw={};const iw=":";function Lr(r){const[e,t]=r.split(iw);return{namespace:e,reference:t}}function Wa(r,e=[]){const t=[];return Object.keys(r).forEach(i=>{if(e.length&&!e.includes(i))return;const s=r[i];t.push(...s.accounts)}),t}function Jh(r,e){return r.includes(":")?[r]:e.chains||[]}var sw=Object.defineProperty,nw=Object.defineProperties,ow=Object.getOwnPropertyDescriptors,Ga=Object.getOwnPropertySymbols,aw=Object.prototype.hasOwnProperty,cw=Object.prototype.propertyIsEnumerable,Ya=(r,e,t)=>e in r?sw(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Ja=(r,e)=>{for(var t in e||(e={}))aw.call(e,t)&&Ya(r,t,e[t]);if(Ga)for(var t of Ga(e))cw.call(e,t)&&Ya(r,t,e[t]);return r},uw=(r,e)=>nw(r,ow(e));const hw="ReactNative",We={reactNative:"react-native",node:"node",browser:"browser",unknown:"unknown"},lw="js";function fs(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"}function Ht(){return!ir.getDocument()&&!!ir.getNavigator()&&navigator.product===hw}function dw(){return Ht()&&typeof global<"u"&&typeof(global==null?void 0:global.Platform)<"u"&&(global==null?void 0:global.Platform.OS)==="android"}function pw(){return Ht()&&typeof global<"u"&&typeof(global==null?void 0:global.Platform)<"u"&&(global==null?void 0:global.Platform.OS)==="ios"}function Ai(){return!fs()&&!!ir.getNavigator()&&!!ir.getDocument()}function xi(){return Ht()?We.reactNative:fs()?We.node:Ai()?We.browser:We.unknown}function Za(){var r;try{return Ht()&&typeof global<"u"&&typeof(global==null?void 0:global.Application)<"u"?(r=global.Application)==null?void 0:r.applicationId:void 0}catch{return}}function fw(r,e){const t=new URLSearchParams(r);for(const i of Object.keys(e).sort())if(e.hasOwnProperty(i)){const s=e[i];s!==void 0&&t.set(i,s)}return t.toString()}function gw(r){var e,t;const i=Zh();try{return r!=null&&r.url&&i.url&&r.url!==i.url&&(console.warn(`The configured WalletConnect 'metadata.url':${r.url} differs from the actual page url:${i.url}. This is probably unintended and can lead to issues.`),r.url=i.url),(e=r==null?void 0:r.icons)!=null&&e.length&&r.icons.length>0&&(r.icons=r.icons.filter(s=>s!=="")),uw(Ja(Ja({},i),r),{url:(r==null?void 0:r.url)||i.url,name:(r==null?void 0:r.name)||i.name,description:(r==null?void 0:r.description)||i.description,icons:(t=r==null?void 0:r.icons)!=null&&t.length&&r.icons.length>0?r.icons:i.icons})}catch(s){return console.warn("Error populating app metadata",s),r||i}}function Zh(){return Ep.getWindowMetadata()||{name:"",description:"",url:"",icons:[""]}}function yw(){if(xi()===We.reactNative&&typeof global<"u"&&typeof(global==null?void 0:global.Platform)<"u"){const{OS:t,Version:i}=global.Platform;return[t,i].join("-")}const r=Fd();if(r===null)return"unknown";const e=r.os?r.os.replace(" ","").toLowerCase():"unknown";return r.type==="browser"?[e,r.name,r.version].join("-"):[e,r.version].join("-")}function mw(){var r;const e=xi();return e===We.browser?[e,((r=ir.getLocation())==null?void 0:r.host)||"unknown"].join(":"):e}function Qh(r,e,t){const i=yw(),s=mw();return[[r,e].join("-"),[lw,t].join("-"),i,s].join("/")}function ww({protocol:r,version:e,relayUrl:t,sdkVersion:i,auth:s,projectId:n,useOnCloseEvent:o,bundleId:a,packageName:c}){const u=t.split("?"),h=Qh(r,e,i),l={auth:s,ua:h,projectId:n,useOnCloseEvent:o,packageName:c||void 0,bundleId:a||void 0},d=fw(u[1]||"",l);return u[0]+"?"+d}function er(r,e){return r.filter(t=>e.includes(t)).length===r.length}function Hn(r){return Object.fromEntries(r.entries())}function Vn(r){return new Map(Object.entries(r))}function Yt(r=L.FIVE_MINUTES,e){const t=L.toMiliseconds(r||L.FIVE_MINUTES);let i,s,n,o;return{resolve:a=>{n&&i&&(clearTimeout(n),i(a),o=Promise.resolve(a))},reject:a=>{n&&s&&(clearTimeout(n),s(a))},done:()=>new Promise((a,c)=>{if(o)return a(o);n=setTimeout(()=>{const u=new Error(e);o=Promise.reject(u),c(u)},t),i=a,s=c})}}function Mt(r,e,t){return new Promise(async(i,s)=>{const n=setTimeout(()=>s(new Error(t)),e);try{const o=await r;i(o)}catch(o){s(o)}clearTimeout(n)})}function Xh(r,e){if(typeof e=="string"&&e.startsWith(`${r}:`))return e;if(r.toLowerCase()==="topic"){if(typeof e!="string")throw new Error('Value must be "string" for expirer target type: topic');return`topic:${e}`}else if(r.toLowerCase()==="id"){if(typeof e!="number")throw new Error('Value must be "number" for expirer target type: id');return`id:${e}`}throw new Error(`Unknown expirer target type: ${r}`)}function bw(r){return Xh("topic",r)}function vw(r){return Xh("id",r)}function el(r){const[e,t]=r.split(":"),i={id:void 0,topic:void 0};if(e==="topic"&&typeof t=="string")i.topic=t;else if(e==="id"&&Number.isInteger(Number(t)))i.id=Number(t);else throw new Error(`Invalid target, expected id:number or topic:string, got ${e}:${t}`);return i}function de(r,e){return L.fromMiliseconds(Date.now()+L.toMiliseconds(r))}function Ft(r){return Date.now()>=L.toMiliseconds(r)}function X(r,e){return`${r}${e?`:${e}`:""}`}function ss(r=[],e=[]){return[...new Set([...r,...e])]}async function Ew({id:r,topic:e,wcDeepLink:t}){var i;try{if(!t)return;const s=typeof t=="string"?JSON.parse(t):t,n=s==null?void 0:s.href;if(typeof n!="string")return;const o=_w(n,r,e),a=xi();if(a===We.browser){if(!((i=ir.getDocument())!=null&&i.hasFocus())){console.warn("Document does not have focus, skipping deeplink.");return}Iw(o)}else a===We.reactNative&&typeof(global==null?void 0:global.Linking)<"u"&&await global.Linking.openURL(o)}catch(s){console.error(s)}}function _w(r,e,t){const i=`requestId=${e}&sessionTopic=${t}`;r.endsWith("/")&&(r=r.slice(0,-1));let s=`${r}`;if(r.startsWith("https://t.me")){const n=r.includes("?")?"&startapp=":"?startapp=";s=`${s}${n}${Ow(i,!0)}`}else s=`${s}/wc?${i}`;return s}function Iw(r){let e="_self";Dw()?e="_top":(Sw()||r.startsWith("https://")||r.startsWith("http://"))&&(e="_blank"),window.open(r,e,"noreferrer noopener")}async function $w(r,e){let t="";try{if(Ai()&&(t=localStorage.getItem(e),t))return t;t=await r.getItem(e)}catch(i){console.error(i)}return t}function Qa(r,e){if(!r.includes(e))return null;const t=r.split(/([&,?,=])/),i=t.indexOf(e);return t[i+2]}function Xa(){return typeof crypto<"u"&&crypto!=null&&crypto.randomUUID?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/gu,r=>{const e=Math.random()*16|0;return(r==="x"?e:e&3|8).toString(16)})}function Ro(){return typeof process<"u"&&rw.IS_VITEST==="true"}function Sw(){return typeof window<"u"&&(!!window.TelegramWebviewProxy||!!window.Telegram||!!window.TelegramWebviewProxyProto)}function Dw(){try{return window.self!==window.top}catch{return!1}}function Ow(r,e=!1){const t=Buffer.from(r).toString("base64");return e?t.replace(/[=]/g,""):t}function tl(r){return Buffer.from(r,"base64").toString("utf-8")}function Pw(r){return new Promise(e=>setTimeout(e,r))}function vi(r){if(!Number.isSafeInteger(r)||r<0)throw new Error("positive integer expected, got "+r)}function Aw(r){return r instanceof Uint8Array||ArrayBuffer.isView(r)&&r.constructor.name==="Uint8Array"}function Ci(r,...e){if(!Aw(r))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(r.length))throw new Error("Uint8Array expected of length "+e+", got length="+r.length)}function No(r){if(typeof r!="function"||typeof r.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");vi(r.outputLen),vi(r.blockLen)}function Ur(r,e=!0){if(r.destroyed)throw new Error("Hash instance has been destroyed");if(e&&r.finished)throw new Error("Hash#digest() has already been called")}function rl(r,e){Ci(r);const t=e.outputLen;if(r.length<t)throw new Error("digestInto() expects output buffer of length at least "+t)}const Vi=BigInt(2**32-1),ec=BigInt(32);function xw(r,e=!1){return e?{h:Number(r&Vi),l:Number(r>>ec&Vi)}:{h:Number(r>>ec&Vi)|0,l:Number(r&Vi)|0}}function Cw(r,e=!1){let t=new Uint32Array(r.length),i=new Uint32Array(r.length);for(let s=0;s<r.length;s++){const{h:n,l:o}=xw(r[s],e);[t[s],i[s]]=[n,o]}return[t,i]}const Tw=(r,e,t)=>r<<t|e>>>32-t,Rw=(r,e,t)=>e<<t|r>>>32-t,Nw=(r,e,t)=>e<<t-32|r>>>64-t,jw=(r,e,t)=>r<<t-32|e>>>64-t,mr=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;function Bw(r){return new Uint32Array(r.buffer,r.byteOffset,Math.floor(r.byteLength/4))}function sn(r){return new DataView(r.buffer,r.byteOffset,r.byteLength)}function ft(r,e){return r<<32-e|r>>>e}const tc=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function Lw(r){return r<<24&4278190080|r<<8&16711680|r>>>8&65280|r>>>24&255}function rc(r){for(let e=0;e<r.length;e++)r[e]=Lw(r[e])}function Uw(r){if(typeof r!="string")throw new Error("utf8ToBytes expected string, got "+typeof r);return new Uint8Array(new TextEncoder().encode(r))}function Fr(r){return typeof r=="string"&&(r=Uw(r)),Ci(r),r}function Fw(...r){let e=0;for(let i=0;i<r.length;i++){const s=r[i];Ci(s),e+=s.length}const t=new Uint8Array(e);for(let i=0,s=0;i<r.length;i++){const n=r[i];t.set(n,s),s+=n.length}return t}let jo=class{clone(){return this._cloneInto()}};function il(r){const e=i=>r().update(Fr(i)).digest(),t=r();return e.outputLen=t.outputLen,e.blockLen=t.blockLen,e.create=()=>r(),e}function Gr(r=32){if(mr&&typeof mr.getRandomValues=="function")return mr.getRandomValues(new Uint8Array(r));if(mr&&typeof mr.randomBytes=="function")return mr.randomBytes(r);throw new Error("crypto.getRandomValues must be defined")}const sl=[],nl=[],ol=[],qw=BigInt(0),si=BigInt(1),Mw=BigInt(2),kw=BigInt(7),zw=BigInt(256),Hw=BigInt(113);for(let r=0,e=si,t=1,i=0;r<24;r++){[t,i]=[i,(2*t+3*i)%5],sl.push(2*(5*i+t)),nl.push((r+1)*(r+2)/2%64);let s=qw;for(let n=0;n<7;n++)e=(e<<si^(e>>kw)*Hw)%zw,e&Mw&&(s^=si<<(si<<BigInt(n))-si);ol.push(s)}const[Vw,Kw]=Cw(ol,!0),ic=(r,e,t)=>t>32?Nw(r,e,t):Tw(r,e,t),sc=(r,e,t)=>t>32?jw(r,e,t):Rw(r,e,t);function Ww(r,e=24){const t=new Uint32Array(10);for(let i=24-e;i<24;i++){for(let o=0;o<10;o++)t[o]=r[o]^r[o+10]^r[o+20]^r[o+30]^r[o+40];for(let o=0;o<10;o+=2){const a=(o+8)%10,c=(o+2)%10,u=t[c],h=t[c+1],l=ic(u,h,1)^t[a],d=sc(u,h,1)^t[a+1];for(let f=0;f<50;f+=10)r[o+f]^=l,r[o+f+1]^=d}let s=r[2],n=r[3];for(let o=0;o<24;o++){const a=nl[o],c=ic(s,n,a),u=sc(s,n,a),h=sl[o];s=r[h],n=r[h+1],r[h]=c,r[h+1]=u}for(let o=0;o<50;o+=10){for(let a=0;a<10;a++)t[a]=r[o+a];for(let a=0;a<10;a++)r[o+a]^=~t[(a+2)%10]&t[(a+4)%10]}r[0]^=Vw[i],r[1]^=Kw[i]}t.fill(0)}let Gw=class al extends jo{constructor(e,t,i,s=!1,n=24){if(super(),this.blockLen=e,this.suffix=t,this.outputLen=i,this.enableXOF=s,this.rounds=n,this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,vi(i),0>=this.blockLen||this.blockLen>=200)throw new Error("Sha3 supports only keccak-f1600 function");this.state=new Uint8Array(200),this.state32=Bw(this.state)}keccak(){tc||rc(this.state32),Ww(this.state32,this.rounds),tc||rc(this.state32),this.posOut=0,this.pos=0}update(e){Ur(this);const{blockLen:t,state:i}=this;e=Fr(e);const s=e.length;for(let n=0;n<s;){const o=Math.min(t-this.pos,s-n);for(let a=0;a<o;a++)i[this.pos++]^=e[n++];this.pos===t&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;const{state:e,suffix:t,pos:i,blockLen:s}=this;e[i]^=t,(t&128)!==0&&i===s-1&&this.keccak(),e[s-1]^=128,this.keccak()}writeInto(e){Ur(this,!1),Ci(e),this.finish();const t=this.state,{blockLen:i}=this;for(let s=0,n=e.length;s<n;){this.posOut>=i&&this.keccak();const o=Math.min(i-this.posOut,n-s);e.set(t.subarray(this.posOut,this.posOut+o),s),this.posOut+=o,s+=o}return e}xofInto(e){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(e)}xof(e){return vi(e),this.xofInto(new Uint8Array(e))}digestInto(e){if(rl(e,this),this.finished)throw new Error("digest() was already called");return this.writeInto(e),this.destroy(),e}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,this.state.fill(0)}_cloneInto(e){const{blockLen:t,suffix:i,outputLen:s,rounds:n,enableXOF:o}=this;return e||(e=new al(t,i,s,o,n)),e.state32.set(this.state32),e.pos=this.pos,e.posOut=this.posOut,e.finished=this.finished,e.rounds=n,e.suffix=i,e.outputLen=s,e.enableXOF=o,e.destroyed=this.destroyed,e}};const Yw=(r,e,t)=>il(()=>new Gw(e,r,t)),Jw=Yw(1,136,256/8),Zw="https://rpc.walletconnect.org/v1";function cl(r){const e=`Ethereum Signed Message:
${r.length}`,t=new TextEncoder().encode(e+r);return"0x"+Buffer.from(Jw(t)).toString("hex")}async function Qw(r,e,t,i,s,n){switch(t.t){case"eip191":return await Xw(r,e,t.s);case"eip1271":return await eb(r,e,t.s,i,s,n);default:throw new Error(`verifySignature failed: Attempted to verify CacaoSignature with unknown type: ${t.t}`)}}async function Xw(r,e,t){return(await uf({hash:cl(e),signature:t})).toLowerCase()===r.toLowerCase()}async function eb(r,e,t,i,s,n){const o=Lr(i);if(!o.namespace||!o.reference)throw new Error(`isValidEip1271Signature failed: chainId must be in CAIP-2 format, received: ${i}`);try{const a="0x1626ba7e",c="0000000000000000000000000000000000000000000000000000000000000040",u="0000000000000000000000000000000000000000000000000000000000000041",h=t.substring(2),l=cl(e).substring(2),d=a+l+c+u+h,f=await fetch(`${n||Zw}/?chainId=${i}&projectId=${s}`,{method:"POST",body:JSON.stringify({id:tb(),jsonrpc:"2.0",method:"eth_call",params:[{to:r,data:d},"latest"]})}),{result:p}=await f.json();return p?p.slice(0,a.length).toLowerCase()===a.toLowerCase():!1}catch(a){return console.error("isValidEip1271Signature: ",a),!1}}function tb(){return Date.now()+Math.floor(Math.random()*1e3)}function rb(r){const e=atob(r),t=new Uint8Array(e.length);for(let o=0;o<e.length;o++)t[o]=e.charCodeAt(o);const i=t[0];if(i===0)throw new Error("No signatures found");const s=1+i*64;if(t.length<s)throw new Error("Transaction data too short for claimed signature count");if(t.length<100)throw new Error("Transaction too short");const n=Buffer.from(r,"base64").slice(1,65);return df.encode(n)}var ib=Object.defineProperty,sb=Object.defineProperties,nb=Object.getOwnPropertyDescriptors,nc=Object.getOwnPropertySymbols,ob=Object.prototype.hasOwnProperty,ab=Object.prototype.propertyIsEnumerable,oc=(r,e,t)=>e in r?ib(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,cb=(r,e)=>{for(var t in e||(e={}))ob.call(e,t)&&oc(r,t,e[t]);if(nc)for(var t of nc(e))ab.call(e,t)&&oc(r,t,e[t]);return r},ub=(r,e)=>sb(r,nb(e));const hb="did:pkh:",Bo=r=>r==null?void 0:r.split(":"),lb=r=>{const e=r&&Bo(r);if(e)return r.includes(hb)?e[3]:e[1]},Kn=r=>{const e=r&&Bo(r);if(e)return e[2]+":"+e[3]},gs=r=>{const e=r&&Bo(r);if(e)return e.pop()};async function ac(r){const{cacao:e,projectId:t}=r,{s:i,p:s}=e,n=ul(s,s.iss),o=gs(s.iss);return await Qw(o,n,i,Kn(s.iss),t)}const ul=(r,e)=>{const t=`${r.domain} wants you to sign in with your Ethereum account:`,i=gs(e);if(!r.aud&&!r.uri)throw new Error("Either `aud` or `uri` is required to construct the message");let s=r.statement||void 0;const n=`URI: ${r.aud||r.uri}`,o=`Version: ${r.version}`,a=`Chain ID: ${lb(e)}`,c=`Nonce: ${r.nonce}`,u=`Issued At: ${r.iat}`,h=r.exp?`Expiration Time: ${r.exp}`:void 0,l=r.nbf?`Not Before: ${r.nbf}`:void 0,d=r.requestId?`Request ID: ${r.requestId}`:void 0,f=r.resources?`Resources:${r.resources.map(g=>`
- ${g}`).join("")}`:void 0,p=ns(r.resources);if(p){const g=Ei(p);s=vb(s,g)}return[t,i,"",s,"",n,o,a,c,u,h,l,d,f].filter(g=>g!=null).join(`
`)};function db(r){return Buffer.from(JSON.stringify(r)).toString("base64")}function pb(r){return JSON.parse(Buffer.from(r,"base64").toString("utf-8"))}function or(r){if(!r)throw new Error("No recap provided, value is undefined");if(!r.att)throw new Error("No `att` property found");const e=Object.keys(r.att);if(!(e!=null&&e.length))throw new Error("No resources found in `att` property");e.forEach(t=>{const i=r.att[t];if(Array.isArray(i))throw new Error(`Resource must be an object: ${t}`);if(typeof i!="object")throw new Error(`Resource must be an object: ${t}`);if(!Object.keys(i).length)throw new Error(`Resource object is empty: ${t}`);Object.keys(i).forEach(s=>{const n=i[s];if(!Array.isArray(n))throw new Error(`Ability limits ${s} must be an array of objects, found: ${n}`);if(!n.length)throw new Error(`Value of ${s} is empty array, must be an array with objects`);n.forEach(o=>{if(typeof o!="object")throw new Error(`Ability limits (${s}) must be an array of objects, found: ${o}`)})})})}function fb(r,e,t,i={}){return t==null||t.sort((s,n)=>s.localeCompare(n)),{att:{[r]:gb(e,t,i)}}}function gb(r,e,t={}){e=e==null?void 0:e.sort((s,n)=>s.localeCompare(n));const i=e.map(s=>({[`${r}/${s}`]:[t]}));return Object.assign({},...i)}function hl(r){return or(r),`urn:recap:${db(r).replace(/=/g,"")}`}function Ei(r){const e=pb(r.replace("urn:recap:",""));return or(e),e}function yb(r,e,t){const i=fb(r,e,t);return hl(i)}function mb(r){return r&&r.includes("urn:recap:")}function wb(r,e){const t=Ei(r),i=Ei(e),s=bb(t,i);return hl(s)}function bb(r,e){or(r),or(e);const t=Object.keys(r.att).concat(Object.keys(e.att)).sort((s,n)=>s.localeCompare(n)),i={att:{}};return t.forEach(s=>{var n,o;Object.keys(((n=r.att)==null?void 0:n[s])||{}).concat(Object.keys(((o=e.att)==null?void 0:o[s])||{})).sort((a,c)=>a.localeCompare(c)).forEach(a=>{var c,u;i.att[s]=ub(cb({},i.att[s]),{[a]:((c=r.att[s])==null?void 0:c[a])||((u=e.att[s])==null?void 0:u[a])})})}),i}function vb(r="",e){or(e);const t="I further authorize the stated URI to perform the following actions on my behalf: ";if(r.includes(t))return r;const i=[];let s=0;Object.keys(e.att).forEach(a=>{const c=Object.keys(e.att[a]).map(l=>({ability:l.split("/")[0],action:l.split("/")[1]}));c.sort((l,d)=>l.action.localeCompare(d.action));const u={};c.forEach(l=>{u[l.ability]||(u[l.ability]=[]),u[l.ability].push(l.action)});const h=Object.keys(u).map(l=>(s++,`(${s}) '${l}': '${u[l].join("', '")}' for '${a}'.`));i.push(h.join(", ").replace(".,","."))});const n=i.join(" "),o=`${t}${n}`;return`${r?r+" ":""}${o}`}function cc(r){var e;const t=Ei(r);or(t);const i=(e=t.att)==null?void 0:e.eip155;return i?Object.keys(i).map(s=>s.split("/")[1]):[]}function uc(r){const e=Ei(r);or(e);const t=[];return Object.values(e.att).forEach(i=>{Object.values(i).forEach(s=>{var n;(n=s==null?void 0:s[0])!=null&&n.chains&&t.push(s[0].chains)})}),[...new Set(t.flat())]}function ns(r){if(!r)return;const e=r==null?void 0:r[r.length-1];return mb(e)?e:void 0}function nn(r){if(!Number.isSafeInteger(r)||r<0)throw new Error("positive integer expected, got "+r)}function ll(r){return r instanceof Uint8Array||ArrayBuffer.isView(r)&&r.constructor.name==="Uint8Array"}function Ke(r,...e){if(!ll(r))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(r.length))throw new Error("Uint8Array expected of length "+e+", got length="+r.length)}function hc(r,e=!0){if(r.destroyed)throw new Error("Hash instance has been destroyed");if(e&&r.finished)throw new Error("Hash#digest() has already been called")}function Eb(r,e){Ke(r);const t=e.outputLen;if(r.length<t)throw new Error("digestInto() expects output buffer of length at least "+t)}function lc(r){if(typeof r!="boolean")throw new Error(`boolean expected, not ${r}`)}const zt=r=>new Uint32Array(r.buffer,r.byteOffset,Math.floor(r.byteLength/4)),_b=r=>new DataView(r.buffer,r.byteOffset,r.byteLength),Ib=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!Ib)throw new Error("Non little-endian hardware is not supported");function $b(r){if(typeof r!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(r))}function Wn(r){if(typeof r=="string")r=$b(r);else if(ll(r))r=Gn(r);else throw new Error("Uint8Array expected, got "+typeof r);return r}function Sb(r,e){if(e==null||typeof e!="object")throw new Error("options must be defined");return Object.assign(r,e)}function Db(r,e){if(r.length!==e.length)return!1;let t=0;for(let i=0;i<r.length;i++)t|=r[i]^e[i];return t===0}const Ob=(r,e)=>{function t(i,...s){if(Ke(i),r.nonceLength!==void 0){const u=s[0];if(!u)throw new Error("nonce / iv required");r.varSizeNonce?Ke(u):Ke(u,r.nonceLength)}const n=r.tagLength;n&&s[1]!==void 0&&Ke(s[1]);const o=e(i,...s),a=(u,h)=>{if(h!==void 0){if(u!==2)throw new Error("cipher output not supported");Ke(h)}};let c=!1;return{encrypt(u,h){if(c)throw new Error("cannot encrypt() twice with same key + nonce");return c=!0,Ke(u),a(o.encrypt.length,h),o.encrypt(u,h)},decrypt(u,h){if(Ke(u),n&&u.length<n)throw new Error("invalid ciphertext length: smaller than tagLength="+n);return a(o.decrypt.length,h),o.decrypt(u,h)}}}return Object.assign(t,r),t};function dc(r,e,t=!0){if(e===void 0)return new Uint8Array(r);if(e.length!==r)throw new Error("invalid output length, expected "+r+", got: "+e.length);if(t&&!Pb(e))throw new Error("invalid output, must be aligned");return e}function pc(r,e,t,i){if(typeof r.setBigUint64=="function")return r.setBigUint64(e,t,i);const s=BigInt(32),n=BigInt(4294967295),o=Number(t>>s&n),a=Number(t&n);r.setUint32(e+4,o,i),r.setUint32(e+0,a,i)}function Pb(r){return r.byteOffset%4===0}function Gn(r){return Uint8Array.from(r)}function qr(...r){for(let e=0;e<r.length;e++)r[e].fill(0)}const dl=r=>Uint8Array.from(r.split("").map(e=>e.charCodeAt(0))),Ab=dl("expand 16-byte k"),xb=dl("expand 32-byte k"),Cb=zt(Ab),Tb=zt(xb);function J(r,e){return r<<e|r>>>32-e}function Yn(r){return r.byteOffset%4===0}const Ki=64,Rb=16,pl=2**32-1,fc=new Uint32Array;function Nb(r,e,t,i,s,n,o,a){const c=s.length,u=new Uint8Array(Ki),h=zt(u),l=Yn(s)&&Yn(n),d=l?zt(s):fc,f=l?zt(n):fc;for(let p=0;p<c;o++){if(r(e,t,i,h,o,a),o>=pl)throw new Error("arx: counter overflow");const g=Math.min(Ki,c-p);if(l&&g===Ki){const b=p/4;if(p%4!==0)throw new Error("arx: invalid block position");for(let $=0,v;$<Rb;$++)v=b+$,f[v]=d[v]^h[$];p+=Ki;continue}for(let b=0,$;b<g;b++)$=p+b,n[$]=s[$]^u[b];p+=g}}function jb(r,e){const{allowShortKeys:t,extendNonceFn:i,counterLength:s,counterRight:n,rounds:o}=Sb({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},e);if(typeof r!="function")throw new Error("core must be a function");return nn(s),nn(o),lc(n),lc(t),(a,c,u,h,l=0)=>{Ke(a),Ke(c),Ke(u);const d=u.length;if(h===void 0&&(h=new Uint8Array(d)),Ke(h),nn(l),l<0||l>=pl)throw new Error("arx: counter overflow");if(h.length<d)throw new Error(`arx: output (${h.length}) is shorter than data (${d})`);const f=[];let p=a.length,g,b;if(p===32)f.push(g=Gn(a)),b=Tb;else if(p===16&&t)g=new Uint8Array(32),g.set(a),g.set(a,16),b=Cb,f.push(g);else throw new Error(`arx: invalid 32-byte key, got length=${p}`);Yn(c)||f.push(c=Gn(c));const $=zt(g);if(i){if(c.length!==24)throw new Error("arx: extended nonce must be 24 bytes");i(b,$,zt(c.subarray(0,16)),$),c=c.subarray(16)}const v=16-s;if(v!==c.length)throw new Error(`arx: nonce must be ${v} or 16 bytes`);if(v!==12){const E=new Uint8Array(12);E.set(c,n?0:12-c.length),c=E,f.push(c)}const S=zt(c);return Nb(r,b,$,S,u,h,l,o),qr(...f),h}}const _e=(r,e)=>r[e++]&255|(r[e++]&255)<<8;class Bb{constructor(e){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,e=Wn(e),Ke(e,32);const t=_e(e,0),i=_e(e,2),s=_e(e,4),n=_e(e,6),o=_e(e,8),a=_e(e,10),c=_e(e,12),u=_e(e,14);this.r[0]=t&8191,this.r[1]=(t>>>13|i<<3)&8191,this.r[2]=(i>>>10|s<<6)&7939,this.r[3]=(s>>>7|n<<9)&8191,this.r[4]=(n>>>4|o<<12)&255,this.r[5]=o>>>1&8190,this.r[6]=(o>>>14|a<<2)&8191,this.r[7]=(a>>>11|c<<5)&8065,this.r[8]=(c>>>8|u<<8)&8191,this.r[9]=u>>>5&127;for(let h=0;h<8;h++)this.pad[h]=_e(e,16+2*h)}process(e,t,i=!1){const s=i?0:2048,{h:n,r:o}=this,a=o[0],c=o[1],u=o[2],h=o[3],l=o[4],d=o[5],f=o[6],p=o[7],g=o[8],b=o[9],$=_e(e,t+0),v=_e(e,t+2),S=_e(e,t+4),E=_e(e,t+6),I=_e(e,t+8),m=_e(e,t+10),_=_e(e,t+12),D=_e(e,t+14);let O=n[0]+($&8191),R=n[1]+(($>>>13|v<<3)&8191),N=n[2]+((v>>>10|S<<6)&8191),j=n[3]+((S>>>7|E<<9)&8191),k=n[4]+((E>>>4|I<<12)&8191),x=n[5]+(I>>>1&8191),y=n[6]+((I>>>14|m<<2)&8191),w=n[7]+((m>>>11|_<<5)&8191),P=n[8]+((_>>>8|D<<8)&8191),C=n[9]+(D>>>5|s),A=0,T=A+O*a+R*(5*b)+N*(5*g)+j*(5*p)+k*(5*f);A=T>>>13,T&=8191,T+=x*(5*d)+y*(5*l)+w*(5*h)+P*(5*u)+C*(5*c),A+=T>>>13,T&=8191;let F=A+O*c+R*a+N*(5*b)+j*(5*g)+k*(5*p);A=F>>>13,F&=8191,F+=x*(5*f)+y*(5*d)+w*(5*l)+P*(5*h)+C*(5*u),A+=F>>>13,F&=8191;let M=A+O*u+R*c+N*a+j*(5*b)+k*(5*g);A=M>>>13,M&=8191,M+=x*(5*p)+y*(5*f)+w*(5*d)+P*(5*l)+C*(5*h),A+=M>>>13,M&=8191;let z=A+O*h+R*u+N*c+j*a+k*(5*b);A=z>>>13,z&=8191,z+=x*(5*g)+y*(5*p)+w*(5*f)+P*(5*d)+C*(5*l),A+=z>>>13,z&=8191;let q=A+O*l+R*h+N*u+j*c+k*a;A=q>>>13,q&=8191,q+=x*(5*b)+y*(5*g)+w*(5*p)+P*(5*f)+C*(5*d),A+=q>>>13,q&=8191;let H=A+O*d+R*l+N*h+j*u+k*c;A=H>>>13,H&=8191,H+=x*a+y*(5*b)+w*(5*g)+P*(5*p)+C*(5*f),A+=H>>>13,H&=8191;let V=A+O*f+R*d+N*l+j*h+k*u;A=V>>>13,V&=8191,V+=x*c+y*a+w*(5*b)+P*(5*g)+C*(5*p),A+=V>>>13,V&=8191;let ne=A+O*p+R*f+N*d+j*l+k*h;A=ne>>>13,ne&=8191,ne+=x*u+y*c+w*a+P*(5*b)+C*(5*g),A+=ne>>>13,ne&=8191;let ee=A+O*g+R*p+N*f+j*d+k*l;A=ee>>>13,ee&=8191,ee+=x*h+y*u+w*c+P*a+C*(5*b),A+=ee>>>13,ee&=8191;let Y=A+O*b+R*g+N*p+j*f+k*d;A=Y>>>13,Y&=8191,Y+=x*l+y*h+w*u+P*c+C*a,A+=Y>>>13,Y&=8191,A=(A<<2)+A|0,A=A+T|0,T=A&8191,A=A>>>13,F+=A,n[0]=T,n[1]=F,n[2]=M,n[3]=z,n[4]=q,n[5]=H,n[6]=V,n[7]=ne,n[8]=ee,n[9]=Y}finalize(){const{h:e,pad:t}=this,i=new Uint16Array(10);let s=e[1]>>>13;e[1]&=8191;for(let a=2;a<10;a++)e[a]+=s,s=e[a]>>>13,e[a]&=8191;e[0]+=s*5,s=e[0]>>>13,e[0]&=8191,e[1]+=s,s=e[1]>>>13,e[1]&=8191,e[2]+=s,i[0]=e[0]+5,s=i[0]>>>13,i[0]&=8191;for(let a=1;a<10;a++)i[a]=e[a]+s,s=i[a]>>>13,i[a]&=8191;i[9]-=8192;let n=(s^1)-1;for(let a=0;a<10;a++)i[a]&=n;n=~n;for(let a=0;a<10;a++)e[a]=e[a]&n|i[a];e[0]=(e[0]|e[1]<<13)&65535,e[1]=(e[1]>>>3|e[2]<<10)&65535,e[2]=(e[2]>>>6|e[3]<<7)&65535,e[3]=(e[3]>>>9|e[4]<<4)&65535,e[4]=(e[4]>>>12|e[5]<<1|e[6]<<14)&65535,e[5]=(e[6]>>>2|e[7]<<11)&65535,e[6]=(e[7]>>>5|e[8]<<8)&65535,e[7]=(e[8]>>>8|e[9]<<5)&65535;let o=e[0]+t[0];e[0]=o&65535;for(let a=1;a<8;a++)o=(e[a]+t[a]|0)+(o>>>16)|0,e[a]=o&65535;qr(i)}update(e){hc(this);const{buffer:t,blockLen:i}=this;e=Wn(e);const s=e.length;for(let n=0;n<s;){const o=Math.min(i-this.pos,s-n);if(o===i){for(;i<=s-n;n+=i)this.process(e,n);continue}t.set(e.subarray(n,n+o),this.pos),this.pos+=o,n+=o,this.pos===i&&(this.process(t,0,!1),this.pos=0)}return this}destroy(){qr(this.h,this.r,this.buffer,this.pad)}digestInto(e){hc(this),Eb(e,this),this.finished=!0;const{buffer:t,h:i}=this;let{pos:s}=this;if(s){for(t[s++]=1;s<16;s++)t[s]=0;this.process(t,0,!0)}this.finalize();let n=0;for(let o=0;o<8;o++)e[n++]=i[o]>>>0,e[n++]=i[o]>>>8;return e}digest(){const{buffer:e,outputLen:t}=this;this.digestInto(e);const i=e.slice(0,t);return this.destroy(),i}}function Lb(r){const e=(i,s)=>r(s).update(Wn(i)).digest(),t=r(new Uint8Array(32));return e.outputLen=t.outputLen,e.blockLen=t.blockLen,e.create=i=>r(i),e}const Ub=Lb(r=>new Bb(r));function Fb(r,e,t,i,s,n=20){let o=r[0],a=r[1],c=r[2],u=r[3],h=e[0],l=e[1],d=e[2],f=e[3],p=e[4],g=e[5],b=e[6],$=e[7],v=s,S=t[0],E=t[1],I=t[2],m=o,_=a,D=c,O=u,R=h,N=l,j=d,k=f,x=p,y=g,w=b,P=$,C=v,A=S,T=E,F=I;for(let z=0;z<n;z+=2)m=m+R|0,C=J(C^m,16),x=x+C|0,R=J(R^x,12),m=m+R|0,C=J(C^m,8),x=x+C|0,R=J(R^x,7),_=_+N|0,A=J(A^_,16),y=y+A|0,N=J(N^y,12),_=_+N|0,A=J(A^_,8),y=y+A|0,N=J(N^y,7),D=D+j|0,T=J(T^D,16),w=w+T|0,j=J(j^w,12),D=D+j|0,T=J(T^D,8),w=w+T|0,j=J(j^w,7),O=O+k|0,F=J(F^O,16),P=P+F|0,k=J(k^P,12),O=O+k|0,F=J(F^O,8),P=P+F|0,k=J(k^P,7),m=m+N|0,F=J(F^m,16),w=w+F|0,N=J(N^w,12),m=m+N|0,F=J(F^m,8),w=w+F|0,N=J(N^w,7),_=_+j|0,C=J(C^_,16),P=P+C|0,j=J(j^P,12),_=_+j|0,C=J(C^_,8),P=P+C|0,j=J(j^P,7),D=D+k|0,A=J(A^D,16),x=x+A|0,k=J(k^x,12),D=D+k|0,A=J(A^D,8),x=x+A|0,k=J(k^x,7),O=O+R|0,T=J(T^O,16),y=y+T|0,R=J(R^y,12),O=O+R|0,T=J(T^O,8),y=y+T|0,R=J(R^y,7);let M=0;i[M++]=o+m|0,i[M++]=a+_|0,i[M++]=c+D|0,i[M++]=u+O|0,i[M++]=h+R|0,i[M++]=l+N|0,i[M++]=d+j|0,i[M++]=f+k|0,i[M++]=p+x|0,i[M++]=g+y|0,i[M++]=b+w|0,i[M++]=$+P|0,i[M++]=v+C|0,i[M++]=S+A|0,i[M++]=E+T|0,i[M++]=I+F|0}const qb=jb(Fb,{counterRight:!1,counterLength:4,allowShortKeys:!1}),Mb=new Uint8Array(16),gc=(r,e)=>{r.update(e);const t=e.length%16;t&&r.update(Mb.subarray(t))},kb=new Uint8Array(32);function yc(r,e,t,i,s){const n=r(e,t,kb),o=Ub.create(n);s&&gc(o,s),gc(o,i);const a=new Uint8Array(16),c=_b(a);pc(c,0,BigInt(s?s.length:0),!0),pc(c,8,BigInt(i.length),!0),o.update(a);const u=o.digest();return qr(n,a),u}const zb=r=>(e,t,i)=>({encrypt(s,n){const o=s.length;n=dc(o+16,n,!1),n.set(s);const a=n.subarray(0,-16);r(e,t,a,a,1);const c=yc(r,e,t,a,i);return n.set(c,o),qr(c),n},decrypt(s,n){n=dc(s.length-16,n,!1);const o=s.subarray(0,-16),a=s.subarray(-16),c=yc(r,e,t,o,i);if(!Db(a,c))throw new Error("invalid tag");return n.set(s.subarray(0,-16)),r(e,t,n,n,1),qr(c),n}}),fl=Ob({blockSize:64,nonceLength:12,tagLength:16},zb(qb));let gl=class extends jo{constructor(e,t){super(),this.finished=!1,this.destroyed=!1,No(e);const i=Fr(t);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const s=this.blockLen,n=new Uint8Array(s);n.set(i.length>s?e.create().update(i).digest():i);for(let o=0;o<n.length;o++)n[o]^=54;this.iHash.update(n),this.oHash=e.create();for(let o=0;o<n.length;o++)n[o]^=106;this.oHash.update(n),n.fill(0)}update(e){return Ur(this),this.iHash.update(e),this}digestInto(e){Ur(this),Ci(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:t,iHash:i,finished:s,destroyed:n,blockLen:o,outputLen:a}=this;return e=e,e.finished=s,e.destroyed=n,e.blockLen=o,e.outputLen=a,e.oHash=t._cloneInto(e.oHash),e.iHash=i._cloneInto(e.iHash),e}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}};const As=(r,e,t)=>new gl(r,e).update(t).digest();As.create=(r,e)=>new gl(r,e);function Hb(r,e,t){return No(r),t===void 0&&(t=new Uint8Array(r.outputLen)),As(r,Fr(t),Fr(e))}const on=new Uint8Array([0]),mc=new Uint8Array;function Vb(r,e,t,i=32){if(No(r),vi(i),i>255*r.outputLen)throw new Error("Length should be <= 255*HashLen");const s=Math.ceil(i/r.outputLen);t===void 0&&(t=mc);const n=new Uint8Array(s*r.outputLen),o=As.create(r,e),a=o._cloneInto(),c=new Uint8Array(o.outputLen);for(let u=0;u<s;u++)on[0]=u+1,a.update(u===0?mc:c).update(t).update(on).digestInto(c),n.set(c,r.outputLen*u),o._cloneInto(a);return o.destroy(),a.destroy(),c.fill(0),on.fill(0),n.slice(0,i)}const Kb=(r,e,t,i,s)=>Vb(r,Hb(r,e,t),i,s);function Wb(r,e,t,i){if(typeof r.setBigUint64=="function")return r.setBigUint64(e,t,i);const s=BigInt(32),n=BigInt(4294967295),o=Number(t>>s&n),a=Number(t&n),c=i?4:0,u=i?0:4;r.setUint32(e+c,o,i),r.setUint32(e+u,a,i)}function Gb(r,e,t){return r&e^~r&t}function Yb(r,e,t){return r&e^r&t^e&t}let Jb=class extends jo{constructor(e,t,i,s){super(),this.blockLen=e,this.outputLen=t,this.padOffset=i,this.isLE=s,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=sn(this.buffer)}update(e){Ur(this);const{view:t,buffer:i,blockLen:s}=this;e=Fr(e);const n=e.length;for(let o=0;o<n;){const a=Math.min(s-this.pos,n-o);if(a===s){const c=sn(e);for(;s<=n-o;o+=s)this.process(c,o);continue}i.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===s&&(this.process(t,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){Ur(this),rl(e,this),this.finished=!0;const{buffer:t,view:i,blockLen:s,isLE:n}=this;let{pos:o}=this;t[o++]=128,this.buffer.subarray(o).fill(0),this.padOffset>s-o&&(this.process(i,0),o=0);for(let l=o;l<s;l++)t[l]=0;Wb(i,s-8,BigInt(this.length*8),n),this.process(i,0);const a=sn(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const u=c/4,h=this.get();if(u>h.length)throw new Error("_sha2: outputLen bigger than state");for(let l=0;l<u;l++)a.setUint32(4*l,h[l],n)}digest(){const{buffer:e,outputLen:t}=this;this.digestInto(e);const i=e.slice(0,t);return this.destroy(),i}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:t,buffer:i,length:s,finished:n,destroyed:o,pos:a}=this;return e.length=s,e.pos=a,e.finished=n,e.destroyed=o,s%t&&e.buffer.set(i),e}};const Zb=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Lt=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Ut=new Uint32Array(64);class Qb extends Jb{constructor(){super(64,32,8,!1),this.A=Lt[0]|0,this.B=Lt[1]|0,this.C=Lt[2]|0,this.D=Lt[3]|0,this.E=Lt[4]|0,this.F=Lt[5]|0,this.G=Lt[6]|0,this.H=Lt[7]|0}get(){const{A:e,B:t,C:i,D:s,E:n,F:o,G:a,H:c}=this;return[e,t,i,s,n,o,a,c]}set(e,t,i,s,n,o,a,c){this.A=e|0,this.B=t|0,this.C=i|0,this.D=s|0,this.E=n|0,this.F=o|0,this.G=a|0,this.H=c|0}process(e,t){for(let l=0;l<16;l++,t+=4)Ut[l]=e.getUint32(t,!1);for(let l=16;l<64;l++){const d=Ut[l-15],f=Ut[l-2],p=ft(d,7)^ft(d,18)^d>>>3,g=ft(f,17)^ft(f,19)^f>>>10;Ut[l]=g+Ut[l-7]+p+Ut[l-16]|0}let{A:i,B:s,C:n,D:o,E:a,F:c,G:u,H:h}=this;for(let l=0;l<64;l++){const d=ft(a,6)^ft(a,11)^ft(a,25),f=h+d+Gb(a,c,u)+Zb[l]+Ut[l]|0,p=(ft(i,2)^ft(i,13)^ft(i,22))+Yb(i,s,n)|0;h=u,u=c,c=a,a=o+f|0,o=n,n=s,s=i,i=f+p|0}i=i+this.A|0,s=s+this.B|0,n=n+this.C|0,o=o+this.D|0,a=a+this.E|0,c=c+this.F|0,u=u+this.G|0,h=h+this.H|0,this.set(i,s,n,o,a,c,u,h)}roundClean(){Ut.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}const Ti=il(()=>new Qb);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const xs=BigInt(0),Cs=BigInt(1),Xb=BigInt(2);function ar(r){return r instanceof Uint8Array||ArrayBuffer.isView(r)&&r.constructor.name==="Uint8Array"}function Ri(r){if(!ar(r))throw new Error("Uint8Array expected")}function Mr(r,e){if(typeof e!="boolean")throw new Error(r+" boolean expected, got "+e)}const ev=Array.from({length:256},(r,e)=>e.toString(16).padStart(2,"0"));function kr(r){Ri(r);let e="";for(let t=0;t<r.length;t++)e+=ev[r[t]];return e}function jr(r){const e=r.toString(16);return e.length&1?"0"+e:e}function Lo(r){if(typeof r!="string")throw new Error("hex string expected, got "+typeof r);return r===""?xs:BigInt("0x"+r)}const Dt={_0:48,_9:57,A:65,F:70,a:97,f:102};function wc(r){if(r>=Dt._0&&r<=Dt._9)return r-Dt._0;if(r>=Dt.A&&r<=Dt.F)return r-(Dt.A-10);if(r>=Dt.a&&r<=Dt.f)return r-(Dt.a-10)}function zr(r){if(typeof r!="string")throw new Error("hex string expected, got "+typeof r);const e=r.length,t=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const i=new Uint8Array(t);for(let s=0,n=0;s<t;s++,n+=2){const o=wc(r.charCodeAt(n)),a=wc(r.charCodeAt(n+1));if(o===void 0||a===void 0){const c=r[n]+r[n+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+n)}i[s]=o*16+a}return i}function rr(r){return Lo(kr(r))}function _i(r){return Ri(r),Lo(kr(Uint8Array.from(r).reverse()))}function Hr(r,e){return zr(r.toString(16).padStart(e*2,"0"))}function Ts(r,e){return Hr(r,e).reverse()}function tv(r){return zr(jr(r))}function Ve(r,e,t){let i;if(typeof e=="string")try{i=zr(e)}catch(n){throw new Error(r+" must be hex string or Uint8Array, cause: "+n)}else if(ar(e))i=Uint8Array.from(e);else throw new Error(r+" must be hex string or Uint8Array");const s=i.length;if(typeof t=="number"&&s!==t)throw new Error(r+" of length "+t+" expected, got "+s);return i}function Ii(...r){let e=0;for(let i=0;i<r.length;i++){const s=r[i];Ri(s),e+=s.length}const t=new Uint8Array(e);for(let i=0,s=0;i<r.length;i++){const n=r[i];t.set(n,s),s+=n.length}return t}function rv(r,e){if(r.length!==e.length)return!1;let t=0;for(let i=0;i<r.length;i++)t|=r[i]^e[i];return t===0}function iv(r){if(typeof r!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(r))}const an=r=>typeof r=="bigint"&&xs<=r;function Rs(r,e,t){return an(r)&&an(e)&&an(t)&&e<=r&&r<t}function Tt(r,e,t,i){if(!Rs(e,t,i))throw new Error("expected valid "+r+": "+t+" <= n < "+i+", got "+e)}function yl(r){let e;for(e=0;r>xs;r>>=Cs,e+=1);return e}function sv(r,e){return r>>BigInt(e)&Cs}function nv(r,e,t){return r|(t?Cs:xs)<<BigInt(e)}const Uo=r=>(Xb<<BigInt(r-1))-Cs,cn=r=>new Uint8Array(r),bc=r=>Uint8Array.from(r);function ml(r,e,t){if(typeof r!="number"||r<2)throw new Error("hashLen must be a number");if(typeof e!="number"||e<2)throw new Error("qByteLen must be a number");if(typeof t!="function")throw new Error("hmacFn must be a function");let i=cn(r),s=cn(r),n=0;const o=()=>{i.fill(1),s.fill(0),n=0},a=(...h)=>t(s,i,...h),c=(h=cn())=>{s=a(bc([0]),h),i=a(),h.length!==0&&(s=a(bc([1]),h),i=a())},u=()=>{if(n++>=1e3)throw new Error("drbg: tried 1000 values");let h=0;const l=[];for(;h<e;){i=a();const d=i.slice();l.push(d),h+=i.length}return Ii(...l)};return(h,l)=>{o(),c(h);let d;for(;!(d=l(u()));)c();return o(),d}}const ov={bigint:r=>typeof r=="bigint",function:r=>typeof r=="function",boolean:r=>typeof r=="boolean",string:r=>typeof r=="string",stringOrUint8Array:r=>typeof r=="string"||ar(r),isSafeInteger:r=>Number.isSafeInteger(r),array:r=>Array.isArray(r),field:(r,e)=>e.Fp.isValid(r),hash:r=>typeof r=="function"&&Number.isSafeInteger(r.outputLen)};function Yr(r,e,t={}){const i=(s,n,o)=>{const a=ov[n];if(typeof a!="function")throw new Error("invalid validator function");const c=r[s];if(!(o&&c===void 0)&&!a(c,r))throw new Error("param "+String(s)+" is invalid. Expected "+n+", got "+c)};for(const[s,n]of Object.entries(e))i(s,n,!1);for(const[s,n]of Object.entries(t))i(s,n,!0);return r}const av=()=>{throw new Error("not implemented")};function Jn(r){const e=new WeakMap;return(t,...i)=>{const s=e.get(t);if(s!==void 0)return s;const n=r(t,...i);return e.set(t,n),n}}var cv=Object.freeze({__proto__:null,isBytes:ar,abytes:Ri,abool:Mr,bytesToHex:kr,numberToHexUnpadded:jr,hexToNumber:Lo,hexToBytes:zr,bytesToNumberBE:rr,bytesToNumberLE:_i,numberToBytesBE:Hr,numberToBytesLE:Ts,numberToVarBytesBE:tv,ensureBytes:Ve,concatBytes:Ii,equalBytes:rv,utf8ToBytes:iv,inRange:Rs,aInRange:Tt,bitLen:yl,bitGet:sv,bitSet:nv,bitMask:Uo,createHmacDrbg:ml,validateObject:Yr,notImplemented:av,memoized:Jn});const ve=BigInt(0),ue=BigInt(1),Zt=BigInt(2),uv=BigInt(3),Zn=BigInt(4),vc=BigInt(5),Ec=BigInt(8);function Fe(r,e){const t=r%e;return t>=ve?t:e+t}function wl(r,e,t){if(e<ve)throw new Error("invalid exponent, negatives unsupported");if(t<=ve)throw new Error("invalid modulus");if(t===ue)return ve;let i=ue;for(;e>ve;)e&ue&&(i=i*r%t),r=r*r%t,e>>=ue;return i}function ut(r,e,t){let i=r;for(;e-- >ve;)i*=i,i%=t;return i}function Qn(r,e){if(r===ve)throw new Error("invert: expected non-zero number");if(e<=ve)throw new Error("invert: expected positive modulus, got "+e);let t=Fe(r,e),i=e,s=ve,n=ue;for(;t!==ve;){const o=i/t,a=i%t,c=s-n*o;i=t,t=a,s=n,n=c}if(i!==ue)throw new Error("invert: does not exist");return Fe(s,e)}function hv(r){const e=(r-ue)/Zt;let t,i,s;for(t=r-ue,i=0;t%Zt===ve;t/=Zt,i++);for(s=Zt;s<r&&wl(s,e,r)!==r-ue;s++)if(s>1e3)throw new Error("Cannot find square root: likely non-prime P");if(i===1){const o=(r+ue)/Zn;return function(a,c){const u=a.pow(c,o);if(!a.eql(a.sqr(u),c))throw new Error("Cannot find square root");return u}}const n=(t+ue)/Zt;return function(o,a){if(o.pow(a,e)===o.neg(o.ONE))throw new Error("Cannot find square root");let c=i,u=o.pow(o.mul(o.ONE,s),t),h=o.pow(a,n),l=o.pow(a,t);for(;!o.eql(l,o.ONE);){if(o.eql(l,o.ZERO))return o.ZERO;let d=1;for(let p=o.sqr(l);d<c&&!o.eql(p,o.ONE);d++)p=o.sqr(p);const f=o.pow(u,ue<<BigInt(c-d-1));u=o.sqr(f),h=o.mul(h,f),l=o.mul(l,u),c=d}return h}}function lv(r){if(r%Zn===uv){const e=(r+ue)/Zn;return function(t,i){const s=t.pow(i,e);if(!t.eql(t.sqr(s),i))throw new Error("Cannot find square root");return s}}if(r%Ec===vc){const e=(r-vc)/Ec;return function(t,i){const s=t.mul(i,Zt),n=t.pow(s,e),o=t.mul(i,n),a=t.mul(t.mul(o,Zt),n),c=t.mul(o,t.sub(a,t.ONE));if(!t.eql(t.sqr(c),i))throw new Error("Cannot find square root");return c}}return hv(r)}const dv=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function pv(r){const e={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},t=dv.reduce((i,s)=>(i[s]="function",i),e);return Yr(r,t)}function fv(r,e,t){if(t<ve)throw new Error("invalid exponent, negatives unsupported");if(t===ve)return r.ONE;if(t===ue)return e;let i=r.ONE,s=e;for(;t>ve;)t&ue&&(i=r.mul(i,s)),s=r.sqr(s),t>>=ue;return i}function gv(r,e){const t=new Array(e.length),i=e.reduce((n,o,a)=>r.is0(o)?n:(t[a]=n,r.mul(n,o)),r.ONE),s=r.inv(i);return e.reduceRight((n,o,a)=>r.is0(o)?n:(t[a]=r.mul(n,t[a]),r.mul(n,o)),s),t}function bl(r,e){const t=e!==void 0?e:r.toString(2).length,i=Math.ceil(t/8);return{nBitLength:t,nByteLength:i}}function vl(r,e,t=!1,i={}){if(r<=ve)throw new Error("invalid field: expected ORDER > 0, got "+r);const{nBitLength:s,nByteLength:n}=bl(r,e);if(n>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let o;const a=Object.freeze({ORDER:r,isLE:t,BITS:s,BYTES:n,MASK:Uo(s),ZERO:ve,ONE:ue,create:c=>Fe(c,r),isValid:c=>{if(typeof c!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof c);return ve<=c&&c<r},is0:c=>c===ve,isOdd:c=>(c&ue)===ue,neg:c=>Fe(-c,r),eql:(c,u)=>c===u,sqr:c=>Fe(c*c,r),add:(c,u)=>Fe(c+u,r),sub:(c,u)=>Fe(c-u,r),mul:(c,u)=>Fe(c*u,r),pow:(c,u)=>fv(a,c,u),div:(c,u)=>Fe(c*Qn(u,r),r),sqrN:c=>c*c,addN:(c,u)=>c+u,subN:(c,u)=>c-u,mulN:(c,u)=>c*u,inv:c=>Qn(c,r),sqrt:i.sqrt||(c=>(o||(o=lv(r)),o(a,c))),invertBatch:c=>gv(a,c),cmov:(c,u,h)=>h?u:c,toBytes:c=>t?Ts(c,n):Hr(c,n),fromBytes:c=>{if(c.length!==n)throw new Error("Field.fromBytes: expected "+n+" bytes, got "+c.length);return t?_i(c):rr(c)}});return Object.freeze(a)}function El(r){if(typeof r!="bigint")throw new Error("field order must be bigint");const e=r.toString(2).length;return Math.ceil(e/8)}function _l(r){const e=El(r);return e+Math.ceil(e/2)}function yv(r,e,t=!1){const i=r.length,s=El(e),n=_l(e);if(i<16||i<n||i>1024)throw new Error("expected "+n+"-1024 bytes of input, got "+i);const o=t?_i(r):rr(r),a=Fe(o,e-ue)+ue;return t?Ts(a,s):Hr(a,s)}const _c=BigInt(0),Wi=BigInt(1);function un(r,e){const t=e.negate();return r?t:e}function Il(r,e){if(!Number.isSafeInteger(r)||r<=0||r>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+r)}function hn(r,e){Il(r,e);const t=Math.ceil(e/r)+1,i=2**(r-1);return{windows:t,windowSize:i}}function mv(r,e){if(!Array.isArray(r))throw new Error("array expected");r.forEach((t,i)=>{if(!(t instanceof e))throw new Error("invalid point at index "+i)})}function wv(r,e){if(!Array.isArray(r))throw new Error("array of scalars expected");r.forEach((t,i)=>{if(!e.isValid(t))throw new Error("invalid scalar at index "+i)})}const ln=new WeakMap,$l=new WeakMap;function dn(r){return $l.get(r)||1}function bv(r,e){return{constTimeNegate:un,hasPrecomputes(t){return dn(t)!==1},unsafeLadder(t,i,s=r.ZERO){let n=t;for(;i>_c;)i&Wi&&(s=s.add(n)),n=n.double(),i>>=Wi;return s},precomputeWindow(t,i){const{windows:s,windowSize:n}=hn(i,e),o=[];let a=t,c=a;for(let u=0;u<s;u++){c=a,o.push(c);for(let h=1;h<n;h++)c=c.add(a),o.push(c);a=c.double()}return o},wNAF(t,i,s){const{windows:n,windowSize:o}=hn(t,e);let a=r.ZERO,c=r.BASE;const u=BigInt(2**t-1),h=2**t,l=BigInt(t);for(let d=0;d<n;d++){const f=d*o;let p=Number(s&u);s>>=l,p>o&&(p-=h,s+=Wi);const g=f,b=f+Math.abs(p)-1,$=d%2!==0,v=p<0;p===0?c=c.add(un($,i[g])):a=a.add(un(v,i[b]))}return{p:a,f:c}},wNAFUnsafe(t,i,s,n=r.ZERO){const{windows:o,windowSize:a}=hn(t,e),c=BigInt(2**t-1),u=2**t,h=BigInt(t);for(let l=0;l<o;l++){const d=l*a;if(s===_c)break;let f=Number(s&c);if(s>>=h,f>a&&(f-=u,s+=Wi),f===0)continue;let p=i[d+Math.abs(f)-1];f<0&&(p=p.negate()),n=n.add(p)}return n},getPrecomputes(t,i,s){let n=ln.get(i);return n||(n=this.precomputeWindow(i,t),t!==1&&ln.set(i,s(n))),n},wNAFCached(t,i,s){const n=dn(t);return this.wNAF(n,this.getPrecomputes(n,t,s),i)},wNAFCachedUnsafe(t,i,s,n){const o=dn(t);return o===1?this.unsafeLadder(t,i,n):this.wNAFUnsafe(o,this.getPrecomputes(o,t,s),i,n)},setWindowSize(t,i){Il(i,e),$l.set(t,i),ln.delete(t)}}}function vv(r,e,t,i){if(mv(t,r),wv(i,e),t.length!==i.length)throw new Error("arrays of points and scalars must have equal length");const s=r.ZERO,n=yl(BigInt(t.length)),o=n>12?n-3:n>4?n-2:n?2:1,a=(1<<o)-1,c=new Array(a+1).fill(s),u=Math.floor((e.BITS-1)/o)*o;let h=s;for(let l=u;l>=0;l-=o){c.fill(s);for(let f=0;f<i.length;f++){const p=i[f],g=Number(p>>BigInt(l)&BigInt(a));c[g]=c[g].add(t[f])}let d=s;for(let f=c.length-1,p=s;f>0;f--)p=p.add(c[f]),d=d.add(p);if(h=h.add(d),l!==0)for(let f=0;f<o;f++)h=h.double()}return h}function Sl(r){return pv(r.Fp),Yr(r,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...bl(r.n,r.nBitLength),...r,p:r.Fp.ORDER})}BigInt(0),BigInt(1),BigInt(2),BigInt(8);const wr=BigInt(0),pn=BigInt(1);function Ev(r){return Yr(r,{a:"bigint"},{montgomeryBits:"isSafeInteger",nByteLength:"isSafeInteger",adjustScalarBytes:"function",domain:"function",powPminus2:"function",Gu:"bigint"}),Object.freeze({...r})}function _v(r){const e=Ev(r),{P:t}=e,i=v=>Fe(v,t),s=e.montgomeryBits,n=Math.ceil(s/8),o=e.nByteLength,a=e.adjustScalarBytes||(v=>v),c=e.powPminus2||(v=>wl(v,t-BigInt(2),t));function u(v,S,E){const I=i(v*(S-E));return S=i(S-I),E=i(E+I),[S,E]}const h=(e.a-BigInt(2))/BigInt(4);function l(v,S){Tt("u",v,wr,t),Tt("scalar",S,wr,t);const E=S,I=v;let m=pn,_=wr,D=v,O=pn,R=wr,N;for(let k=BigInt(s-1);k>=wr;k--){const x=E>>k&pn;R^=x,N=u(R,m,D),m=N[0],D=N[1],N=u(R,_,O),_=N[0],O=N[1],R=x;const y=m+_,w=i(y*y),P=m-_,C=i(P*P),A=w-C,T=D+O,F=D-O,M=i(F*y),z=i(T*P),q=M+z,H=M-z;D=i(q*q),O=i(I*i(H*H)),m=i(w*C),_=i(A*(w+i(h*A)))}N=u(R,m,D),m=N[0],D=N[1],N=u(R,_,O),_=N[0],O=N[1];const j=c(_);return i(m*j)}function d(v){return Ts(i(v),n)}function f(v){const S=Ve("u coordinate",v,n);return o===32&&(S[31]&=127),_i(S)}function p(v){const S=Ve("scalar",v),E=S.length;if(E!==n&&E!==o){let I=""+n+" or "+o;throw new Error("invalid scalar, expected "+I+" bytes, got "+E)}return _i(a(S))}function g(v,S){const E=f(S),I=p(v),m=l(E,I);if(m===wr)throw new Error("invalid private or public key received");return d(m)}const b=d(e.Gu);function $(v){return g(v,b)}return{scalarMult:g,scalarMultBase:$,getSharedSecret:(v,S)=>g(v,S),getPublicKey:v=>$(v),utils:{randomPrivateKey:()=>e.randomBytes(e.nByteLength)},GuBytes:b}}const Xn=BigInt("57896044618658097711785492504343953926634992332820282019728792003956564819949");BigInt(0);const Iv=BigInt(1),Ic=BigInt(2),$v=BigInt(3),Sv=BigInt(5);BigInt(8);function Dv(r){const e=BigInt(10),t=BigInt(20),i=BigInt(40),s=BigInt(80),n=Xn,o=r*r%n*r%n,a=ut(o,Ic,n)*o%n,c=ut(a,Iv,n)*r%n,u=ut(c,Sv,n)*c%n,h=ut(u,e,n)*u%n,l=ut(h,t,n)*h%n,d=ut(l,i,n)*l%n,f=ut(d,s,n)*d%n,p=ut(f,s,n)*d%n,g=ut(p,e,n)*u%n;return{pow_p_5_8:ut(g,Ic,n)*r%n,b2:o}}function Ov(r){return r[0]&=248,r[31]&=127,r[31]|=64,r}const eo=_v({P:Xn,a:BigInt(486662),montgomeryBits:255,nByteLength:32,Gu:BigInt(9),powPminus2:r=>{const e=Xn,{pow_p_5_8:t,b2:i}=Dv(r);return Fe(ut(t,$v,e)*i,e)},adjustScalarBytes:Ov,randomBytes:Gr});function $c(r){r.lowS!==void 0&&Mr("lowS",r.lowS),r.prehash!==void 0&&Mr("prehash",r.prehash)}function Pv(r){const e=Sl(r);Yr(e,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});const{endo:t,Fp:i,a:s}=e;if(t){if(!i.eql(s,i.ZERO))throw new Error("invalid endomorphism, can only be defined for Koblitz curves that have a=0");if(typeof t!="object"||typeof t.beta!="bigint"||typeof t.splitScalar!="function")throw new Error("invalid endomorphism, expected beta: bigint and splitScalar: function")}return Object.freeze({...e})}const{bytesToNumberBE:Av,hexToBytes:xv}=cv;class Cv extends Error{constructor(e=""){super(e)}}const xt={Err:Cv,_tlv:{encode:(r,e)=>{const{Err:t}=xt;if(r<0||r>256)throw new t("tlv.encode: wrong tag");if(e.length&1)throw new t("tlv.encode: unpadded data");const i=e.length/2,s=jr(i);if(s.length/2&128)throw new t("tlv.encode: long form length too big");const n=i>127?jr(s.length/2|128):"";return jr(r)+n+s+e},decode(r,e){const{Err:t}=xt;let i=0;if(r<0||r>256)throw new t("tlv.encode: wrong tag");if(e.length<2||e[i++]!==r)throw new t("tlv.decode: wrong tlv");const s=e[i++],n=!!(s&128);let o=0;if(!n)o=s;else{const c=s&127;if(!c)throw new t("tlv.decode(long): indefinite length not supported");if(c>4)throw new t("tlv.decode(long): byte length is too big");const u=e.subarray(i,i+c);if(u.length!==c)throw new t("tlv.decode: length bytes not complete");if(u[0]===0)throw new t("tlv.decode(long): zero leftmost byte");for(const h of u)o=o<<8|h;if(i+=c,o<128)throw new t("tlv.decode(long): not minimal encoding")}const a=e.subarray(i,i+o);if(a.length!==o)throw new t("tlv.decode: wrong value length");return{v:a,l:e.subarray(i+o)}}},_int:{encode(r){const{Err:e}=xt;if(r<Ct)throw new e("integer: negative integers are not allowed");let t=jr(r);if(Number.parseInt(t[0],16)&8&&(t="00"+t),t.length&1)throw new e("unexpected DER parsing assertion: unpadded hex");return t},decode(r){const{Err:e}=xt;if(r[0]&128)throw new e("invalid signature integer: negative");if(r[0]===0&&!(r[1]&128))throw new e("invalid signature integer: unnecessary leading zero");return Av(r)}},toSig(r){const{Err:e,_int:t,_tlv:i}=xt,s=typeof r=="string"?xv(r):r;Ri(s);const{v:n,l:o}=i.decode(48,s);if(o.length)throw new e("invalid signature: left bytes after parsing");const{v:a,l:c}=i.decode(2,n),{v:u,l:h}=i.decode(2,c);if(h.length)throw new e("invalid signature: left bytes after parsing");return{r:t.decode(a),s:t.decode(u)}},hexFromSig(r){const{_tlv:e,_int:t}=xt,i=e.encode(2,t.encode(r.r)),s=e.encode(2,t.encode(r.s)),n=i+s;return e.encode(48,n)}},Ct=BigInt(0),me=BigInt(1);BigInt(2);const Sc=BigInt(3);BigInt(4);function Tv(r){const e=Pv(r),{Fp:t}=e,i=vl(e.n,e.nBitLength),s=e.toBytes||((g,b,$)=>{const v=b.toAffine();return Ii(Uint8Array.from([4]),t.toBytes(v.x),t.toBytes(v.y))}),n=e.fromBytes||(g=>{const b=g.subarray(1),$=t.fromBytes(b.subarray(0,t.BYTES)),v=t.fromBytes(b.subarray(t.BYTES,2*t.BYTES));return{x:$,y:v}});function o(g){const{a:b,b:$}=e,v=t.sqr(g),S=t.mul(v,g);return t.add(t.add(S,t.mul(g,b)),$)}if(!t.eql(t.sqr(e.Gy),o(e.Gx)))throw new Error("bad generator point: equation left != right");function a(g){return Rs(g,me,e.n)}function c(g){const{allowedPrivateKeyLengths:b,nByteLength:$,wrapPrivateKey:v,n:S}=e;if(b&&typeof g!="bigint"){if(ar(g)&&(g=kr(g)),typeof g!="string"||!b.includes(g.length))throw new Error("invalid private key");g=g.padStart($*2,"0")}let E;try{E=typeof g=="bigint"?g:rr(Ve("private key",g,$))}catch{throw new Error("invalid private key, expected hex or "+$+" bytes, got "+typeof g)}return v&&(E=Fe(E,S)),Tt("private key",E,me,S),E}function u(g){if(!(g instanceof d))throw new Error("ProjectivePoint expected")}const h=Jn((g,b)=>{const{px:$,py:v,pz:S}=g;if(t.eql(S,t.ONE))return{x:$,y:v};const E=g.is0();b==null&&(b=E?t.ONE:t.inv(S));const I=t.mul($,b),m=t.mul(v,b),_=t.mul(S,b);if(E)return{x:t.ZERO,y:t.ZERO};if(!t.eql(_,t.ONE))throw new Error("invZ was invalid");return{x:I,y:m}}),l=Jn(g=>{if(g.is0()){if(e.allowInfinityPoint&&!t.is0(g.py))return;throw new Error("bad point: ZERO")}const{x:b,y:$}=g.toAffine();if(!t.isValid(b)||!t.isValid($))throw new Error("bad point: x or y not FE");const v=t.sqr($),S=o(b);if(!t.eql(v,S))throw new Error("bad point: equation left != right");if(!g.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});class d{constructor(b,$,v){if(this.px=b,this.py=$,this.pz=v,b==null||!t.isValid(b))throw new Error("x required");if($==null||!t.isValid($))throw new Error("y required");if(v==null||!t.isValid(v))throw new Error("z required");Object.freeze(this)}static fromAffine(b){const{x:$,y:v}=b||{};if(!b||!t.isValid($)||!t.isValid(v))throw new Error("invalid affine point");if(b instanceof d)throw new Error("projective point not allowed");const S=E=>t.eql(E,t.ZERO);return S($)&&S(v)?d.ZERO:new d($,v,t.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(b){const $=t.invertBatch(b.map(v=>v.pz));return b.map((v,S)=>v.toAffine($[S])).map(d.fromAffine)}static fromHex(b){const $=d.fromAffine(n(Ve("pointHex",b)));return $.assertValidity(),$}static fromPrivateKey(b){return d.BASE.multiply(c(b))}static msm(b,$){return vv(d,i,b,$)}_setWindowSize(b){p.setWindowSize(this,b)}assertValidity(){l(this)}hasEvenY(){const{y:b}=this.toAffine();if(t.isOdd)return!t.isOdd(b);throw new Error("Field doesn't support isOdd")}equals(b){u(b);const{px:$,py:v,pz:S}=this,{px:E,py:I,pz:m}=b,_=t.eql(t.mul($,m),t.mul(E,S)),D=t.eql(t.mul(v,m),t.mul(I,S));return _&&D}negate(){return new d(this.px,t.neg(this.py),this.pz)}double(){const{a:b,b:$}=e,v=t.mul($,Sc),{px:S,py:E,pz:I}=this;let m=t.ZERO,_=t.ZERO,D=t.ZERO,O=t.mul(S,S),R=t.mul(E,E),N=t.mul(I,I),j=t.mul(S,E);return j=t.add(j,j),D=t.mul(S,I),D=t.add(D,D),m=t.mul(b,D),_=t.mul(v,N),_=t.add(m,_),m=t.sub(R,_),_=t.add(R,_),_=t.mul(m,_),m=t.mul(j,m),D=t.mul(v,D),N=t.mul(b,N),j=t.sub(O,N),j=t.mul(b,j),j=t.add(j,D),D=t.add(O,O),O=t.add(D,O),O=t.add(O,N),O=t.mul(O,j),_=t.add(_,O),N=t.mul(E,I),N=t.add(N,N),O=t.mul(N,j),m=t.sub(m,O),D=t.mul(N,R),D=t.add(D,D),D=t.add(D,D),new d(m,_,D)}add(b){u(b);const{px:$,py:v,pz:S}=this,{px:E,py:I,pz:m}=b;let _=t.ZERO,D=t.ZERO,O=t.ZERO;const R=e.a,N=t.mul(e.b,Sc);let j=t.mul($,E),k=t.mul(v,I),x=t.mul(S,m),y=t.add($,v),w=t.add(E,I);y=t.mul(y,w),w=t.add(j,k),y=t.sub(y,w),w=t.add($,S);let P=t.add(E,m);return w=t.mul(w,P),P=t.add(j,x),w=t.sub(w,P),P=t.add(v,S),_=t.add(I,m),P=t.mul(P,_),_=t.add(k,x),P=t.sub(P,_),O=t.mul(R,w),_=t.mul(N,x),O=t.add(_,O),_=t.sub(k,O),O=t.add(k,O),D=t.mul(_,O),k=t.add(j,j),k=t.add(k,j),x=t.mul(R,x),w=t.mul(N,w),k=t.add(k,x),x=t.sub(j,x),x=t.mul(R,x),w=t.add(w,x),j=t.mul(k,w),D=t.add(D,j),j=t.mul(P,w),_=t.mul(y,_),_=t.sub(_,j),j=t.mul(y,k),O=t.mul(P,O),O=t.add(O,j),new d(_,D,O)}subtract(b){return this.add(b.negate())}is0(){return this.equals(d.ZERO)}wNAF(b){return p.wNAFCached(this,b,d.normalizeZ)}multiplyUnsafe(b){const{endo:$,n:v}=e;Tt("scalar",b,Ct,v);const S=d.ZERO;if(b===Ct)return S;if(this.is0()||b===me)return this;if(!$||p.hasPrecomputes(this))return p.wNAFCachedUnsafe(this,b,d.normalizeZ);let{k1neg:E,k1:I,k2neg:m,k2:_}=$.splitScalar(b),D=S,O=S,R=this;for(;I>Ct||_>Ct;)I&me&&(D=D.add(R)),_&me&&(O=O.add(R)),R=R.double(),I>>=me,_>>=me;return E&&(D=D.negate()),m&&(O=O.negate()),O=new d(t.mul(O.px,$.beta),O.py,O.pz),D.add(O)}multiply(b){const{endo:$,n:v}=e;Tt("scalar",b,me,v);let S,E;if($){const{k1neg:I,k1:m,k2neg:_,k2:D}=$.splitScalar(b);let{p:O,f:R}=this.wNAF(m),{p:N,f:j}=this.wNAF(D);O=p.constTimeNegate(I,O),N=p.constTimeNegate(_,N),N=new d(t.mul(N.px,$.beta),N.py,N.pz),S=O.add(N),E=R.add(j)}else{const{p:I,f:m}=this.wNAF(b);S=I,E=m}return d.normalizeZ([S,E])[0]}multiplyAndAddUnsafe(b,$,v){const S=d.BASE,E=(m,_)=>_===Ct||_===me||!m.equals(S)?m.multiplyUnsafe(_):m.multiply(_),I=E(this,$).add(E(b,v));return I.is0()?void 0:I}toAffine(b){return h(this,b)}isTorsionFree(){const{h:b,isTorsionFree:$}=e;if(b===me)return!0;if($)return $(d,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:b,clearCofactor:$}=e;return b===me?this:$?$(d,this):this.multiplyUnsafe(e.h)}toRawBytes(b=!0){return Mr("isCompressed",b),this.assertValidity(),s(d,this,b)}toHex(b=!0){return Mr("isCompressed",b),kr(this.toRawBytes(b))}}d.BASE=new d(e.Gx,e.Gy,t.ONE),d.ZERO=new d(t.ZERO,t.ONE,t.ZERO);const f=e.nBitLength,p=bv(d,e.endo?Math.ceil(f/2):f);return{CURVE:e,ProjectivePoint:d,normPrivateKeyToScalar:c,weierstrassEquation:o,isWithinCurveOrder:a}}function Rv(r){const e=Sl(r);return Yr(e,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...e})}function Nv(r){const e=Rv(r),{Fp:t,n:i}=e,s=t.BYTES+1,n=2*t.BYTES+1;function o(x){return Fe(x,i)}function a(x){return Qn(x,i)}const{ProjectivePoint:c,normPrivateKeyToScalar:u,weierstrassEquation:h,isWithinCurveOrder:l}=Tv({...e,toBytes(x,y,w){const P=y.toAffine(),C=t.toBytes(P.x),A=Ii;return Mr("isCompressed",w),w?A(Uint8Array.from([y.hasEvenY()?2:3]),C):A(Uint8Array.from([4]),C,t.toBytes(P.y))},fromBytes(x){const y=x.length,w=x[0],P=x.subarray(1);if(y===s&&(w===2||w===3)){const C=rr(P);if(!Rs(C,me,t.ORDER))throw new Error("Point is not on curve");const A=h(C);let T;try{T=t.sqrt(A)}catch(M){const z=M instanceof Error?": "+M.message:"";throw new Error("Point is not on curve"+z)}const F=(T&me)===me;return(w&1)===1!==F&&(T=t.neg(T)),{x:C,y:T}}else if(y===n&&w===4){const C=t.fromBytes(P.subarray(0,t.BYTES)),A=t.fromBytes(P.subarray(t.BYTES,2*t.BYTES));return{x:C,y:A}}else{const C=s,A=n;throw new Error("invalid Point, expected length of "+C+", or uncompressed "+A+", got "+y)}}}),d=x=>kr(Hr(x,e.nByteLength));function f(x){const y=i>>me;return x>y}function p(x){return f(x)?o(-x):x}const g=(x,y,w)=>rr(x.slice(y,w));class b{constructor(y,w,P){this.r=y,this.s=w,this.recovery=P,this.assertValidity()}static fromCompact(y){const w=e.nByteLength;return y=Ve("compactSignature",y,w*2),new b(g(y,0,w),g(y,w,2*w))}static fromDER(y){const{r:w,s:P}=xt.toSig(Ve("DER",y));return new b(w,P)}assertValidity(){Tt("r",this.r,me,i),Tt("s",this.s,me,i)}addRecoveryBit(y){return new b(this.r,this.s,y)}recoverPublicKey(y){const{r:w,s:P,recovery:C}=this,A=m(Ve("msgHash",y));if(C==null||![0,1,2,3].includes(C))throw new Error("recovery id invalid");const T=C===2||C===3?w+e.n:w;if(T>=t.ORDER)throw new Error("recovery id 2 or 3 invalid");const F=(C&1)===0?"02":"03",M=c.fromHex(F+d(T)),z=a(T),q=o(-A*z),H=o(P*z),V=c.BASE.multiplyAndAddUnsafe(M,q,H);if(!V)throw new Error("point at infinify");return V.assertValidity(),V}hasHighS(){return f(this.s)}normalizeS(){return this.hasHighS()?new b(this.r,o(-this.s),this.recovery):this}toDERRawBytes(){return zr(this.toDERHex())}toDERHex(){return xt.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return zr(this.toCompactHex())}toCompactHex(){return d(this.r)+d(this.s)}}const $={isValidPrivateKey(x){try{return u(x),!0}catch{return!1}},normPrivateKeyToScalar:u,randomPrivateKey:()=>{const x=_l(e.n);return yv(e.randomBytes(x),e.n)},precompute(x=8,y=c.BASE){return y._setWindowSize(x),y.multiply(BigInt(3)),y}};function v(x,y=!0){return c.fromPrivateKey(x).toRawBytes(y)}function S(x){const y=ar(x),w=typeof x=="string",P=(y||w)&&x.length;return y?P===s||P===n:w?P===2*s||P===2*n:x instanceof c}function E(x,y,w=!0){if(S(x))throw new Error("first arg must be private key");if(!S(y))throw new Error("second arg must be public key");return c.fromHex(y).multiply(u(x)).toRawBytes(w)}const I=e.bits2int||function(x){if(x.length>8192)throw new Error("input is too large");const y=rr(x),w=x.length*8-e.nBitLength;return w>0?y>>BigInt(w):y},m=e.bits2int_modN||function(x){return o(I(x))},_=Uo(e.nBitLength);function D(x){return Tt("num < 2^"+e.nBitLength,x,Ct,_),Hr(x,e.nByteLength)}function O(x,y,w=R){if(["recovered","canonical"].some(ee=>ee in w))throw new Error("sign() legacy options not supported");const{hash:P,randomBytes:C}=e;let{lowS:A,prehash:T,extraEntropy:F}=w;A==null&&(A=!0),x=Ve("msgHash",x),$c(w),T&&(x=Ve("prehashed msgHash",P(x)));const M=m(x),z=u(y),q=[D(z),D(M)];if(F!=null&&F!==!1){const ee=F===!0?C(t.BYTES):F;q.push(Ve("extraEntropy",ee))}const H=Ii(...q),V=M;function ne(ee){const Y=I(ee);if(!l(Y))return;const Ae=a(Y),Ee=c.BASE.multiply(Y).toAffine(),Ce=o(Ee.x);if(Ce===Ct)return;const Je=o(Ae*o(V+Ce*z));if(Je===Ct)return;let Ze=(Ee.x===Ce?0:2)|Number(Ee.y&me),pr=Je;return A&&f(Je)&&(pr=p(Je),Ze^=1),new b(Ce,pr,Ze)}return{seed:H,k2sig:ne}}const R={lowS:e.lowS,prehash:!1},N={lowS:e.lowS,prehash:!1};function j(x,y,w=R){const{seed:P,k2sig:C}=O(x,y,w),A=e;return ml(A.hash.outputLen,A.nByteLength,A.hmac)(P,C)}c.BASE._setWindowSize(8);function k(x,y,w,P=N){var Je;const C=x;y=Ve("msgHash",y),w=Ve("publicKey",w);const{lowS:A,prehash:T,format:F}=P;if($c(P),"strict"in P)throw new Error("options.strict was renamed to lowS");if(F!==void 0&&F!=="compact"&&F!=="der")throw new Error("format must be compact or der");const M=typeof C=="string"||ar(C),z=!M&&!F&&typeof C=="object"&&C!==null&&typeof C.r=="bigint"&&typeof C.s=="bigint";if(!M&&!z)throw new Error("invalid signature, expected Uint8Array, hex string or Signature instance");let q,H;try{if(z&&(q=new b(C.r,C.s)),M){try{F!=="compact"&&(q=b.fromDER(C))}catch(Ze){if(!(Ze instanceof xt.Err))throw Ze}!q&&F!=="der"&&(q=b.fromCompact(C))}H=c.fromHex(w)}catch{return!1}if(!q||A&&q.hasHighS())return!1;T&&(y=e.hash(y));const{r:V,s:ne}=q,ee=m(y),Y=a(ne),Ae=o(ee*Y),Ee=o(V*Y),Ce=(Je=c.BASE.multiplyAndAddUnsafe(H,Ae,Ee))==null?void 0:Je.toAffine();return Ce?o(Ce.x)===V:!1}return{CURVE:e,getPublicKey:v,getSharedSecret:E,sign:j,verify:k,ProjectivePoint:c,Signature:b,utils:$}}function jv(r){return{hash:r,hmac:(e,...t)=>As(r,e,Fw(...t)),randomBytes:Gr}}function Bv(r,e){const t=i=>Nv({...r,...jv(i)});return{...t(e),create:t}}const Dl=vl(BigInt("0xffffffff00000001000000000000000000000000ffffffffffffffffffffffff")),Lv=Dl.create(BigInt("-3")),Uv=BigInt("0x5ac635d8aa3a93e7b3ebbd55769886bc651d06b0cc53b0f63bce3c3e27d2604b"),Fv=Bv({a:Lv,b:Uv,Fp:Dl,n:BigInt("0xffffffff00000000ffffffffffffffffbce6faada7179e84f3b9cac2fc632551"),Gx:BigInt("0x6b17d1f2e12c4247f8bce6e563a440f277037d812deb33a0f4a13945d898c296"),Gy:BigInt("0x4fe342e2fe1a7f9b8ee7eb4a7c0f9e162bce33576b315ececbb6406837bf51f5"),h:BigInt(1),lowS:!1},Ti),Ol="base10",Re="base16",ht="base64pad",qt="base64url",Ni="utf8",Pl=0,Rt=1,ji=2,qv=0,Dc=1,fi=12,Fo=32;function Mv(){const r=eo.utils.randomPrivateKey(),e=eo.getPublicKey(r);return{privateKey:qe(r,Re),publicKey:qe(e,Re)}}function to(){const r=Gr(Fo);return qe(r,Re)}function kv(r,e){const t=eo.getSharedSecret(rt(r,Re),rt(e,Re)),i=Kb(Ti,t,void 0,void 0,Fo);return qe(i,Re)}function os(r){const e=Ti(rt(r,Re));return qe(e,Re)}function Et(r){const e=Ti(rt(r,Ni));return qe(e,Re)}function Al(r){return rt(`${r}`,Ol)}function cr(r){return Number(qe(r,Ol))}function xl(r){return r.replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}function Cl(r){const e=r.replace(/-/g,"+").replace(/_/g,"/"),t=(4-e.length%4)%4;return e+"=".repeat(t)}function zv(r){const e=Al(typeof r.type<"u"?r.type:Pl);if(cr(e)===Rt&&typeof r.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");const t=typeof r.senderPublicKey<"u"?rt(r.senderPublicKey,Re):void 0,i=typeof r.iv<"u"?rt(r.iv,Re):Gr(fi),s=rt(r.symKey,Re),n=fl(s,i).encrypt(rt(r.message,Ni)),o=Tl({type:e,sealed:n,iv:i,senderPublicKey:t});return r.encoding===qt?xl(o):o}function Hv(r){const e=rt(r.symKey,Re),{sealed:t,iv:i}=$i({encoded:r.encoded,encoding:r.encoding}),s=fl(e,i).decrypt(t);if(s===null)throw new Error("Failed to decrypt");return qe(s,Ni)}function Vv(r,e){const t=Al(ji),i=Gr(fi),s=rt(r,Ni),n=Tl({type:t,sealed:s,iv:i});return e===qt?xl(n):n}function Kv(r,e){const{sealed:t}=$i({encoded:r,encoding:e});return qe(t,Ni)}function Tl(r){if(cr(r.type)===ji)return qe(pi([r.type,r.sealed]),ht);if(cr(r.type)===Rt){if(typeof r.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");return qe(pi([r.type,r.senderPublicKey,r.iv,r.sealed]),ht)}return qe(pi([r.type,r.iv,r.sealed]),ht)}function $i(r){const e=(r.encoding||ht)===qt?Cl(r.encoded):r.encoded,t=rt(e,ht),i=t.slice(qv,Dc),s=Dc;if(cr(i)===Rt){const c=s+Fo,u=c+fi,h=t.slice(s,c),l=t.slice(c,u),d=t.slice(u);return{type:i,sealed:d,iv:l,senderPublicKey:h}}if(cr(i)===ji){const c=t.slice(s),u=Gr(fi);return{type:i,sealed:c,iv:u}}const n=s+fi,o=t.slice(s,n),a=t.slice(n);return{type:i,sealed:a,iv:o}}function Wv(r,e){const t=$i({encoded:r,encoding:e==null?void 0:e.encoding});return Rl({type:cr(t.type),senderPublicKey:typeof t.senderPublicKey<"u"?qe(t.senderPublicKey,Re):void 0,receiverPublicKey:e==null?void 0:e.receiverPublicKey})}function Rl(r){const e=(r==null?void 0:r.type)||Pl;if(e===Rt){if(typeof(r==null?void 0:r.senderPublicKey)>"u")throw new Error("missing sender public key");if(typeof(r==null?void 0:r.receiverPublicKey)>"u")throw new Error("missing receiver public key")}return{type:e,senderPublicKey:r==null?void 0:r.senderPublicKey,receiverPublicKey:r==null?void 0:r.receiverPublicKey}}function Oc(r){return r.type===Rt&&typeof r.senderPublicKey=="string"&&typeof r.receiverPublicKey=="string"}function Pc(r){return r.type===ji}function Gv(r){const e=Buffer.from(r.x,"base64"),t=Buffer.from(r.y,"base64");return pi([new Uint8Array([4]),e,t])}function Yv(r,e){const[t,i,s]=r.split("."),n=Buffer.from(Cl(s),"base64");if(n.length!==64)throw new Error("Invalid signature length");const o=n.slice(0,32),a=n.slice(32,64),c=`${t}.${i}`,u=Ti(c),h=Gv(e);if(!Fv.verify(pi([o,a]),u,h))throw new Error("Invalid signature");return zn(r).payload}const Jv="irn";function ys(r){return(r==null?void 0:r.relay)||{protocol:Jv}}function hi(r){const e=tw[r];if(typeof e>"u")throw new Error(`Relay Protocol not supported: ${r}`);return e}function Zv(r,e="-"){const t={},i="relay"+e;return Object.keys(r).forEach(s=>{if(s.startsWith(i)){const n=s.replace(i,""),o=r[s];t[n]=o}}),t}function Ac(r){if(!r.includes("wc:")){const u=tl(r);u!=null&&u.includes("wc:")&&(r=u)}r=r.includes("wc://")?r.replace("wc://",""):r,r=r.includes("wc:")?r.replace("wc:",""):r;const e=r.indexOf(":"),t=r.indexOf("?")!==-1?r.indexOf("?"):void 0,i=r.substring(0,e),s=r.substring(e+1,t).split("@"),n=typeof t<"u"?r.substring(t):"",o=new URLSearchParams(n),a={};o.forEach((u,h)=>{a[h]=u});const c=typeof a.methods=="string"?a.methods.split(","):void 0;return{protocol:i,topic:Qv(s[0]),version:parseInt(s[1],10),symKey:a.symKey,relay:Zv(a),methods:c,expiryTimestamp:a.expiryTimestamp?parseInt(a.expiryTimestamp,10):void 0}}function Qv(r){return r.startsWith("//")?r.substring(2):r}function Xv(r,e="-"){const t="relay",i={};return Object.keys(r).forEach(s=>{const n=s,o=t+e+n;r[n]&&(i[o]=r[n])}),i}function xc(r){const e=new URLSearchParams,t=Xv(r.relay);Object.keys(t).sort().forEach(s=>{e.set(s,t[s])}),e.set("symKey",r.symKey),r.expiryTimestamp&&e.set("expiryTimestamp",r.expiryTimestamp.toString()),r.methods&&e.set("methods",r.methods.join(","));const i=e.toString();return`${r.protocol}:${r.topic}@${r.version}?${i}`}function Gi(r,e,t){return`${r}?wc_ev=${t}&topic=${e}`}function Jr(r){const e=[];return r.forEach(t=>{const[i,s]=t.split(":");e.push(`${i}:${s}`)}),e}function e0(r){const e=[];return Object.values(r).forEach(t=>{e.push(...Jr(t.accounts))}),e}function t0(r,e){const t=[];return Object.values(r).forEach(i=>{Jr(i.accounts).includes(e)&&t.push(...i.methods)}),t}function r0(r,e){const t=[];return Object.values(r).forEach(i=>{Jr(i.accounts).includes(e)&&t.push(...i.events)}),t}function qo(r){return r.includes(":")}function li(r){return qo(r)?r.split(":")[0]:r}function i0(r){const e={};return r==null||r.forEach(t=>{var i;const[s,n]=t.split(":");e[s]||(e[s]={accounts:[],chains:[],events:[],methods:[]}),e[s].accounts.push(t),(i=e[s].chains)==null||i.push(`${s}:${n}`)}),e}function Cc(r,e){e=e.map(i=>i.replace("did:pkh:",""));const t=i0(e);for(const[i,s]of Object.entries(t))s.methods?s.methods=ss(s.methods,r):s.methods=r,s.events=["chainChanged","accountsChanged"];return t}const s0={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}},n0={NOT_INITIALIZED:{message:"Not initialized.",code:1},NO_MATCHING_KEY:{message:"No matching key.",code:2},RESTORE_WILL_OVERRIDE:{message:"Restore will override.",code:3},RESUBSCRIBED:{message:"Resubscribed.",code:4},MISSING_OR_INVALID:{message:"Missing or invalid.",code:5},EXPIRED:{message:"Expired.",code:6},UNKNOWN_TYPE:{message:"Unknown type.",code:7},MISMATCHED_TOPIC:{message:"Mismatched topic.",code:8},NON_CONFORMING_NAMESPACES:{message:"Non conforming namespaces.",code:9}};function U(r,e){const{message:t,code:i}=n0[r];return{message:e?`${t} ${e}`:t,code:i}}function te(r,e){const{message:t,code:i}=s0[r];return{message:e?`${t} ${e}`:t,code:i}}function lt(r,e){return!!Array.isArray(r)}function Si(r){return Object.getPrototypeOf(r)===Object.prototype&&Object.keys(r).length}function Se(r){return typeof r>"u"}function le(r,e){return e&&Se(r)?!0:typeof r=="string"&&!!r.trim().length}function Mo(r,e){return e&&Se(r)?!0:typeof r=="number"&&!isNaN(r)}function o0(r,e){const{requiredNamespaces:t}=e,i=Object.keys(r.namespaces),s=Object.keys(t);let n=!0;return er(s,i)?(i.forEach(o=>{const{accounts:a,methods:c,events:u}=r.namespaces[o],h=Jr(a),l=t[o];(!er(Jh(o,l),h)||!er(l.methods,c)||!er(l.events,u))&&(n=!1)}),n):!1}function ms(r){return le(r,!1)&&r.includes(":")?r.split(":").length===2:!1}function a0(r){if(le(r,!1)&&r.includes(":")){const e=r.split(":");if(e.length===3){const t=e[0]+":"+e[1];return!!e[2]&&ms(t)}}return!1}function c0(r){function e(t){try{return typeof new URL(t)<"u"}catch{return!1}}try{if(le(r,!1)){if(e(r))return!0;const t=tl(r);return e(t)}}catch{}return!1}function u0(r){var e;return(e=r==null?void 0:r.proposer)==null?void 0:e.publicKey}function h0(r){return r==null?void 0:r.topic}function l0(r,e){let t=null;return le(r==null?void 0:r.publicKey,!1)||(t=U("MISSING_OR_INVALID",`${e} controller public key should be a string`)),t}function Tc(r){let e=!0;return lt(r)?r.length&&(e=r.every(t=>le(t,!1))):e=!1,e}function d0(r,e,t){let i=null;return lt(e)&&e.length?e.forEach(s=>{i||ms(s)||(i=te("UNSUPPORTED_CHAINS",`${t}, chain ${s} should be a string and conform to "namespace:chainId" format`))}):ms(r)||(i=te("UNSUPPORTED_CHAINS",`${t}, chains must be defined as "namespace:chainId" e.g. "eip155:1": {...} in the namespace key OR as an array of CAIP-2 chainIds e.g. eip155: { chains: ["eip155:1", "eip155:5"] }`)),i}function p0(r,e,t){let i=null;return Object.entries(r).forEach(([s,n])=>{if(i)return;const o=d0(s,Jh(s,n),`${e} ${t}`);o&&(i=o)}),i}function f0(r,e){let t=null;return lt(r)?r.forEach(i=>{t||a0(i)||(t=te("UNSUPPORTED_ACCOUNTS",`${e}, account ${i} should be a string and conform to "namespace:chainId:address" format`))}):t=te("UNSUPPORTED_ACCOUNTS",`${e}, accounts should be an array of strings conforming to "namespace:chainId:address" format`),t}function g0(r,e){let t=null;return Object.values(r).forEach(i=>{if(t)return;const s=f0(i==null?void 0:i.accounts,`${e} namespace`);s&&(t=s)}),t}function y0(r,e){let t=null;return Tc(r==null?void 0:r.methods)?Tc(r==null?void 0:r.events)||(t=te("UNSUPPORTED_EVENTS",`${e}, events should be an array of strings or empty array for no events`)):t=te("UNSUPPORTED_METHODS",`${e}, methods should be an array of strings or empty array for no methods`),t}function Nl(r,e){let t=null;return Object.values(r).forEach(i=>{if(t)return;const s=y0(i,`${e}, namespace`);s&&(t=s)}),t}function m0(r,e,t){let i=null;if(r&&Si(r)){const s=Nl(r,e);s&&(i=s);const n=p0(r,e,t);n&&(i=n)}else i=U("MISSING_OR_INVALID",`${e}, ${t} should be an object with data`);return i}function fn(r,e){let t=null;if(r&&Si(r)){const i=Nl(r,e);i&&(t=i);const s=g0(r,e);s&&(t=s)}else t=U("MISSING_OR_INVALID",`${e}, namespaces should be an object with data`);return t}function jl(r){return le(r.protocol,!0)}function w0(r,e){let t=!1;return r?r&&lt(r)&&r.length&&r.forEach(i=>{t=jl(i)}):t=!0,t}function b0(r){return typeof r=="number"}function Ue(r){return typeof r<"u"&&typeof r!==null}function v0(r){return!(!r||typeof r!="object"||!r.code||!Mo(r.code,!1)||!r.message||!le(r.message,!1))}function E0(r){return!(Se(r)||!le(r.method,!1))}function _0(r){return!(Se(r)||Se(r.result)&&Se(r.error)||!Mo(r.id,!1)||!le(r.jsonrpc,!1))}function I0(r){return!(Se(r)||!le(r.name,!1))}function Rc(r,e){return!(!ms(e)||!e0(r).includes(e))}function $0(r,e,t){return le(t,!1)?t0(r,e).includes(t):!1}function S0(r,e,t){return le(t,!1)?r0(r,e).includes(t):!1}function Nc(r,e,t){let i=null;const s=D0(r),n=O0(e),o=Object.keys(s),a=Object.keys(n),c=jc(Object.keys(r)),u=jc(Object.keys(e)),h=c.filter(l=>!u.includes(l));return h.length&&(i=U("NON_CONFORMING_NAMESPACES",`${t} namespaces keys don't satisfy requiredNamespaces.
      Required: ${h.toString()}
      Received: ${Object.keys(e).toString()}`)),er(o,a)||(i=U("NON_CONFORMING_NAMESPACES",`${t} namespaces chains don't satisfy required namespaces.
      Required: ${o.toString()}
      Approved: ${a.toString()}`)),Object.keys(e).forEach(l=>{if(!l.includes(":")||i)return;const d=Jr(e[l].accounts);d.includes(l)||(i=U("NON_CONFORMING_NAMESPACES",`${t} namespaces accounts don't satisfy namespace accounts for ${l}
        Required: ${l}
        Approved: ${d.toString()}`))}),o.forEach(l=>{i||(er(s[l].methods,n[l].methods)?er(s[l].events,n[l].events)||(i=U("NON_CONFORMING_NAMESPACES",`${t} namespaces events don't satisfy namespace events for ${l}`)):i=U("NON_CONFORMING_NAMESPACES",`${t} namespaces methods don't satisfy namespace methods for ${l}`))}),i}function D0(r){const e={};return Object.keys(r).forEach(t=>{var i;t.includes(":")?e[t]=r[t]:(i=r[t].chains)==null||i.forEach(s=>{e[s]={methods:r[t].methods,events:r[t].events}})}),e}function jc(r){return[...new Set(r.map(e=>e.includes(":")?e.split(":")[0]:e))]}function O0(r){const e={};return Object.keys(r).forEach(t=>{if(t.includes(":"))e[t]=r[t];else{const i=Jr(r[t].accounts);i==null||i.forEach(s=>{e[s]={accounts:r[t].accounts.filter(n=>n.includes(`${s}:`)),methods:r[t].methods,events:r[t].events}})}}),e}function P0(r,e){return Mo(r,!1)&&r<=e.max&&r>=e.min}function Bc(){const r=xi();return new Promise(e=>{switch(r){case We.browser:e(A0());break;case We.reactNative:e(x0());break;case We.node:e(C0());break;default:e(!0)}})}function A0(){return Ai()&&(navigator==null?void 0:navigator.onLine)}async function x0(){if(Ht()&&typeof global<"u"&&global!=null&&global.NetInfo){const r=await(global==null?void 0:global.NetInfo.fetch());return r==null?void 0:r.isConnected}return!0}function C0(){return!0}function T0(r){switch(xi()){case We.browser:R0(r);break;case We.reactNative:N0(r);break}}function R0(r){!Ht()&&Ai()&&(window.addEventListener("online",()=>r(!0)),window.addEventListener("offline",()=>r(!1)))}function N0(r){Ht()&&typeof global<"u"&&global!=null&&global.NetInfo&&(global==null||global.NetInfo.addEventListener(e=>r(e==null?void 0:e.isConnected)))}const gn={};class ni{static get(e){return gn[e]}static set(e,t){gn[e]=t}static delete(e){delete gn[e]}}class ur{}let j0=class extends ur{constructor(e){super()}};const Lc=L.FIVE_SECONDS,Zr={pulse:"heartbeat_pulse"};let B0=class Bl extends j0{constructor(e){super(e),this.events=new Ye.EventEmitter,this.interval=Lc,this.interval=(e==null?void 0:e.interval)||Lc}static async init(e){const t=new Bl(e);return await t.init(),t}async init(){await this.initialize()}stop(){clearInterval(this.intervalRef)}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}off(e,t){this.events.off(e,t)}removeListener(e,t){this.events.removeListener(e,t)}async initialize(){this.intervalRef=setInterval(()=>this.pulse(),L.toMiliseconds(this.interval))}pulse(){this.events.emit(Zr.pulse)}};const L0=/"(?:_|\\u0{2}5[Ff]){2}(?:p|\\u0{2}70)(?:r|\\u0{2}72)(?:o|\\u0{2}6[Ff])(?:t|\\u0{2}74)(?:o|\\u0{2}6[Ff])(?:_|\\u0{2}5[Ff]){2}"\s*:/,U0=/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/,F0=/^\s*["[{]|^\s*-?\d{1,16}(\.\d{1,17})?([Ee][+-]?\d+)?\s*$/;function q0(r,e){if(r==="__proto__"||r==="constructor"&&e&&typeof e=="object"&&"prototype"in e){M0(r);return}return e}function M0(r){console.warn(`[destr] Dropping "${r}" key to prevent prototype pollution.`)}function Yi(r,e={}){if(typeof r!="string")return r;if(r[0]==='"'&&r[r.length-1]==='"'&&r.indexOf("\\")===-1)return r.slice(1,-1);const t=r.trim();if(t.length<=9)switch(t.toLowerCase()){case"true":return!0;case"false":return!1;case"undefined":return;case"null":return null;case"nan":return Number.NaN;case"infinity":return Number.POSITIVE_INFINITY;case"-infinity":return Number.NEGATIVE_INFINITY}if(!F0.test(r)){if(e.strict)throw new SyntaxError("[destr] Invalid JSON");return r}try{if(L0.test(r)||U0.test(r)){if(e.strict)throw new Error("[destr] Possible prototype pollution");return JSON.parse(r,q0)}return JSON.parse(r)}catch(i){if(e.strict)throw i;return r}}function k0(r){return!r||typeof r.then!="function"?Promise.resolve(r):r}function ye(r,...e){try{return k0(r(...e))}catch(t){return Promise.reject(t)}}function z0(r){const e=typeof r;return r===null||e!=="object"&&e!=="function"}function H0(r){const e=Object.getPrototypeOf(r);return!e||e.isPrototypeOf(Object)}function as(r){if(z0(r))return String(r);if(H0(r)||Array.isArray(r))return JSON.stringify(r);if(typeof r.toJSON=="function")return as(r.toJSON());throw new Error("[unstorage] Cannot stringify value!")}const ro="base64:";function V0(r){return typeof r=="string"?r:ro+G0(r)}function K0(r){return typeof r!="string"||!r.startsWith(ro)?r:W0(r.slice(ro.length))}function W0(r){return globalThis.Buffer?Buffer.from(r,"base64"):Uint8Array.from(globalThis.atob(r),e=>e.codePointAt(0))}function G0(r){return globalThis.Buffer?Buffer.from(r).toString("base64"):globalThis.btoa(String.fromCodePoint(...r))}function Le(r){var e;return r&&((e=r.split("?")[0])==null?void 0:e.replace(/[/\\]/g,":").replace(/:+/g,":").replace(/^:|:$/g,""))||""}function Y0(...r){return Le(r.join(":"))}function Ji(r){return r=Le(r),r?r+":":""}function J0(r,e){if(e===void 0)return!0;let t=0,i=r.indexOf(":");for(;i>-1;)t++,i=r.indexOf(":",i+1);return t<=e}function Z0(r,e){return e?r.startsWith(e)&&r[r.length-1]!=="$":r[r.length-1]!=="$"}const Q0="memory",X0=()=>{const r=new Map;return{name:Q0,getInstance:()=>r,hasItem(e){return r.has(e)},getItem(e){return r.get(e)??null},getItemRaw(e){return r.get(e)??null},setItem(e,t){r.set(e,t)},setItemRaw(e,t){r.set(e,t)},removeItem(e){r.delete(e)},getKeys(){return[...r.keys()]},clear(){r.clear()},dispose(){r.clear()}}};function e1(r={}){const e={mounts:{"":r.driver||X0()},mountpoints:[""],watching:!1,watchListeners:[],unwatch:{}},t=u=>{for(const h of e.mountpoints)if(u.startsWith(h))return{base:h,relativeKey:u.slice(h.length),driver:e.mounts[h]};return{base:"",relativeKey:u,driver:e.mounts[""]}},i=(u,h)=>e.mountpoints.filter(l=>l.startsWith(u)||h&&u.startsWith(l)).map(l=>({relativeBase:u.length>l.length?u.slice(l.length):void 0,mountpoint:l,driver:e.mounts[l]})),s=(u,h)=>{if(e.watching){h=Le(h);for(const l of e.watchListeners)l(u,h)}},n=async()=>{if(!e.watching){e.watching=!0;for(const u in e.mounts)e.unwatch[u]=await Uc(e.mounts[u],s,u)}},o=async()=>{if(e.watching){for(const u in e.unwatch)await e.unwatch[u]();e.unwatch={},e.watching=!1}},a=(u,h,l)=>{const d=new Map,f=p=>{let g=d.get(p.base);return g||(g={driver:p.driver,base:p.base,items:[]},d.set(p.base,g)),g};for(const p of u){const g=typeof p=="string",b=Le(g?p:p.key),$=g?void 0:p.value,v=g||!p.options?h:{...h,...p.options},S=t(b);f(S).items.push({key:b,value:$,relativeKey:S.relativeKey,options:v})}return Promise.all([...d.values()].map(p=>l(p))).then(p=>p.flat())},c={hasItem(u,h={}){u=Le(u);const{relativeKey:l,driver:d}=t(u);return ye(d.hasItem,l,h)},getItem(u,h={}){u=Le(u);const{relativeKey:l,driver:d}=t(u);return ye(d.getItem,l,h).then(f=>Yi(f))},getItems(u,h={}){return a(u,h,l=>l.driver.getItems?ye(l.driver.getItems,l.items.map(d=>({key:d.relativeKey,options:d.options})),h).then(d=>d.map(f=>({key:Y0(l.base,f.key),value:Yi(f.value)}))):Promise.all(l.items.map(d=>ye(l.driver.getItem,d.relativeKey,d.options).then(f=>({key:d.key,value:Yi(f)})))))},getItemRaw(u,h={}){u=Le(u);const{relativeKey:l,driver:d}=t(u);return d.getItemRaw?ye(d.getItemRaw,l,h):ye(d.getItem,l,h).then(f=>K0(f))},async setItem(u,h,l={}){if(h===void 0)return c.removeItem(u);u=Le(u);const{relativeKey:d,driver:f}=t(u);f.setItem&&(await ye(f.setItem,d,as(h),l),f.watch||s("update",u))},async setItems(u,h){await a(u,h,async l=>{if(l.driver.setItems)return ye(l.driver.setItems,l.items.map(d=>({key:d.relativeKey,value:as(d.value),options:d.options})),h);l.driver.setItem&&await Promise.all(l.items.map(d=>ye(l.driver.setItem,d.relativeKey,as(d.value),d.options)))})},async setItemRaw(u,h,l={}){if(h===void 0)return c.removeItem(u,l);u=Le(u);const{relativeKey:d,driver:f}=t(u);if(f.setItemRaw)await ye(f.setItemRaw,d,h,l);else if(f.setItem)await ye(f.setItem,d,V0(h),l);else return;f.watch||s("update",u)},async removeItem(u,h={}){typeof h=="boolean"&&(h={removeMeta:h}),u=Le(u);const{relativeKey:l,driver:d}=t(u);d.removeItem&&(await ye(d.removeItem,l,h),(h.removeMeta||h.removeMata)&&await ye(d.removeItem,l+"$",h),d.watch||s("remove",u))},async getMeta(u,h={}){typeof h=="boolean"&&(h={nativeOnly:h}),u=Le(u);const{relativeKey:l,driver:d}=t(u),f=Object.create(null);if(d.getMeta&&Object.assign(f,await ye(d.getMeta,l,h)),!h.nativeOnly){const p=await ye(d.getItem,l+"$",h).then(g=>Yi(g));p&&typeof p=="object"&&(typeof p.atime=="string"&&(p.atime=new Date(p.atime)),typeof p.mtime=="string"&&(p.mtime=new Date(p.mtime)),Object.assign(f,p))}return f},setMeta(u,h,l={}){return this.setItem(u+"$",h,l)},removeMeta(u,h={}){return this.removeItem(u+"$",h)},async getKeys(u,h={}){var b;u=Ji(u);const l=i(u,!0);let d=[];const f=[];let p=!0;for(const $ of l){(b=$.driver.flags)!=null&&b.maxDepth||(p=!1);const v=await ye($.driver.getKeys,$.relativeBase,h);for(const S of v){const E=$.mountpoint+Le(S);d.some(I=>E.startsWith(I))||f.push(E)}d=[$.mountpoint,...d.filter(S=>!S.startsWith($.mountpoint))]}const g=h.maxDepth!==void 0&&!p;return f.filter($=>(!g||J0($,h.maxDepth))&&Z0($,u))},async clear(u,h={}){u=Ji(u),await Promise.all(i(u,!1).map(async l=>{if(l.driver.clear)return ye(l.driver.clear,l.relativeBase,h);if(l.driver.removeItem){const d=await l.driver.getKeys(l.relativeBase||"",h);return Promise.all(d.map(f=>l.driver.removeItem(f,h)))}}))},async dispose(){await Promise.all(Object.values(e.mounts).map(u=>Fc(u)))},async watch(u){return await n(),e.watchListeners.push(u),async()=>{e.watchListeners=e.watchListeners.filter(h=>h!==u),e.watchListeners.length===0&&await o()}},async unwatch(){e.watchListeners=[],await o()},mount(u,h){if(u=Ji(u),u&&e.mounts[u])throw new Error(`already mounted at ${u}`);return u&&(e.mountpoints.push(u),e.mountpoints.sort((l,d)=>d.length-l.length)),e.mounts[u]=h,e.watching&&Promise.resolve(Uc(h,s,u)).then(l=>{e.unwatch[u]=l}).catch(console.error),c},async unmount(u,h=!0){var l,d;u=Ji(u),!(!u||!e.mounts[u])&&(e.watching&&u in e.unwatch&&((d=(l=e.unwatch)[u])==null||d.call(l),delete e.unwatch[u]),h&&await Fc(e.mounts[u]),e.mountpoints=e.mountpoints.filter(f=>f!==u),delete e.mounts[u])},getMount(u=""){u=Le(u)+":";const h=t(u);return{driver:h.driver,base:h.base}},getMounts(u="",h={}){return u=Le(u),i(u,h.parents).map(d=>({driver:d.driver,base:d.mountpoint}))},keys:(u,h={})=>c.getKeys(u,h),get:(u,h={})=>c.getItem(u,h),set:(u,h,l={})=>c.setItem(u,h,l),has:(u,h={})=>c.hasItem(u,h),del:(u,h={})=>c.removeItem(u,h),remove:(u,h={})=>c.removeItem(u,h)};return c}function Uc(r,e,t){return r.watch?r.watch((i,s)=>e(i,t+s)):()=>{}}async function Fc(r){typeof r.dispose=="function"&&await ye(r.dispose)}function hr(r){return new Promise((e,t)=>{r.oncomplete=r.onsuccess=()=>e(r.result),r.onabort=r.onerror=()=>t(r.error)})}function Ll(r,e){const t=indexedDB.open(r);t.onupgradeneeded=()=>t.result.createObjectStore(e);const i=hr(t);return(s,n)=>i.then(o=>n(o.transaction(e,s).objectStore(e)))}let yn;function Bi(){return yn||(yn=Ll("keyval-store","keyval")),yn}function qc(r,e=Bi()){return e("readonly",t=>hr(t.get(r)))}function t1(r,e,t=Bi()){return t("readwrite",i=>(i.put(e,r),hr(i.transaction)))}function r1(r,e=Bi()){return e("readwrite",t=>(t.delete(r),hr(t.transaction)))}function i1(r=Bi()){return r("readwrite",e=>(e.clear(),hr(e.transaction)))}function s1(r,e){return r.openCursor().onsuccess=function(){this.result&&(e(this.result),this.result.continue())},hr(r.transaction)}function n1(r=Bi()){return r("readonly",e=>{if(e.getAllKeys)return hr(e.getAllKeys());const t=[];return s1(e,i=>t.push(i.key)).then(()=>t)})}const o1="idb-keyval";var a1=(r={})=>{const e=r.base&&r.base.length>0?`${r.base}:`:"",t=s=>e+s;let i;return r.dbName&&r.storeName&&(i=Ll(r.dbName,r.storeName)),{name:o1,options:r,async hasItem(s){return!(typeof await qc(t(s),i)>"u")},async getItem(s){return await qc(t(s),i)??null},setItem(s,n){return t1(t(s),n,i)},removeItem(s){return r1(t(s),i)},getKeys(){return n1(i)},clear(){return i1(i)}}};const c1="WALLET_CONNECT_V2_INDEXED_DB",u1="keyvaluestorage";let h1=class{constructor(){this.indexedDb=e1({driver:a1({dbName:c1,storeName:u1})})}async getKeys(){return this.indexedDb.getKeys()}async getEntries(){return(await this.indexedDb.getItems(await this.indexedDb.getKeys())).map(e=>[e.key,e.value])}async getItem(e){const t=await this.indexedDb.getItem(e);if(t!==null)return t}async setItem(e,t){await this.indexedDb.setItem(e,Nt(t))}async removeItem(e){await this.indexedDb.removeItem(e)}};var mn=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},cs={exports:{}};(function(){let r;function e(){}r=e,r.prototype.getItem=function(t){return this.hasOwnProperty(t)?String(this[t]):null},r.prototype.setItem=function(t,i){this[t]=String(i)},r.prototype.removeItem=function(t){delete this[t]},r.prototype.clear=function(){const t=this;Object.keys(t).forEach(function(i){t[i]=void 0,delete t[i]})},r.prototype.key=function(t){return t=t||0,Object.keys(this)[t]},r.prototype.__defineGetter__("length",function(){return Object.keys(this).length}),typeof mn<"u"&&mn.localStorage?cs.exports=mn.localStorage:typeof window<"u"&&window.localStorage?cs.exports=window.localStorage:cs.exports=new e})();function l1(r){var e;return[r[0],nr((e=r[1])!=null?e:"")]}let d1=class{constructor(){this.localStorage=cs.exports}async getKeys(){return Object.keys(this.localStorage)}async getEntries(){return Object.entries(this.localStorage).map(l1)}async getItem(e){const t=this.localStorage.getItem(e);if(t!==null)return nr(t)}async setItem(e,t){this.localStorage.setItem(e,Nt(t))}async removeItem(e){this.localStorage.removeItem(e)}};const p1="wc_storage_version",Mc=1,f1=async(r,e,t)=>{const i=p1,s=await e.getItem(i);if(s&&s>=Mc){t(e);return}const n=await r.getKeys();if(!n.length){t(e);return}const o=[];for(;n.length;){const a=n.shift();if(!a)continue;const c=a.toLowerCase();if(c.includes("wc@")||c.includes("walletconnect")||c.includes("wc_")||c.includes("wallet_connect")){const u=await r.getItem(a);await e.setItem(a,u),o.push(a)}}await e.setItem(i,Mc),t(e),g1(r,o)},g1=async(r,e)=>{e.length&&e.forEach(async t=>{await r.removeItem(t)})};let y1=class{constructor(){this.initialized=!1,this.setInitialized=t=>{this.storage=t,this.initialized=!0};const e=new d1;this.storage=e;try{const t=new h1;f1(e,t,this.setInitialized)}catch{this.initialized=!0}}async getKeys(){return await this.initialize(),this.storage.getKeys()}async getEntries(){return await this.initialize(),this.storage.getEntries()}async getItem(e){return await this.initialize(),this.storage.getItem(e)}async setItem(e,t){return await this.initialize(),this.storage.setItem(e,t)}async removeItem(e){return await this.initialize(),this.storage.removeItem(e)}async initialize(){this.initialized||await new Promise(e=>{const t=setInterval(()=>{this.initialized&&(clearInterval(t),e())},20)})}};var wn,kc;function m1(){if(kc)return wn;kc=1;function r(t){try{return JSON.stringify(t)}catch{return'"[Circular]"'}}wn=e;function e(t,i,s){var n=s&&s.stringify||r,o=1;if(typeof t=="object"&&t!==null){var a=i.length+o;if(a===1)return t;var c=new Array(a);c[0]=n(t);for(var u=1;u<a;u++)c[u]=n(i[u]);return c.join(" ")}if(typeof t!="string")return t;var h=i.length;if(h===0)return t;for(var l="",d=1-o,f=-1,p=t&&t.length||0,g=0;g<p;){if(t.charCodeAt(g)===37&&g+1<p){switch(f=f>-1?f:0,t.charCodeAt(g+1)){case 100:case 102:if(d>=h||i[d]==null)break;f<g&&(l+=t.slice(f,g)),l+=Number(i[d]),f=g+2,g++;break;case 105:if(d>=h||i[d]==null)break;f<g&&(l+=t.slice(f,g)),l+=Math.floor(Number(i[d])),f=g+2,g++;break;case 79:case 111:case 106:if(d>=h||i[d]===void 0)break;f<g&&(l+=t.slice(f,g));var b=typeof i[d];if(b==="string"){l+="'"+i[d]+"'",f=g+2,g++;break}if(b==="function"){l+=i[d].name||"<anonymous>",f=g+2,g++;break}l+=n(i[d]),f=g+2,g++;break;case 115:if(d>=h)break;f<g&&(l+=t.slice(f,g)),l+=String(i[d]),f=g+2,g++;break;case 37:f<g&&(l+=t.slice(f,g)),l+="%",f=g+2,g++,d--;break}++d}++g}return f===-1?t:(f<p&&(l+=t.slice(f)),l)}return wn}var bn,zc;function w1(){if(zc)return bn;zc=1;const r=m1();bn=s;const e=I().console||{},t={mapHttpRequest:p,mapHttpResponse:p,wrapRequestSerializer:g,wrapResponseSerializer:g,wrapErrorSerializer:g,req:p,res:p,err:d};function i(m,_){return Array.isArray(m)?m.filter(function(O){return O!=="!stdSerializers.err"}):m===!0?Object.keys(_):!1}function s(m){m=m||{},m.browser=m.browser||{};const _=m.browser.transmit;if(_&&typeof _.send!="function")throw Error("pino: transmit option must have a send function");const D=m.browser.write||e;m.browser.write&&(m.browser.asObject=!0);const O=m.serializers||{},R=i(m.browser.serialize,O);let N=m.browser.serialize;Array.isArray(m.browser.serialize)&&m.browser.serialize.indexOf("!stdSerializers.err")>-1&&(N=!1);const j=["error","fatal","warn","info","debug","trace"];typeof D=="function"&&(D.error=D.fatal=D.warn=D.info=D.debug=D.trace=D),m.enabled===!1&&(m.level="silent");const k=m.level||"info",x=Object.create(D);x.log||(x.log=b),Object.defineProperty(x,"levelVal",{get:w}),Object.defineProperty(x,"level",{get:P,set:C});const y={transmit:_,serialize:R,asObject:m.browser.asObject,levels:j,timestamp:f(m)};x.levels=s.levels,x.level=k,x.setMaxListeners=x.getMaxListeners=x.emit=x.addListener=x.on=x.prependListener=x.once=x.prependOnceListener=x.removeListener=x.removeAllListeners=x.listeners=x.listenerCount=x.eventNames=x.write=x.flush=b,x.serializers=O,x._serialize=R,x._stdErrSerialize=N,x.child=A,_&&(x._logEvent=l());function w(){return this.level==="silent"?1/0:this.levels.values[this.level]}function P(){return this._level}function C(T){if(T!=="silent"&&!this.levels.values[T])throw Error("unknown level "+T);this._level=T,n(y,x,"error","log"),n(y,x,"fatal","error"),n(y,x,"warn","error"),n(y,x,"info","log"),n(y,x,"debug","log"),n(y,x,"trace","log")}function A(T,F){if(!T)throw new Error("missing bindings for child Pino");F=F||{},R&&T.serializers&&(F.serializers=T.serializers);const M=F.serializers;if(R&&M){var z=Object.assign({},O,M),q=m.browser.serialize===!0?Object.keys(z):R;delete T.serializers,c([T],q,z,this._stdErrSerialize)}function H(V){this._childLevel=(V._childLevel|0)+1,this.error=u(V,T,"error"),this.fatal=u(V,T,"fatal"),this.warn=u(V,T,"warn"),this.info=u(V,T,"info"),this.debug=u(V,T,"debug"),this.trace=u(V,T,"trace"),z&&(this.serializers=z,this._serialize=q),_&&(this._logEvent=l([].concat(V._logEvent.bindings,T)))}return H.prototype=this,new H(this)}return x}s.levels={values:{fatal:60,error:50,warn:40,info:30,debug:20,trace:10},labels:{10:"trace",20:"debug",30:"info",40:"warn",50:"error",60:"fatal"}},s.stdSerializers=t,s.stdTimeFunctions=Object.assign({},{nullTime:$,epochTime:v,unixTime:S,isoTime:E});function n(m,_,D,O){const R=Object.getPrototypeOf(_);_[D]=_.levelVal>_.levels.values[D]?b:R[D]?R[D]:e[D]||e[O]||b,o(m,_,D)}function o(m,_,D){!m.transmit&&_[D]===b||(_[D]=function(O){return function(){const N=m.timestamp(),j=new Array(arguments.length),k=Object.getPrototypeOf&&Object.getPrototypeOf(this)===e?e:this;for(var x=0;x<j.length;x++)j[x]=arguments[x];if(m.serialize&&!m.asObject&&c(j,this._serialize,this.serializers,this._stdErrSerialize),m.asObject?O.call(k,a(this,D,j,N)):O.apply(k,j),m.transmit){const y=m.transmit.level||_.level,w=s.levels.values[y],P=s.levels.values[D];if(P<w)return;h(this,{ts:N,methodLevel:D,methodValue:P,transmitValue:s.levels.values[m.transmit.level||_.level],send:m.transmit.send,val:_.levelVal},j)}}}(_[D]))}function a(m,_,D,O){m._serialize&&c(D,m._serialize,m.serializers,m._stdErrSerialize);const R=D.slice();let N=R[0];const j={};O&&(j.time=O),j.level=s.levels.values[_];let k=(m._childLevel|0)+1;if(k<1&&(k=1),N!==null&&typeof N=="object"){for(;k--&&typeof R[0]=="object";)Object.assign(j,R.shift());N=R.length?r(R.shift(),R):void 0}else typeof N=="string"&&(N=r(R.shift(),R));return N!==void 0&&(j.msg=N),j}function c(m,_,D,O){for(const R in m)if(O&&m[R]instanceof Error)m[R]=s.stdSerializers.err(m[R]);else if(typeof m[R]=="object"&&!Array.isArray(m[R]))for(const N in m[R])_&&_.indexOf(N)>-1&&N in D&&(m[R][N]=D[N](m[R][N]))}function u(m,_,D){return function(){const O=new Array(1+arguments.length);O[0]=_;for(var R=1;R<O.length;R++)O[R]=arguments[R-1];return m[D].apply(this,O)}}function h(m,_,D){const O=_.send,R=_.ts,N=_.methodLevel,j=_.methodValue,k=_.val,x=m._logEvent.bindings;c(D,m._serialize||Object.keys(m.serializers),m.serializers,m._stdErrSerialize===void 0?!0:m._stdErrSerialize),m._logEvent.ts=R,m._logEvent.messages=D.filter(function(y){return x.indexOf(y)===-1}),m._logEvent.level.label=N,m._logEvent.level.value=j,O(N,m._logEvent,k),m._logEvent=l(x)}function l(m){return{ts:0,messages:[],bindings:m||[],level:{label:"",value:0}}}function d(m){const _={type:m.constructor.name,msg:m.message,stack:m.stack};for(const D in m)_[D]===void 0&&(_[D]=m[D]);return _}function f(m){return typeof m.timestamp=="function"?m.timestamp:m.timestamp===!1?$:v}function p(){return{}}function g(m){return m}function b(){}function $(){return!1}function v(){return Date.now()}function S(){return Math.round(Date.now()/1e3)}function E(){return new Date(Date.now()).toISOString()}function I(){function m(_){return typeof _<"u"&&_}try{return typeof globalThis<"u"||Object.defineProperty(Object.prototype,"globalThis",{get:function(){return delete Object.prototype.globalThis,this.globalThis=this},configurable:!0}),globalThis}catch{return m(self)||m(window)||m(this)||{}}}return bn}var Tr=w1();const Li=Io(Tr),b1={level:"info"},Ui="custom_context",ko=1e3*1024;let v1=class{constructor(e){this.nodeValue=e,this.sizeInBytes=new TextEncoder().encode(this.nodeValue).length,this.next=null}get value(){return this.nodeValue}get size(){return this.sizeInBytes}},Hc=class{constructor(e){this.head=null,this.tail=null,this.lengthInNodes=0,this.maxSizeInBytes=e,this.sizeInBytes=0}append(e){const t=new v1(e);if(t.size>this.maxSizeInBytes)throw new Error(`[LinkedList] Value too big to insert into list: ${e} with size ${t.size}`);for(;this.size+t.size>this.maxSizeInBytes;)this.shift();this.head?(this.tail&&(this.tail.next=t),this.tail=t):(this.head=t,this.tail=t),this.lengthInNodes++,this.sizeInBytes+=t.size}shift(){if(!this.head)return;const e=this.head;this.head=this.head.next,this.head||(this.tail=null),this.lengthInNodes--,this.sizeInBytes-=e.size}toArray(){const e=[];let t=this.head;for(;t!==null;)e.push(t.value),t=t.next;return e}get length(){return this.lengthInNodes}get size(){return this.sizeInBytes}toOrderedArray(){return Array.from(this)}[Symbol.iterator](){let e=this.head;return{next:()=>{if(!e)return{done:!0,value:null};const t=e.value;return e=e.next,{done:!1,value:t}}}}},Ul=class{constructor(e,t=ko){this.level=e??"error",this.levelValue=Tr.levels.values[this.level],this.MAX_LOG_SIZE_IN_BYTES=t,this.logs=new Hc(this.MAX_LOG_SIZE_IN_BYTES)}forwardToConsole(e,t){t===Tr.levels.values.error?console.error(e):t===Tr.levels.values.warn?console.warn(e):t===Tr.levels.values.debug?console.debug(e):t===Tr.levels.values.trace?console.trace(e):console.log(e)}appendToLogs(e){this.logs.append(Nt({timestamp:new Date().toISOString(),log:e}));const t=typeof e=="string"?JSON.parse(e).level:e.level;t>=this.levelValue&&this.forwardToConsole(e,t)}getLogs(){return this.logs}clearLogs(){this.logs=new Hc(this.MAX_LOG_SIZE_IN_BYTES)}getLogArray(){return Array.from(this.logs)}logsToBlob(e){const t=this.getLogArray();return t.push(Nt({extraMetadata:e})),new Blob(t,{type:"application/json"})}},E1=class{constructor(e,t=ko){this.baseChunkLogger=new Ul(e,t)}write(e){this.baseChunkLogger.appendToLogs(e)}getLogs(){return this.baseChunkLogger.getLogs()}clearLogs(){this.baseChunkLogger.clearLogs()}getLogArray(){return this.baseChunkLogger.getLogArray()}logsToBlob(e){return this.baseChunkLogger.logsToBlob(e)}downloadLogsBlobInBrowser(e){const t=URL.createObjectURL(this.logsToBlob(e)),i=document.createElement("a");i.href=t,i.download=`walletconnect-logs-${new Date().toISOString()}.txt`,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(t)}},_1=class{constructor(e,t=ko){this.baseChunkLogger=new Ul(e,t)}write(e){this.baseChunkLogger.appendToLogs(e)}getLogs(){return this.baseChunkLogger.getLogs()}clearLogs(){this.baseChunkLogger.clearLogs()}getLogArray(){return this.baseChunkLogger.getLogArray()}logsToBlob(e){return this.baseChunkLogger.logsToBlob(e)}};var I1=Object.defineProperty,$1=Object.defineProperties,S1=Object.getOwnPropertyDescriptors,Vc=Object.getOwnPropertySymbols,D1=Object.prototype.hasOwnProperty,O1=Object.prototype.propertyIsEnumerable,Kc=(r,e,t)=>e in r?I1(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,ws=(r,e)=>{for(var t in e||(e={}))D1.call(e,t)&&Kc(r,t,e[t]);if(Vc)for(var t of Vc(e))O1.call(e,t)&&Kc(r,t,e[t]);return r},bs=(r,e)=>$1(r,S1(e));function Ns(r){return bs(ws({},r),{level:(r==null?void 0:r.level)||b1.level})}function P1(r,e=Ui){return r[e]||""}function A1(r,e,t=Ui){return r[t]=e,r}function Me(r,e=Ui){let t="";return typeof r.bindings>"u"?t=P1(r,e):t=r.bindings().context||"",t}function x1(r,e,t=Ui){const i=Me(r,t);return i.trim()?`${i}/${e}`:e}function Ne(r,e,t=Ui){const i=x1(r,e,t),s=r.child({context:i});return A1(s,i,t)}function C1(r){var e,t;const i=new E1((e=r.opts)==null?void 0:e.level,r.maxSizeInBytes);return{logger:Li(bs(ws({},r.opts),{level:"trace",browser:bs(ws({},(t=r.opts)==null?void 0:t.browser),{write:s=>i.write(s)})})),chunkLoggerController:i}}function T1(r){var e;const t=new _1((e=r.opts)==null?void 0:e.level,r.maxSizeInBytes);return{logger:Li(bs(ws({},r.opts),{level:"trace"}),t),chunkLoggerController:t}}function R1(r){return typeof r.loggerOverride<"u"&&typeof r.loggerOverride!="string"?{logger:r.loggerOverride,chunkLoggerController:null}:typeof window<"u"?C1(r):T1(r)}var N1=Object.defineProperty,j1=(r,e,t)=>e in r?N1(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Wc=(r,e,t)=>j1(r,typeof e!="symbol"?e+"":e,t);let B1=class extends ur{constructor(e){super(),this.opts=e,Wc(this,"protocol","wc"),Wc(this,"version",2)}};var L1=Object.defineProperty,U1=(r,e,t)=>e in r?L1(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,F1=(r,e,t)=>U1(r,e+"",t);let q1=class extends ur{constructor(e,t){super(),this.core=e,this.logger=t,F1(this,"records",new Map)}},M1=class{constructor(e,t){this.logger=e,this.core=t}},k1=class extends ur{constructor(e,t){super(),this.relayer=e,this.logger=t}},z1=class extends ur{constructor(e){super()}},H1=class{constructor(e,t,i,s){this.core=e,this.logger=t,this.name=i}},V1=class extends ur{constructor(e,t){super(),this.relayer=e,this.logger=t}},K1=class extends ur{constructor(e,t){super(),this.core=e,this.logger=t}},W1=class{constructor(e,t,i){this.core=e,this.logger=t,this.store=i}},G1=class{constructor(e,t){this.projectId=e,this.logger=t}},Y1=class{constructor(e,t,i){this.core=e,this.logger=t,this.telemetryEnabled=i}};var J1=Object.defineProperty,Z1=(r,e,t)=>e in r?J1(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Gc=(r,e,t)=>Z1(r,typeof e!="symbol"?e+"":e,t);let Q1=class{constructor(e){this.opts=e,Gc(this,"protocol","wc"),Gc(this,"version",2)}},X1=class{constructor(e){this.client=e}};const eE="PARSE_ERROR",tE="INVALID_REQUEST",rE="METHOD_NOT_FOUND",iE="INVALID_PARAMS",Fl="INTERNAL_ERROR",zo="SERVER_ERROR",sE=[-32700,-32600,-32601,-32602,-32603],gi={[eE]:{code:-32700,message:"Parse error"},[tE]:{code:-32600,message:"Invalid Request"},[rE]:{code:-32601,message:"Method not found"},[iE]:{code:-32602,message:"Invalid params"},[Fl]:{code:-32603,message:"Internal error"},[zo]:{code:-32e3,message:"Server error"}},ql=zo;function nE(r){return sE.includes(r)}function Yc(r){return Object.keys(gi).includes(r)?gi[r]:gi[ql]}function oE(r){const e=Object.values(gi).find(t=>t.code===r);return e||gi[ql]}function Ml(r,e,t){return r.message.includes("getaddrinfo ENOTFOUND")||r.message.includes("connect ECONNREFUSED")?new Error(`Unavailable ${t} RPC url at ${e}`):r}var vn={};/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var io=function(r,e){return io=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var s in i)i.hasOwnProperty(s)&&(t[s]=i[s])},io(r,e)};function aE(r,e){io(r,e);function t(){this.constructor=r}r.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}var so=function(){return so=Object.assign||function(e){for(var t,i=1,s=arguments.length;i<s;i++){t=arguments[i];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e},so.apply(this,arguments)};function cE(r,e){var t={};for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&e.indexOf(i)<0&&(t[i]=r[i]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,i=Object.getOwnPropertySymbols(r);s<i.length;s++)e.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(r,i[s])&&(t[i[s]]=r[i[s]]);return t}function uE(r,e,t,i){var s=arguments.length,n=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")n=Reflect.decorate(r,e,t,i);else for(var a=r.length-1;a>=0;a--)(o=r[a])&&(n=(s<3?o(n):s>3?o(e,t,n):o(e,t))||n);return s>3&&n&&Object.defineProperty(e,t,n),n}function hE(r,e){return function(t,i){e(t,i,r)}}function lE(r,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(r,e)}function dE(r,e,t,i){function s(n){return n instanceof t?n:new t(function(o){o(n)})}return new(t||(t=Promise))(function(n,o){function a(h){try{u(i.next(h))}catch(l){o(l)}}function c(h){try{u(i.throw(h))}catch(l){o(l)}}function u(h){h.done?n(h.value):s(h.value).then(a,c)}u((i=i.apply(r,e||[])).next())})}function pE(r,e){var t={label:0,sent:function(){if(n[0]&1)throw n[1];return n[1]},trys:[],ops:[]},i,s,n,o;return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(u){return function(h){return c([u,h])}}function c(u){if(i)throw new TypeError("Generator is already executing.");for(;t;)try{if(i=1,s&&(n=u[0]&2?s.return:u[0]?s.throw||((n=s.return)&&n.call(s),0):s.next)&&!(n=n.call(s,u[1])).done)return n;switch(s=0,n&&(u=[u[0]&2,n.value]),u[0]){case 0:case 1:n=u;break;case 4:return t.label++,{value:u[1],done:!1};case 5:t.label++,s=u[1],u=[0];continue;case 7:u=t.ops.pop(),t.trys.pop();continue;default:if(n=t.trys,!(n=n.length>0&&n[n.length-1])&&(u[0]===6||u[0]===2)){t=0;continue}if(u[0]===3&&(!n||u[1]>n[0]&&u[1]<n[3])){t.label=u[1];break}if(u[0]===6&&t.label<n[1]){t.label=n[1],n=u;break}if(n&&t.label<n[2]){t.label=n[2],t.ops.push(u);break}n[2]&&t.ops.pop(),t.trys.pop();continue}u=e.call(r,t)}catch(h){u=[6,h],s=0}finally{i=n=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}function fE(r,e,t,i){i===void 0&&(i=t),r[i]=e[t]}function gE(r,e){for(var t in r)t!=="default"&&!e.hasOwnProperty(t)&&(e[t]=r[t])}function no(r){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&r[e],i=0;if(t)return t.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&i>=r.length&&(r=void 0),{value:r&&r[i++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function kl(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var i=t.call(r),s,n=[],o;try{for(;(e===void 0||e-- >0)&&!(s=i.next()).done;)n.push(s.value)}catch(a){o={error:a}}finally{try{s&&!s.done&&(t=i.return)&&t.call(i)}finally{if(o)throw o.error}}return n}function yE(){for(var r=[],e=0;e<arguments.length;e++)r=r.concat(kl(arguments[e]));return r}function mE(){for(var r=0,e=0,t=arguments.length;e<t;e++)r+=arguments[e].length;for(var i=Array(r),s=0,e=0;e<t;e++)for(var n=arguments[e],o=0,a=n.length;o<a;o++,s++)i[s]=n[o];return i}function Di(r){return this instanceof Di?(this.v=r,this):new Di(r)}function wE(r,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i=t.apply(r,e||[]),s,n=[];return s={},o("next"),o("throw"),o("return"),s[Symbol.asyncIterator]=function(){return this},s;function o(d){i[d]&&(s[d]=function(f){return new Promise(function(p,g){n.push([d,f,p,g])>1||a(d,f)})})}function a(d,f){try{c(i[d](f))}catch(p){l(n[0][3],p)}}function c(d){d.value instanceof Di?Promise.resolve(d.value.v).then(u,h):l(n[0][2],d)}function u(d){a("next",d)}function h(d){a("throw",d)}function l(d,f){d(f),n.shift(),n.length&&a(n[0][0],n[0][1])}}function bE(r){var e,t;return e={},i("next"),i("throw",function(s){throw s}),i("return"),e[Symbol.iterator]=function(){return this},e;function i(s,n){e[s]=r[s]?function(o){return(t=!t)?{value:Di(r[s](o)),done:s==="return"}:n?n(o):o}:n}}function vE(r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=r[Symbol.asyncIterator],t;return e?e.call(r):(r=typeof no=="function"?no(r):r[Symbol.iterator](),t={},i("next"),i("throw"),i("return"),t[Symbol.asyncIterator]=function(){return this},t);function i(n){t[n]=r[n]&&function(o){return new Promise(function(a,c){o=r[n](o),s(a,c,o.done,o.value)})}}function s(n,o,a,c){Promise.resolve(c).then(function(u){n({value:u,done:a})},o)}}function EE(r,e){return Object.defineProperty?Object.defineProperty(r,"raw",{value:e}):r.raw=e,r}function _E(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)Object.hasOwnProperty.call(r,t)&&(e[t]=r[t]);return e.default=r,e}function IE(r){return r&&r.__esModule?r:{default:r}}function $E(r,e){if(!e.has(r))throw new TypeError("attempted to get private field on non-instance");return e.get(r)}function SE(r,e,t){if(!e.has(r))throw new TypeError("attempted to set private field on non-instance");return e.set(r,t),t}const DE=Object.freeze(Object.defineProperty({__proto__:null,get __assign(){return so},__asyncDelegator:bE,__asyncGenerator:wE,__asyncValues:vE,__await:Di,__awaiter:dE,__classPrivateFieldGet:$E,__classPrivateFieldSet:SE,__createBinding:fE,__decorate:uE,__exportStar:gE,__extends:aE,__generator:pE,__importDefault:IE,__importStar:_E,__makeTemplateObject:EE,__metadata:lE,__param:hE,__read:kl,__rest:cE,__spread:yE,__spreadArrays:mE,__values:no},Symbol.toStringTag,{value:"Module"})),OE=Xu(DE);var Ot={},Jc;function PE(){if(Jc)return Ot;Jc=1,Object.defineProperty(Ot,"__esModule",{value:!0}),Ot.isBrowserCryptoAvailable=Ot.getSubtleCrypto=Ot.getBrowerCrypto=void 0;function r(){return(vt===null||vt===void 0?void 0:vt.crypto)||(vt===null||vt===void 0?void 0:vt.msCrypto)||{}}Ot.getBrowerCrypto=r;function e(){const i=r();return i.subtle||i.webkitSubtle}Ot.getSubtleCrypto=e;function t(){return!!r()&&!!e()}return Ot.isBrowserCryptoAvailable=t,Ot}var Pt={},Zc;function AE(){if(Zc)return Pt;Zc=1,Object.defineProperty(Pt,"__esModule",{value:!0}),Pt.isBrowser=Pt.isNode=Pt.isReactNative=void 0;function r(){return typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"}Pt.isReactNative=r;function e(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"}Pt.isNode=e;function t(){return!r()&&!e()}return Pt.isBrowser=t,Pt}var Qc;function xE(){return Qc||(Qc=1,function(r){Object.defineProperty(r,"__esModule",{value:!0});const e=OE;e.__exportStar(PE(),r),e.__exportStar(AE(),r)}(vn)),vn}var CE=xE();function wt(r=3){const e=Date.now()*Math.pow(10,r),t=Math.floor(Math.random()*Math.pow(10,r));return e+t}function tr(r=6){return BigInt(wt(r))}function kt(r,e,t){return{id:t||wt(),jsonrpc:"2.0",method:r,params:e}}function js(r,e){return{id:r,jsonrpc:"2.0",result:e}}function Bs(r,e,t){return{id:r,jsonrpc:"2.0",error:TE(e)}}function TE(r,e){return typeof r>"u"?Yc(Fl):(typeof r=="string"&&(r=Object.assign(Object.assign({},Yc(zo)),{message:r})),nE(r.code)&&(r=oE(r.code)),r)}class RE{}class NE extends RE{constructor(){super()}}class jE extends NE{constructor(e){super()}}const BE="^https?:",LE="^wss?:";function UE(r){const e=r.match(new RegExp(/^\w+:/,"gi"));if(!(!e||!e.length))return e[0]}function zl(r,e){const t=UE(r);return typeof t>"u"?!1:new RegExp(e).test(t)}function Xc(r){return zl(r,BE)}function eu(r){return zl(r,LE)}function FE(r){return new RegExp("wss?://localhost(:d{2,5})?").test(r)}function Hl(r){return typeof r=="object"&&"id"in r&&"jsonrpc"in r&&r.jsonrpc==="2.0"}function Ho(r){return Hl(r)&&"method"in r}function Ls(r){return Hl(r)&&(bt(r)||tt(r))}function bt(r){return"result"in r}function tt(r){return"error"in r}let it=class extends jE{constructor(e){super(e),this.events=new Ye.EventEmitter,this.hasRegisteredEventListeners=!1,this.connection=this.setConnection(e),this.connection.connected&&this.registerEventListeners()}async connect(e=this.connection){await this.open(e)}async disconnect(){await this.close()}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}off(e,t){this.events.off(e,t)}removeListener(e,t){this.events.removeListener(e,t)}async request(e,t){return this.requestStrict(kt(e.method,e.params||[],e.id||tr().toString()),t)}async requestStrict(e,t){return new Promise(async(i,s)=>{if(!this.connection.connected)try{await this.open()}catch(n){s(n)}this.events.on(`${e.id}`,n=>{tt(n)?s(n.error):i(n.result)});try{await this.connection.send(e,t)}catch(n){s(n)}})}setConnection(e=this.connection){return e}onPayload(e){this.events.emit("payload",e),Ls(e)?this.events.emit(`${e.id}`,e):this.events.emit("message",{type:e.method,data:e.params})}onClose(e){e&&e.code===3e3&&this.events.emit("error",new Error(`WebSocket connection closed abnormally with code: ${e.code} ${e.reason?`(${e.reason})`:""}`)),this.events.emit("disconnect")}async open(e=this.connection){this.connection===e&&this.connection.connected||(this.connection.connected&&this.close(),typeof e=="string"&&(await this.connection.open(e),e=this.connection),this.connection=this.setConnection(e),await this.connection.open(),this.registerEventListeners(),this.events.emit("connect"))}async close(){await this.connection.close()}registerEventListeners(){this.hasRegisteredEventListeners||(this.connection.on("payload",e=>this.onPayload(e)),this.connection.on("close",e=>this.onClose(e)),this.connection.on("error",e=>this.events.emit("error",e)),this.connection.on("register_error",e=>this.onClose()),this.hasRegisteredEventListeners=!0)}};const qE=()=>typeof WebSocket<"u"?WebSocket:typeof global<"u"&&typeof global.WebSocket<"u"?global.WebSocket:typeof window<"u"&&typeof window.WebSocket<"u"?window.WebSocket:typeof self<"u"&&typeof self.WebSocket<"u"?self.WebSocket:require("ws"),ME=()=>typeof WebSocket<"u"||typeof global<"u"&&typeof global.WebSocket<"u"||typeof window<"u"&&typeof window.WebSocket<"u"||typeof self<"u"&&typeof self.WebSocket<"u",tu=r=>r.split("?")[0],ru=10,kE=qE();let zE=class{constructor(e){if(this.url=e,this.events=new Ye.EventEmitter,this.registering=!1,!eu(e))throw new Error(`Provided URL is not compatible with WebSocket connection: ${e}`);this.url=e}get connected(){return typeof this.socket<"u"}get connecting(){return this.registering}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}off(e,t){this.events.off(e,t)}removeListener(e,t){this.events.removeListener(e,t)}async open(e=this.url){await this.register(e)}async close(){return new Promise((e,t)=>{if(typeof this.socket>"u"){t(new Error("Connection already closed"));return}this.socket.onclose=i=>{this.onClose(i),e()},this.socket.close()})}async send(e){typeof this.socket>"u"&&(this.socket=await this.register());try{this.socket.send(Nt(e))}catch(t){this.onError(e.id,t)}}register(e=this.url){if(!eu(e))throw new Error(`Provided URL is not compatible with WebSocket connection: ${e}`);if(this.registering){const t=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=t||this.events.listenerCount("open")>=t)&&this.events.setMaxListeners(t+1),new Promise((i,s)=>{this.events.once("register_error",n=>{this.resetMaxListeners(),s(n)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.socket>"u")return s(new Error("WebSocket connection is missing or invalid"));i(this.socket)})})}return this.url=e,this.registering=!0,new Promise((t,i)=>{const s=CE.isReactNative()?void 0:{rejectUnauthorized:!FE(e)},n=new kE(e,[],s);ME()?n.onerror=o=>{const a=o;i(this.emitError(a.error))}:n.on("error",o=>{i(this.emitError(o))}),n.onopen=()=>{this.onOpen(n),t(n)}})}onOpen(e){e.onmessage=t=>this.onPayload(t),e.onclose=t=>this.onClose(t),this.socket=e,this.registering=!1,this.events.emit("open")}onClose(e){this.socket=void 0,this.registering=!1,this.events.emit("close",e)}onPayload(e){if(typeof e.data>"u")return;const t=typeof e.data=="string"?nr(e.data):e.data;this.events.emit("payload",t)}onError(e,t){const i=this.parseError(t),s=i.message||i.toString(),n=Bs(e,s);this.events.emit("payload",n)}parseError(e,t=this.url){return Ml(e,tu(t),"WS")}resetMaxListeners(){this.events.getMaxListeners()>ru&&this.events.setMaxListeners(ru)}emitError(e){const t=this.parseError(new Error((e==null?void 0:e.message)||`WebSocket connection failed for host: ${tu(this.url)}`));return this.events.emit("register_error",t),t}};var HE={};const Vl="wc",Kl=2,oo="core",_t=`${Vl}@2:${oo}:`,VE={logger:"error"},KE={database:":memory:"},WE="crypto",iu="client_ed25519_seed",GE=L.ONE_DAY,YE="keychain",JE="0.3",ZE="messages",QE="0.3",su=L.SIX_HOURS,XE="publisher",Wl="irn",e_="error",Gl="wss://relay.walletconnect.org",t_="relayer",we={message:"relayer_message",message_ack:"relayer_message_ack",connect:"relayer_connect",disconnect:"relayer_disconnect",error:"relayer_error",connection_stalled:"relayer_connection_stalled",transport_closed:"relayer_transport_closed",publish:"relayer_publish"},r_="_subscription",Qe={payload:"payload",connect:"connect",disconnect:"disconnect",error:"error"},i_=.1,ao="2.19.2",ae={link_mode:"link_mode",relay:"relay"},us={inbound:"inbound",outbound:"outbound"},s_="0.3",n_="WALLETCONNECT_CLIENT_ID",nu="WALLETCONNECT_LINK_MODE_APPS",He={created:"subscription_created",deleted:"subscription_deleted",expired:"subscription_expired",disabled:"subscription_disabled",sync:"subscription_sync",resubscribed:"subscription_resubscribed"},o_="subscription",a_="0.3",c_="pairing",u_="0.3",oi={wc_pairingDelete:{req:{ttl:L.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:L.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:L.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:L.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:L.ONE_DAY,prompt:!1,tag:0},res:{ttl:L.ONE_DAY,prompt:!1,tag:0}}},Qt={create:"pairing_create",expire:"pairing_expire",delete:"pairing_delete",ping:"pairing_ping"},ot={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},h_="history",l_="0.3",d_="expirer",et={created:"expirer_created",deleted:"expirer_deleted",expired:"expirer_expired",sync:"expirer_sync"},p_="0.3",f_="verify-api",g_="https://verify.walletconnect.com",Yl="https://verify.walletconnect.org",yi=Yl,y_=`${yi}/v3`,m_=[g_,Yl],w_="echo",b_="https://echo.walletconnect.com",mt={pairing_started:"pairing_started",pairing_uri_validation_success:"pairing_uri_validation_success",pairing_uri_not_expired:"pairing_uri_not_expired",store_new_pairing:"store_new_pairing",subscribing_pairing_topic:"subscribing_pairing_topic",subscribe_pairing_topic_success:"subscribe_pairing_topic_success",existing_pairing:"existing_pairing",pairing_not_expired:"pairing_not_expired",emit_inactive_pairing:"emit_inactive_pairing",emit_session_proposal:"emit_session_proposal",subscribing_to_pairing_topic:"subscribing_to_pairing_topic"},At={no_wss_connection:"no_wss_connection",no_internet_connection:"no_internet_connection",malformed_pairing_uri:"malformed_pairing_uri",active_pairing_already_exists:"active_pairing_already_exists",subscribe_pairing_topic_failure:"subscribe_pairing_topic_failure",pairing_expired:"pairing_expired",proposal_expired:"proposal_expired",proposal_listener_not_found:"proposal_listener_not_found"},at={session_approve_started:"session_approve_started",proposal_not_expired:"proposal_not_expired",session_namespaces_validation_success:"session_namespaces_validation_success",create_session_topic:"create_session_topic",subscribing_session_topic:"subscribing_session_topic",subscribe_session_topic_success:"subscribe_session_topic_success",publishing_session_approve:"publishing_session_approve",session_approve_publish_success:"session_approve_publish_success",store_session:"store_session",publishing_session_settle:"publishing_session_settle",session_settle_publish_success:"session_settle_publish_success"},Wt={no_internet_connection:"no_internet_connection",no_wss_connection:"no_wss_connection",proposal_expired:"proposal_expired",subscribe_session_topic_failure:"subscribe_session_topic_failure",session_approve_publish_failure:"session_approve_publish_failure",session_settle_publish_failure:"session_settle_publish_failure",session_approve_namespace_validation_failure:"session_approve_namespace_validation_failure",proposal_not_found:"proposal_not_found"},Gt={authenticated_session_approve_started:"authenticated_session_approve_started",create_authenticated_session_topic:"create_authenticated_session_topic",cacaos_verified:"cacaos_verified",store_authenticated_session:"store_authenticated_session",subscribing_authenticated_session_topic:"subscribing_authenticated_session_topic",subscribe_authenticated_session_topic_success:"subscribe_authenticated_session_topic_success",publishing_authenticated_session_approve:"publishing_authenticated_session_approve"},ai={no_internet_connection:"no_internet_connection",invalid_cacao:"invalid_cacao",subscribe_authenticated_session_topic_failure:"subscribe_authenticated_session_topic_failure",authenticated_session_approve_publish_failure:"authenticated_session_approve_publish_failure",authenticated_session_pending_request_not_found:"authenticated_session_pending_request_not_found"},v_=.1,E_="event-client",__=86400,I_="https://pulse.walletconnect.org/batch";function $_(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),i=0;i<t.length;i++)t[i]=255;for(var s=0;s<r.length;s++){var n=r.charAt(s),o=n.charCodeAt(0);if(t[o]!==255)throw new TypeError(n+" is ambiguous");t[o]=s}var a=r.length,c=r.charAt(0),u=Math.log(a)/Math.log(256),h=Math.log(256)/Math.log(a);function l(p){if(p instanceof Uint8Array||(ArrayBuffer.isView(p)?p=new Uint8Array(p.buffer,p.byteOffset,p.byteLength):Array.isArray(p)&&(p=Uint8Array.from(p))),!(p instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(p.length===0)return"";for(var g=0,b=0,$=0,v=p.length;$!==v&&p[$]===0;)$++,g++;for(var S=(v-$)*h+1>>>0,E=new Uint8Array(S);$!==v;){for(var I=p[$],m=0,_=S-1;(I!==0||m<b)&&_!==-1;_--,m++)I+=256*E[_]>>>0,E[_]=I%a>>>0,I=I/a>>>0;if(I!==0)throw new Error("Non-zero carry");b=m,$++}for(var D=S-b;D!==S&&E[D]===0;)D++;for(var O=c.repeat(g);D<S;++D)O+=r.charAt(E[D]);return O}function d(p){if(typeof p!="string")throw new TypeError("Expected String");if(p.length===0)return new Uint8Array;var g=0;if(p[g]!==" "){for(var b=0,$=0;p[g]===c;)b++,g++;for(var v=(p.length-g)*u+1>>>0,S=new Uint8Array(v);p[g];){var E=t[p.charCodeAt(g)];if(E===255)return;for(var I=0,m=v-1;(E!==0||I<$)&&m!==-1;m--,I++)E+=a*S[m]>>>0,S[m]=E%256>>>0,E=E/256>>>0;if(E!==0)throw new Error("Non-zero carry");$=I,g++}if(p[g]!==" "){for(var _=v-$;_!==v&&S[_]===0;)_++;for(var D=new Uint8Array(b+(v-_)),O=b;_!==v;)D[O++]=S[_++];return D}}}function f(p){var g=d(p);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:l,decodeUnsafe:d,decode:f}}var S_=$_,D_=S_;const Jl=r=>{if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")},O_=r=>new TextEncoder().encode(r),P_=r=>new TextDecoder().decode(r);class A_{constructor(e,t,i){this.name=e,this.prefix=t,this.baseEncode=i}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class x_{constructor(e,t,i){if(this.name=e,this.prefix=t,t.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=i}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return Zl(this,e)}}class C_{constructor(e){this.decoders=e}or(e){return Zl(this,e)}decode(e){const t=e[0],i=this.decoders[t];if(i)return i.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const Zl=(r,e)=>new C_({...r.decoders||{[r.prefix]:r},...e.decoders||{[e.prefix]:e}});class T_{constructor(e,t,i,s){this.name=e,this.prefix=t,this.baseEncode=i,this.baseDecode=s,this.encoder=new A_(e,t,i),this.decoder=new x_(e,t,s)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const Us=({name:r,prefix:e,encode:t,decode:i})=>new T_(r,e,t,i),Fi=({prefix:r,name:e,alphabet:t})=>{const{encode:i,decode:s}=D_(t,e);return Us({prefix:r,name:e,encode:i,decode:n=>Jl(s(n))})},R_=(r,e,t,i)=>{const s={};for(let h=0;h<e.length;++h)s[e[h]]=h;let n=r.length;for(;r[n-1]==="=";)--n;const o=new Uint8Array(n*t/8|0);let a=0,c=0,u=0;for(let h=0;h<n;++h){const l=s[r[h]];if(l===void 0)throw new SyntaxError(`Non-${i} character`);c=c<<t|l,a+=t,a>=8&&(a-=8,o[u++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},N_=(r,e,t)=>{const i=e[e.length-1]==="=",s=(1<<t)-1;let n="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,n+=e[s&a>>o];if(o&&(n+=e[s&a<<t-o]),i)for(;n.length*t&7;)n+="=";return n},Pe=({name:r,prefix:e,bitsPerChar:t,alphabet:i})=>Us({prefix:e,name:r,encode(s){return N_(s,i,t)},decode(s){return R_(s,i,t,r)}}),j_=Us({prefix:"\0",name:"identity",encode:r=>P_(r),decode:r=>O_(r)});var B_=Object.freeze({__proto__:null,identity:j_});const L_=Pe({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var U_=Object.freeze({__proto__:null,base2:L_});const F_=Pe({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var q_=Object.freeze({__proto__:null,base8:F_});const M_=Fi({prefix:"9",name:"base10",alphabet:"0123456789"});var k_=Object.freeze({__proto__:null,base10:M_});const z_=Pe({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),H_=Pe({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var V_=Object.freeze({__proto__:null,base16:z_,base16upper:H_});const K_=Pe({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),W_=Pe({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),G_=Pe({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),Y_=Pe({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),J_=Pe({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),Z_=Pe({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),Q_=Pe({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),X_=Pe({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),eI=Pe({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var tI=Object.freeze({__proto__:null,base32:K_,base32upper:W_,base32pad:G_,base32padupper:Y_,base32hex:J_,base32hexupper:Z_,base32hexpad:Q_,base32hexpadupper:X_,base32z:eI});const rI=Fi({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),iI=Fi({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var sI=Object.freeze({__proto__:null,base36:rI,base36upper:iI});const nI=Fi({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),oI=Fi({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var aI=Object.freeze({__proto__:null,base58btc:nI,base58flickr:oI});const cI=Pe({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),uI=Pe({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),hI=Pe({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),lI=Pe({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var dI=Object.freeze({__proto__:null,base64:cI,base64pad:uI,base64url:hI,base64urlpad:lI});const Ql=Array.from(""),pI=Ql.reduce((r,e,t)=>(r[t]=e,r),[]),fI=Ql.reduce((r,e,t)=>(r[e.codePointAt(0)]=t,r),[]);function gI(r){return r.reduce((e,t)=>(e+=pI[t],e),"")}function yI(r){const e=[];for(const t of r){const i=fI[t.codePointAt(0)];if(i===void 0)throw new Error(`Non-base256emoji character: ${t}`);e.push(i)}return new Uint8Array(e)}const mI=Us({prefix:"",name:"base256emoji",encode:gI,decode:yI});var wI=Object.freeze({__proto__:null,base256emoji:mI}),bI=Xl,ou=128,vI=-128,EI=Math.pow(2,31);function Xl(r,e,t){e=e||[],t=t||0;for(var i=t;r>=EI;)e[t++]=r&255|ou,r/=128;for(;r&vI;)e[t++]=r&255|ou,r>>>=7;return e[t]=r|0,Xl.bytes=t-i+1,e}var _I=co,II=128,au=127;function co(r,i){var t=0,i=i||0,s=0,n=i,o,a=r.length;do{if(n>=a)throw co.bytes=0,new RangeError("Could not decode varint");o=r[n++],t+=s<28?(o&au)<<s:(o&au)*Math.pow(2,s),s+=7}while(o>=II);return co.bytes=n-i,t}var $I=Math.pow(2,7),SI=Math.pow(2,14),DI=Math.pow(2,21),OI=Math.pow(2,28),PI=Math.pow(2,35),AI=Math.pow(2,42),xI=Math.pow(2,49),CI=Math.pow(2,56),TI=Math.pow(2,63),RI=function(r){return r<$I?1:r<SI?2:r<DI?3:r<OI?4:r<PI?5:r<AI?6:r<xI?7:r<CI?8:r<TI?9:10},NI={encode:bI,decode:_I,encodingLength:RI},ed=NI;const cu=(r,e,t=0)=>(ed.encode(r,e,t),e),uu=r=>ed.encodingLength(r),uo=(r,e)=>{const t=e.byteLength,i=uu(r),s=i+uu(t),n=new Uint8Array(s+t);return cu(r,n,0),cu(t,n,i),n.set(e,s),new jI(r,t,e,n)};class jI{constructor(e,t,i,s){this.code=e,this.size=t,this.digest=i,this.bytes=s}}const td=({name:r,code:e,encode:t})=>new BI(r,e,t);class BI{constructor(e,t,i){this.name=e,this.code=t,this.encode=i}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?uo(this.code,t):t.then(i=>uo(this.code,i))}else throw Error("Unknown type, must be binary type")}}const rd=r=>async e=>new Uint8Array(await crypto.subtle.digest(r,e)),LI=td({name:"sha2-256",code:18,encode:rd("SHA-256")}),UI=td({name:"sha2-512",code:19,encode:rd("SHA-512")});var FI=Object.freeze({__proto__:null,sha256:LI,sha512:UI});const id=0,qI="identity",sd=Jl,MI=r=>uo(id,sd(r)),kI={code:id,name:qI,encode:sd,digest:MI};var zI=Object.freeze({__proto__:null,identity:kI});new TextEncoder,new TextDecoder;const hu={...B_,...U_,...q_,...k_,...V_,...tI,...sI,...aI,...dI,...wI};({...FI,...zI});function HI(r=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?globalThis.Buffer.allocUnsafe(r):new Uint8Array(r)}function nd(r,e,t,i){return{name:r,prefix:e,encoder:{name:r,prefix:e,encode:t},decoder:{decode:i}}}const lu=nd("utf8","u",r=>"u"+new TextDecoder("utf8").decode(r),r=>new TextEncoder().encode(r.substring(1))),En=nd("ascii","a",r=>{let e="a";for(let t=0;t<r.length;t++)e+=String.fromCharCode(r[t]);return e},r=>{r=r.substring(1);const e=HI(r.length);for(let t=0;t<r.length;t++)e[t]=r.charCodeAt(t);return e}),VI={utf8:lu,"utf-8":lu,hex:hu.base16,latin1:En,ascii:En,binary:En,...hu};function KI(r,e="utf8"){const t=VI[e];if(!t)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(r,"utf8"):t.decoder.decode(`${t.prefix}${r}`)}var WI=Object.defineProperty,GI=(r,e,t)=>e in r?WI(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,gt=(r,e,t)=>GI(r,typeof e!="symbol"?e+"":e,t);class YI{constructor(e,t){this.core=e,this.logger=t,gt(this,"keychain",new Map),gt(this,"name",YE),gt(this,"version",JE),gt(this,"initialized",!1),gt(this,"storagePrefix",_t),gt(this,"init",async()=>{if(!this.initialized){const i=await this.getKeyChain();typeof i<"u"&&(this.keychain=i),this.initialized=!0}}),gt(this,"has",i=>(this.isInitialized(),this.keychain.has(i))),gt(this,"set",async(i,s)=>{this.isInitialized(),this.keychain.set(i,s),await this.persist()}),gt(this,"get",i=>{this.isInitialized();const s=this.keychain.get(i);if(typeof s>"u"){const{message:n}=U("NO_MATCHING_KEY",`${this.name}: ${i}`);throw new Error(n)}return s}),gt(this,"del",async i=>{this.isInitialized(),this.keychain.delete(i),await this.persist()}),this.core=e,this.logger=Ne(t,this.name)}get context(){return Me(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setKeyChain(e){await this.core.storage.setItem(this.storageKey,Hn(e))}async getKeyChain(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?Vn(e):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){const{message:e}=U("NOT_INITIALIZED",this.name);throw new Error(e)}}}var JI=Object.defineProperty,ZI=(r,e,t)=>e in r?JI(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Ie=(r,e,t)=>ZI(r,typeof e!="symbol"?e+"":e,t);class QI{constructor(e,t,i){this.core=e,this.logger=t,Ie(this,"name",WE),Ie(this,"keychain"),Ie(this,"randomSessionIdentifier",to()),Ie(this,"initialized",!1),Ie(this,"init",async()=>{this.initialized||(await this.keychain.init(),this.initialized=!0)}),Ie(this,"hasKeys",s=>(this.isInitialized(),this.keychain.has(s))),Ie(this,"getClientId",async()=>{this.isInitialized();const s=await this.getClientSeed(),n=Ha(s);return Hh(n.publicKey)}),Ie(this,"generateKeyPair",()=>{this.isInitialized();const s=Mv();return this.setPrivateKey(s.publicKey,s.privateKey)}),Ie(this,"signJWT",async s=>{this.isInitialized();const n=await this.getClientSeed(),o=Ha(n),a=this.randomSessionIdentifier;return await sm(a,s,GE,o)}),Ie(this,"generateSharedKey",(s,n,o)=>{this.isInitialized();const a=this.getPrivateKey(s),c=kv(a,n);return this.setSymKey(c,o)}),Ie(this,"setSymKey",async(s,n)=>{this.isInitialized();const o=n||os(s);return await this.keychain.set(o,s),o}),Ie(this,"deleteKeyPair",async s=>{this.isInitialized(),await this.keychain.del(s)}),Ie(this,"deleteSymKey",async s=>{this.isInitialized(),await this.keychain.del(s)}),Ie(this,"encode",async(s,n,o)=>{this.isInitialized();const a=Rl(o),c=Nt(n);if(Pc(a))return Vv(c,o==null?void 0:o.encoding);if(Oc(a)){const d=a.senderPublicKey,f=a.receiverPublicKey;s=await this.generateSharedKey(d,f)}const u=this.getSymKey(s),{type:h,senderPublicKey:l}=a;return zv({type:h,symKey:u,message:c,senderPublicKey:l,encoding:o==null?void 0:o.encoding})}),Ie(this,"decode",async(s,n,o)=>{this.isInitialized();const a=Wv(n,o);if(Pc(a)){const c=Kv(n,o==null?void 0:o.encoding);return nr(c)}if(Oc(a)){const c=a.receiverPublicKey,u=a.senderPublicKey;s=await this.generateSharedKey(c,u)}try{const c=this.getSymKey(s),u=Hv({symKey:c,encoded:n,encoding:o==null?void 0:o.encoding});return nr(u)}catch(c){this.logger.error(`Failed to decode message from topic: '${s}', clientId: '${await this.getClientId()}'`),this.logger.error(c)}}),Ie(this,"getPayloadType",(s,n=ht)=>{const o=$i({encoded:s,encoding:n});return cr(o.type)}),Ie(this,"getPayloadSenderPublicKey",(s,n=ht)=>{const o=$i({encoded:s,encoding:n});return o.senderPublicKey?qe(o.senderPublicKey,Re):void 0}),this.core=e,this.logger=Ne(t,this.name),this.keychain=i||new YI(this.core,this.logger)}get context(){return Me(this.logger)}async setPrivateKey(e,t){return await this.keychain.set(e,t),e}getPrivateKey(e){return this.keychain.get(e)}async getClientSeed(){let e="";try{e=this.keychain.get(iu)}catch{e=to(),await this.keychain.set(iu,e)}return KI(e,"base16")}getSymKey(e){return this.keychain.get(e)}isInitialized(){if(!this.initialized){const{message:e}=U("NOT_INITIALIZED",this.name);throw new Error(e)}}}var XI=Object.defineProperty,e2=Object.defineProperties,t2=Object.getOwnPropertyDescriptors,du=Object.getOwnPropertySymbols,r2=Object.prototype.hasOwnProperty,i2=Object.prototype.propertyIsEnumerable,ho=(r,e,t)=>e in r?XI(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,s2=(r,e)=>{for(var t in e||(e={}))r2.call(e,t)&&ho(r,t,e[t]);if(du)for(var t of du(e))i2.call(e,t)&&ho(r,t,e[t]);return r},n2=(r,e)=>e2(r,t2(e)),ke=(r,e,t)=>ho(r,typeof e!="symbol"?e+"":e,t);class o2 extends M1{constructor(e,t){super(e,t),this.logger=e,this.core=t,ke(this,"messages",new Map),ke(this,"messagesWithoutClientAck",new Map),ke(this,"name",ZE),ke(this,"version",QE),ke(this,"initialized",!1),ke(this,"storagePrefix",_t),ke(this,"init",async()=>{if(!this.initialized){this.logger.trace("Initialized");try{const i=await this.getRelayerMessages();typeof i<"u"&&(this.messages=i);const s=await this.getRelayerMessagesWithoutClientAck();typeof s<"u"&&(this.messagesWithoutClientAck=s),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",size:this.messages.size})}catch(i){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(i)}finally{this.initialized=!0}}}),ke(this,"set",async(i,s,n)=>{this.isInitialized();const o=Et(s);let a=this.messages.get(i);if(typeof a>"u"&&(a={}),typeof a[o]<"u")return o;if(a[o]=s,this.messages.set(i,a),n===us.inbound){const c=this.messagesWithoutClientAck.get(i)||{};this.messagesWithoutClientAck.set(i,n2(s2({},c),{[o]:s}))}return await this.persist(),o}),ke(this,"get",i=>{this.isInitialized();let s=this.messages.get(i);return typeof s>"u"&&(s={}),s}),ke(this,"getWithoutAck",i=>{this.isInitialized();const s={};for(const n of i){const o=this.messagesWithoutClientAck.get(n)||{};s[n]=Object.values(o)}return s}),ke(this,"has",(i,s)=>{this.isInitialized();const n=this.get(i),o=Et(s);return typeof n[o]<"u"}),ke(this,"ack",async(i,s)=>{this.isInitialized();const n=this.messagesWithoutClientAck.get(i);if(typeof n>"u")return;const o=Et(s);delete n[o],Object.keys(n).length===0?this.messagesWithoutClientAck.delete(i):this.messagesWithoutClientAck.set(i,n),await this.persist()}),ke(this,"del",async i=>{this.isInitialized(),this.messages.delete(i),this.messagesWithoutClientAck.delete(i),await this.persist()}),this.logger=Ne(e,this.name),this.core=t}get context(){return Me(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get storageKeyWithoutClientAck(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name+"_withoutClientAck"}async setRelayerMessages(e){await this.core.storage.setItem(this.storageKey,Hn(e))}async setRelayerMessagesWithoutClientAck(e){await this.core.storage.setItem(this.storageKeyWithoutClientAck,Hn(e))}async getRelayerMessages(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?Vn(e):void 0}async getRelayerMessagesWithoutClientAck(){const e=await this.core.storage.getItem(this.storageKeyWithoutClientAck);return typeof e<"u"?Vn(e):void 0}async persist(){await this.setRelayerMessages(this.messages),await this.setRelayerMessagesWithoutClientAck(this.messagesWithoutClientAck)}isInitialized(){if(!this.initialized){const{message:e}=U("NOT_INITIALIZED",this.name);throw new Error(e)}}}var a2=Object.defineProperty,c2=Object.defineProperties,u2=Object.getOwnPropertyDescriptors,pu=Object.getOwnPropertySymbols,h2=Object.prototype.hasOwnProperty,l2=Object.prototype.propertyIsEnumerable,lo=(r,e,t)=>e in r?a2(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Zi=(r,e)=>{for(var t in e||(e={}))h2.call(e,t)&&lo(r,t,e[t]);if(pu)for(var t of pu(e))l2.call(e,t)&&lo(r,t,e[t]);return r},_n=(r,e)=>c2(r,u2(e)),ct=(r,e,t)=>lo(r,typeof e!="symbol"?e+"":e,t);class d2 extends k1{constructor(e,t){super(e,t),this.relayer=e,this.logger=t,ct(this,"events",new Ye.EventEmitter),ct(this,"name",XE),ct(this,"queue",new Map),ct(this,"publishTimeout",L.toMiliseconds(L.ONE_MINUTE)),ct(this,"initialPublishTimeout",L.toMiliseconds(L.ONE_SECOND*15)),ct(this,"needsTransportRestart",!1),ct(this,"publish",async(i,s,n)=>{var o;this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:i,message:s,opts:n}});const a=(n==null?void 0:n.ttl)||su,c=ys(n),u=(n==null?void 0:n.prompt)||!1,h=(n==null?void 0:n.tag)||0,l=(n==null?void 0:n.id)||tr().toString(),d={topic:i,message:s,opts:{ttl:a,relay:c,prompt:u,tag:h,id:l,attestation:n==null?void 0:n.attestation,tvf:n==null?void 0:n.tvf}},f=`Failed to publish payload, please try again. id:${l} tag:${h}`;try{const p=new Promise(async g=>{const b=({id:v})=>{d.opts.id===v&&(this.removeRequestFromQueue(v),this.relayer.events.removeListener(we.publish,b),g(d))};this.relayer.events.on(we.publish,b);const $=Mt(new Promise((v,S)=>{this.rpcPublish({topic:i,message:s,ttl:a,prompt:u,tag:h,id:l,attestation:n==null?void 0:n.attestation,tvf:n==null?void 0:n.tvf}).then(v).catch(E=>{this.logger.warn(E,E==null?void 0:E.message),S(E)})}),this.initialPublishTimeout,`Failed initial publish, retrying.... id:${l} tag:${h}`);try{await $,this.events.removeListener(we.publish,b)}catch(v){this.queue.set(l,_n(Zi({},d),{attempt:1})),this.logger.warn(v,v==null?void 0:v.message)}});this.logger.trace({type:"method",method:"publish",params:{id:l,topic:i,message:s,opts:n}}),await Mt(p,this.publishTimeout,f)}catch(p){if(this.logger.debug("Failed to Publish Payload"),this.logger.error(p),(o=n==null?void 0:n.internal)!=null&&o.throwOnFailedPublish)throw p}finally{this.queue.delete(l)}}),ct(this,"on",(i,s)=>{this.events.on(i,s)}),ct(this,"once",(i,s)=>{this.events.once(i,s)}),ct(this,"off",(i,s)=>{this.events.off(i,s)}),ct(this,"removeListener",(i,s)=>{this.events.removeListener(i,s)}),this.relayer=e,this.logger=Ne(t,this.name),this.registerEventListeners()}get context(){return Me(this.logger)}async rpcPublish(e){var t,i,s,n;const{topic:o,message:a,ttl:c=su,prompt:u,tag:h,id:l,attestation:d,tvf:f}=e,p={method:hi(ys().protocol).publish,params:Zi({topic:o,message:a,ttl:c,prompt:u,tag:h,attestation:d},f),id:l};Se((t=p.params)==null?void 0:t.prompt)&&((i=p.params)==null||delete i.prompt),Se((s=p.params)==null?void 0:s.tag)&&((n=p.params)==null||delete n.tag),this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:p});const g=await this.relayer.request(p);return this.relayer.events.emit(we.publish,e),this.logger.debug("Successfully Published Payload"),g}removeRequestFromQueue(e){this.queue.delete(e)}checkQueue(){this.queue.forEach(async(e,t)=>{const i=e.attempt+1;this.queue.set(t,_n(Zi({},e),{attempt:i}));const{topic:s,message:n,opts:o,attestation:a}=e;this.logger.warn({},`Publisher: queue->publishing: ${e.opts.id}, tag: ${e.opts.tag}, attempt: ${i}`),await this.rpcPublish(_n(Zi({},e),{topic:s,message:n,ttl:o.ttl,prompt:o.prompt,tag:o.tag,id:o.id,attestation:a,tvf:o.tvf})),this.logger.warn({},`Publisher: queue->published: ${e.opts.id}`)})}registerEventListeners(){this.relayer.core.heartbeat.on(Zr.pulse,()=>{if(this.needsTransportRestart){this.needsTransportRestart=!1,this.relayer.events.emit(we.connection_stalled);return}this.checkQueue()}),this.relayer.on(we.message_ack,e=>{this.removeRequestFromQueue(e.id.toString())})}}var p2=Object.defineProperty,f2=(r,e,t)=>e in r?p2(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,br=(r,e,t)=>f2(r,typeof e!="symbol"?e+"":e,t);class g2{constructor(){br(this,"map",new Map),br(this,"set",(e,t)=>{const i=this.get(e);this.exists(e,t)||this.map.set(e,[...i,t])}),br(this,"get",e=>this.map.get(e)||[]),br(this,"exists",(e,t)=>this.get(e).includes(t)),br(this,"delete",(e,t)=>{if(typeof t>"u"){this.map.delete(e);return}if(!this.map.has(e))return;const i=this.get(e);if(!this.exists(e,t))return;const s=i.filter(n=>n!==t);if(!s.length){this.map.delete(e);return}this.map.set(e,s)}),br(this,"clear",()=>{this.map.clear()})}get topics(){return Array.from(this.map.keys())}}var y2=Object.defineProperty,m2=Object.defineProperties,w2=Object.getOwnPropertyDescriptors,fu=Object.getOwnPropertySymbols,b2=Object.prototype.hasOwnProperty,v2=Object.prototype.propertyIsEnumerable,po=(r,e,t)=>e in r?y2(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,ci=(r,e)=>{for(var t in e||(e={}))b2.call(e,t)&&po(r,t,e[t]);if(fu)for(var t of fu(e))v2.call(e,t)&&po(r,t,e[t]);return r},In=(r,e)=>m2(r,w2(e)),ie=(r,e,t)=>po(r,typeof e!="symbol"?e+"":e,t);class E2 extends V1{constructor(e,t){super(e,t),this.relayer=e,this.logger=t,ie(this,"subscriptions",new Map),ie(this,"topicMap",new g2),ie(this,"events",new Ye.EventEmitter),ie(this,"name",o_),ie(this,"version",a_),ie(this,"pending",new Map),ie(this,"cached",[]),ie(this,"initialized",!1),ie(this,"storagePrefix",_t),ie(this,"subscribeTimeout",L.toMiliseconds(L.ONE_MINUTE)),ie(this,"initialSubscribeTimeout",L.toMiliseconds(L.ONE_SECOND*15)),ie(this,"clientId"),ie(this,"batchSubscribeTopicsLimit",500),ie(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),this.registerEventListeners(),await this.restore()),this.initialized=!0}),ie(this,"subscribe",async(i,s)=>{this.isInitialized(),this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:i,opts:s}});try{const n=ys(s),o={topic:i,relay:n,transportType:s==null?void 0:s.transportType};this.pending.set(i,o);const a=await this.rpcSubscribe(i,n,s);return typeof a=="string"&&(this.onSubscribe(a,o),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:i,opts:s}})),a}catch(n){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(n),n}}),ie(this,"unsubscribe",async(i,s)=>{this.isInitialized(),typeof(s==null?void 0:s.id)<"u"?await this.unsubscribeById(i,s.id,s):await this.unsubscribeByTopic(i,s)}),ie(this,"isSubscribed",i=>new Promise(s=>{s(this.topicMap.topics.includes(i))})),ie(this,"isKnownTopic",i=>new Promise(s=>{s(this.topicMap.topics.includes(i)||this.pending.has(i)||this.cached.some(n=>n.topic===i))})),ie(this,"on",(i,s)=>{this.events.on(i,s)}),ie(this,"once",(i,s)=>{this.events.once(i,s)}),ie(this,"off",(i,s)=>{this.events.off(i,s)}),ie(this,"removeListener",(i,s)=>{this.events.removeListener(i,s)}),ie(this,"start",async()=>{await this.onConnect()}),ie(this,"stop",async()=>{await this.onDisconnect()}),ie(this,"restart",async()=>{await this.restore(),await this.onRestart()}),ie(this,"checkPending",async()=>{if(this.pending.size===0&&(!this.initialized||!this.relayer.connected))return;const i=[];this.pending.forEach(s=>{i.push(s)}),await this.batchSubscribe(i)}),ie(this,"registerEventListeners",()=>{this.relayer.core.heartbeat.on(Zr.pulse,async()=>{await this.checkPending()}),this.events.on(He.created,async i=>{const s=He.created;this.logger.info(`Emitting ${s}`),this.logger.debug({type:"event",event:s,data:i}),await this.persist()}),this.events.on(He.deleted,async i=>{const s=He.deleted;this.logger.info(`Emitting ${s}`),this.logger.debug({type:"event",event:s,data:i}),await this.persist()})}),this.relayer=e,this.logger=Ne(t,this.name),this.clientId=""}get context(){return Me(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.relayer.core.customStoragePrefix+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}get hasAnyTopics(){return this.topicMap.topics.length>0||this.pending.size>0||this.cached.length>0||this.subscriptions.size>0}hasSubscription(e,t){let i=!1;try{i=this.getSubscription(e).topic===t}catch{}return i}reset(){this.cached=[],this.initialized=!0}onDisable(){this.cached=this.values,this.subscriptions.clear(),this.topicMap.clear()}async unsubscribeByTopic(e,t){const i=this.topicMap.get(e);await Promise.all(i.map(async s=>await this.unsubscribeById(e,s,t)))}async unsubscribeById(e,t,i){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:t,opts:i}});try{const s=ys(i);await this.restartToComplete({topic:e,id:t,relay:s}),await this.rpcUnsubscribe(e,t,s);const n=te("USER_DISCONNECTED",`${this.name}, ${e}`);await this.onUnsubscribe(e,t,n),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:t,opts:i}})}catch(s){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(s),s}}async rpcSubscribe(e,t,i){var s;(!i||(i==null?void 0:i.transportType)===ae.relay)&&await this.restartToComplete({topic:e,id:e,relay:t});const n={method:hi(t.protocol).subscribe,params:{topic:e}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:n});const o=(s=i==null?void 0:i.internal)==null?void 0:s.throwOnFailedPublish;try{const a=await this.getSubscriptionId(e);if((i==null?void 0:i.transportType)===ae.link_mode)return setTimeout(()=>{(this.relayer.connected||this.relayer.connecting)&&this.relayer.request(n).catch(h=>this.logger.warn(h))},L.toMiliseconds(L.ONE_SECOND)),a;const c=new Promise(async h=>{const l=d=>{d.topic===e&&(this.events.removeListener(He.created,l),h(d.id))};this.events.on(He.created,l);try{const d=await Mt(new Promise((f,p)=>{this.relayer.request(n).catch(g=>{this.logger.warn(g,g==null?void 0:g.message),p(g)}).then(f)}),this.initialSubscribeTimeout,`Subscribing to ${e} failed, please try again`);this.events.removeListener(He.created,l),h(d)}catch{}}),u=await Mt(c,this.subscribeTimeout,`Subscribing to ${e} failed, please try again`);if(!u&&o)throw new Error(`Subscribing to ${e} failed, please try again`);return u?a:null}catch(a){if(this.logger.debug("Outgoing Relay Subscribe Payload stalled"),this.relayer.events.emit(we.connection_stalled),o)throw a}return null}async rpcBatchSubscribe(e){if(!e.length)return;const t=e[0].relay,i={method:hi(t.protocol).batchSubscribe,params:{topics:e.map(s=>s.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:i});try{await await Mt(new Promise(s=>{this.relayer.request(i).catch(n=>this.logger.warn(n)).then(s)}),this.subscribeTimeout,"rpcBatchSubscribe failed, please try again")}catch{this.relayer.events.emit(we.connection_stalled)}}async rpcBatchFetchMessages(e){if(!e.length)return;const t=e[0].relay,i={method:hi(t.protocol).batchFetchMessages,params:{topics:e.map(n=>n.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:i});let s;try{s=await await Mt(new Promise((n,o)=>{this.relayer.request(i).catch(a=>{this.logger.warn(a),o(a)}).then(n)}),this.subscribeTimeout,"rpcBatchFetchMessages failed, please try again")}catch{this.relayer.events.emit(we.connection_stalled)}return s}rpcUnsubscribe(e,t,i){const s={method:hi(i.protocol).unsubscribe,params:{topic:e,id:t}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:s}),this.relayer.request(s)}onSubscribe(e,t){this.setSubscription(e,In(ci({},t),{id:e})),this.pending.delete(t.topic)}onBatchSubscribe(e){e.length&&e.forEach(t=>{this.setSubscription(t.id,ci({},t)),this.pending.delete(t.topic)})}async onUnsubscribe(e,t,i){this.events.removeAllListeners(t),this.hasSubscription(t,e)&&this.deleteSubscription(t,i),await this.relayer.messages.del(e)}async setRelayerSubscriptions(e){await this.relayer.core.storage.setItem(this.storageKey,e)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(e,t){this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:e,subscription:t}),this.addSubscription(e,t)}addSubscription(e,t){this.subscriptions.set(e,ci({},t)),this.topicMap.set(t.topic,e),this.events.emit(He.created,t)}getSubscription(e){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:e});const t=this.subscriptions.get(e);if(!t){const{message:i}=U("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(i)}return t}deleteSubscription(e,t){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:e,reason:t});const i=this.getSubscription(e);this.subscriptions.delete(e),this.topicMap.delete(i.topic,e),this.events.emit(He.deleted,In(ci({},i),{reason:t}))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit(He.sync)}async onRestart(){if(this.cached.length){const e=[...this.cached],t=Math.ceil(this.cached.length/this.batchSubscribeTopicsLimit);for(let i=0;i<t;i++){const s=e.splice(0,this.batchSubscribeTopicsLimit);await this.batchSubscribe(s)}}this.events.emit(He.resubscribed)}async restore(){try{const e=await this.getRelayerSubscriptions();if(typeof e>"u"||!e.length)return;if(this.subscriptions.size){const{message:t}=U("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(t),this.logger.error(`${this.name}: ${JSON.stringify(this.values)}`),new Error(t)}this.cached=e,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(e){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(e)}}async batchSubscribe(e){e.length&&(await this.rpcBatchSubscribe(e),this.onBatchSubscribe(await Promise.all(e.map(async t=>In(ci({},t),{id:await this.getSubscriptionId(t.topic)})))))}async batchFetchMessages(e){if(!e.length)return;this.logger.trace(`Fetching batch messages for ${e.length} subscriptions`);const t=await this.rpcBatchFetchMessages(e);t&&t.messages&&(await Pw(L.toMiliseconds(L.ONE_SECOND)),await this.relayer.handleBatchMessageEvents(t.messages))}async onConnect(){await this.restart(),this.reset()}onDisconnect(){this.onDisable()}isInitialized(){if(!this.initialized){const{message:e}=U("NOT_INITIALIZED",this.name);throw new Error(e)}}async restartToComplete(e){!this.relayer.connected&&!this.relayer.connecting&&(this.cached.push(e),await this.relayer.transportOpen())}async getClientId(){return this.clientId||(this.clientId=await this.relayer.core.crypto.getClientId()),this.clientId}async getSubscriptionId(e){return Et(e+await this.getClientId())}}var _2=Object.defineProperty,gu=Object.getOwnPropertySymbols,I2=Object.prototype.hasOwnProperty,$2=Object.prototype.propertyIsEnumerable,fo=(r,e,t)=>e in r?_2(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,yu=(r,e)=>{for(var t in e||(e={}))I2.call(e,t)&&fo(r,t,e[t]);if(gu)for(var t of gu(e))$2.call(e,t)&&fo(r,t,e[t]);return r},Z=(r,e,t)=>fo(r,typeof e!="symbol"?e+"":e,t);class S2 extends z1{constructor(e){super(e),Z(this,"protocol","wc"),Z(this,"version",2),Z(this,"core"),Z(this,"logger"),Z(this,"events",new Ye.EventEmitter),Z(this,"provider"),Z(this,"messages"),Z(this,"subscriber"),Z(this,"publisher"),Z(this,"name",t_),Z(this,"transportExplicitlyClosed",!1),Z(this,"initialized",!1),Z(this,"connectionAttemptInProgress",!1),Z(this,"relayUrl"),Z(this,"projectId"),Z(this,"packageName"),Z(this,"bundleId"),Z(this,"hasExperiencedNetworkDisruption",!1),Z(this,"pingTimeout"),Z(this,"heartBeatTimeout",L.toMiliseconds(L.THIRTY_SECONDS+L.FIVE_SECONDS)),Z(this,"reconnectTimeout"),Z(this,"connectPromise"),Z(this,"reconnectInProgress",!1),Z(this,"requestsInFlight",[]),Z(this,"connectTimeout",L.toMiliseconds(L.ONE_SECOND*15)),Z(this,"request",async t=>{var i,s;this.logger.debug("Publishing Request Payload");const n=t.id||tr().toString();await this.toEstablishConnection();try{this.logger.trace({id:n,method:t.method,topic:(i=t.params)==null?void 0:i.topic},"relayer.request - publishing...");const o=`${n}:${((s=t.params)==null?void 0:s.tag)||""}`;this.requestsInFlight.push(o);const a=await this.provider.request(t);return this.requestsInFlight=this.requestsInFlight.filter(c=>c!==o),a}catch(o){throw this.logger.debug(`Failed to Publish Request: ${n}`),o}}),Z(this,"resetPingTimeout",()=>{fs()&&(clearTimeout(this.pingTimeout),this.pingTimeout=setTimeout(()=>{var t,i,s,n;try{this.logger.debug({},"pingTimeout: Connection stalled, terminating..."),(n=(s=(i=(t=this.provider)==null?void 0:t.connection)==null?void 0:i.socket)==null?void 0:s.terminate)==null||n.call(s)}catch(o){this.logger.warn(o,o==null?void 0:o.message)}},this.heartBeatTimeout))}),Z(this,"onPayloadHandler",t=>{this.onProviderPayload(t),this.resetPingTimeout()}),Z(this,"onConnectHandler",()=>{this.logger.warn({},"Relayer connected "),this.startPingTimeout(),this.events.emit(we.connect)}),Z(this,"onDisconnectHandler",()=>{this.logger.warn({},"Relayer disconnected "),this.requestsInFlight=[],this.onProviderDisconnect()}),Z(this,"onProviderErrorHandler",t=>{this.logger.fatal(`Fatal socket error: ${t.message}`),this.events.emit(we.error,t),this.logger.fatal("Fatal socket error received, closing transport"),this.transportClose()}),Z(this,"registerProviderListeners",()=>{this.provider.on(Qe.payload,this.onPayloadHandler),this.provider.on(Qe.connect,this.onConnectHandler),this.provider.on(Qe.disconnect,this.onDisconnectHandler),this.provider.on(Qe.error,this.onProviderErrorHandler)}),this.core=e.core,this.logger=typeof e.logger<"u"&&typeof e.logger!="string"?Ne(e.logger,this.name):Li(Ns({level:e.logger||e_})),this.messages=new o2(this.logger,e.core),this.subscriber=new E2(this,this.logger),this.publisher=new d2(this,this.logger),this.relayUrl=(e==null?void 0:e.relayUrl)||Gl,this.projectId=e.projectId,dw()?this.packageName=Za():pw()&&(this.bundleId=Za()),this.provider={}}async init(){if(this.logger.trace("Initialized"),this.registerEventListeners(),await Promise.all([this.messages.init(),this.subscriber.init()]),this.initialized=!0,this.subscriber.hasAnyTopics)try{await this.transportOpen()}catch(e){this.logger.warn(e,e==null?void 0:e.message)}}get context(){return Me(this.logger)}get connected(){var e,t,i;return((i=(t=(e=this.provider)==null?void 0:e.connection)==null?void 0:t.socket)==null?void 0:i.readyState)===1||!1}get connecting(){var e,t,i;return((i=(t=(e=this.provider)==null?void 0:e.connection)==null?void 0:t.socket)==null?void 0:i.readyState)===0||this.connectPromise!==void 0||!1}async publish(e,t,i){this.isInitialized(),await this.publisher.publish(e,t,i),await this.recordMessageEvent({topic:e,message:t,publishedAt:Date.now(),transportType:ae.relay},us.outbound)}async subscribe(e,t){var i,s,n;this.isInitialized(),(!(t!=null&&t.transportType)||(t==null?void 0:t.transportType)==="relay")&&await this.toEstablishConnection();const o=typeof((i=t==null?void 0:t.internal)==null?void 0:i.throwOnFailedPublish)>"u"?!0:(s=t==null?void 0:t.internal)==null?void 0:s.throwOnFailedPublish;let a=((n=this.subscriber.topicMap.get(e))==null?void 0:n[0])||"",c;const u=h=>{h.topic===e&&(this.subscriber.off(He.created,u),c())};return await Promise.all([new Promise(h=>{c=h,this.subscriber.on(He.created,u)}),new Promise(async(h,l)=>{a=await this.subscriber.subscribe(e,yu({internal:{throwOnFailedPublish:o}},t)).catch(d=>{o&&l(d)})||a,h()})]),a}async unsubscribe(e,t){this.isInitialized(),await this.subscriber.unsubscribe(e,t)}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}off(e,t){this.events.off(e,t)}removeListener(e,t){this.events.removeListener(e,t)}async transportDisconnect(){this.provider.disconnect&&(this.hasExperiencedNetworkDisruption||this.connected)?await Mt(this.provider.disconnect(),2e3,"provider.disconnect()").catch(()=>this.onProviderDisconnect()):this.onProviderDisconnect()}async transportClose(){this.transportExplicitlyClosed=!0,await this.transportDisconnect()}async transportOpen(e){if(!this.subscriber.hasAnyTopics){this.logger.warn("Starting WS connection skipped because the client has no topics to work with.");return}if(this.connectPromise?(this.logger.debug({},"Waiting for existing connection attempt to resolve..."),await this.connectPromise,this.logger.debug({},"Existing connection attempt resolved")):(this.connectPromise=new Promise(async(t,i)=>{await this.connect(e).then(t).catch(i).finally(()=>{this.connectPromise=void 0})}),await this.connectPromise),!this.connected)throw new Error(`Couldn't establish socket connection to the relay server: ${this.relayUrl}`)}async restartTransport(e){this.logger.debug({},"Restarting transport..."),!this.connectionAttemptInProgress&&(this.relayUrl=e||this.relayUrl,await this.confirmOnlineStateOrThrow(),await this.transportClose(),await this.transportOpen())}async confirmOnlineStateOrThrow(){if(!await Bc())throw new Error("No internet connection detected. Please restart your network and try again.")}async handleBatchMessageEvents(e){if((e==null?void 0:e.length)===0){this.logger.trace("Batch message events is empty. Ignoring...");return}const t=e.sort((i,s)=>i.publishedAt-s.publishedAt);this.logger.debug(`Batch of ${t.length} message events sorted`);for(const i of t)try{await this.onMessageEvent(i)}catch(s){this.logger.warn(s,"Error while processing batch message event: "+(s==null?void 0:s.message))}this.logger.trace(`Batch of ${t.length} message events processed`)}async onLinkMessageEvent(e,t){const{topic:i}=e;if(!t.sessionExists){const s=de(L.FIVE_MINUTES),n={topic:i,expiry:s,relay:{protocol:"irn"},active:!1};await this.core.pairing.pairings.set(i,n)}this.events.emit(we.message,e),await this.recordMessageEvent(e,us.inbound)}async connect(e){await this.confirmOnlineStateOrThrow(),e&&e!==this.relayUrl&&(this.relayUrl=e,await this.transportDisconnect()),this.connectionAttemptInProgress=!0,this.transportExplicitlyClosed=!1;let t=1;for(;t<6;){try{if(this.transportExplicitlyClosed)break;this.logger.debug({},`Connecting to ${this.relayUrl}, attempt: ${t}...`),await this.createProvider(),await new Promise(async(i,s)=>{const n=()=>{s(new Error("Connection interrupted while trying to subscribe"))};this.provider.once(Qe.disconnect,n),await Mt(new Promise((o,a)=>{this.provider.connect().then(o).catch(a)}),this.connectTimeout,`Socket stalled when trying to connect to ${this.relayUrl}`).catch(o=>{s(o)}).finally(()=>{this.provider.off(Qe.disconnect,n),clearTimeout(this.reconnectTimeout)}),await new Promise(async(o,a)=>{const c=()=>{a(new Error("Connection interrupted while trying to subscribe"))};this.provider.once(Qe.disconnect,c),await this.subscriber.start().then(o).catch(a).finally(()=>{this.provider.off(Qe.disconnect,c)})}),this.hasExperiencedNetworkDisruption=!1,i()})}catch(i){await this.subscriber.stop();const s=i;this.logger.warn({},s.message),this.hasExperiencedNetworkDisruption=!0}finally{this.connectionAttemptInProgress=!1}if(this.connected){this.logger.debug({},`Connected to ${this.relayUrl} successfully on attempt: ${t}`);break}await new Promise(i=>setTimeout(i,L.toMiliseconds(t*1))),t++}}startPingTimeout(){var e,t,i,s,n;if(fs())try{(t=(e=this.provider)==null?void 0:e.connection)!=null&&t.socket&&((n=(s=(i=this.provider)==null?void 0:i.connection)==null?void 0:s.socket)==null||n.on("ping",()=>{this.resetPingTimeout()})),this.resetPingTimeout()}catch(o){this.logger.warn(o,o==null?void 0:o.message)}}async createProvider(){this.provider.connection&&this.unregisterProviderListeners();const e=await this.core.crypto.signJWT(this.relayUrl);this.provider=new it(new zE(ww({sdkVersion:ao,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:e,useOnCloseEvent:!0,bundleId:this.bundleId,packageName:this.packageName}))),this.registerProviderListeners()}async recordMessageEvent(e,t){const{topic:i,message:s}=e;await this.messages.set(i,s,t)}async shouldIgnoreMessageEvent(e){const{topic:t,message:i}=e;if(!i||i.length===0)return this.logger.warn(`Ignoring invalid/empty message: ${i}`),!0;if(!await this.subscriber.isKnownTopic(t))return this.logger.warn(`Ignoring message for unknown topic ${t}`),!0;const s=this.messages.has(t,i);return s&&this.logger.warn(`Ignoring duplicate message: ${i}`),s}async onProviderPayload(e){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:e}),Ho(e)){if(!e.method.endsWith(r_))return;const t=e.params,{topic:i,message:s,publishedAt:n,attestation:o}=t.data,a={topic:i,message:s,publishedAt:n,transportType:ae.relay,attestation:o};this.logger.debug("Emitting Relayer Payload"),this.logger.trace(yu({type:"event",event:t.id},a)),this.events.emit(t.id,a),await this.acknowledgePayload(e),await this.onMessageEvent(a)}else Ls(e)&&this.events.emit(we.message_ack,e)}async onMessageEvent(e){await this.shouldIgnoreMessageEvent(e)||(await this.recordMessageEvent(e,us.inbound),this.events.emit(we.message,e))}async acknowledgePayload(e){const t=js(e.id,!0);await this.provider.connection.send(t)}unregisterProviderListeners(){this.provider.off(Qe.payload,this.onPayloadHandler),this.provider.off(Qe.connect,this.onConnectHandler),this.provider.off(Qe.disconnect,this.onDisconnectHandler),this.provider.off(Qe.error,this.onProviderErrorHandler),clearTimeout(this.pingTimeout)}async registerEventListeners(){let e=await Bc();T0(async t=>{e!==t&&(e=t,t?await this.transportOpen().catch(i=>this.logger.error(i,i==null?void 0:i.message)):(this.hasExperiencedNetworkDisruption=!0,await this.transportDisconnect(),this.transportExplicitlyClosed=!1))})}async onProviderDisconnect(){clearTimeout(this.pingTimeout),this.events.emit(we.disconnect),this.connectionAttemptInProgress=!1,!this.reconnectInProgress&&(this.reconnectInProgress=!0,await this.subscriber.stop(),this.subscriber.hasAnyTopics&&(this.transportExplicitlyClosed||(this.reconnectTimeout=setTimeout(async()=>{await this.transportOpen().catch(e=>this.logger.error(e,e==null?void 0:e.message)),this.reconnectTimeout=void 0,this.reconnectInProgress=!1},L.toMiliseconds(i_)))))}isInitialized(){if(!this.initialized){const{message:e}=U("NOT_INITIALIZED",this.name);throw new Error(e)}}async toEstablishConnection(){await this.confirmOnlineStateOrThrow(),!this.connected&&await this.connect()}}function D2(){}function mu(r){if(!r||typeof r!="object")return!1;const e=Object.getPrototypeOf(r);return e===null||e===Object.prototype||Object.getPrototypeOf(e)===null?Object.prototype.toString.call(r)==="[object Object]":!1}function wu(r){return Object.getOwnPropertySymbols(r).filter(e=>Object.prototype.propertyIsEnumerable.call(r,e))}function bu(r){return r==null?r===void 0?"[object Undefined]":"[object Null]":Object.prototype.toString.call(r)}const O2="[object RegExp]",P2="[object String]",A2="[object Number]",x2="[object Boolean]",vu="[object Arguments]",C2="[object Symbol]",T2="[object Date]",R2="[object Map]",N2="[object Set]",j2="[object Array]",B2="[object Function]",L2="[object ArrayBuffer]",$n="[object Object]",U2="[object Error]",F2="[object DataView]",q2="[object Uint8Array]",M2="[object Uint8ClampedArray]",k2="[object Uint16Array]",z2="[object Uint32Array]",H2="[object BigUint64Array]",V2="[object Int8Array]",K2="[object Int16Array]",W2="[object Int32Array]",G2="[object BigInt64Array]",Y2="[object Float32Array]",J2="[object Float64Array]";function Z2(r,e){return r===e||Number.isNaN(r)&&Number.isNaN(e)}function Q2(r,e,t){return di(r,e,void 0,void 0,void 0,void 0,t)}function di(r,e,t,i,s,n,o){const a=o(r,e,t,i,s,n);if(a!==void 0)return a;if(typeof r==typeof e)switch(typeof r){case"bigint":case"string":case"boolean":case"symbol":case"undefined":return r===e;case"number":return r===e||Object.is(r,e);case"function":return r===e;case"object":return mi(r,e,n,o)}return mi(r,e,n,o)}function mi(r,e,t,i){if(Object.is(r,e))return!0;let s=bu(r),n=bu(e);if(s===vu&&(s=$n),n===vu&&(n=$n),s!==n)return!1;switch(s){case P2:return r.toString()===e.toString();case A2:{const c=r.valueOf(),u=e.valueOf();return Z2(c,u)}case x2:case T2:case C2:return Object.is(r.valueOf(),e.valueOf());case O2:return r.source===e.source&&r.flags===e.flags;case B2:return r===e}t=t??new Map;const o=t.get(r),a=t.get(e);if(o!=null&&a!=null)return o===e;t.set(r,e),t.set(e,r);try{switch(s){case R2:{if(r.size!==e.size)return!1;for(const[c,u]of r.entries())if(!e.has(c)||!di(u,e.get(c),c,r,e,t,i))return!1;return!0}case N2:{if(r.size!==e.size)return!1;const c=Array.from(r.values()),u=Array.from(e.values());for(let h=0;h<c.length;h++){const l=c[h],d=u.findIndex(f=>di(l,f,void 0,r,e,t,i));if(d===-1)return!1;u.splice(d,1)}return!0}case j2:case q2:case M2:case k2:case z2:case H2:case V2:case K2:case W2:case G2:case Y2:case J2:{if(typeof Buffer<"u"&&Buffer.isBuffer(r)!==Buffer.isBuffer(e)||r.length!==e.length)return!1;for(let c=0;c<r.length;c++)if(!di(r[c],e[c],c,r,e,t,i))return!1;return!0}case L2:return r.byteLength!==e.byteLength?!1:mi(new Uint8Array(r),new Uint8Array(e),t,i);case F2:return r.byteLength!==e.byteLength||r.byteOffset!==e.byteOffset?!1:mi(new Uint8Array(r),new Uint8Array(e),t,i);case U2:return r.name===e.name&&r.message===e.message;case $n:{if(!(mi(r.constructor,e.constructor,t,i)||mu(r)&&mu(e)))return!1;const c=[...Object.keys(r),...wu(r)],u=[...Object.keys(e),...wu(e)];if(c.length!==u.length)return!1;for(let h=0;h<c.length;h++){const l=c[h],d=r[l];if(!Object.hasOwn(e,l))return!1;const f=e[l];if(!di(d,f,l,r,e,t,i))return!1}return!0}default:return!1}}finally{t.delete(r),t.delete(e)}}function X2(r,e){return Q2(r,e,D2)}var e$=Object.defineProperty,Eu=Object.getOwnPropertySymbols,t$=Object.prototype.hasOwnProperty,r$=Object.prototype.propertyIsEnumerable,go=(r,e,t)=>e in r?e$(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,_u=(r,e)=>{for(var t in e||(e={}))t$.call(e,t)&&go(r,t,e[t]);if(Eu)for(var t of Eu(e))r$.call(e,t)&&go(r,t,e[t]);return r},Be=(r,e,t)=>go(r,typeof e!="symbol"?e+"":e,t);class lr extends H1{constructor(e,t,i,s=_t,n=void 0){super(e,t,i,s),this.core=e,this.logger=t,this.name=i,Be(this,"map",new Map),Be(this,"version",s_),Be(this,"cached",[]),Be(this,"initialized",!1),Be(this,"getKey"),Be(this,"storagePrefix",_t),Be(this,"recentlyDeleted",[]),Be(this,"recentlyDeletedLimit",200),Be(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(o=>{this.getKey&&o!==null&&!Se(o)?this.map.set(this.getKey(o),o):u0(o)?this.map.set(o.id,o):h0(o)&&this.map.set(o.topic,o)}),this.cached=[],this.initialized=!0)}),Be(this,"set",async(o,a)=>{this.isInitialized(),this.map.has(o)?await this.update(o,a):(this.logger.debug("Setting value"),this.logger.trace({type:"method",method:"set",key:o,value:a}),this.map.set(o,a),await this.persist())}),Be(this,"get",o=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:o}),this.getData(o))),Be(this,"getAll",o=>(this.isInitialized(),o?this.values.filter(a=>Object.keys(o).every(c=>X2(a[c],o[c]))):this.values)),Be(this,"update",async(o,a)=>{this.isInitialized(),this.logger.debug("Updating value"),this.logger.trace({type:"method",method:"update",key:o,update:a});const c=_u(_u({},this.getData(o)),a);this.map.set(o,c),await this.persist()}),Be(this,"delete",async(o,a)=>{this.isInitialized(),this.map.has(o)&&(this.logger.debug("Deleting value"),this.logger.trace({type:"method",method:"delete",key:o,reason:a}),this.map.delete(o),this.addToRecentlyDeleted(o),await this.persist())}),this.logger=Ne(t,this.name),this.storagePrefix=s,this.getKey=n}get context(){return Me(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}addToRecentlyDeleted(e){this.recentlyDeleted.push(e),this.recentlyDeleted.length>=this.recentlyDeletedLimit&&this.recentlyDeleted.splice(0,this.recentlyDeletedLimit/2)}async setDataStore(e){await this.core.storage.setItem(this.storageKey,e)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(e){const t=this.map.get(e);if(!t){if(this.recentlyDeleted.includes(e)){const{message:s}=U("MISSING_OR_INVALID",`Record was recently deleted - ${this.name}: ${e}`);throw this.logger.error(s),new Error(s)}const{message:i}=U("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.error(i),new Error(i)}return t}async persist(){await this.setDataStore(this.values)}async restore(){try{const e=await this.getDataStore();if(typeof e>"u"||!e.length)return;if(this.map.size){const{message:t}=U("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(t),new Error(t)}this.cached=e,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:"method",method:"restore",value:this.values})}catch(e){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(e)}}isInitialized(){if(!this.initialized){const{message:e}=U("NOT_INITIALIZED",this.name);throw new Error(e)}}}var i$=Object.defineProperty,s$=(r,e,t)=>e in r?i$(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,W=(r,e,t)=>s$(r,typeof e!="symbol"?e+"":e,t);class n${constructor(e,t){this.core=e,this.logger=t,W(this,"name",c_),W(this,"version",u_),W(this,"events",new $o),W(this,"pairings"),W(this,"initialized",!1),W(this,"storagePrefix",_t),W(this,"ignoredPayloadTypes",[Rt]),W(this,"registeredMethods",[]),W(this,"init",async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace("Initialized"))}),W(this,"register",({methods:i})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...i])]}),W(this,"create",async i=>{this.isInitialized();const s=to(),n=await this.core.crypto.setSymKey(s),o=de(L.FIVE_MINUTES),a={protocol:Wl},c={topic:n,expiry:o,relay:a,active:!1,methods:i==null?void 0:i.methods},u=xc({protocol:this.core.protocol,version:this.core.version,topic:n,symKey:s,relay:a,expiryTimestamp:o,methods:i==null?void 0:i.methods});return this.events.emit(Qt.create,c),this.core.expirer.set(n,o),await this.pairings.set(n,c),await this.core.relayer.subscribe(n,{transportType:i==null?void 0:i.transportType}),{topic:n,uri:u}}),W(this,"pair",async i=>{this.isInitialized();const s=this.core.eventClient.createEvent({properties:{topic:i==null?void 0:i.uri,trace:[mt.pairing_started]}});this.isValidPair(i,s);const{topic:n,symKey:o,relay:a,expiryTimestamp:c,methods:u}=Ac(i.uri);s.props.properties.topic=n,s.addTrace(mt.pairing_uri_validation_success),s.addTrace(mt.pairing_uri_not_expired);let h;if(this.pairings.keys.includes(n)){if(h=this.pairings.get(n),s.addTrace(mt.existing_pairing),h.active)throw s.setError(At.active_pairing_already_exists),new Error(`Pairing already exists: ${n}. Please try again with a new connection URI.`);s.addTrace(mt.pairing_not_expired)}const l=c||de(L.FIVE_MINUTES),d={topic:n,relay:a,expiry:l,active:!1,methods:u};this.core.expirer.set(n,l),await this.pairings.set(n,d),s.addTrace(mt.store_new_pairing),i.activatePairing&&await this.activate({topic:n}),this.events.emit(Qt.create,d),s.addTrace(mt.emit_inactive_pairing),this.core.crypto.keychain.has(n)||await this.core.crypto.setSymKey(o,n),s.addTrace(mt.subscribing_pairing_topic);try{await this.core.relayer.confirmOnlineStateOrThrow()}catch{s.setError(At.no_internet_connection)}try{await this.core.relayer.subscribe(n,{relay:a})}catch(f){throw s.setError(At.subscribe_pairing_topic_failure),f}return s.addTrace(mt.subscribe_pairing_topic_success),d}),W(this,"activate",async({topic:i})=>{this.isInitialized();const s=de(L.FIVE_MINUTES);this.core.expirer.set(i,s),await this.pairings.update(i,{active:!0,expiry:s})}),W(this,"ping",async i=>{this.isInitialized(),await this.isValidPing(i),this.logger.warn("ping() is deprecated and will be removed in the next major release.");const{topic:s}=i;if(this.pairings.keys.includes(s)){const n=await this.sendRequest(s,"wc_pairingPing",{}),{done:o,resolve:a,reject:c}=Yt();this.events.once(X("pairing_ping",n),({error:u})=>{u?c(u):a()}),await o()}}),W(this,"updateExpiry",async({topic:i,expiry:s})=>{this.isInitialized(),await this.pairings.update(i,{expiry:s})}),W(this,"updateMetadata",async({topic:i,metadata:s})=>{this.isInitialized(),await this.pairings.update(i,{peerMetadata:s})}),W(this,"getPairings",()=>(this.isInitialized(),this.pairings.values)),W(this,"disconnect",async i=>{this.isInitialized(),await this.isValidDisconnect(i);const{topic:s}=i;this.pairings.keys.includes(s)&&(await this.sendRequest(s,"wc_pairingDelete",te("USER_DISCONNECTED")),await this.deletePairing(s))}),W(this,"formatUriFromPairing",i=>{this.isInitialized();const{topic:s,relay:n,expiry:o,methods:a}=i,c=this.core.crypto.keychain.get(s);return xc({protocol:this.core.protocol,version:this.core.version,topic:s,symKey:c,relay:n,expiryTimestamp:o,methods:a})}),W(this,"sendRequest",async(i,s,n)=>{const o=kt(s,n),a=await this.core.crypto.encode(i,o),c=oi[s].req;return this.core.history.set(i,o),this.core.relayer.publish(i,a,c),o.id}),W(this,"sendResult",async(i,s,n)=>{const o=js(i,n),a=await this.core.crypto.encode(s,o),c=(await this.core.history.get(s,i)).request.method,u=oi[c].res;await this.core.relayer.publish(s,a,u),await this.core.history.resolve(o)}),W(this,"sendError",async(i,s,n)=>{const o=Bs(i,n),a=await this.core.crypto.encode(s,o),c=(await this.core.history.get(s,i)).request.method,u=oi[c]?oi[c].res:oi.unregistered_method.res;await this.core.relayer.publish(s,a,u),await this.core.history.resolve(o)}),W(this,"deletePairing",async(i,s)=>{await this.core.relayer.unsubscribe(i),await Promise.all([this.pairings.delete(i,te("USER_DISCONNECTED")),this.core.crypto.deleteSymKey(i),s?Promise.resolve():this.core.expirer.del(i)])}),W(this,"cleanup",async()=>{const i=this.pairings.getAll().filter(s=>Ft(s.expiry));await Promise.all(i.map(s=>this.deletePairing(s.topic)))}),W(this,"onRelayEventRequest",async i=>{const{topic:s,payload:n}=i;switch(n.method){case"wc_pairingPing":return await this.onPairingPingRequest(s,n);case"wc_pairingDelete":return await this.onPairingDeleteRequest(s,n);default:return await this.onUnknownRpcMethodRequest(s,n)}}),W(this,"onRelayEventResponse",async i=>{const{topic:s,payload:n}=i,o=(await this.core.history.get(s,n.id)).request.method;switch(o){case"wc_pairingPing":return this.onPairingPingResponse(s,n);default:return this.onUnknownRpcMethodResponse(o)}}),W(this,"onPairingPingRequest",async(i,s)=>{const{id:n}=s;try{this.isValidPing({topic:i}),await this.sendResult(n,i,!0),this.events.emit(Qt.ping,{id:n,topic:i})}catch(o){await this.sendError(n,i,o),this.logger.error(o)}}),W(this,"onPairingPingResponse",(i,s)=>{const{id:n}=s;setTimeout(()=>{bt(s)?this.events.emit(X("pairing_ping",n),{}):tt(s)&&this.events.emit(X("pairing_ping",n),{error:s.error})},500)}),W(this,"onPairingDeleteRequest",async(i,s)=>{const{id:n}=s;try{this.isValidDisconnect({topic:i}),await this.deletePairing(i),this.events.emit(Qt.delete,{id:n,topic:i})}catch(o){await this.sendError(n,i,o),this.logger.error(o)}}),W(this,"onUnknownRpcMethodRequest",async(i,s)=>{const{id:n,method:o}=s;try{if(this.registeredMethods.includes(o))return;const a=te("WC_METHOD_UNSUPPORTED",o);await this.sendError(n,i,a),this.logger.error(a)}catch(a){await this.sendError(n,i,a),this.logger.error(a)}}),W(this,"onUnknownRpcMethodResponse",i=>{this.registeredMethods.includes(i)||this.logger.error(te("WC_METHOD_UNSUPPORTED",i))}),W(this,"isValidPair",(i,s)=>{var n;if(!Ue(i)){const{message:a}=U("MISSING_OR_INVALID",`pair() params: ${i}`);throw s.setError(At.malformed_pairing_uri),new Error(a)}if(!c0(i.uri)){const{message:a}=U("MISSING_OR_INVALID",`pair() uri: ${i.uri}`);throw s.setError(At.malformed_pairing_uri),new Error(a)}const o=Ac(i==null?void 0:i.uri);if(!((n=o==null?void 0:o.relay)!=null&&n.protocol)){const{message:a}=U("MISSING_OR_INVALID","pair() uri#relay-protocol");throw s.setError(At.malformed_pairing_uri),new Error(a)}if(!(o!=null&&o.symKey)){const{message:a}=U("MISSING_OR_INVALID","pair() uri#symKey");throw s.setError(At.malformed_pairing_uri),new Error(a)}if(o!=null&&o.expiryTimestamp&&L.toMiliseconds(o==null?void 0:o.expiryTimestamp)<Date.now()){s.setError(At.pairing_expired);const{message:a}=U("EXPIRED","pair() URI has expired. Please try again with a new connection URI.");throw new Error(a)}}),W(this,"isValidPing",async i=>{if(!Ue(i)){const{message:n}=U("MISSING_OR_INVALID",`ping() params: ${i}`);throw new Error(n)}const{topic:s}=i;await this.isValidPairingTopic(s)}),W(this,"isValidDisconnect",async i=>{if(!Ue(i)){const{message:n}=U("MISSING_OR_INVALID",`disconnect() params: ${i}`);throw new Error(n)}const{topic:s}=i;await this.isValidPairingTopic(s)}),W(this,"isValidPairingTopic",async i=>{if(!le(i,!1)){const{message:s}=U("MISSING_OR_INVALID",`pairing topic should be a string: ${i}`);throw new Error(s)}if(!this.pairings.keys.includes(i)){const{message:s}=U("NO_MATCHING_KEY",`pairing topic doesn't exist: ${i}`);throw new Error(s)}if(Ft(this.pairings.get(i).expiry)){await this.deletePairing(i);const{message:s}=U("EXPIRED",`pairing topic: ${i}`);throw new Error(s)}}),this.core=e,this.logger=Ne(t,this.name),this.pairings=new lr(this.core,this.logger,this.name,this.storagePrefix)}get context(){return Me(this.logger)}isInitialized(){if(!this.initialized){const{message:e}=U("NOT_INITIALIZED",this.name);throw new Error(e)}}registerRelayerEvents(){this.core.relayer.on(we.message,async e=>{const{topic:t,message:i,transportType:s}=e;if(this.pairings.keys.includes(t)&&s!==ae.link_mode&&!this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(i)))try{const n=await this.core.crypto.decode(t,i);Ho(n)?(this.core.history.set(t,n),await this.onRelayEventRequest({topic:t,payload:n})):Ls(n)&&(await this.core.history.resolve(n),await this.onRelayEventResponse({topic:t,payload:n}),this.core.history.delete(t,n.id)),await this.core.relayer.messages.ack(t,i)}catch(n){this.logger.error(n)}})}registerExpirerEvents(){this.core.expirer.on(et.expired,async e=>{const{topic:t}=el(e.target);t&&this.pairings.keys.includes(t)&&(await this.deletePairing(t,!0),this.events.emit(Qt.expire,{topic:t}))})}}var o$=Object.defineProperty,a$=(r,e,t)=>e in r?o$(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,$e=(r,e,t)=>a$(r,typeof e!="symbol"?e+"":e,t);class c$ extends q1{constructor(e,t){super(e,t),this.core=e,this.logger=t,$e(this,"records",new Map),$e(this,"events",new Ye.EventEmitter),$e(this,"name",h_),$e(this,"version",l_),$e(this,"cached",[]),$e(this,"initialized",!1),$e(this,"storagePrefix",_t),$e(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(i=>this.records.set(i.id,i)),this.cached=[],this.registerEventListeners(),this.initialized=!0)}),$e(this,"set",(i,s,n)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:i,request:s,chainId:n}),this.records.has(s.id))return;const o={id:s.id,topic:i,request:{method:s.method,params:s.params||null},chainId:n,expiry:de(L.THIRTY_DAYS)};this.records.set(o.id,o),this.persist(),this.events.emit(ot.created,o)}),$e(this,"resolve",async i=>{if(this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:i}),!this.records.has(i.id))return;const s=await this.getRecord(i.id);typeof s.response>"u"&&(s.response=tt(i)?{error:i.error}:{result:i.result},this.records.set(s.id,s),this.persist(),this.events.emit(ot.updated,s))}),$e(this,"get",async(i,s)=>(this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:i,id:s}),await this.getRecord(s))),$e(this,"delete",(i,s)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:s}),this.values.forEach(n=>{if(n.topic===i){if(typeof s<"u"&&n.id!==s)return;this.records.delete(n.id),this.events.emit(ot.deleted,n)}}),this.persist()}),$e(this,"exists",async(i,s)=>(this.isInitialized(),this.records.has(s)?(await this.getRecord(s)).topic===i:!1)),$e(this,"on",(i,s)=>{this.events.on(i,s)}),$e(this,"once",(i,s)=>{this.events.once(i,s)}),$e(this,"off",(i,s)=>{this.events.off(i,s)}),$e(this,"removeListener",(i,s)=>{this.events.removeListener(i,s)}),this.logger=Ne(t,this.name)}get context(){return Me(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){const e=[];return this.values.forEach(t=>{if(typeof t.response<"u")return;const i={topic:t.topic,request:kt(t.request.method,t.request.params,t.id),chainId:t.chainId};return e.push(i)}),e}async setJsonRpcRecords(e){await this.core.storage.setItem(this.storageKey,e)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(e){this.isInitialized();const t=this.records.get(e);if(!t){const{message:i}=U("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(i)}return t}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit(ot.sync)}async restore(){try{const e=await this.getJsonRpcRecords();if(typeof e>"u"||!e.length)return;if(this.records.size){const{message:t}=U("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(t),new Error(t)}this.cached=e,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(e){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(e)}}registerEventListeners(){this.events.on(ot.created,e=>{const t=ot.created;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,record:e})}),this.events.on(ot.updated,e=>{const t=ot.updated;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,record:e})}),this.events.on(ot.deleted,e=>{const t=ot.deleted;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,record:e})}),this.core.heartbeat.on(Zr.pulse,()=>{this.cleanup()})}cleanup(){try{this.isInitialized();let e=!1;this.records.forEach(t=>{L.toMiliseconds(t.expiry||0)-Date.now()<=0&&(this.logger.info(`Deleting expired history log: ${t.id}`),this.records.delete(t.id),this.events.emit(ot.deleted,t,!1),e=!0)}),e&&this.persist()}catch(e){this.logger.warn(e)}}isInitialized(){if(!this.initialized){const{message:e}=U("NOT_INITIALIZED",this.name);throw new Error(e)}}}var u$=Object.defineProperty,h$=(r,e,t)=>e in r?u$(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,xe=(r,e,t)=>h$(r,typeof e!="symbol"?e+"":e,t);class l$ extends K1{constructor(e,t){super(e,t),this.core=e,this.logger=t,xe(this,"expirations",new Map),xe(this,"events",new Ye.EventEmitter),xe(this,"name",d_),xe(this,"version",p_),xe(this,"cached",[]),xe(this,"initialized",!1),xe(this,"storagePrefix",_t),xe(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(i=>this.expirations.set(i.target,i)),this.cached=[],this.registerEventListeners(),this.initialized=!0)}),xe(this,"has",i=>{try{const s=this.formatTarget(i);return typeof this.getExpiration(s)<"u"}catch{return!1}}),xe(this,"set",(i,s)=>{this.isInitialized();const n=this.formatTarget(i),o={target:n,expiry:s};this.expirations.set(n,o),this.checkExpiry(n,o),this.events.emit(et.created,{target:n,expiration:o})}),xe(this,"get",i=>{this.isInitialized();const s=this.formatTarget(i);return this.getExpiration(s)}),xe(this,"del",i=>{if(this.isInitialized(),this.has(i)){const s=this.formatTarget(i),n=this.getExpiration(s);this.expirations.delete(s),this.events.emit(et.deleted,{target:s,expiration:n})}}),xe(this,"on",(i,s)=>{this.events.on(i,s)}),xe(this,"once",(i,s)=>{this.events.once(i,s)}),xe(this,"off",(i,s)=>{this.events.off(i,s)}),xe(this,"removeListener",(i,s)=>{this.events.removeListener(i,s)}),this.logger=Ne(t,this.name)}get context(){return Me(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(e){if(typeof e=="string")return bw(e);if(typeof e=="number")return vw(e);const{message:t}=U("UNKNOWN_TYPE",`Target type: ${typeof e}`);throw new Error(t)}async setExpirations(e){await this.core.storage.setItem(this.storageKey,e)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit(et.sync)}async restore(){try{const e=await this.getExpirations();if(typeof e>"u"||!e.length)return;if(this.expirations.size){const{message:t}=U("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(t),new Error(t)}this.cached=e,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(e){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(e)}}getExpiration(e){const t=this.expirations.get(e);if(!t){const{message:i}=U("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.warn(i),new Error(i)}return t}checkExpiry(e,t){const{expiry:i}=t;L.toMiliseconds(i)-Date.now()<=0&&this.expire(e,t)}expire(e,t){this.expirations.delete(e),this.events.emit(et.expired,{target:e,expiration:t})}checkExpirations(){this.core.relayer.connected&&this.expirations.forEach((e,t)=>this.checkExpiry(t,e))}registerEventListeners(){this.core.heartbeat.on(Zr.pulse,()=>this.checkExpirations()),this.events.on(et.created,e=>{const t=et.created;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,data:e}),this.persist()}),this.events.on(et.expired,e=>{const t=et.expired;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,data:e}),this.persist()}),this.events.on(et.deleted,e=>{const t=et.deleted;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,data:e}),this.persist()})}isInitialized(){if(!this.initialized){const{message:e}=U("NOT_INITIALIZED",this.name);throw new Error(e)}}}var d$=Object.defineProperty,p$=(r,e,t)=>e in r?d$(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,he=(r,e,t)=>p$(r,typeof e!="symbol"?e+"":e,t);class f$ extends W1{constructor(e,t,i){super(e,t,i),this.core=e,this.logger=t,this.store=i,he(this,"name",f_),he(this,"abortController"),he(this,"isDevEnv"),he(this,"verifyUrlV3",y_),he(this,"storagePrefix",_t),he(this,"version",Kl),he(this,"publicKey"),he(this,"fetchPromise"),he(this,"init",async()=>{var s;this.isDevEnv||(this.publicKey=await this.store.getItem(this.storeKey),this.publicKey&&L.toMiliseconds((s=this.publicKey)==null?void 0:s.expiresAt)<Date.now()&&(this.logger.debug("verify v2 public key expired"),await this.removePublicKey()))}),he(this,"register",async s=>{if(!Ai()||this.isDevEnv)return;const n=window.location.origin,{id:o,decryptedId:a}=s,c=`${this.verifyUrlV3}/attestation?projectId=${this.core.projectId}&origin=${n}&id=${o}&decryptedId=${a}`;try{const u=ir.getDocument(),h=this.startAbortTimer(L.ONE_SECOND*5),l=await new Promise((d,f)=>{const p=()=>{window.removeEventListener("message",b),u.body.removeChild(g),f("attestation aborted")};this.abortController.signal.addEventListener("abort",p);const g=u.createElement("iframe");g.src=c,g.style.display="none",g.addEventListener("error",p,{signal:this.abortController.signal});const b=$=>{if($.data&&typeof $.data=="string")try{const v=JSON.parse($.data);if(v.type==="verify_attestation"){if(zn(v.attestation).payload.id!==o)return;clearInterval(h),u.body.removeChild(g),this.abortController.signal.removeEventListener("abort",p),window.removeEventListener("message",b),d(v.attestation===null?"":v.attestation)}}catch(v){this.logger.warn(v)}};u.body.appendChild(g),window.addEventListener("message",b,{signal:this.abortController.signal})});return this.logger.debug("jwt attestation",l),l}catch(u){this.logger.warn(u)}return""}),he(this,"resolve",async s=>{if(this.isDevEnv)return"";const{attestationId:n,hash:o,encryptedId:a}=s;if(n===""){this.logger.debug("resolve: attestationId is empty, skipping");return}if(n){if(zn(n).payload.id!==a)return;const u=await this.isValidJwtAttestation(n);if(u){if(!u.isVerified){this.logger.warn("resolve: jwt attestation: origin url not verified");return}return u}}if(!o)return;const c=this.getVerifyUrl(s==null?void 0:s.verifyUrl);return this.fetchAttestation(o,c)}),he(this,"fetchAttestation",async(s,n)=>{this.logger.debug(`resolving attestation: ${s} from url: ${n}`);const o=this.startAbortTimer(L.ONE_SECOND*5),a=await fetch(`${n}/attestation/${s}?v2Supported=true`,{signal:this.abortController.signal});return clearTimeout(o),a.status===200?await a.json():void 0}),he(this,"getVerifyUrl",s=>{let n=s||yi;return m_.includes(n)||(this.logger.info(`verify url: ${n}, not included in trusted list, assigning default: ${yi}`),n=yi),n}),he(this,"fetchPublicKey",async()=>{try{this.logger.debug(`fetching public key from: ${this.verifyUrlV3}`);const s=this.startAbortTimer(L.FIVE_SECONDS),n=await fetch(`${this.verifyUrlV3}/public-key`,{signal:this.abortController.signal});return clearTimeout(s),await n.json()}catch(s){this.logger.warn(s)}}),he(this,"persistPublicKey",async s=>{this.logger.debug("persisting public key to local storage",s),await this.store.setItem(this.storeKey,s),this.publicKey=s}),he(this,"removePublicKey",async()=>{this.logger.debug("removing verify v2 public key from storage"),await this.store.removeItem(this.storeKey),this.publicKey=void 0}),he(this,"isValidJwtAttestation",async s=>{const n=await this.getPublicKey();try{if(n)return this.validateAttestation(s,n)}catch(a){this.logger.error(a),this.logger.warn("error validating attestation")}const o=await this.fetchAndPersistPublicKey();try{if(o)return this.validateAttestation(s,o)}catch(a){this.logger.error(a),this.logger.warn("error validating attestation")}}),he(this,"getPublicKey",async()=>this.publicKey?this.publicKey:await this.fetchAndPersistPublicKey()),he(this,"fetchAndPersistPublicKey",async()=>{if(this.fetchPromise)return await this.fetchPromise,this.publicKey;this.fetchPromise=new Promise(async n=>{const o=await this.fetchPublicKey();o&&(await this.persistPublicKey(o),n(o))});const s=await this.fetchPromise;return this.fetchPromise=void 0,s}),he(this,"validateAttestation",(s,n)=>{const o=Yv(s,n.publicKey),a={hasExpired:L.toMiliseconds(o.exp)<Date.now(),payload:o};if(a.hasExpired)throw this.logger.warn("resolve: jwt attestation expired"),new Error("JWT attestation expired");return{origin:a.payload.origin,isScam:a.payload.isScam,isVerified:a.payload.isVerified}}),this.logger=Ne(t,this.name),this.abortController=new AbortController,this.isDevEnv=Ro(),this.init()}get storeKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//verify:public:key"}get context(){return Me(this.logger)}startAbortTimer(e){return this.abortController=new AbortController,setTimeout(()=>this.abortController.abort(),L.toMiliseconds(e))}}var g$=Object.defineProperty,y$=(r,e,t)=>e in r?g$(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Iu=(r,e,t)=>y$(r,typeof e!="symbol"?e+"":e,t);class m$ extends G1{constructor(e,t){super(e,t),this.projectId=e,this.logger=t,Iu(this,"context",w_),Iu(this,"registerDeviceToken",async i=>{const{clientId:s,token:n,notificationType:o,enableEncrypted:a=!1}=i,c=`${b_}/${this.projectId}/clients`;await fetch(c,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({client_id:s,type:o,token:n,always_raw:a})})}),this.logger=Ne(t,this.context)}}var w$=Object.defineProperty,$u=Object.getOwnPropertySymbols,b$=Object.prototype.hasOwnProperty,v$=Object.prototype.propertyIsEnumerable,yo=(r,e,t)=>e in r?w$(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,ui=(r,e)=>{for(var t in e||(e={}))b$.call(e,t)&&yo(r,t,e[t]);if($u)for(var t of $u(e))v$.call(e,t)&&yo(r,t,e[t]);return r},fe=(r,e,t)=>yo(r,typeof e!="symbol"?e+"":e,t);class E$ extends Y1{constructor(e,t,i=!0){super(e,t,i),this.core=e,this.logger=t,fe(this,"context",E_),fe(this,"storagePrefix",_t),fe(this,"storageVersion",v_),fe(this,"events",new Map),fe(this,"shouldPersist",!1),fe(this,"init",async()=>{if(!Ro())try{const s={eventId:Xa(),timestamp:Date.now(),domain:this.getAppDomain(),props:{event:"INIT",type:"",properties:{client_id:await this.core.crypto.getClientId(),user_agent:Qh(this.core.relayer.protocol,this.core.relayer.version,ao)}}};await this.sendEvent([s])}catch(s){this.logger.warn(s)}}),fe(this,"createEvent",s=>{const{event:n="ERROR",type:o="",properties:{topic:a,trace:c}}=s,u=Xa(),h=this.core.projectId||"",l=Date.now(),d=ui({eventId:u,timestamp:l,props:{event:n,type:o,properties:{topic:a,trace:c}},bundleId:h,domain:this.getAppDomain()},this.setMethods(u));return this.telemetryEnabled&&(this.events.set(u,d),this.shouldPersist=!0),d}),fe(this,"getEvent",s=>{const{eventId:n,topic:o}=s;if(n)return this.events.get(n);const a=Array.from(this.events.values()).find(c=>c.props.properties.topic===o);if(a)return ui(ui({},a),this.setMethods(a.eventId))}),fe(this,"deleteEvent",s=>{const{eventId:n}=s;this.events.delete(n),this.shouldPersist=!0}),fe(this,"setEventListeners",()=>{this.core.heartbeat.on(Zr.pulse,async()=>{this.shouldPersist&&await this.persist(),this.events.forEach(s=>{L.fromMiliseconds(Date.now())-L.fromMiliseconds(s.timestamp)>__&&(this.events.delete(s.eventId),this.shouldPersist=!0)})})}),fe(this,"setMethods",s=>({addTrace:n=>this.addTrace(s,n),setError:n=>this.setError(s,n)})),fe(this,"addTrace",(s,n)=>{const o=this.events.get(s);o&&(o.props.properties.trace.push(n),this.events.set(s,o),this.shouldPersist=!0)}),fe(this,"setError",(s,n)=>{const o=this.events.get(s);o&&(o.props.type=n,o.timestamp=Date.now(),this.events.set(s,o),this.shouldPersist=!0)}),fe(this,"persist",async()=>{await this.core.storage.setItem(this.storageKey,Array.from(this.events.values())),this.shouldPersist=!1}),fe(this,"restore",async()=>{try{const s=await this.core.storage.getItem(this.storageKey)||[];if(!s.length)return;s.forEach(n=>{this.events.set(n.eventId,ui(ui({},n),this.setMethods(n.eventId)))})}catch(s){this.logger.warn(s)}}),fe(this,"submit",async()=>{if(!this.telemetryEnabled||this.events.size===0)return;const s=[];for(const[n,o]of this.events)o.props.type&&s.push(o);if(s.length!==0)try{if((await this.sendEvent(s)).ok)for(const n of s)this.events.delete(n.eventId),this.shouldPersist=!0}catch(n){this.logger.warn(n)}}),fe(this,"sendEvent",async s=>{const n=this.getAppDomain()?"":"&sp=desktop";return await fetch(`${I_}?projectId=${this.core.projectId}&st=events_sdk&sv=js-${ao}${n}`,{method:"POST",body:JSON.stringify(s)})}),fe(this,"getAppDomain",()=>Zh().url),this.logger=Ne(t,this.context),this.telemetryEnabled=i,i?this.restore().then(async()=>{await this.submit(),this.setEventListeners()}):this.persist()}get storageKey(){return this.storagePrefix+this.storageVersion+this.core.customStoragePrefix+"//"+this.context}}var _$=Object.defineProperty,Su=Object.getOwnPropertySymbols,I$=Object.prototype.hasOwnProperty,$$=Object.prototype.propertyIsEnumerable,mo=(r,e,t)=>e in r?_$(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Du=(r,e)=>{for(var t in e||(e={}))I$.call(e,t)&&mo(r,t,e[t]);if(Su)for(var t of Su(e))$$.call(e,t)&&mo(r,t,e[t]);return r},oe=(r,e,t)=>mo(r,typeof e!="symbol"?e+"":e,t);let S$=class od extends B1{constructor(e){var t;super(e),oe(this,"protocol",Vl),oe(this,"version",Kl),oe(this,"name",oo),oe(this,"relayUrl"),oe(this,"projectId"),oe(this,"customStoragePrefix"),oe(this,"events",new Ye.EventEmitter),oe(this,"logger"),oe(this,"heartbeat"),oe(this,"relayer"),oe(this,"crypto"),oe(this,"storage"),oe(this,"history"),oe(this,"expirer"),oe(this,"pairing"),oe(this,"verify"),oe(this,"echoClient"),oe(this,"linkModeSupportedApps"),oe(this,"eventClient"),oe(this,"initialized",!1),oe(this,"logChunkController"),oe(this,"on",(a,c)=>this.events.on(a,c)),oe(this,"once",(a,c)=>this.events.once(a,c)),oe(this,"off",(a,c)=>this.events.off(a,c)),oe(this,"removeListener",(a,c)=>this.events.removeListener(a,c)),oe(this,"dispatchEnvelope",({topic:a,message:c,sessionExists:u})=>{if(!a||!c)return;const h={topic:a,message:c,publishedAt:Date.now(),transportType:ae.link_mode};this.relayer.onLinkMessageEvent(h,{sessionExists:u})});const i=this.getGlobalCore(e==null?void 0:e.customStoragePrefix);if(i)try{return this.customStoragePrefix=i.customStoragePrefix,this.logger=i.logger,this.heartbeat=i.heartbeat,this.crypto=i.crypto,this.history=i.history,this.expirer=i.expirer,this.storage=i.storage,this.relayer=i.relayer,this.pairing=i.pairing,this.verify=i.verify,this.echoClient=i.echoClient,this.linkModeSupportedApps=i.linkModeSupportedApps,this.eventClient=i.eventClient,this.initialized=i.initialized,this.logChunkController=i.logChunkController,i}catch(a){console.warn("Failed to copy global core",a)}this.projectId=e==null?void 0:e.projectId,this.relayUrl=(e==null?void 0:e.relayUrl)||Gl,this.customStoragePrefix=e!=null&&e.customStoragePrefix?`:${e.customStoragePrefix}`:"";const s=Ns({level:typeof(e==null?void 0:e.logger)=="string"&&e.logger?e.logger:VE.logger,name:oo}),{logger:n,chunkLoggerController:o}=R1({opts:s,maxSizeInBytes:e==null?void 0:e.maxLogBlobSizeInBytes,loggerOverride:e==null?void 0:e.logger});this.logChunkController=o,(t=this.logChunkController)!=null&&t.downloadLogsBlobInBrowser&&(window.downloadLogsBlobInBrowser=async()=>{var a,c;(a=this.logChunkController)!=null&&a.downloadLogsBlobInBrowser&&((c=this.logChunkController)==null||c.downloadLogsBlobInBrowser({clientId:await this.crypto.getClientId()}))}),this.logger=Ne(n,this.name),this.heartbeat=new B0,this.crypto=new QI(this,this.logger,e==null?void 0:e.keychain),this.history=new c$(this,this.logger),this.expirer=new l$(this,this.logger),this.storage=e!=null&&e.storage?e.storage:new y1(Du(Du({},KE),e==null?void 0:e.storageOptions)),this.relayer=new S2({core:this,logger:this.logger,relayUrl:this.relayUrl,projectId:this.projectId}),this.pairing=new n$(this,this.logger),this.verify=new f$(this,this.logger,this.storage),this.echoClient=new m$(this.projectId||"",this.logger),this.linkModeSupportedApps=[],this.eventClient=new E$(this,this.logger,e==null?void 0:e.telemetryEnabled),this.setGlobalCore(this)}static async init(e){const t=new od(e);await t.initialize();const i=await t.crypto.getClientId();return await t.storage.setItem(n_,i),t}get context(){return Me(this.logger)}async start(){this.initialized||await this.initialize()}async getLogsBlob(){var e;return(e=this.logChunkController)==null?void 0:e.logsToBlob({clientId:await this.crypto.getClientId()})}async addLinkModeSupportedApp(e){this.linkModeSupportedApps.includes(e)||(this.linkModeSupportedApps.push(e),await this.storage.setItem(nu,this.linkModeSupportedApps))}async initialize(){this.logger.trace("Initialized");try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.linkModeSupportedApps=await this.storage.getItem(nu)||[],this.initialized=!0,this.logger.info("Core Initialization Success")}catch(e){throw this.logger.warn(`Core Initialization Failure at epoch ${Date.now()}`,e),this.logger.error(e.message),e}}getGlobalCore(e=""){try{if(this.isGlobalCoreDisabled())return;const t=`_walletConnectCore_${e}`,i=`${t}_count`;return globalThis[i]=(globalThis[i]||0)+1,globalThis[i]>1&&console.warn(`WalletConnect Core is already initialized. This is probably a mistake and can lead to unexpected behavior. Init() was called ${globalThis[i]} times.`),globalThis[t]}catch(t){console.warn("Failed to get global WalletConnect core",t);return}}setGlobalCore(e){var t;try{if(this.isGlobalCoreDisabled())return;const i=`_walletConnectCore_${((t=e.opts)==null?void 0:t.customStoragePrefix)||""}`;globalThis[i]=e}catch(i){console.warn("Failed to set global WalletConnect core",i)}}isGlobalCoreDisabled(){try{return typeof process<"u"&&HE.DISABLE_GLOBAL_CORE==="true"}catch{return!0}}};const D$=S$,ad="wc",cd=2,ud="client",Vo=`${ad}@${cd}:${ud}:`,Sn={name:ud,logger:"error"},Ou="WALLETCONNECT_DEEPLINK_CHOICE",O$="proposal",Pu="Proposal expired",P$="session",vr=L.SEVEN_DAYS,A$="engine",ge={wc_sessionPropose:{req:{ttl:L.FIVE_MINUTES,prompt:!0,tag:1100},res:{ttl:L.FIVE_MINUTES,prompt:!1,tag:1101},reject:{ttl:L.FIVE_MINUTES,prompt:!1,tag:1120},autoReject:{ttl:L.FIVE_MINUTES,prompt:!1,tag:1121}},wc_sessionSettle:{req:{ttl:L.FIVE_MINUTES,prompt:!1,tag:1102},res:{ttl:L.FIVE_MINUTES,prompt:!1,tag:1103}},wc_sessionUpdate:{req:{ttl:L.ONE_DAY,prompt:!1,tag:1104},res:{ttl:L.ONE_DAY,prompt:!1,tag:1105}},wc_sessionExtend:{req:{ttl:L.ONE_DAY,prompt:!1,tag:1106},res:{ttl:L.ONE_DAY,prompt:!1,tag:1107}},wc_sessionRequest:{req:{ttl:L.FIVE_MINUTES,prompt:!0,tag:1108},res:{ttl:L.FIVE_MINUTES,prompt:!1,tag:1109}},wc_sessionEvent:{req:{ttl:L.FIVE_MINUTES,prompt:!0,tag:1110},res:{ttl:L.FIVE_MINUTES,prompt:!1,tag:1111}},wc_sessionDelete:{req:{ttl:L.ONE_DAY,prompt:!1,tag:1112},res:{ttl:L.ONE_DAY,prompt:!1,tag:1113}},wc_sessionPing:{req:{ttl:L.ONE_DAY,prompt:!1,tag:1114},res:{ttl:L.ONE_DAY,prompt:!1,tag:1115}},wc_sessionAuthenticate:{req:{ttl:L.ONE_HOUR,prompt:!0,tag:1116},res:{ttl:L.ONE_HOUR,prompt:!1,tag:1117},reject:{ttl:L.FIVE_MINUTES,prompt:!1,tag:1118},autoReject:{ttl:L.FIVE_MINUTES,prompt:!1,tag:1119}}},Dn={min:L.FIVE_MINUTES,max:L.SEVEN_DAYS},yt={idle:"IDLE",active:"ACTIVE"},Au={eth_sendTransaction:{key:""},eth_sendRawTransaction:{key:""},wallet_sendCalls:{key:""},solana_signTransaction:{key:"signature"},solana_signAllTransactions:{key:"transactions"},solana_signAndSendTransaction:{key:"signature"}},x$="request",C$=["wc_sessionPropose","wc_sessionRequest","wc_authRequest","wc_sessionAuthenticate"],T$="wc",R$="auth",N$="authKeys",j$="pairingTopics",B$="requests",Fs=`${T$}@${1.5}:${R$}:`,hs=`${Fs}:PUB_KEY`;var L$=Object.defineProperty,U$=Object.defineProperties,F$=Object.getOwnPropertyDescriptors,xu=Object.getOwnPropertySymbols,q$=Object.prototype.hasOwnProperty,M$=Object.prototype.propertyIsEnumerable,wo=(r,e,t)=>e in r?L$(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,se=(r,e)=>{for(var t in e||(e={}))q$.call(e,t)&&wo(r,t,e[t]);if(xu)for(var t of xu(e))M$.call(e,t)&&wo(r,t,e[t]);return r},Te=(r,e)=>U$(r,F$(e)),B=(r,e,t)=>wo(r,typeof e!="symbol"?e+"":e,t);class k$ extends X1{constructor(e){super(e),B(this,"name",A$),B(this,"events",new $o),B(this,"initialized",!1),B(this,"requestQueue",{state:yt.idle,queue:[]}),B(this,"sessionRequestQueue",{state:yt.idle,queue:[]}),B(this,"requestQueueDelay",L.ONE_SECOND),B(this,"expectedPairingMethodMap",new Map),B(this,"recentlyDeletedMap",new Map),B(this,"recentlyDeletedLimit",200),B(this,"relayMessageCache",[]),B(this,"pendingSessions",new Map),B(this,"init",async()=>{this.initialized||(await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.registerPairingEvents(),await this.registerLinkModeListeners(),this.client.core.pairing.register({methods:Object.keys(ge)}),this.initialized=!0,setTimeout(async()=>{await this.processPendingMessageEvents(),this.sessionRequestQueue.queue=this.getPendingSessionRequests(),this.processSessionRequestQueue()},L.toMiliseconds(this.requestQueueDelay)))}),B(this,"connect",async t=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();const i=Te(se({},t),{requiredNamespaces:t.requiredNamespaces||{},optionalNamespaces:t.optionalNamespaces||{}});await this.isValidConnect(i);const{pairingTopic:s,requiredNamespaces:n,optionalNamespaces:o,sessionProperties:a,scopedProperties:c,relays:u}=i;let h=s,l,d=!1;try{if(h){const m=this.client.core.pairing.pairings.get(h);this.client.logger.warn("connect() with existing pairing topic is deprecated and will be removed in the next major release."),d=m.active}}catch(m){throw this.client.logger.error(`connect() -> pairing.get(${h}) failed`),m}if(!h||!d){const{topic:m,uri:_}=await this.client.core.pairing.create();h=m,l=_}if(!h){const{message:m}=U("NO_MATCHING_KEY",`connect() pairing topic: ${h}`);throw new Error(m)}const f=await this.client.core.crypto.generateKeyPair(),p=ge.wc_sessionPropose.req.ttl||L.FIVE_MINUTES,g=de(p),b=Te(se(se({requiredNamespaces:n,optionalNamespaces:o,relays:u??[{protocol:Wl}],proposer:{publicKey:f,metadata:this.client.metadata},expiryTimestamp:g,pairingTopic:h},a&&{sessionProperties:a}),c&&{scopedProperties:c}),{id:wt()}),$=X("session_connect",b.id),{reject:v,resolve:S,done:E}=Yt(p,Pu),I=({id:m})=>{m===b.id&&(this.client.events.off("proposal_expire",I),this.pendingSessions.delete(b.id),this.events.emit($,{error:{message:Pu,code:0}}))};return this.client.events.on("proposal_expire",I),this.events.once($,({error:m,session:_})=>{this.client.events.off("proposal_expire",I),m?v(m):_&&S(_)}),await this.sendRequest({topic:h,method:"wc_sessionPropose",params:b,throwOnFailedPublish:!0,clientRpcId:b.id}),await this.setProposal(b.id,b),{uri:l,approval:E}}),B(this,"pair",async t=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{return await this.client.core.pairing.pair(t)}catch(i){throw this.client.logger.error("pair() failed"),i}}),B(this,"approve",async t=>{var i,s,n;const o=this.client.core.eventClient.createEvent({properties:{topic:(i=t==null?void 0:t.id)==null?void 0:i.toString(),trace:[at.session_approve_started]}});try{this.isInitialized(),await this.confirmOnlineStateOrThrow()}catch(O){throw o.setError(Wt.no_internet_connection),O}try{await this.isValidProposalId(t==null?void 0:t.id)}catch(O){throw this.client.logger.error(`approve() -> proposal.get(${t==null?void 0:t.id}) failed`),o.setError(Wt.proposal_not_found),O}try{await this.isValidApprove(t)}catch(O){throw this.client.logger.error("approve() -> isValidApprove() failed"),o.setError(Wt.session_approve_namespace_validation_failure),O}const{id:a,relayProtocol:c,namespaces:u,sessionProperties:h,scopedProperties:l,sessionConfig:d}=t,f=this.client.proposal.get(a);this.client.core.eventClient.deleteEvent({eventId:o.eventId});const{pairingTopic:p,proposer:g,requiredNamespaces:b,optionalNamespaces:$}=f;let v=(s=this.client.core.eventClient)==null?void 0:s.getEvent({topic:p});v||(v=(n=this.client.core.eventClient)==null?void 0:n.createEvent({type:at.session_approve_started,properties:{topic:p,trace:[at.session_approve_started,at.session_namespaces_validation_success]}}));const S=await this.client.core.crypto.generateKeyPair(),E=g.publicKey,I=await this.client.core.crypto.generateSharedKey(S,E),m=se(se(se({relay:{protocol:c??"irn"},namespaces:u,controller:{publicKey:S,metadata:this.client.metadata},expiry:de(vr)},h&&{sessionProperties:h}),l&&{scopedProperties:l}),d&&{sessionConfig:d}),_=ae.relay;v.addTrace(at.subscribing_session_topic);try{await this.client.core.relayer.subscribe(I,{transportType:_})}catch(O){throw v.setError(Wt.subscribe_session_topic_failure),O}v.addTrace(at.subscribe_session_topic_success);const D=Te(se({},m),{topic:I,requiredNamespaces:b,optionalNamespaces:$,pairingTopic:p,acknowledged:!1,self:m.controller,peer:{publicKey:g.publicKey,metadata:g.metadata},controller:S,transportType:ae.relay});await this.client.session.set(I,D),v.addTrace(at.store_session);try{v.addTrace(at.publishing_session_settle),await this.sendRequest({topic:I,method:"wc_sessionSettle",params:m,throwOnFailedPublish:!0}).catch(O=>{throw v==null||v.setError(Wt.session_settle_publish_failure),O}),v.addTrace(at.session_settle_publish_success),v.addTrace(at.publishing_session_approve),await this.sendResult({id:a,topic:p,result:{relay:{protocol:c??"irn"},responderPublicKey:S},throwOnFailedPublish:!0}).catch(O=>{throw v==null||v.setError(Wt.session_approve_publish_failure),O}),v.addTrace(at.session_approve_publish_success)}catch(O){throw this.client.logger.error(O),this.client.session.delete(I,te("USER_DISCONNECTED")),await this.client.core.relayer.unsubscribe(I),O}return this.client.core.eventClient.deleteEvent({eventId:v.eventId}),await this.client.core.pairing.updateMetadata({topic:p,metadata:g.metadata}),await this.client.proposal.delete(a,te("USER_DISCONNECTED")),await this.client.core.pairing.activate({topic:p}),await this.setExpiry(I,de(vr)),{topic:I,acknowledged:()=>Promise.resolve(this.client.session.get(I))}}),B(this,"reject",async t=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidReject(t)}catch(o){throw this.client.logger.error("reject() -> isValidReject() failed"),o}const{id:i,reason:s}=t;let n;try{n=this.client.proposal.get(i).pairingTopic}catch(o){throw this.client.logger.error(`reject() -> proposal.get(${i}) failed`),o}n&&(await this.sendError({id:i,topic:n,error:s,rpcOpts:ge.wc_sessionPropose.reject}),await this.client.proposal.delete(i,te("USER_DISCONNECTED")))}),B(this,"update",async t=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidUpdate(t)}catch(l){throw this.client.logger.error("update() -> isValidUpdate() failed"),l}const{topic:i,namespaces:s}=t,{done:n,resolve:o,reject:a}=Yt(),c=wt(),u=tr().toString(),h=this.client.session.get(i).namespaces;return this.events.once(X("session_update",c),({error:l})=>{l?a(l):o()}),await this.client.session.update(i,{namespaces:s}),await this.sendRequest({topic:i,method:"wc_sessionUpdate",params:{namespaces:s},throwOnFailedPublish:!0,clientRpcId:c,relayRpcId:u}).catch(l=>{this.client.logger.error(l),this.client.session.update(i,{namespaces:h}),a(l)}),{acknowledged:n}}),B(this,"extend",async t=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidExtend(t)}catch(c){throw this.client.logger.error("extend() -> isValidExtend() failed"),c}const{topic:i}=t,s=wt(),{done:n,resolve:o,reject:a}=Yt();return this.events.once(X("session_extend",s),({error:c})=>{c?a(c):o()}),await this.setExpiry(i,de(vr)),this.sendRequest({topic:i,method:"wc_sessionExtend",params:{},clientRpcId:s,throwOnFailedPublish:!0}).catch(c=>{a(c)}),{acknowledged:n}}),B(this,"request",async t=>{this.isInitialized();try{await this.isValidRequest(t)}catch($){throw this.client.logger.error("request() -> isValidRequest() failed"),$}const{chainId:i,request:s,topic:n,expiry:o=ge.wc_sessionRequest.req.ttl}=t,a=this.client.session.get(n);(a==null?void 0:a.transportType)===ae.relay&&await this.confirmOnlineStateOrThrow();const c=wt(),u=tr().toString(),{done:h,resolve:l,reject:d}=Yt(o,"Request expired. Please try again.");this.events.once(X("session_request",c),({error:$,result:v})=>{$?d($):l(v)});const f="wc_sessionRequest",p=this.getAppLinkIfEnabled(a.peer.metadata,a.transportType);if(p)return await this.sendRequest({clientRpcId:c,relayRpcId:u,topic:n,method:f,params:{request:Te(se({},s),{expiryTimestamp:de(o)}),chainId:i},expiry:o,throwOnFailedPublish:!0,appLink:p}).catch($=>d($)),this.client.events.emit("session_request_sent",{topic:n,request:s,chainId:i,id:c}),await h();const g={request:Te(se({},s),{expiryTimestamp:de(o)}),chainId:i},b=this.shouldSetTVF(f,g);return await Promise.all([new Promise(async $=>{await this.sendRequest(se({clientRpcId:c,relayRpcId:u,topic:n,method:f,params:g,expiry:o,throwOnFailedPublish:!0},b&&{tvf:this.getTVFParams(c,g)})).catch(v=>d(v)),this.client.events.emit("session_request_sent",{topic:n,request:s,chainId:i,id:c}),$()}),new Promise(async $=>{var v;if(!((v=a.sessionConfig)!=null&&v.disableDeepLink)){const S=await $w(this.client.core.storage,Ou);await Ew({id:c,topic:n,wcDeepLink:S})}$()}),h()]).then($=>$[2])}),B(this,"respond",async t=>{this.isInitialized(),await this.isValidRespond(t);const{topic:i,response:s}=t,{id:n}=s,o=this.client.session.get(i);o.transportType===ae.relay&&await this.confirmOnlineStateOrThrow();const a=this.getAppLinkIfEnabled(o.peer.metadata,o.transportType);bt(s)?await this.sendResult({id:n,topic:i,result:s.result,throwOnFailedPublish:!0,appLink:a}):tt(s)&&await this.sendError({id:n,topic:i,error:s.error,appLink:a}),this.cleanupAfterResponse(t)}),B(this,"ping",async t=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidPing(t)}catch(s){throw this.client.logger.error("ping() -> isValidPing() failed"),s}const{topic:i}=t;if(this.client.session.keys.includes(i)){const s=wt(),n=tr().toString(),{done:o,resolve:a,reject:c}=Yt();this.events.once(X("session_ping",s),({error:u})=>{u?c(u):a()}),await Promise.all([this.sendRequest({topic:i,method:"wc_sessionPing",params:{},throwOnFailedPublish:!0,clientRpcId:s,relayRpcId:n}),o()])}else this.client.core.pairing.pairings.keys.includes(i)&&(this.client.logger.warn("ping() on pairing topic is deprecated and will be removed in the next major release."),await this.client.core.pairing.ping({topic:i}))}),B(this,"emit",async t=>{this.isInitialized(),await this.confirmOnlineStateOrThrow(),await this.isValidEmit(t);const{topic:i,event:s,chainId:n}=t,o=tr().toString(),a=wt();await this.sendRequest({topic:i,method:"wc_sessionEvent",params:{event:s,chainId:n},throwOnFailedPublish:!0,relayRpcId:o,clientRpcId:a})}),B(this,"disconnect",async t=>{this.isInitialized(),await this.confirmOnlineStateOrThrow(),await this.isValidDisconnect(t);const{topic:i}=t;if(this.client.session.keys.includes(i))await this.sendRequest({topic:i,method:"wc_sessionDelete",params:te("USER_DISCONNECTED"),throwOnFailedPublish:!0}),await this.deleteSession({topic:i,emitEvent:!1});else if(this.client.core.pairing.pairings.keys.includes(i))await this.client.core.pairing.disconnect({topic:i});else{const{message:s}=U("MISMATCHED_TOPIC",`Session or pairing topic not found: ${i}`);throw new Error(s)}}),B(this,"find",t=>(this.isInitialized(),this.client.session.getAll().filter(i=>o0(i,t)))),B(this,"getPendingSessionRequests",()=>this.client.pendingRequest.getAll()),B(this,"authenticate",async(t,i)=>{var s;this.isInitialized(),this.isValidAuthenticate(t);const n=i&&this.client.core.linkModeSupportedApps.includes(i)&&((s=this.client.metadata.redirect)==null?void 0:s.linkMode),o=n?ae.link_mode:ae.relay;o===ae.relay&&await this.confirmOnlineStateOrThrow();const{chains:a,statement:c="",uri:u,domain:h,nonce:l,type:d,exp:f,nbf:p,methods:g=[],expiry:b}=t,$=[...t.resources||[]],{topic:v,uri:S}=await this.client.core.pairing.create({methods:["wc_sessionAuthenticate"],transportType:o});this.client.logger.info({message:"Generated new pairing",pairing:{topic:v,uri:S}});const E=await this.client.core.crypto.generateKeyPair(),I=os(E);if(await Promise.all([this.client.auth.authKeys.set(hs,{responseTopic:I,publicKey:E}),this.client.auth.pairingTopics.set(I,{topic:I,pairingTopic:v})]),await this.client.core.relayer.subscribe(I,{transportType:o}),this.client.logger.info(`sending request to new pairing topic: ${v}`),g.length>0){const{namespace:A}=Lr(a[0]);let T=yb(A,"request",g);ns($)&&(T=wb(T,$.pop())),$.push(T)}const m=b&&b>ge.wc_sessionAuthenticate.req.ttl?b:ge.wc_sessionAuthenticate.req.ttl,_={authPayload:{type:d??"caip122",chains:a,statement:c,aud:u,domain:h,version:"1",nonce:l,iat:new Date().toISOString(),exp:f,nbf:p,resources:$},requester:{publicKey:E,metadata:this.client.metadata},expiryTimestamp:de(m)},D={eip155:{chains:a,methods:[...new Set(["personal_sign",...g])],events:["chainChanged","accountsChanged"]}},O={requiredNamespaces:{},optionalNamespaces:D,relays:[{protocol:"irn"}],pairingTopic:v,proposer:{publicKey:E,metadata:this.client.metadata},expiryTimestamp:de(ge.wc_sessionPropose.req.ttl),id:wt()},{done:R,resolve:N,reject:j}=Yt(m,"Request expired"),k=wt(),x=X("session_connect",O.id),y=X("session_request",k),w=async({error:A,session:T})=>{this.events.off(y,P),A?j(A):T&&N({session:T})},P=async A=>{var T,F,M;if(await this.deletePendingAuthRequest(k,{message:"fulfilled",code:0}),A.error){const Y=te("WC_METHOD_UNSUPPORTED","wc_sessionAuthenticate");return A.error.code===Y.code?void 0:(this.events.off(x,w),j(A.error.message))}await this.deleteProposal(O.id),this.events.off(x,w);const{cacaos:z,responder:q}=A.result,H=[],V=[];for(const Y of z){await ac({cacao:Y,projectId:this.client.core.projectId})||(this.client.logger.error(Y,"Signature verification failed"),j(te("SESSION_SETTLEMENT_FAILED","Signature verification failed")));const{p:Ae}=Y,Ee=ns(Ae.resources),Ce=[Kn(Ae.iss)],Je=gs(Ae.iss);if(Ee){const Ze=cc(Ee),pr=uc(Ee);H.push(...Ze),Ce.push(...pr)}for(const Ze of Ce)V.push(`${Ze}:${Je}`)}const ne=await this.client.core.crypto.generateSharedKey(E,q.publicKey);let ee;H.length>0&&(ee={topic:ne,acknowledged:!0,self:{publicKey:E,metadata:this.client.metadata},peer:q,controller:q.publicKey,expiry:de(vr),requiredNamespaces:{},optionalNamespaces:{},relay:{protocol:"irn"},pairingTopic:v,namespaces:Cc([...new Set(H)],[...new Set(V)]),transportType:o},await this.client.core.relayer.subscribe(ne,{transportType:o}),await this.client.session.set(ne,ee),v&&await this.client.core.pairing.updateMetadata({topic:v,metadata:q.metadata}),ee=this.client.session.get(ne)),(T=this.client.metadata.redirect)!=null&&T.linkMode&&(F=q.metadata.redirect)!=null&&F.linkMode&&(M=q.metadata.redirect)!=null&&M.universal&&i&&(this.client.core.addLinkModeSupportedApp(q.metadata.redirect.universal),this.client.session.update(ne,{transportType:ae.link_mode})),N({auths:z,session:ee})};this.events.once(x,w),this.events.once(y,P);let C;try{if(n){const A=kt("wc_sessionAuthenticate",_,k);this.client.core.history.set(v,A);const T=await this.client.core.crypto.encode("",A,{type:ji,encoding:qt});C=Gi(i,v,T)}else await Promise.all([this.sendRequest({topic:v,method:"wc_sessionAuthenticate",params:_,expiry:t.expiry,throwOnFailedPublish:!0,clientRpcId:k}),this.sendRequest({topic:v,method:"wc_sessionPropose",params:O,expiry:ge.wc_sessionPropose.req.ttl,throwOnFailedPublish:!0,clientRpcId:O.id})])}catch(A){throw this.events.off(x,w),this.events.off(y,P),A}return await this.setProposal(O.id,O),await this.setAuthRequest(k,{request:Te(se({},_),{verifyContext:{}}),pairingTopic:v,transportType:o}),{uri:C??S,response:R}}),B(this,"approveSessionAuthenticate",async t=>{const{id:i,auths:s}=t,n=this.client.core.eventClient.createEvent({properties:{topic:i.toString(),trace:[Gt.authenticated_session_approve_started]}});try{this.isInitialized()}catch(b){throw n.setError(ai.no_internet_connection),b}const o=this.getPendingAuthRequest(i);if(!o)throw n.setError(ai.authenticated_session_pending_request_not_found),new Error(`Could not find pending auth request with id ${i}`);const a=o.transportType||ae.relay;a===ae.relay&&await this.confirmOnlineStateOrThrow();const c=o.requester.publicKey,u=await this.client.core.crypto.generateKeyPair(),h=os(c),l={type:Rt,receiverPublicKey:c,senderPublicKey:u},d=[],f=[];for(const b of s){if(!await ac({cacao:b,projectId:this.client.core.projectId})){n.setError(ai.invalid_cacao);const I=te("SESSION_SETTLEMENT_FAILED","Signature verification failed");throw await this.sendError({id:i,topic:h,error:I,encodeOpts:l}),new Error(I.message)}n.addTrace(Gt.cacaos_verified);const{p:$}=b,v=ns($.resources),S=[Kn($.iss)],E=gs($.iss);if(v){const I=cc(v),m=uc(v);d.push(...I),S.push(...m)}for(const I of S)f.push(`${I}:${E}`)}const p=await this.client.core.crypto.generateSharedKey(u,c);n.addTrace(Gt.create_authenticated_session_topic);let g;if((d==null?void 0:d.length)>0){g={topic:p,acknowledged:!0,self:{publicKey:u,metadata:this.client.metadata},peer:{publicKey:c,metadata:o.requester.metadata},controller:c,expiry:de(vr),authentication:s,requiredNamespaces:{},optionalNamespaces:{},relay:{protocol:"irn"},pairingTopic:o.pairingTopic,namespaces:Cc([...new Set(d)],[...new Set(f)]),transportType:a},n.addTrace(Gt.subscribing_authenticated_session_topic);try{await this.client.core.relayer.subscribe(p,{transportType:a})}catch(b){throw n.setError(ai.subscribe_authenticated_session_topic_failure),b}n.addTrace(Gt.subscribe_authenticated_session_topic_success),await this.client.session.set(p,g),n.addTrace(Gt.store_authenticated_session),await this.client.core.pairing.updateMetadata({topic:o.pairingTopic,metadata:o.requester.metadata})}n.addTrace(Gt.publishing_authenticated_session_approve);try{await this.sendResult({topic:h,id:i,result:{cacaos:s,responder:{publicKey:u,metadata:this.client.metadata}},encodeOpts:l,throwOnFailedPublish:!0,appLink:this.getAppLinkIfEnabled(o.requester.metadata,a)})}catch(b){throw n.setError(ai.authenticated_session_approve_publish_failure),b}return await this.client.auth.requests.delete(i,{message:"fulfilled",code:0}),await this.client.core.pairing.activate({topic:o.pairingTopic}),this.client.core.eventClient.deleteEvent({eventId:n.eventId}),{session:g}}),B(this,"rejectSessionAuthenticate",async t=>{this.isInitialized();const{id:i,reason:s}=t,n=this.getPendingAuthRequest(i);if(!n)throw new Error(`Could not find pending auth request with id ${i}`);n.transportType===ae.relay&&await this.confirmOnlineStateOrThrow();const o=n.requester.publicKey,a=await this.client.core.crypto.generateKeyPair(),c=os(o),u={type:Rt,receiverPublicKey:o,senderPublicKey:a};await this.sendError({id:i,topic:c,error:s,encodeOpts:u,rpcOpts:ge.wc_sessionAuthenticate.reject,appLink:this.getAppLinkIfEnabled(n.requester.metadata,n.transportType)}),await this.client.auth.requests.delete(i,{message:"rejected",code:0}),await this.client.proposal.delete(i,te("USER_DISCONNECTED"))}),B(this,"formatAuthMessage",t=>{this.isInitialized();const{request:i,iss:s}=t;return ul(i,s)}),B(this,"processRelayMessageCache",()=>{setTimeout(async()=>{if(this.relayMessageCache.length!==0)for(;this.relayMessageCache.length>0;)try{const t=this.relayMessageCache.shift();t&&await this.onRelayMessage(t)}catch(t){this.client.logger.error(t)}},50)}),B(this,"cleanupDuplicatePairings",async t=>{if(t.pairingTopic)try{const i=this.client.core.pairing.pairings.get(t.pairingTopic),s=this.client.core.pairing.pairings.getAll().filter(n=>{var o,a;return((o=n.peerMetadata)==null?void 0:o.url)&&((a=n.peerMetadata)==null?void 0:a.url)===t.peer.metadata.url&&n.topic&&n.topic!==i.topic});if(s.length===0)return;this.client.logger.info(`Cleaning up ${s.length} duplicate pairing(s)`),await Promise.all(s.map(n=>this.client.core.pairing.disconnect({topic:n.topic}))),this.client.logger.info("Duplicate pairings clean up finished")}catch(i){this.client.logger.error(i)}}),B(this,"deleteSession",async t=>{var i;const{topic:s,expirerHasDeleted:n=!1,emitEvent:o=!0,id:a=0}=t,{self:c}=this.client.session.get(s);await this.client.core.relayer.unsubscribe(s),await this.client.session.delete(s,te("USER_DISCONNECTED")),this.addToRecentlyDeleted(s,"session"),this.client.core.crypto.keychain.has(c.publicKey)&&await this.client.core.crypto.deleteKeyPair(c.publicKey),this.client.core.crypto.keychain.has(s)&&await this.client.core.crypto.deleteSymKey(s),n||this.client.core.expirer.del(s),this.client.core.storage.removeItem(Ou).catch(u=>this.client.logger.warn(u)),this.getPendingSessionRequests().forEach(u=>{u.topic===s&&this.deletePendingSessionRequest(u.id,te("USER_DISCONNECTED"))}),s===((i=this.sessionRequestQueue.queue[0])==null?void 0:i.topic)&&(this.sessionRequestQueue.state=yt.idle),o&&this.client.events.emit("session_delete",{id:a,topic:s})}),B(this,"deleteProposal",async(t,i)=>{if(i)try{const s=this.client.proposal.get(t),n=this.client.core.eventClient.getEvent({topic:s.pairingTopic});n==null||n.setError(Wt.proposal_expired)}catch{}await Promise.all([this.client.proposal.delete(t,te("USER_DISCONNECTED")),i?Promise.resolve():this.client.core.expirer.del(t)]),this.addToRecentlyDeleted(t,"proposal")}),B(this,"deletePendingSessionRequest",async(t,i,s=!1)=>{await Promise.all([this.client.pendingRequest.delete(t,i),s?Promise.resolve():this.client.core.expirer.del(t)]),this.addToRecentlyDeleted(t,"request"),this.sessionRequestQueue.queue=this.sessionRequestQueue.queue.filter(n=>n.id!==t),s&&(this.sessionRequestQueue.state=yt.idle,this.client.events.emit("session_request_expire",{id:t}))}),B(this,"deletePendingAuthRequest",async(t,i,s=!1)=>{await Promise.all([this.client.auth.requests.delete(t,i),s?Promise.resolve():this.client.core.expirer.del(t)])}),B(this,"setExpiry",async(t,i)=>{this.client.session.keys.includes(t)&&(this.client.core.expirer.set(t,i),await this.client.session.update(t,{expiry:i}))}),B(this,"setProposal",async(t,i)=>{this.client.core.expirer.set(t,de(ge.wc_sessionPropose.req.ttl)),await this.client.proposal.set(t,i)}),B(this,"setAuthRequest",async(t,i)=>{const{request:s,pairingTopic:n,transportType:o=ae.relay}=i;this.client.core.expirer.set(t,s.expiryTimestamp),await this.client.auth.requests.set(t,{authPayload:s.authPayload,requester:s.requester,expiryTimestamp:s.expiryTimestamp,id:t,pairingTopic:n,verifyContext:s.verifyContext,transportType:o})}),B(this,"setPendingSessionRequest",async t=>{const{id:i,topic:s,params:n,verifyContext:o}=t,a=n.request.expiryTimestamp||de(ge.wc_sessionRequest.req.ttl);this.client.core.expirer.set(i,a),await this.client.pendingRequest.set(i,{id:i,topic:s,params:n,verifyContext:o})}),B(this,"sendRequest",async t=>{const{topic:i,method:s,params:n,expiry:o,relayRpcId:a,clientRpcId:c,throwOnFailedPublish:u,appLink:h,tvf:l}=t,d=kt(s,n,c);let f;const p=!!h;try{const $=p?qt:ht;f=await this.client.core.crypto.encode(i,d,{encoding:$})}catch($){throw await this.cleanup(),this.client.logger.error(`sendRequest() -> core.crypto.encode() for topic ${i} failed`),$}let g;if(C$.includes(s)){const $=Et(JSON.stringify(d)),v=Et(f);g=await this.client.core.verify.register({id:v,decryptedId:$})}const b=ge[s].req;if(b.attestation=g,o&&(b.ttl=o),a&&(b.id=a),this.client.core.history.set(i,d),p){const $=Gi(h,i,f);await global.Linking.openURL($,this.client.name)}else{const $=ge[s].req;o&&($.ttl=o),a&&($.id=a),$.tvf=Te(se({},l),{correlationId:d.id}),u?($.internal=Te(se({},$.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(i,f,$)):this.client.core.relayer.publish(i,f,$).catch(v=>this.client.logger.error(v))}return d.id}),B(this,"sendResult",async t=>{const{id:i,topic:s,result:n,throwOnFailedPublish:o,encodeOpts:a,appLink:c}=t,u=js(i,n);let h;const l=c&&typeof(global==null?void 0:global.Linking)<"u";try{const p=l?qt:ht;h=await this.client.core.crypto.encode(s,u,Te(se({},a||{}),{encoding:p}))}catch(p){throw await this.cleanup(),this.client.logger.error(`sendResult() -> core.crypto.encode() for topic ${s} failed`),p}let d,f;try{d=await this.client.core.history.get(s,i);const p=d.request;try{this.shouldSetTVF(p.method,p.params)&&(f=this.getTVFParams(i,p.params,n))}catch(g){this.client.logger.warn("sendResult() -> getTVFParams() failed",g)}}catch(p){throw this.client.logger.error(`sendResult() -> history.get(${s}, ${i}) failed`),p}if(l){const p=Gi(c,s,h);await global.Linking.openURL(p,this.client.name)}else{const p=d.request.method,g=ge[p].res;g.tvf=Te(se({},f),{correlationId:i}),o?(g.internal=Te(se({},g.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(s,h,g)):this.client.core.relayer.publish(s,h,g).catch(b=>this.client.logger.error(b))}await this.client.core.history.resolve(u)}),B(this,"sendError",async t=>{const{id:i,topic:s,error:n,encodeOpts:o,rpcOpts:a,appLink:c}=t,u=Bs(i,n);let h;const l=c&&typeof(global==null?void 0:global.Linking)<"u";try{const f=l?qt:ht;h=await this.client.core.crypto.encode(s,u,Te(se({},o||{}),{encoding:f}))}catch(f){throw await this.cleanup(),this.client.logger.error(`sendError() -> core.crypto.encode() for topic ${s} failed`),f}let d;try{d=await this.client.core.history.get(s,i)}catch(f){throw this.client.logger.error(`sendError() -> history.get(${s}, ${i}) failed`),f}if(l){const f=Gi(c,s,h);await global.Linking.openURL(f,this.client.name)}else{const f=d.request.method,p=a||ge[f].res;this.client.core.relayer.publish(s,h,p)}await this.client.core.history.resolve(u)}),B(this,"cleanup",async()=>{const t=[],i=[];this.client.session.getAll().forEach(s=>{let n=!1;Ft(s.expiry)&&(n=!0),this.client.core.crypto.keychain.has(s.topic)||(n=!0),n&&t.push(s.topic)}),this.client.proposal.getAll().forEach(s=>{Ft(s.expiryTimestamp)&&i.push(s.id)}),await Promise.all([...t.map(s=>this.deleteSession({topic:s})),...i.map(s=>this.deleteProposal(s))])}),B(this,"onProviderMessageEvent",async t=>{!this.initialized||this.relayMessageCache.length>0?this.relayMessageCache.push(t):await this.onRelayMessage(t)}),B(this,"onRelayEventRequest",async t=>{this.requestQueue.queue.push(t),await this.processRequestsQueue()}),B(this,"processRequestsQueue",async()=>{if(this.requestQueue.state===yt.active){this.client.logger.info("Request queue already active, skipping...");return}for(this.client.logger.info(`Request queue starting with ${this.requestQueue.queue.length} requests`);this.requestQueue.queue.length>0;){this.requestQueue.state=yt.active;const t=this.requestQueue.queue.shift();if(t)try{await this.processRequest(t)}catch(i){this.client.logger.warn(i)}}this.requestQueue.state=yt.idle}),B(this,"processRequest",async t=>{const{topic:i,payload:s,attestation:n,transportType:o,encryptedId:a}=t,c=s.method;if(!this.shouldIgnorePairingRequest({topic:i,requestMethod:c}))switch(c){case"wc_sessionPropose":return await this.onSessionProposeRequest({topic:i,payload:s,attestation:n,encryptedId:a});case"wc_sessionSettle":return await this.onSessionSettleRequest(i,s);case"wc_sessionUpdate":return await this.onSessionUpdateRequest(i,s);case"wc_sessionExtend":return await this.onSessionExtendRequest(i,s);case"wc_sessionPing":return await this.onSessionPingRequest(i,s);case"wc_sessionDelete":return await this.onSessionDeleteRequest(i,s);case"wc_sessionRequest":return await this.onSessionRequest({topic:i,payload:s,attestation:n,encryptedId:a,transportType:o});case"wc_sessionEvent":return await this.onSessionEventRequest(i,s);case"wc_sessionAuthenticate":return await this.onSessionAuthenticateRequest({topic:i,payload:s,attestation:n,encryptedId:a,transportType:o});default:return this.client.logger.info(`Unsupported request method ${c}`)}}),B(this,"onRelayEventResponse",async t=>{const{topic:i,payload:s,transportType:n}=t,o=(await this.client.core.history.get(i,s.id)).request.method;switch(o){case"wc_sessionPropose":return this.onSessionProposeResponse(i,s,n);case"wc_sessionSettle":return this.onSessionSettleResponse(i,s);case"wc_sessionUpdate":return this.onSessionUpdateResponse(i,s);case"wc_sessionExtend":return this.onSessionExtendResponse(i,s);case"wc_sessionPing":return this.onSessionPingResponse(i,s);case"wc_sessionRequest":return this.onSessionRequestResponse(i,s);case"wc_sessionAuthenticate":return this.onSessionAuthenticateResponse(i,s);default:return this.client.logger.info(`Unsupported response method ${o}`)}}),B(this,"onRelayEventUnknownPayload",t=>{const{topic:i}=t,{message:s}=U("MISSING_OR_INVALID",`Decoded payload on topic ${i} is not identifiable as a JSON-RPC request or a response.`);throw new Error(s)}),B(this,"shouldIgnorePairingRequest",t=>{const{topic:i,requestMethod:s}=t,n=this.expectedPairingMethodMap.get(i);return!n||n.includes(s)?!1:!!(n.includes("wc_sessionAuthenticate")&&this.client.events.listenerCount("session_authenticate")>0)}),B(this,"onSessionProposeRequest",async t=>{const{topic:i,payload:s,attestation:n,encryptedId:o}=t,{params:a,id:c}=s;try{const u=this.client.core.eventClient.getEvent({topic:i});this.client.events.listenerCount("session_proposal")===0&&(console.warn("No listener for session_proposal event"),u==null||u.setError(At.proposal_listener_not_found)),this.isValidConnect(se({},s.params));const h=a.expiryTimestamp||de(ge.wc_sessionPropose.req.ttl),l=se({id:c,pairingTopic:i,expiryTimestamp:h},a);await this.setProposal(c,l);const d=await this.getVerifyContext({attestationId:n,hash:Et(JSON.stringify(s)),encryptedId:o,metadata:l.proposer.metadata});u==null||u.addTrace(mt.emit_session_proposal),this.client.events.emit("session_proposal",{id:c,params:l,verifyContext:d})}catch(u){await this.sendError({id:c,topic:i,error:u,rpcOpts:ge.wc_sessionPropose.autoReject}),this.client.logger.error(u)}}),B(this,"onSessionProposeResponse",async(t,i,s)=>{const{id:n}=i;if(bt(i)){const{result:o}=i;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",result:o});const a=this.client.proposal.get(n);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",proposal:a});const c=a.proposer.publicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",selfPublicKey:c});const u=o.responderPublicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",peerPublicKey:u});const h=await this.client.core.crypto.generateSharedKey(c,u);this.pendingSessions.set(n,{sessionTopic:h,pairingTopic:t,proposalId:n,publicKey:c});const l=await this.client.core.relayer.subscribe(h,{transportType:s});this.client.logger.trace({type:"method",method:"onSessionProposeResponse",subscriptionId:l}),await this.client.core.pairing.activate({topic:t})}else if(tt(i)){await this.client.proposal.delete(n,te("USER_DISCONNECTED"));const o=X("session_connect",n);if(this.events.listenerCount(o)===0)throw new Error(`emitting ${o} without any listeners, 954`);this.events.emit(o,{error:i.error})}}),B(this,"onSessionSettleRequest",async(t,i)=>{const{id:s,params:n}=i;try{this.isValidSessionSettleRequest(n);const{relay:o,controller:a,expiry:c,namespaces:u,sessionProperties:h,scopedProperties:l,sessionConfig:d}=i.params,f=[...this.pendingSessions.values()].find(b=>b.sessionTopic===t);if(!f)return this.client.logger.error(`Pending session not found for topic ${t}`);const p=this.client.proposal.get(f.proposalId),g=Te(se(se(se({topic:t,relay:o,expiry:c,namespaces:u,acknowledged:!0,pairingTopic:f.pairingTopic,requiredNamespaces:p.requiredNamespaces,optionalNamespaces:p.optionalNamespaces,controller:a.publicKey,self:{publicKey:f.publicKey,metadata:this.client.metadata},peer:{publicKey:a.publicKey,metadata:a.metadata}},h&&{sessionProperties:h}),l&&{scopedProperties:l}),d&&{sessionConfig:d}),{transportType:ae.relay});await this.client.session.set(g.topic,g),await this.setExpiry(g.topic,g.expiry),await this.client.core.pairing.updateMetadata({topic:f.pairingTopic,metadata:g.peer.metadata}),this.client.events.emit("session_connect",{session:g}),this.events.emit(X("session_connect",f.proposalId),{session:g}),this.pendingSessions.delete(f.proposalId),this.deleteProposal(f.proposalId,!1),this.cleanupDuplicatePairings(g),await this.sendResult({id:i.id,topic:t,result:!0,throwOnFailedPublish:!0})}catch(o){await this.sendError({id:s,topic:t,error:o}),this.client.logger.error(o)}}),B(this,"onSessionSettleResponse",async(t,i)=>{const{id:s}=i;bt(i)?(await this.client.session.update(t,{acknowledged:!0}),this.events.emit(X("session_approve",s),{})):tt(i)&&(await this.client.session.delete(t,te("USER_DISCONNECTED")),this.events.emit(X("session_approve",s),{error:i.error}))}),B(this,"onSessionUpdateRequest",async(t,i)=>{const{params:s,id:n}=i;try{const o=`${t}_session_update`,a=ni.get(o);if(a&&this.isRequestOutOfSync(a,n)){this.client.logger.warn(`Discarding out of sync request - ${n}`),this.sendError({id:n,topic:t,error:te("INVALID_UPDATE_REQUEST")});return}this.isValidUpdate(se({topic:t},s));try{ni.set(o,n),await this.client.session.update(t,{namespaces:s.namespaces}),await this.sendResult({id:n,topic:t,result:!0,throwOnFailedPublish:!0})}catch(c){throw ni.delete(o),c}this.client.events.emit("session_update",{id:n,topic:t,params:s})}catch(o){await this.sendError({id:n,topic:t,error:o}),this.client.logger.error(o)}}),B(this,"isRequestOutOfSync",(t,i)=>i.toString().slice(0,-3)<t.toString().slice(0,-3)),B(this,"onSessionUpdateResponse",(t,i)=>{const{id:s}=i,n=X("session_update",s);if(this.events.listenerCount(n)===0)throw new Error(`emitting ${n} without any listeners`);bt(i)?this.events.emit(X("session_update",s),{}):tt(i)&&this.events.emit(X("session_update",s),{error:i.error})}),B(this,"onSessionExtendRequest",async(t,i)=>{const{id:s}=i;try{this.isValidExtend({topic:t}),await this.setExpiry(t,de(vr)),await this.sendResult({id:s,topic:t,result:!0,throwOnFailedPublish:!0}),this.client.events.emit("session_extend",{id:s,topic:t})}catch(n){await this.sendError({id:s,topic:t,error:n}),this.client.logger.error(n)}}),B(this,"onSessionExtendResponse",(t,i)=>{const{id:s}=i,n=X("session_extend",s);if(this.events.listenerCount(n)===0)throw new Error(`emitting ${n} without any listeners`);bt(i)?this.events.emit(X("session_extend",s),{}):tt(i)&&this.events.emit(X("session_extend",s),{error:i.error})}),B(this,"onSessionPingRequest",async(t,i)=>{const{id:s}=i;try{this.isValidPing({topic:t}),await this.sendResult({id:s,topic:t,result:!0,throwOnFailedPublish:!0}),this.client.events.emit("session_ping",{id:s,topic:t})}catch(n){await this.sendError({id:s,topic:t,error:n}),this.client.logger.error(n)}}),B(this,"onSessionPingResponse",(t,i)=>{const{id:s}=i,n=X("session_ping",s);setTimeout(()=>{if(this.events.listenerCount(n)===0)throw new Error(`emitting ${n} without any listeners 2176`);bt(i)?this.events.emit(X("session_ping",s),{}):tt(i)&&this.events.emit(X("session_ping",s),{error:i.error})},500)}),B(this,"onSessionDeleteRequest",async(t,i)=>{const{id:s}=i;try{this.isValidDisconnect({topic:t,reason:i.params}),Promise.all([new Promise(n=>{this.client.core.relayer.once(we.publish,async()=>{n(await this.deleteSession({topic:t,id:s}))})}),this.sendResult({id:s,topic:t,result:!0,throwOnFailedPublish:!0}),this.cleanupPendingSentRequestsForTopic({topic:t,error:te("USER_DISCONNECTED")})]).catch(n=>this.client.logger.error(n))}catch(n){this.client.logger.error(n)}}),B(this,"onSessionRequest",async t=>{var i,s,n;const{topic:o,payload:a,attestation:c,encryptedId:u,transportType:h}=t,{id:l,params:d}=a;try{await this.isValidRequest(se({topic:o},d));const f=this.client.session.get(o),p=await this.getVerifyContext({attestationId:c,hash:Et(JSON.stringify(kt("wc_sessionRequest",d,l))),encryptedId:u,metadata:f.peer.metadata,transportType:h}),g={id:l,topic:o,params:d,verifyContext:p};await this.setPendingSessionRequest(g),h===ae.link_mode&&(i=f.peer.metadata.redirect)!=null&&i.universal&&this.client.core.addLinkModeSupportedApp((s=f.peer.metadata.redirect)==null?void 0:s.universal),(n=this.client.signConfig)!=null&&n.disableRequestQueue?this.emitSessionRequest(g):(this.addSessionRequestToSessionRequestQueue(g),this.processSessionRequestQueue())}catch(f){await this.sendError({id:l,topic:o,error:f}),this.client.logger.error(f)}}),B(this,"onSessionRequestResponse",(t,i)=>{const{id:s}=i,n=X("session_request",s);if(this.events.listenerCount(n)===0)throw new Error(`emitting ${n} without any listeners`);bt(i)?this.events.emit(X("session_request",s),{result:i.result}):tt(i)&&this.events.emit(X("session_request",s),{error:i.error})}),B(this,"onSessionEventRequest",async(t,i)=>{const{id:s,params:n}=i;try{const o=`${t}_session_event_${n.event.name}`,a=ni.get(o);if(a&&this.isRequestOutOfSync(a,s)){this.client.logger.info(`Discarding out of sync request - ${s}`);return}this.isValidEmit(se({topic:t},n)),this.client.events.emit("session_event",{id:s,topic:t,params:n}),ni.set(o,s)}catch(o){await this.sendError({id:s,topic:t,error:o}),this.client.logger.error(o)}}),B(this,"onSessionAuthenticateResponse",(t,i)=>{const{id:s}=i;this.client.logger.trace({type:"method",method:"onSessionAuthenticateResponse",topic:t,payload:i}),bt(i)?this.events.emit(X("session_request",s),{result:i.result}):tt(i)&&this.events.emit(X("session_request",s),{error:i.error})}),B(this,"onSessionAuthenticateRequest",async t=>{var i;const{topic:s,payload:n,attestation:o,encryptedId:a,transportType:c}=t;try{const{requester:u,authPayload:h,expiryTimestamp:l}=n.params,d=await this.getVerifyContext({attestationId:o,hash:Et(JSON.stringify(n)),encryptedId:a,metadata:u.metadata,transportType:c}),f={requester:u,pairingTopic:s,id:n.id,authPayload:h,verifyContext:d,expiryTimestamp:l};await this.setAuthRequest(n.id,{request:f,pairingTopic:s,transportType:c}),c===ae.link_mode&&(i=u.metadata.redirect)!=null&&i.universal&&this.client.core.addLinkModeSupportedApp(u.metadata.redirect.universal),this.client.events.emit("session_authenticate",{topic:s,params:n.params,id:n.id,verifyContext:d})}catch(u){this.client.logger.error(u);const h=n.params.requester.publicKey,l=await this.client.core.crypto.generateKeyPair(),d=this.getAppLinkIfEnabled(n.params.requester.metadata,c),f={type:Rt,receiverPublicKey:h,senderPublicKey:l};await this.sendError({id:n.id,topic:s,error:u,encodeOpts:f,rpcOpts:ge.wc_sessionAuthenticate.autoReject,appLink:d})}}),B(this,"addSessionRequestToSessionRequestQueue",t=>{this.sessionRequestQueue.queue.push(t)}),B(this,"cleanupAfterResponse",t=>{this.deletePendingSessionRequest(t.response.id,{message:"fulfilled",code:0}),setTimeout(()=>{this.sessionRequestQueue.state=yt.idle,this.processSessionRequestQueue()},L.toMiliseconds(this.requestQueueDelay))}),B(this,"cleanupPendingSentRequestsForTopic",({topic:t,error:i})=>{const s=this.client.core.history.pending;s.length>0&&s.filter(n=>n.topic===t&&n.request.method==="wc_sessionRequest").forEach(n=>{const o=n.request.id,a=X("session_request",o);if(this.events.listenerCount(a)===0)throw new Error(`emitting ${a} without any listeners`);this.events.emit(X("session_request",n.request.id),{error:i})})}),B(this,"processSessionRequestQueue",()=>{if(this.sessionRequestQueue.state===yt.active){this.client.logger.info("session request queue is already active.");return}const t=this.sessionRequestQueue.queue[0];if(!t){this.client.logger.info("session request queue is empty.");return}try{this.sessionRequestQueue.state=yt.active,this.emitSessionRequest(t)}catch(i){this.client.logger.error(i)}}),B(this,"emitSessionRequest",t=>{this.client.events.emit("session_request",t)}),B(this,"onPairingCreated",t=>{if(t.methods&&this.expectedPairingMethodMap.set(t.topic,t.methods),t.active)return;const i=this.client.proposal.getAll().find(s=>s.pairingTopic===t.topic);i&&this.onSessionProposeRequest({topic:t.topic,payload:kt("wc_sessionPropose",Te(se({},i),{requiredNamespaces:i.requiredNamespaces,optionalNamespaces:i.optionalNamespaces,relays:i.relays,proposer:i.proposer,sessionProperties:i.sessionProperties,scopedProperties:i.scopedProperties}),i.id)})}),B(this,"isValidConnect",async t=>{if(!Ue(t)){const{message:u}=U("MISSING_OR_INVALID",`connect() params: ${JSON.stringify(t)}`);throw new Error(u)}const{pairingTopic:i,requiredNamespaces:s,optionalNamespaces:n,sessionProperties:o,scopedProperties:a,relays:c}=t;if(Se(i)||await this.isValidPairingTopic(i),!w0(c)){const{message:u}=U("MISSING_OR_INVALID",`connect() relays: ${c}`);throw new Error(u)}if(!Se(s)&&Si(s)!==0&&this.validateNamespaces(s,"requiredNamespaces"),!Se(n)&&Si(n)!==0&&this.validateNamespaces(n,"optionalNamespaces"),Se(o)||this.validateSessionProps(o,"sessionProperties"),!Se(a)){this.validateSessionProps(a,"scopedProperties");const u=Object.keys(s||{}).concat(Object.keys(n||{}));if(!Object.keys(a).every(h=>u.includes(h)))throw new Error(`Scoped properties must be a subset of required/optional namespaces, received: ${JSON.stringify(a)}, required/optional namespaces: ${JSON.stringify(u)}`)}}),B(this,"validateNamespaces",(t,i)=>{const s=m0(t,"connect()",i);if(s)throw new Error(s.message)}),B(this,"isValidApprove",async t=>{if(!Ue(t))throw new Error(U("MISSING_OR_INVALID",`approve() params: ${t}`).message);const{id:i,namespaces:s,relayProtocol:n,sessionProperties:o,scopedProperties:a}=t;this.checkRecentlyDeleted(i),await this.isValidProposalId(i);const c=this.client.proposal.get(i),u=fn(s,"approve()");if(u)throw new Error(u.message);const h=Nc(c.requiredNamespaces,s,"approve()");if(h)throw new Error(h.message);if(!le(n,!0)){const{message:l}=U("MISSING_OR_INVALID",`approve() relayProtocol: ${n}`);throw new Error(l)}if(Se(o)||this.validateSessionProps(o,"sessionProperties"),!Se(a)){this.validateSessionProps(a,"scopedProperties");const l=new Set(Object.keys(s));if(!Object.keys(a).every(d=>l.has(d)))throw new Error(`Scoped properties must be a subset of approved namespaces, received: ${JSON.stringify(a)}, approved namespaces: ${Array.from(l).join(", ")}`)}}),B(this,"isValidReject",async t=>{if(!Ue(t)){const{message:n}=U("MISSING_OR_INVALID",`reject() params: ${t}`);throw new Error(n)}const{id:i,reason:s}=t;if(this.checkRecentlyDeleted(i),await this.isValidProposalId(i),!v0(s)){const{message:n}=U("MISSING_OR_INVALID",`reject() reason: ${JSON.stringify(s)}`);throw new Error(n)}}),B(this,"isValidSessionSettleRequest",t=>{if(!Ue(t)){const{message:u}=U("MISSING_OR_INVALID",`onSessionSettleRequest() params: ${t}`);throw new Error(u)}const{relay:i,controller:s,namespaces:n,expiry:o}=t;if(!jl(i)){const{message:u}=U("MISSING_OR_INVALID","onSessionSettleRequest() relay protocol should be a string");throw new Error(u)}const a=l0(s,"onSessionSettleRequest()");if(a)throw new Error(a.message);const c=fn(n,"onSessionSettleRequest()");if(c)throw new Error(c.message);if(Ft(o)){const{message:u}=U("EXPIRED","onSessionSettleRequest()");throw new Error(u)}}),B(this,"isValidUpdate",async t=>{if(!Ue(t)){const{message:c}=U("MISSING_OR_INVALID",`update() params: ${t}`);throw new Error(c)}const{topic:i,namespaces:s}=t;this.checkRecentlyDeleted(i),await this.isValidSessionTopic(i);const n=this.client.session.get(i),o=fn(s,"update()");if(o)throw new Error(o.message);const a=Nc(n.requiredNamespaces,s,"update()");if(a)throw new Error(a.message)}),B(this,"isValidExtend",async t=>{if(!Ue(t)){const{message:s}=U("MISSING_OR_INVALID",`extend() params: ${t}`);throw new Error(s)}const{topic:i}=t;this.checkRecentlyDeleted(i),await this.isValidSessionTopic(i)}),B(this,"isValidRequest",async t=>{if(!Ue(t)){const{message:c}=U("MISSING_OR_INVALID",`request() params: ${t}`);throw new Error(c)}const{topic:i,request:s,chainId:n,expiry:o}=t;this.checkRecentlyDeleted(i),await this.isValidSessionTopic(i);const{namespaces:a}=this.client.session.get(i);if(!Rc(a,n)){const{message:c}=U("MISSING_OR_INVALID",`request() chainId: ${n}`);throw new Error(c)}if(!E0(s)){const{message:c}=U("MISSING_OR_INVALID",`request() ${JSON.stringify(s)}`);throw new Error(c)}if(!$0(a,n,s.method)){const{message:c}=U("MISSING_OR_INVALID",`request() method: ${s.method}`);throw new Error(c)}if(o&&!P0(o,Dn)){const{message:c}=U("MISSING_OR_INVALID",`request() expiry: ${o}. Expiry must be a number (in seconds) between ${Dn.min} and ${Dn.max}`);throw new Error(c)}}),B(this,"isValidRespond",async t=>{var i;if(!Ue(t)){const{message:o}=U("MISSING_OR_INVALID",`respond() params: ${t}`);throw new Error(o)}const{topic:s,response:n}=t;try{await this.isValidSessionTopic(s)}catch(o){throw(i=t==null?void 0:t.response)!=null&&i.id&&this.cleanupAfterResponse(t),o}if(!_0(n)){const{message:o}=U("MISSING_OR_INVALID",`respond() response: ${JSON.stringify(n)}`);throw new Error(o)}}),B(this,"isValidPing",async t=>{if(!Ue(t)){const{message:s}=U("MISSING_OR_INVALID",`ping() params: ${t}`);throw new Error(s)}const{topic:i}=t;await this.isValidSessionOrPairingTopic(i)}),B(this,"isValidEmit",async t=>{if(!Ue(t)){const{message:a}=U("MISSING_OR_INVALID",`emit() params: ${t}`);throw new Error(a)}const{topic:i,event:s,chainId:n}=t;await this.isValidSessionTopic(i);const{namespaces:o}=this.client.session.get(i);if(!Rc(o,n)){const{message:a}=U("MISSING_OR_INVALID",`emit() chainId: ${n}`);throw new Error(a)}if(!I0(s)){const{message:a}=U("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(s)}`);throw new Error(a)}if(!S0(o,n,s.name)){const{message:a}=U("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(s)}`);throw new Error(a)}}),B(this,"isValidDisconnect",async t=>{if(!Ue(t)){const{message:s}=U("MISSING_OR_INVALID",`disconnect() params: ${t}`);throw new Error(s)}const{topic:i}=t;await this.isValidSessionOrPairingTopic(i)}),B(this,"isValidAuthenticate",t=>{const{chains:i,uri:s,domain:n,nonce:o}=t;if(!Array.isArray(i)||i.length===0)throw new Error("chains is required and must be a non-empty array");if(!le(s,!1))throw new Error("uri is required parameter");if(!le(n,!1))throw new Error("domain is required parameter");if(!le(o,!1))throw new Error("nonce is required parameter");if([...new Set(i.map(c=>Lr(c).namespace))].length>1)throw new Error("Multi-namespace requests are not supported. Please request single namespace only.");const{namespace:a}=Lr(i[0]);if(a!=="eip155")throw new Error("Only eip155 namespace is supported for authenticated sessions. Please use .connect() for non-eip155 chains.")}),B(this,"getVerifyContext",async t=>{const{attestationId:i,hash:s,encryptedId:n,metadata:o,transportType:a}=t,c={verified:{verifyUrl:o.verifyUrl||yi,validation:"UNKNOWN",origin:o.url||""}};try{if(a===ae.link_mode){const h=this.getAppLinkIfEnabled(o,a);return c.verified.validation=h&&new URL(h).origin===new URL(o.url).origin?"VALID":"INVALID",c}const u=await this.client.core.verify.resolve({attestationId:i,hash:s,encryptedId:n,verifyUrl:o.verifyUrl});u&&(c.verified.origin=u.origin,c.verified.isScam=u.isScam,c.verified.validation=u.origin===new URL(o.url).origin?"VALID":"INVALID")}catch(u){this.client.logger.warn(u)}return this.client.logger.debug(`Verify context: ${JSON.stringify(c)}`),c}),B(this,"validateSessionProps",(t,i)=>{Object.values(t).forEach((s,n)=>{if(s==null){const{message:o}=U("MISSING_OR_INVALID",`${i} must contain an existing value for each key. Received: ${s} for key ${Object.keys(t)[n]}`);throw new Error(o)}})}),B(this,"getPendingAuthRequest",t=>{const i=this.client.auth.requests.get(t);return typeof i=="object"?i:void 0}),B(this,"addToRecentlyDeleted",(t,i)=>{if(this.recentlyDeletedMap.set(t,i),this.recentlyDeletedMap.size>=this.recentlyDeletedLimit){let s=0;const n=this.recentlyDeletedLimit/2;for(const o of this.recentlyDeletedMap.keys()){if(s++>=n)break;this.recentlyDeletedMap.delete(o)}}}),B(this,"checkRecentlyDeleted",t=>{const i=this.recentlyDeletedMap.get(t);if(i){const{message:s}=U("MISSING_OR_INVALID",`Record was recently deleted - ${i}: ${t}`);throw new Error(s)}}),B(this,"isLinkModeEnabled",(t,i)=>{var s,n,o,a,c,u,h,l,d;return!t||i!==ae.link_mode?!1:((n=(s=this.client.metadata)==null?void 0:s.redirect)==null?void 0:n.linkMode)===!0&&((a=(o=this.client.metadata)==null?void 0:o.redirect)==null?void 0:a.universal)!==void 0&&((u=(c=this.client.metadata)==null?void 0:c.redirect)==null?void 0:u.universal)!==""&&((h=t==null?void 0:t.redirect)==null?void 0:h.universal)!==void 0&&((l=t==null?void 0:t.redirect)==null?void 0:l.universal)!==""&&((d=t==null?void 0:t.redirect)==null?void 0:d.linkMode)===!0&&this.client.core.linkModeSupportedApps.includes(t.redirect.universal)&&typeof(global==null?void 0:global.Linking)<"u"}),B(this,"getAppLinkIfEnabled",(t,i)=>{var s;return this.isLinkModeEnabled(t,i)?(s=t==null?void 0:t.redirect)==null?void 0:s.universal:void 0}),B(this,"handleLinkModeMessage",({url:t})=>{if(!t||!t.includes("wc_ev")||!t.includes("topic"))return;const i=Qa(t,"topic")||"",s=decodeURIComponent(Qa(t,"wc_ev")||""),n=this.client.session.keys.includes(i);n&&this.client.session.update(i,{transportType:ae.link_mode}),this.client.core.dispatchEnvelope({topic:i,message:s,sessionExists:n})}),B(this,"registerLinkModeListeners",async()=>{var t;if(Ro()||Ht()&&(t=this.client.metadata.redirect)!=null&&t.linkMode){const i=global==null?void 0:global.Linking;if(typeof i<"u"){i.addEventListener("url",this.handleLinkModeMessage,this.client.name);const s=await i.getInitialURL();s&&setTimeout(()=>{this.handleLinkModeMessage({url:s})},50)}}}),B(this,"shouldSetTVF",(t,i)=>{if(!i||t!=="wc_sessionRequest")return!1;const{request:s}=i;return Object.keys(Au).includes(s.method)}),B(this,"getTVFParams",(t,i,s)=>{var n,o;try{const a=i.request.method,c=this.extractTxHashesFromResult(a,s);return Te(se({correlationId:t,rpcMethods:[a],chainId:i.chainId},this.isValidContractData(i.request.params)&&{contractAddresses:[(o=(n=i.request.params)==null?void 0:n[0])==null?void 0:o.to]}),{txHashes:c})}catch(a){this.client.logger.warn("Error getting TVF params",a)}return{}}),B(this,"isValidContractData",t=>{var i;if(!t)return!1;try{const s=(t==null?void 0:t.data)||((i=t==null?void 0:t[0])==null?void 0:i.data);if(!s.startsWith("0x"))return!1;const n=s.slice(2);return/^[0-9a-fA-F]*$/.test(n)?n.length%2===0:!1}catch{}return!1}),B(this,"extractTxHashesFromResult",(t,i)=>{try{const s=Au[t];if(typeof i=="string")return[i];const n=i[s.key];if(lt(n))return t==="solana_signAllTransactions"?n.map(o=>rb(o)):n;if(typeof n=="string")return[n]}catch(s){this.client.logger.warn("Error extracting tx hashes from result",s)}return[]})}async processPendingMessageEvents(){try{const e=this.client.session.keys,t=this.client.core.relayer.messages.getWithoutAck(e);for(const[i,s]of Object.entries(t))for(const n of s)try{await this.onProviderMessageEvent({topic:i,message:n,publishedAt:Date.now()})}catch{this.client.logger.warn(`Error processing pending message event for topic: ${i}, message: ${n}`)}}catch(e){this.client.logger.warn("processPendingMessageEvents failed",e)}}isInitialized(){if(!this.initialized){const{message:e}=U("NOT_INITIALIZED",this.name);throw new Error(e)}}async confirmOnlineStateOrThrow(){await this.client.core.relayer.confirmOnlineStateOrThrow()}registerRelayerEvents(){this.client.core.relayer.on(we.message,e=>{this.onProviderMessageEvent(e)})}async onRelayMessage(e){const{topic:t,message:i,attestation:s,transportType:n}=e,{publicKey:o}=this.client.auth.authKeys.keys.includes(hs)?this.client.auth.authKeys.get(hs):{publicKey:void 0};try{const a=await this.client.core.crypto.decode(t,i,{receiverPublicKey:o,encoding:n===ae.link_mode?qt:ht});Ho(a)?(this.client.core.history.set(t,a),await this.onRelayEventRequest({topic:t,payload:a,attestation:s,transportType:n,encryptedId:Et(i)})):Ls(a)?(await this.client.core.history.resolve(a),await this.onRelayEventResponse({topic:t,payload:a,transportType:n}),this.client.core.history.delete(t,a.id)):await this.onRelayEventUnknownPayload({topic:t,payload:a,transportType:n}),await this.client.core.relayer.messages.ack(t,i)}catch(a){this.client.logger.error(a)}}registerExpirerEvents(){this.client.core.expirer.on(et.expired,async e=>{const{topic:t,id:i}=el(e.target);if(i&&this.client.pendingRequest.keys.includes(i))return await this.deletePendingSessionRequest(i,U("EXPIRED"),!0);if(i&&this.client.auth.requests.keys.includes(i))return await this.deletePendingAuthRequest(i,U("EXPIRED"),!0);t?this.client.session.keys.includes(t)&&(await this.deleteSession({topic:t,expirerHasDeleted:!0}),this.client.events.emit("session_expire",{topic:t})):i&&(await this.deleteProposal(i,!0),this.client.events.emit("proposal_expire",{id:i}))})}registerPairingEvents(){this.client.core.pairing.events.on(Qt.create,e=>this.onPairingCreated(e)),this.client.core.pairing.events.on(Qt.delete,e=>{this.addToRecentlyDeleted(e.topic,"pairing")})}isValidPairingTopic(e){if(!le(e,!1)){const{message:t}=U("MISSING_OR_INVALID",`pairing topic should be a string: ${e}`);throw new Error(t)}if(!this.client.core.pairing.pairings.keys.includes(e)){const{message:t}=U("NO_MATCHING_KEY",`pairing topic doesn't exist: ${e}`);throw new Error(t)}if(Ft(this.client.core.pairing.pairings.get(e).expiry)){const{message:t}=U("EXPIRED",`pairing topic: ${e}`);throw new Error(t)}}async isValidSessionTopic(e){if(!le(e,!1)){const{message:t}=U("MISSING_OR_INVALID",`session topic should be a string: ${e}`);throw new Error(t)}if(this.checkRecentlyDeleted(e),!this.client.session.keys.includes(e)){const{message:t}=U("NO_MATCHING_KEY",`session topic doesn't exist: ${e}`);throw new Error(t)}if(Ft(this.client.session.get(e).expiry)){await this.deleteSession({topic:e});const{message:t}=U("EXPIRED",`session topic: ${e}`);throw new Error(t)}if(!this.client.core.crypto.keychain.has(e)){const{message:t}=U("MISSING_OR_INVALID",`session topic does not exist in keychain: ${e}`);throw await this.deleteSession({topic:e}),new Error(t)}}async isValidSessionOrPairingTopic(e){if(this.checkRecentlyDeleted(e),this.client.session.keys.includes(e))await this.isValidSessionTopic(e);else if(this.client.core.pairing.pairings.keys.includes(e))this.isValidPairingTopic(e);else if(le(e,!1)){const{message:t}=U("NO_MATCHING_KEY",`session or pairing topic doesn't exist: ${e}`);throw new Error(t)}else{const{message:t}=U("MISSING_OR_INVALID",`session or pairing topic should be a string: ${e}`);throw new Error(t)}}async isValidProposalId(e){if(!b0(e)){const{message:t}=U("MISSING_OR_INVALID",`proposal id should be a number: ${e}`);throw new Error(t)}if(!this.client.proposal.keys.includes(e)){const{message:t}=U("NO_MATCHING_KEY",`proposal id doesn't exist: ${e}`);throw new Error(t)}if(Ft(this.client.proposal.get(e).expiryTimestamp)){await this.deleteProposal(e);const{message:t}=U("EXPIRED",`proposal id: ${e}`);throw new Error(t)}}}class z$ extends lr{constructor(e,t){super(e,t,O$,Vo),this.core=e,this.logger=t}}let H$=class extends lr{constructor(e,t){super(e,t,P$,Vo),this.core=e,this.logger=t}};class V$ extends lr{constructor(e,t){super(e,t,x$,Vo,i=>i.id),this.core=e,this.logger=t}}class K$ extends lr{constructor(e,t){super(e,t,N$,Fs,()=>hs),this.core=e,this.logger=t}}class W$ extends lr{constructor(e,t){super(e,t,j$,Fs),this.core=e,this.logger=t}}class G$ extends lr{constructor(e,t){super(e,t,B$,Fs,i=>i.id),this.core=e,this.logger=t}}var Y$=Object.defineProperty,J$=(r,e,t)=>e in r?Y$(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,On=(r,e,t)=>J$(r,typeof e!="symbol"?e+"":e,t);class Z${constructor(e,t){this.core=e,this.logger=t,On(this,"authKeys"),On(this,"pairingTopics"),On(this,"requests"),this.authKeys=new K$(this.core,this.logger),this.pairingTopics=new W$(this.core,this.logger),this.requests=new G$(this.core,this.logger)}async init(){await this.authKeys.init(),await this.pairingTopics.init(),await this.requests.init()}}var Q$=Object.defineProperty,X$=(r,e,t)=>e in r?Q$(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,G=(r,e,t)=>X$(r,typeof e!="symbol"?e+"":e,t);let eS=class hd extends Q1{constructor(e){super(e),G(this,"protocol",ad),G(this,"version",cd),G(this,"name",Sn.name),G(this,"metadata"),G(this,"core"),G(this,"logger"),G(this,"events",new Ye.EventEmitter),G(this,"engine"),G(this,"session"),G(this,"proposal"),G(this,"pendingRequest"),G(this,"auth"),G(this,"signConfig"),G(this,"on",(i,s)=>this.events.on(i,s)),G(this,"once",(i,s)=>this.events.once(i,s)),G(this,"off",(i,s)=>this.events.off(i,s)),G(this,"removeListener",(i,s)=>this.events.removeListener(i,s)),G(this,"removeAllListeners",i=>this.events.removeAllListeners(i)),G(this,"connect",async i=>{try{return await this.engine.connect(i)}catch(s){throw this.logger.error(s.message),s}}),G(this,"pair",async i=>{try{return await this.engine.pair(i)}catch(s){throw this.logger.error(s.message),s}}),G(this,"approve",async i=>{try{return await this.engine.approve(i)}catch(s){throw this.logger.error(s.message),s}}),G(this,"reject",async i=>{try{return await this.engine.reject(i)}catch(s){throw this.logger.error(s.message),s}}),G(this,"update",async i=>{try{return await this.engine.update(i)}catch(s){throw this.logger.error(s.message),s}}),G(this,"extend",async i=>{try{return await this.engine.extend(i)}catch(s){throw this.logger.error(s.message),s}}),G(this,"request",async i=>{try{return await this.engine.request(i)}catch(s){throw this.logger.error(s.message),s}}),G(this,"respond",async i=>{try{return await this.engine.respond(i)}catch(s){throw this.logger.error(s.message),s}}),G(this,"ping",async i=>{try{return await this.engine.ping(i)}catch(s){throw this.logger.error(s.message),s}}),G(this,"emit",async i=>{try{return await this.engine.emit(i)}catch(s){throw this.logger.error(s.message),s}}),G(this,"disconnect",async i=>{try{return await this.engine.disconnect(i)}catch(s){throw this.logger.error(s.message),s}}),G(this,"find",i=>{try{return this.engine.find(i)}catch(s){throw this.logger.error(s.message),s}}),G(this,"getPendingSessionRequests",()=>{try{return this.engine.getPendingSessionRequests()}catch(i){throw this.logger.error(i.message),i}}),G(this,"authenticate",async(i,s)=>{try{return await this.engine.authenticate(i,s)}catch(n){throw this.logger.error(n.message),n}}),G(this,"formatAuthMessage",i=>{try{return this.engine.formatAuthMessage(i)}catch(s){throw this.logger.error(s.message),s}}),G(this,"approveSessionAuthenticate",async i=>{try{return await this.engine.approveSessionAuthenticate(i)}catch(s){throw this.logger.error(s.message),s}}),G(this,"rejectSessionAuthenticate",async i=>{try{return await this.engine.rejectSessionAuthenticate(i)}catch(s){throw this.logger.error(s.message),s}}),this.name=(e==null?void 0:e.name)||Sn.name,this.metadata=gw(e==null?void 0:e.metadata),this.signConfig=e==null?void 0:e.signConfig;const t=typeof(e==null?void 0:e.logger)<"u"&&typeof(e==null?void 0:e.logger)!="string"?e.logger:Li(Ns({level:(e==null?void 0:e.logger)||Sn.logger}));this.core=(e==null?void 0:e.core)||new D$(e),this.logger=Ne(t,this.name),this.session=new H$(this.core,this.logger),this.proposal=new z$(this.core,this.logger),this.pendingRequest=new V$(this.core,this.logger),this.engine=new k$(this),this.auth=new Z$(this.core,this.logger)}static async init(e){const t=new hd(e);return await t.initialize(),t}get context(){return Me(this.logger)}get pairing(){return this.core.pairing.pairings}async initialize(){this.logger.trace("Initialized");try{await this.core.start(),await this.session.init(),await this.proposal.init(),await this.pendingRequest.init(),await this.auth.init(),await this.engine.init(),this.logger.info("SignClient Initialization Success"),setTimeout(()=>{this.engine.processRelayMessageCache()},L.toMiliseconds(L.ONE_SECOND))}catch(e){throw this.logger.info("SignClient Initialization Failure"),this.logger.error(e.message),e}}};var Qi={exports:{}},Cu;function tS(){return Cu||(Cu=1,function(r,e){var t=typeof globalThis<"u"&&globalThis||typeof self<"u"&&self||typeof vt<"u"&&vt,i=function(){function n(){this.fetch=!1,this.DOMException=t.DOMException}return n.prototype=t,new n}();(function(n){(function(o){var a=typeof n<"u"&&n||typeof self<"u"&&self||typeof vt<"u"&&vt||{},c={searchParams:"URLSearchParams"in a,iterable:"Symbol"in a&&"iterator"in Symbol,blob:"FileReader"in a&&"Blob"in a&&function(){try{return new Blob,!0}catch{return!1}}(),formData:"FormData"in a,arrayBuffer:"ArrayBuffer"in a};function u(y){return y&&DataView.prototype.isPrototypeOf(y)}if(c.arrayBuffer)var h=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],l=ArrayBuffer.isView||function(y){return y&&h.indexOf(Object.prototype.toString.call(y))>-1};function d(y){if(typeof y!="string"&&(y=String(y)),/[^a-z0-9\-#$%&'*+.^_`|~!]/i.test(y)||y==="")throw new TypeError('Invalid character in header field name: "'+y+'"');return y.toLowerCase()}function f(y){return typeof y!="string"&&(y=String(y)),y}function p(y){var w={next:function(){var P=y.shift();return{done:P===void 0,value:P}}};return c.iterable&&(w[Symbol.iterator]=function(){return w}),w}function g(y){this.map={},y instanceof g?y.forEach(function(w,P){this.append(P,w)},this):Array.isArray(y)?y.forEach(function(w){if(w.length!=2)throw new TypeError("Headers constructor: expected name/value pair to be length 2, found"+w.length);this.append(w[0],w[1])},this):y&&Object.getOwnPropertyNames(y).forEach(function(w){this.append(w,y[w])},this)}g.prototype.append=function(y,w){y=d(y),w=f(w);var P=this.map[y];this.map[y]=P?P+", "+w:w},g.prototype.delete=function(y){delete this.map[d(y)]},g.prototype.get=function(y){return y=d(y),this.has(y)?this.map[y]:null},g.prototype.has=function(y){return this.map.hasOwnProperty(d(y))},g.prototype.set=function(y,w){this.map[d(y)]=f(w)},g.prototype.forEach=function(y,w){for(var P in this.map)this.map.hasOwnProperty(P)&&y.call(w,this.map[P],P,this)},g.prototype.keys=function(){var y=[];return this.forEach(function(w,P){y.push(P)}),p(y)},g.prototype.values=function(){var y=[];return this.forEach(function(w){y.push(w)}),p(y)},g.prototype.entries=function(){var y=[];return this.forEach(function(w,P){y.push([P,w])}),p(y)},c.iterable&&(g.prototype[Symbol.iterator]=g.prototype.entries);function b(y){if(!y._noBody){if(y.bodyUsed)return Promise.reject(new TypeError("Already read"));y.bodyUsed=!0}}function $(y){return new Promise(function(w,P){y.onload=function(){w(y.result)},y.onerror=function(){P(y.error)}})}function v(y){var w=new FileReader,P=$(w);return w.readAsArrayBuffer(y),P}function S(y){var w=new FileReader,P=$(w),C=/charset=([A-Za-z0-9_-]+)/.exec(y.type),A=C?C[1]:"utf-8";return w.readAsText(y,A),P}function E(y){for(var w=new Uint8Array(y),P=new Array(w.length),C=0;C<w.length;C++)P[C]=String.fromCharCode(w[C]);return P.join("")}function I(y){if(y.slice)return y.slice(0);var w=new Uint8Array(y.byteLength);return w.set(new Uint8Array(y)),w.buffer}function m(){return this.bodyUsed=!1,this._initBody=function(y){this.bodyUsed=this.bodyUsed,this._bodyInit=y,y?typeof y=="string"?this._bodyText=y:c.blob&&Blob.prototype.isPrototypeOf(y)?this._bodyBlob=y:c.formData&&FormData.prototype.isPrototypeOf(y)?this._bodyFormData=y:c.searchParams&&URLSearchParams.prototype.isPrototypeOf(y)?this._bodyText=y.toString():c.arrayBuffer&&c.blob&&u(y)?(this._bodyArrayBuffer=I(y.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):c.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(y)||l(y))?this._bodyArrayBuffer=I(y):this._bodyText=y=Object.prototype.toString.call(y):(this._noBody=!0,this._bodyText=""),this.headers.get("content-type")||(typeof y=="string"?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):c.searchParams&&URLSearchParams.prototype.isPrototypeOf(y)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},c.blob&&(this.blob=function(){var y=b(this);if(y)return y;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))}),this.arrayBuffer=function(){if(this._bodyArrayBuffer){var y=b(this);return y||(ArrayBuffer.isView(this._bodyArrayBuffer)?Promise.resolve(this._bodyArrayBuffer.buffer.slice(this._bodyArrayBuffer.byteOffset,this._bodyArrayBuffer.byteOffset+this._bodyArrayBuffer.byteLength)):Promise.resolve(this._bodyArrayBuffer))}else{if(c.blob)return this.blob().then(v);throw new Error("could not read as ArrayBuffer")}},this.text=function(){var y=b(this);if(y)return y;if(this._bodyBlob)return S(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(E(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},c.formData&&(this.formData=function(){return this.text().then(R)}),this.json=function(){return this.text().then(JSON.parse)},this}var _=["CONNECT","DELETE","GET","HEAD","OPTIONS","PATCH","POST","PUT","TRACE"];function D(y){var w=y.toUpperCase();return _.indexOf(w)>-1?w:y}function O(y,w){if(!(this instanceof O))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');w=w||{};var P=w.body;if(y instanceof O){if(y.bodyUsed)throw new TypeError("Already read");this.url=y.url,this.credentials=y.credentials,w.headers||(this.headers=new g(y.headers)),this.method=y.method,this.mode=y.mode,this.signal=y.signal,!P&&y._bodyInit!=null&&(P=y._bodyInit,y.bodyUsed=!0)}else this.url=String(y);if(this.credentials=w.credentials||this.credentials||"same-origin",(w.headers||!this.headers)&&(this.headers=new g(w.headers)),this.method=D(w.method||this.method||"GET"),this.mode=w.mode||this.mode||null,this.signal=w.signal||this.signal||function(){if("AbortController"in a){var T=new AbortController;return T.signal}}(),this.referrer=null,(this.method==="GET"||this.method==="HEAD")&&P)throw new TypeError("Body not allowed for GET or HEAD requests");if(this._initBody(P),(this.method==="GET"||this.method==="HEAD")&&(w.cache==="no-store"||w.cache==="no-cache")){var C=/([?&])_=[^&]*/;if(C.test(this.url))this.url=this.url.replace(C,"$1_="+new Date().getTime());else{var A=/\?/;this.url+=(A.test(this.url)?"&":"?")+"_="+new Date().getTime()}}}O.prototype.clone=function(){return new O(this,{body:this._bodyInit})};function R(y){var w=new FormData;return y.trim().split("&").forEach(function(P){if(P){var C=P.split("="),A=C.shift().replace(/\+/g," "),T=C.join("=").replace(/\+/g," ");w.append(decodeURIComponent(A),decodeURIComponent(T))}}),w}function N(y){var w=new g,P=y.replace(/\r?\n[\t ]+/g," ");return P.split("\r").map(function(C){return C.indexOf(`
`)===0?C.substr(1,C.length):C}).forEach(function(C){var A=C.split(":"),T=A.shift().trim();if(T){var F=A.join(":").trim();try{w.append(T,F)}catch(M){console.warn("Response "+M.message)}}}),w}m.call(O.prototype);function j(y,w){if(!(this instanceof j))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');if(w||(w={}),this.type="default",this.status=w.status===void 0?200:w.status,this.status<200||this.status>599)throw new RangeError("Failed to construct 'Response': The status provided (0) is outside the range [200, 599].");this.ok=this.status>=200&&this.status<300,this.statusText=w.statusText===void 0?"":""+w.statusText,this.headers=new g(w.headers),this.url=w.url||"",this._initBody(y)}m.call(j.prototype),j.prototype.clone=function(){return new j(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new g(this.headers),url:this.url})},j.error=function(){var y=new j(null,{status:200,statusText:""});return y.ok=!1,y.status=0,y.type="error",y};var k=[301,302,303,307,308];j.redirect=function(y,w){if(k.indexOf(w)===-1)throw new RangeError("Invalid status code");return new j(null,{status:w,headers:{location:y}})},o.DOMException=a.DOMException;try{new o.DOMException}catch{o.DOMException=function(w,P){this.message=w,this.name=P;var C=Error(w);this.stack=C.stack},o.DOMException.prototype=Object.create(Error.prototype),o.DOMException.prototype.constructor=o.DOMException}function x(y,w){return new Promise(function(P,C){var A=new O(y,w);if(A.signal&&A.signal.aborted)return C(new o.DOMException("Aborted","AbortError"));var T=new XMLHttpRequest;function F(){T.abort()}T.onload=function(){var q={statusText:T.statusText,headers:N(T.getAllResponseHeaders()||"")};A.url.indexOf("file://")===0&&(T.status<200||T.status>599)?q.status=200:q.status=T.status,q.url="responseURL"in T?T.responseURL:q.headers.get("X-Request-URL");var H="response"in T?T.response:T.responseText;setTimeout(function(){P(new j(H,q))},0)},T.onerror=function(){setTimeout(function(){C(new TypeError("Network request failed"))},0)},T.ontimeout=function(){setTimeout(function(){C(new TypeError("Network request timed out"))},0)},T.onabort=function(){setTimeout(function(){C(new o.DOMException("Aborted","AbortError"))},0)};function M(q){try{return q===""&&a.location.href?a.location.href:q}catch{return q}}if(T.open(A.method,M(A.url),!0),A.credentials==="include"?T.withCredentials=!0:A.credentials==="omit"&&(T.withCredentials=!1),"responseType"in T&&(c.blob?T.responseType="blob":c.arrayBuffer&&(T.responseType="arraybuffer")),w&&typeof w.headers=="object"&&!(w.headers instanceof g||a.Headers&&w.headers instanceof a.Headers)){var z=[];Object.getOwnPropertyNames(w.headers).forEach(function(q){z.push(d(q)),T.setRequestHeader(q,f(w.headers[q]))}),A.headers.forEach(function(q,H){z.indexOf(H)===-1&&T.setRequestHeader(H,q)})}else A.headers.forEach(function(q,H){T.setRequestHeader(H,q)});A.signal&&(A.signal.addEventListener("abort",F),T.onreadystatechange=function(){T.readyState===4&&A.signal.removeEventListener("abort",F)}),T.send(typeof A._bodyInit>"u"?null:A._bodyInit)})}return x.polyfill=!0,a.fetch||(a.fetch=x,a.Headers=g,a.Request=O,a.Response=j),o.Headers=g,o.Request=O,o.Response=j,o.fetch=x,Object.defineProperty(o,"__esModule",{value:!0}),o})({})})(i),i.fetch.ponyfill=!0,delete i.fetch.polyfill;var s=t.fetch?t:i;e=s.fetch,e.default=s.fetch,e.fetch=s.fetch,e.Headers=s.Headers,e.Request=s.Request,e.Response=s.Response,r.exports=e}(Qi,Qi.exports)),Qi.exports}var rS=tS();const Tu=Io(rS);var iS=Object.defineProperty,sS=Object.defineProperties,nS=Object.getOwnPropertyDescriptors,Ru=Object.getOwnPropertySymbols,oS=Object.prototype.hasOwnProperty,aS=Object.prototype.propertyIsEnumerable,Nu=(r,e,t)=>e in r?iS(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,ju=(r,e)=>{for(var t in e||(e={}))oS.call(e,t)&&Nu(r,t,e[t]);if(Ru)for(var t of Ru(e))aS.call(e,t)&&Nu(r,t,e[t]);return r},Bu=(r,e)=>sS(r,nS(e));const cS={Accept:"application/json","Content-Type":"application/json"},uS="POST",Lu={headers:cS,method:uS},Uu=10;class dt{constructor(e,t=!1){if(this.url=e,this.disableProviderPing=t,this.events=new Ye.EventEmitter,this.isAvailable=!1,this.registering=!1,!Xc(e))throw new Error(`Provided URL is not compatible with HTTP connection: ${e}`);this.url=e,this.disableProviderPing=t}get connected(){return this.isAvailable}get connecting(){return this.registering}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}off(e,t){this.events.off(e,t)}removeListener(e,t){this.events.removeListener(e,t)}async open(e=this.url){await this.register(e)}async close(){if(!this.isAvailable)throw new Error("Connection already closed");this.onClose()}async send(e){this.isAvailable||await this.register();try{const t=Nt(e),i=await(await Tu(this.url,Bu(ju({},Lu),{body:t}))).json();this.onPayload({data:i})}catch(t){this.onError(e.id,t)}}async register(e=this.url){if(!Xc(e))throw new Error(`Provided URL is not compatible with HTTP connection: ${e}`);if(this.registering){const t=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=t||this.events.listenerCount("open")>=t)&&this.events.setMaxListeners(t+1),new Promise((i,s)=>{this.events.once("register_error",n=>{this.resetMaxListeners(),s(n)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.isAvailable>"u")return s(new Error("HTTP connection is missing or invalid"));i()})})}this.url=e,this.registering=!0;try{if(!this.disableProviderPing){const t=Nt({id:1,jsonrpc:"2.0",method:"test",params:[]});await Tu(e,Bu(ju({},Lu),{body:t}))}this.onOpen()}catch(t){const i=this.parseError(t);throw this.events.emit("register_error",i),this.onClose(),i}}onOpen(){this.isAvailable=!0,this.registering=!1,this.events.emit("open")}onClose(){this.isAvailable=!1,this.registering=!1,this.events.emit("close")}onPayload(e){if(typeof e.data>"u")return;const t=typeof e.data=="string"?nr(e.data):e.data;this.events.emit("payload",t)}onError(e,t){const i=this.parseError(t),s=i.message||i.toString(),n=Bs(e,s);this.events.emit("payload",n)}parseError(e,t=this.url){return Ml(e,t,"HTTP")}resetMaxListeners(){this.events.getMaxListeners()>Uu&&this.events.setMaxListeners(Uu)}}const Fu="error",hS="wss://relay.walletconnect.org",lS="wc",dS="universal_provider",Xi=`${lS}@2:${dS}:`,ld="https://rpc.walletconnect.org/v1/",Rr="generic",pS=`${ld}bundler`,st={DEFAULT_CHAIN_CHANGED:"default_chain_changed"};function fS(){}function Ko(r){return r==null||typeof r!="object"&&typeof r!="function"}function Wo(r){return ArrayBuffer.isView(r)&&!(r instanceof DataView)}function gS(r){if(Ko(r))return r;if(Array.isArray(r)||Wo(r)||r instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&r instanceof SharedArrayBuffer)return r.slice(0);const e=Object.getPrototypeOf(r),t=e.constructor;if(r instanceof Date||r instanceof Map||r instanceof Set)return new t(r);if(r instanceof RegExp){const i=new t(r);return i.lastIndex=r.lastIndex,i}if(r instanceof DataView)return new t(r.buffer.slice(0));if(r instanceof Error){const i=new t(r.message);return i.stack=r.stack,i.name=r.name,i.cause=r.cause,i}if(typeof File<"u"&&r instanceof File)return new t([r],r.name,{type:r.type,lastModified:r.lastModified});if(typeof r=="object"){const i=Object.create(e);return Object.assign(i,r)}return r}function qu(r){return typeof r=="object"&&r!==null}function dd(r){return Object.getOwnPropertySymbols(r).filter(e=>Object.prototype.propertyIsEnumerable.call(r,e))}function pd(r){return r==null?r===void 0?"[object Undefined]":"[object Null]":Object.prototype.toString.call(r)}const yS="[object RegExp]",fd="[object String]",gd="[object Number]",yd="[object Boolean]",md="[object Arguments]",mS="[object Symbol]",wS="[object Date]",bS="[object Map]",vS="[object Set]",ES="[object Array]",_S="[object ArrayBuffer]",IS="[object Object]",$S="[object DataView]",SS="[object Uint8Array]",DS="[object Uint8ClampedArray]",OS="[object Uint16Array]",PS="[object Uint32Array]",AS="[object Int8Array]",xS="[object Int16Array]",CS="[object Int32Array]",TS="[object Float32Array]",RS="[object Float64Array]";function NS(r,e){return Br(r,void 0,r,new Map,e)}function Br(r,e,t,i=new Map,s=void 0){const n=s==null?void 0:s(r,e,t,i);if(n!=null)return n;if(Ko(r))return r;if(i.has(r))return i.get(r);if(Array.isArray(r)){const o=new Array(r.length);i.set(r,o);for(let a=0;a<r.length;a++)o[a]=Br(r[a],a,t,i,s);return Object.hasOwn(r,"index")&&(o.index=r.index),Object.hasOwn(r,"input")&&(o.input=r.input),o}if(r instanceof Date)return new Date(r.getTime());if(r instanceof RegExp){const o=new RegExp(r.source,r.flags);return o.lastIndex=r.lastIndex,o}if(r instanceof Map){const o=new Map;i.set(r,o);for(const[a,c]of r)o.set(a,Br(c,a,t,i,s));return o}if(r instanceof Set){const o=new Set;i.set(r,o);for(const a of r)o.add(Br(a,void 0,t,i,s));return o}if(typeof Buffer<"u"&&Buffer.isBuffer(r))return r.subarray();if(Wo(r)){const o=new(Object.getPrototypeOf(r)).constructor(r.length);i.set(r,o);for(let a=0;a<r.length;a++)o[a]=Br(r[a],a,t,i,s);return o}if(r instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&r instanceof SharedArrayBuffer)return r.slice(0);if(r instanceof DataView){const o=new DataView(r.buffer.slice(0),r.byteOffset,r.byteLength);return i.set(r,o),Xt(o,r,t,i,s),o}if(typeof File<"u"&&r instanceof File){const o=new File([r],r.name,{type:r.type});return i.set(r,o),Xt(o,r,t,i,s),o}if(r instanceof Blob){const o=new Blob([r],{type:r.type});return i.set(r,o),Xt(o,r,t,i,s),o}if(r instanceof Error){const o=new r.constructor;return i.set(r,o),o.message=r.message,o.name=r.name,o.stack=r.stack,o.cause=r.cause,Xt(o,r,t,i,s),o}if(typeof r=="object"&&jS(r)){const o=Object.create(Object.getPrototypeOf(r));return i.set(r,o),Xt(o,r,t,i,s),o}return r}function Xt(r,e,t=r,i,s){const n=[...Object.keys(e),...dd(e)];for(let o=0;o<n.length;o++){const a=n[o],c=Object.getOwnPropertyDescriptor(r,a);(c==null||c.writable)&&(r[a]=Br(e[a],a,t,i,s))}}function jS(r){switch(pd(r)){case md:case ES:case _S:case $S:case yd:case wS:case TS:case RS:case AS:case xS:case CS:case bS:case gd:case IS:case yS:case vS:case fd:case mS:case SS:case DS:case OS:case PS:return!0;default:return!1}}function BS(r,e){return NS(r,(t,i,s,n)=>{if(typeof r=="object")switch(Object.prototype.toString.call(r)){case gd:case fd:case yd:{const o=new r.constructor(r==null?void 0:r.valueOf());return Xt(o,r),o}case md:{const o={};return Xt(o,r),o.length=r.length,o[Symbol.iterator]=r[Symbol.iterator],o}default:return}})}function Mu(r){return BS(r)}function ku(r){return r!==null&&typeof r=="object"&&pd(r)==="[object Arguments]"}function LS(r){return Wo(r)}function US(r){var t;if(typeof r!="object"||r==null)return!1;if(Object.getPrototypeOf(r)===null)return!0;if(Object.prototype.toString.call(r)!=="[object Object]"){const i=r[Symbol.toStringTag];return i==null||!((t=Object.getOwnPropertyDescriptor(r,Symbol.toStringTag))!=null&&t.writable)?!1:r.toString()===`[object ${i}]`}let e=r;for(;Object.getPrototypeOf(e)!==null;)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(r)===e}function FS(r,...e){const t=e.slice(0,-1),i=e[e.length-1];let s=r;for(let n=0;n<t.length;n++){const o=t[n];s=bo(s,o,i,new Map)}return s}function bo(r,e,t,i){if(Ko(r)&&(r=Object(r)),e==null||typeof e!="object")return r;if(i.has(e))return gS(i.get(e));if(i.set(e,r),Array.isArray(e)){e=e.slice();for(let n=0;n<e.length;n++)e[n]=e[n]??void 0}const s=[...Object.keys(e),...dd(e)];for(let n=0;n<s.length;n++){const o=s[n];let a=e[o],c=r[o];if(ku(a)&&(a={...a}),ku(c)&&(c={...c}),typeof Buffer<"u"&&Buffer.isBuffer(a)&&(a=Mu(a)),Array.isArray(a))if(typeof c=="object"&&c!=null){const h=[],l=Reflect.ownKeys(c);for(let d=0;d<l.length;d++){const f=l[d];h[f]=c[f]}c=h}else c=[];const u=t(c,a,o,r,e,i);u!=null?r[o]=u:Array.isArray(a)||qu(c)&&qu(a)?r[o]=bo(c,a,t,i):c==null&&US(a)?r[o]=bo({},a,t,i):c==null&&LS(a)?r[o]=Mu(a):(c===void 0||a!==void 0)&&(r[o]=a)}return r}function qS(r,...e){return FS(r,...e,fS)}var MS=Object.defineProperty,kS=Object.defineProperties,zS=Object.getOwnPropertyDescriptors,zu=Object.getOwnPropertySymbols,HS=Object.prototype.hasOwnProperty,VS=Object.prototype.propertyIsEnumerable,Hu=(r,e,t)=>e in r?MS(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,es=(r,e)=>{for(var t in e||(e={}))HS.call(e,t)&&Hu(r,t,e[t]);if(zu)for(var t of zu(e))VS.call(e,t)&&Hu(r,t,e[t]);return r},KS=(r,e)=>kS(r,zS(e));function Ge(r,e,t){var i;const s=Lr(r);return((i=e.rpcMap)==null?void 0:i[s.reference])||`${ld}?chainId=${s.namespace}:${s.reference}&projectId=${t}`}function dr(r){return r.includes(":")?r.split(":")[1]:r}function wd(r){return r.map(e=>`${e.split(":")[0]}:${e.split(":")[1]}`)}function WS(r,e){const t=Object.keys(e.namespaces).filter(s=>s.includes(r));if(!t.length)return[];const i=[];return t.forEach(s=>{const n=e.namespaces[s].accounts;i.push(...n)}),i}function Pn(r={},e={}){const t=Vu(r),i=Vu(e);return qS(t,i)}function Vu(r){var e,t,i,s;const n={};if(!Si(r))return n;for(const[o,a]of Object.entries(r)){const c=qo(o)?[o]:a.chains,u=a.methods||[],h=a.events||[],l=a.rpcMap||{},d=li(o);n[d]=KS(es(es({},n[d]),a),{chains:ss(c,(e=n[d])==null?void 0:e.chains),methods:ss(u,(t=n[d])==null?void 0:t.methods),events:ss(h,(i=n[d])==null?void 0:i.events),rpcMap:es(es({},l),(s=n[d])==null?void 0:s.rpcMap)})}return n}function Ku(r){return r.includes(":")?r.split(":")[2]:r}function Wu(r){const e={};for(const[t,i]of Object.entries(r)){const s=i.methods||[],n=i.events||[],o=i.accounts||[],a=qo(t)?[t]:i.chains?i.chains:wd(i.accounts);e[t]={chains:a,methods:s,events:n,accounts:o}}return e}function An(r){return typeof r=="number"?r:r.includes("0x")?parseInt(r,16):(r=r.includes(":")?r.split(":")[1]:r,isNaN(Number(r))?r:Number(r))}const bd={},Q=r=>bd[r],xn=(r,e)=>{bd[r]=e};var GS=Object.defineProperty,YS=(r,e,t)=>e in r?GS(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Er=(r,e,t)=>YS(r,typeof e!="symbol"?e+"":e,t);class JS{constructor(e){Er(this,"name","polkadot"),Er(this,"client"),Er(this,"httpProviders"),Er(this,"events"),Er(this,"namespace"),Er(this,"chainId"),this.namespace=e.namespace,this.events=Q("events"),this.client=Q("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t),this.chainId=e,this.events.emit(st.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}getAccounts(){const e=this.namespace.accounts;return e?e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2])||[]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{var i;const s=dr(t);e[s]=this.createHttpProvider(s,(i=this.namespace.rpcMap)==null?void 0:i[t])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProvider(e,t){const i=t||Ge(e,this.namespace,this.client.core.projectId);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);return new it(new dt(i,Q("disableProviderPing")))}}var ZS=Object.defineProperty,QS=Object.defineProperties,XS=Object.getOwnPropertyDescriptors,Gu=Object.getOwnPropertySymbols,eD=Object.prototype.hasOwnProperty,tD=Object.prototype.propertyIsEnumerable,vo=(r,e,t)=>e in r?ZS(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Yu=(r,e)=>{for(var t in e||(e={}))eD.call(e,t)&&vo(r,t,e[t]);if(Gu)for(var t of Gu(e))tD.call(e,t)&&vo(r,t,e[t]);return r},Ju=(r,e)=>QS(r,XS(e)),_r=(r,e,t)=>vo(r,typeof e!="symbol"?e+"":e,t);class rD{constructor(e){_r(this,"name","eip155"),_r(this,"client"),_r(this,"chainId"),_r(this,"namespace"),_r(this,"httpProviders"),_r(this,"events"),this.namespace=e.namespace,this.events=Q("events"),this.client=Q("client"),this.httpProviders=this.createHttpProviders(),this.chainId=parseInt(this.getDefaultChain())}async request(e){switch(e.request.method){case"eth_requestAccounts":return this.getAccounts();case"eth_accounts":return this.getAccounts();case"wallet_switchEthereumChain":return await this.handleSwitchChain(e);case"eth_chainId":return parseInt(this.getDefaultChain());case"wallet_getCapabilities":return await this.getCapabilities(e);case"wallet_getCallsStatus":return await this.getCallStatus(e)}return this.namespace.methods.includes(e.request.method)?await this.client.request(e):this.getHttpProvider().request(e.request)}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(parseInt(e),t),this.chainId=parseInt(e),this.events.emit(st.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId.toString();if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}createHttpProvider(e,t){const i=t||Ge(`${this.name}:${e}`,this.namespace,this.client.core.projectId);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);return new it(new dt(i,Q("disableProviderPing")))}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{var i;const s=parseInt(dr(t));e[s]=this.createHttpProvider(s,(i=this.namespace.rpcMap)==null?void 0:i[t])}),e}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}getHttpProvider(){const e=this.chainId,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}async handleSwitchChain(e){var t,i;let s=e.request.params?(t=e.request.params[0])==null?void 0:t.chainId:"0x0";s=s.startsWith("0x")?s:`0x${s}`;const n=parseInt(s,16);if(this.isChainApproved(n))this.setDefaultChain(`${n}`);else if(this.namespace.methods.includes("wallet_switchEthereumChain"))await this.client.request({topic:e.topic,request:{method:e.request.method,params:[{chainId:s}]},chainId:(i=this.namespace.chains)==null?void 0:i[0]}),this.setDefaultChain(`${n}`);else throw new Error(`Failed to switch to chain 'eip155:${n}'. The chain is not approved or the wallet does not support 'wallet_switchEthereumChain' method.`);return null}isChainApproved(e){return this.namespace.chains.includes(`${this.name}:${e}`)}async getCapabilities(e){var t,i,s;const n=(i=(t=e.request)==null?void 0:t.params)==null?void 0:i[0];if(!n)throw new Error("Missing address parameter in `wallet_getCapabilities` request");const o=this.client.session.get(e.topic),a=((s=o==null?void 0:o.sessionProperties)==null?void 0:s.capabilities)||{};if(a!=null&&a[n])return a==null?void 0:a[n];const c=await this.client.request(e);try{await this.client.session.update(e.topic,{sessionProperties:Ju(Yu({},o.sessionProperties||{}),{capabilities:Ju(Yu({},a||{}),{[n]:c})})})}catch(u){console.warn("Failed to update session with capabilities",u)}return c}async getCallStatus(e){var t,i;const s=this.client.session.get(e.topic),n=(t=s.sessionProperties)==null?void 0:t.bundler_name;if(n){const a=this.getBundlerUrl(e.chainId,n);try{return await this.getUserOperationReceipt(a,e)}catch(c){console.warn("Failed to fetch call status from bundler",c,a)}}const o=(i=s.sessionProperties)==null?void 0:i.bundler_url;if(o)try{return await this.getUserOperationReceipt(o,e)}catch(a){console.warn("Failed to fetch call status from custom bundler",a,o)}if(this.namespace.methods.includes(e.request.method))return await this.client.request(e);throw new Error("Fetching call status not approved by the wallet.")}async getUserOperationReceipt(e,t){var i;const s=new URL(e),n=await fetch(s,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(kt("eth_getUserOperationReceipt",[(i=t.request.params)==null?void 0:i[0]]))});if(!n.ok)throw new Error(`Failed to fetch user operation receipt - ${n.status}`);return await n.json()}getBundlerUrl(e,t){return`${pS}?projectId=${this.client.core.projectId}&chainId=${e}&bundler=${t}`}}var iD=Object.defineProperty,sD=(r,e,t)=>e in r?iD(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Ir=(r,e,t)=>sD(r,typeof e!="symbol"?e+"":e,t);class nD{constructor(e){Ir(this,"name","solana"),Ir(this,"client"),Ir(this,"httpProviders"),Ir(this,"events"),Ir(this,"namespace"),Ir(this,"chainId"),this.namespace=e.namespace,this.events=Q("events"),this.client=Q("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t),this.chainId=e,this.events.emit(st.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{var i;const s=dr(t);e[s]=this.createHttpProvider(s,(i=this.namespace.rpcMap)==null?void 0:i[t])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProvider(e,t){const i=t||Ge(e,this.namespace,this.client.core.projectId);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);return new it(new dt(i,Q("disableProviderPing")))}}var oD=Object.defineProperty,aD=(r,e,t)=>e in r?oD(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,$r=(r,e,t)=>aD(r,typeof e!="symbol"?e+"":e,t);class cD{constructor(e){$r(this,"name","cosmos"),$r(this,"client"),$r(this,"httpProviders"),$r(this,"events"),$r(this,"namespace"),$r(this,"chainId"),this.namespace=e.namespace,this.events=Q("events"),this.client=Q("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t),this.chainId=e,this.events.emit(st.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{var i;const s=dr(t);e[s]=this.createHttpProvider(s,(i=this.namespace.rpcMap)==null?void 0:i[t])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProvider(e,t){const i=t||Ge(e,this.namespace,this.client.core.projectId);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);return new it(new dt(i,Q("disableProviderPing")))}}var uD=Object.defineProperty,hD=(r,e,t)=>e in r?uD(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Sr=(r,e,t)=>hD(r,typeof e!="symbol"?e+"":e,t);class lD{constructor(e){Sr(this,"name","algorand"),Sr(this,"client"),Sr(this,"httpProviders"),Sr(this,"events"),Sr(this,"namespace"),Sr(this,"chainId"),this.namespace=e.namespace,this.events=Q("events"),this.client=Q("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){if(!this.httpProviders[e]){const i=t||Ge(`${this.name}:${e}`,this.namespace,this.client.core.projectId);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);this.setHttpProvider(e,i)}this.chainId=e,this.events.emit(st.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{var i;e[t]=this.createHttpProvider(t,(i=this.namespace.rpcMap)==null?void 0:i[t])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProvider(e,t){const i=t||Ge(e,this.namespace,this.client.core.projectId);return typeof i>"u"?void 0:new it(new dt(i,Q("disableProviderPing")))}}var dD=Object.defineProperty,pD=(r,e,t)=>e in r?dD(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Dr=(r,e,t)=>pD(r,typeof e!="symbol"?e+"":e,t);class fD{constructor(e){Dr(this,"name","cip34"),Dr(this,"client"),Dr(this,"httpProviders"),Dr(this,"events"),Dr(this,"namespace"),Dr(this,"chainId"),this.namespace=e.namespace,this.events=Q("events"),this.client=Q("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t),this.chainId=e,this.events.emit(st.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{const i=this.getCardanoRPCUrl(t),s=dr(t);e[s]=this.createHttpProvider(s,i)}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}getCardanoRPCUrl(e){const t=this.namespace.rpcMap;if(t)return t[e]}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProvider(e,t){const i=t||this.getCardanoRPCUrl(e);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);return new it(new dt(i,Q("disableProviderPing")))}}var gD=Object.defineProperty,yD=(r,e,t)=>e in r?gD(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Or=(r,e,t)=>yD(r,typeof e!="symbol"?e+"":e,t);class mD{constructor(e){Or(this,"name","elrond"),Or(this,"client"),Or(this,"httpProviders"),Or(this,"events"),Or(this,"namespace"),Or(this,"chainId"),this.namespace=e.namespace,this.events=Q("events"),this.client=Q("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t),this.chainId=e,this.events.emit(st.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{var i;const s=dr(t);e[s]=this.createHttpProvider(s,(i=this.namespace.rpcMap)==null?void 0:i[t])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProvider(e,t){const i=t||Ge(e,this.namespace,this.client.core.projectId);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);return new it(new dt(i,Q("disableProviderPing")))}}var wD=Object.defineProperty,bD=(r,e,t)=>e in r?wD(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Pr=(r,e,t)=>bD(r,typeof e!="symbol"?e+"":e,t);class vD{constructor(e){Pr(this,"name","multiversx"),Pr(this,"client"),Pr(this,"httpProviders"),Pr(this,"events"),Pr(this,"namespace"),Pr(this,"chainId"),this.namespace=e.namespace,this.events=Q("events"),this.client=Q("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t),this.chainId=e,this.events.emit(st.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{var i;const s=dr(t);e[s]=this.createHttpProvider(s,(i=this.namespace.rpcMap)==null?void 0:i[t])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProvider(e,t){const i=t||Ge(e,this.namespace,this.client.core.projectId);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);return new it(new dt(i,Q("disableProviderPing")))}}var ED=Object.defineProperty,_D=(r,e,t)=>e in r?ED(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Ar=(r,e,t)=>_D(r,typeof e!="symbol"?e+"":e,t);class ID{constructor(e){Ar(this,"name","near"),Ar(this,"client"),Ar(this,"httpProviders"),Ar(this,"events"),Ar(this,"namespace"),Ar(this,"chainId"),this.namespace=e.namespace,this.events=Q("events"),this.client=Q("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){if(this.chainId=e,!this.httpProviders[e]){const i=t||Ge(`${this.name}:${e}`,this.namespace);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);this.setHttpProvider(e,i)}this.events.emit(st.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const e=this.namespace.accounts;return e?e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2])||[]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{var i;e[t]=this.createHttpProvider(t,(i=this.namespace.rpcMap)==null?void 0:i[t])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProvider(e,t){const i=t||Ge(e,this.namespace);return typeof i>"u"?void 0:new it(new dt(i,Q("disableProviderPing")))}}var $D=Object.defineProperty,SD=(r,e,t)=>e in r?$D(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,xr=(r,e,t)=>SD(r,typeof e!="symbol"?e+"":e,t);class DD{constructor(e){xr(this,"name","tezos"),xr(this,"client"),xr(this,"httpProviders"),xr(this,"events"),xr(this,"namespace"),xr(this,"chainId"),this.namespace=e.namespace,this.events=Q("events"),this.client=Q("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){if(this.chainId=e,!this.httpProviders[e]){const i=t||Ge(`${this.name}:${e}`,this.namespace);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);this.setHttpProvider(e,i)}this.events.emit(st.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const e=this.namespace.accounts;return e?e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2])||[]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{e[t]=this.createHttpProvider(t)}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProvider(e,t){const i=t||Ge(e,this.namespace);return typeof i>"u"?void 0:new it(new dt(i))}}var OD=Object.defineProperty,PD=(r,e,t)=>e in r?OD(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Cr=(r,e,t)=>PD(r,typeof e!="symbol"?e+"":e,t);class AD{constructor(e){Cr(this,"name",Rr),Cr(this,"client"),Cr(this,"httpProviders"),Cr(this,"events"),Cr(this,"namespace"),Cr(this,"chainId"),this.namespace=e.namespace,this.events=Q("events"),this.client=Q("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace.chains=[...new Set((this.namespace.chains||[]).concat(e.chains||[]))],this.namespace.accounts=[...new Set((this.namespace.accounts||[]).concat(e.accounts||[]))],this.namespace.methods=[...new Set((this.namespace.methods||[]).concat(e.methods||[]))],this.namespace.events=[...new Set((this.namespace.events||[]).concat(e.events||[]))],this.httpProviders=this.createHttpProviders()}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider(e.chainId).request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t),this.chainId=e,this.events.emit(st.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}createHttpProviders(){var e,t;const i={};return(t=(e=this.namespace)==null?void 0:e.accounts)==null||t.forEach(s=>{const n=Lr(s);i[`${n.namespace}:${n.reference}`]=this.createHttpProvider(s)}),i}getHttpProvider(e){const t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProvider(e,t){const i=t||Ge(e,this.namespace,this.client.core.projectId);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);return new it(new dt(i,Q("disableProviderPing")))}}var xD=Object.defineProperty,CD=Object.defineProperties,TD=Object.getOwnPropertyDescriptors,Zu=Object.getOwnPropertySymbols,RD=Object.prototype.hasOwnProperty,ND=Object.prototype.propertyIsEnumerable,Eo=(r,e,t)=>e in r?xD(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,ts=(r,e)=>{for(var t in e||(e={}))RD.call(e,t)&&Eo(r,t,e[t]);if(Zu)for(var t of Zu(e))ND.call(e,t)&&Eo(r,t,e[t]);return r},Cn=(r,e)=>CD(r,TD(e)),Xe=(r,e,t)=>Eo(r,typeof e!="symbol"?e+"":e,t);let jD=class vd{constructor(e){Xe(this,"client"),Xe(this,"namespaces"),Xe(this,"optionalNamespaces"),Xe(this,"sessionProperties"),Xe(this,"scopedProperties"),Xe(this,"events",new $o),Xe(this,"rpcProviders",{}),Xe(this,"session"),Xe(this,"providerOpts"),Xe(this,"logger"),Xe(this,"uri"),Xe(this,"disableProviderPing",!1),this.providerOpts=e,this.logger=typeof(e==null?void 0:e.logger)<"u"&&typeof(e==null?void 0:e.logger)!="string"?e.logger:Li(Ns({level:(e==null?void 0:e.logger)||Fu})),this.disableProviderPing=(e==null?void 0:e.disableProviderPing)||!1}static async init(e){const t=new vd(e);return await t.initialize(),t}async request(e,t,i){const[s,n]=this.validateChain(t);if(!this.session)throw new Error("Please call connect() before request()");return await this.getProvider(s).request({request:ts({},e),chainId:`${s}:${n}`,topic:this.session.topic,expiry:i})}sendAsync(e,t,i,s){const n=new Date().getTime();this.request(e,i,s).then(o=>t(null,js(n,o))).catch(o=>t(o,void 0))}async enable(){if(!this.client)throw new Error("Sign Client not initialized");return this.session||await this.connect({namespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties,scopedProperties:this.scopedProperties}),await this.requestAccounts()}async disconnect(){var e;if(!this.session)throw new Error("Please call connect() before enable()");await this.client.disconnect({topic:(e=this.session)==null?void 0:e.topic,reason:te("USER_DISCONNECTED")}),await this.cleanup()}async connect(e){if(!this.client)throw new Error("Sign Client not initialized");if(this.setNamespaces(e),await this.cleanupPendingPairings(),!e.skipPairing)return await this.pair(e.pairingTopic)}async authenticate(e,t){if(!this.client)throw new Error("Sign Client not initialized");this.setNamespaces(e),await this.cleanupPendingPairings();const{uri:i,response:s}=await this.client.authenticate(e,t);i&&(this.uri=i,this.events.emit("display_uri",i));const n=await s();if(this.session=n.session,this.session){const o=Wu(this.session.namespaces);this.namespaces=Pn(this.namespaces,o),await this.persist("namespaces",this.namespaces),this.onConnect()}return n}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}removeListener(e,t){this.events.removeListener(e,t)}off(e,t){this.events.off(e,t)}get isWalletConnect(){return!0}async pair(e){const{uri:t,approval:i}=await this.client.connect({pairingTopic:e,requiredNamespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties,scopedProperties:this.scopedProperties});t&&(this.uri=t,this.events.emit("display_uri",t));const s=await i();this.session=s;const n=Wu(s.namespaces);return this.namespaces=Pn(this.namespaces,n),await this.persist("namespaces",this.namespaces),await this.persist("optionalNamespaces",this.optionalNamespaces),this.onConnect(),this.session}setDefaultChain(e,t){try{if(!this.session)return;const[i,s]=this.validateChain(e),n=this.getProvider(i);n.name===Rr?n.setDefaultChain(`${i}:${s}`,t):n.setDefaultChain(s,t)}catch(i){if(!/Please call connect/.test(i.message))throw i}}async cleanupPendingPairings(e={}){this.logger.info("Cleaning up inactive pairings...");const t=this.client.pairing.getAll();if(lt(t)){for(const i of t)e.deletePairings?this.client.core.expirer.set(i.topic,0):await this.client.core.relayer.subscriber.unsubscribe(i.topic);this.logger.info(`Inactive pairings cleared: ${t.length}`)}}abortPairingAttempt(){this.logger.warn("abortPairingAttempt is deprecated. This is now a no-op.")}async checkStorage(){this.namespaces=await this.getFromStore("namespaces")||{},this.optionalNamespaces=await this.getFromStore("optionalNamespaces")||{},this.session&&this.createProviders()}async initialize(){this.logger.trace("Initialized"),await this.createClient(),await this.checkStorage(),this.registerEventListeners()}async createClient(){var e,t;if(this.client=this.providerOpts.client||await eS.init({core:this.providerOpts.core,logger:this.providerOpts.logger||Fu,relayUrl:this.providerOpts.relayUrl||hS,projectId:this.providerOpts.projectId,metadata:this.providerOpts.metadata,storageOptions:this.providerOpts.storageOptions,storage:this.providerOpts.storage,name:this.providerOpts.name,customStoragePrefix:this.providerOpts.customStoragePrefix,telemetryEnabled:this.providerOpts.telemetryEnabled}),this.providerOpts.session)try{this.session=this.client.session.get(this.providerOpts.session.topic)}catch(i){throw this.logger.error("Failed to get session",i),new Error(`The provided session: ${(t=(e=this.providerOpts)==null?void 0:e.session)==null?void 0:t.topic} doesn't exist in the Sign client`)}else{const i=this.client.session.getAll();this.session=i[0]}this.logger.trace("SignClient Initialized")}createProviders(){if(!this.client)throw new Error("Sign Client not initialized");if(!this.session)throw new Error("Session not initialized. Please call connect() before enable()");const e=[...new Set(Object.keys(this.session.namespaces).map(t=>li(t)))];xn("client",this.client),xn("events",this.events),xn("disableProviderPing",this.disableProviderPing),e.forEach(t=>{if(!this.session)return;const i=WS(t,this.session),s=wd(i),n=Pn(this.namespaces,this.optionalNamespaces),o=Cn(ts({},n[t]),{accounts:i,chains:s});switch(t){case"eip155":this.rpcProviders[t]=new rD({namespace:o});break;case"algorand":this.rpcProviders[t]=new lD({namespace:o});break;case"solana":this.rpcProviders[t]=new nD({namespace:o});break;case"cosmos":this.rpcProviders[t]=new cD({namespace:o});break;case"polkadot":this.rpcProviders[t]=new JS({namespace:o});break;case"cip34":this.rpcProviders[t]=new fD({namespace:o});break;case"elrond":this.rpcProviders[t]=new mD({namespace:o});break;case"multiversx":this.rpcProviders[t]=new vD({namespace:o});break;case"near":this.rpcProviders[t]=new ID({namespace:o});break;case"tezos":this.rpcProviders[t]=new DD({namespace:o});break;default:this.rpcProviders[Rr]?this.rpcProviders[Rr].updateNamespace(o):this.rpcProviders[Rr]=new AD({namespace:o})}})}registerEventListeners(){if(typeof this.client>"u")throw new Error("Sign Client is not initialized");this.client.on("session_ping",e=>{var t;const{topic:i}=e;i===((t=this.session)==null?void 0:t.topic)&&this.events.emit("session_ping",e)}),this.client.on("session_event",e=>{var t;const{params:i,topic:s}=e;if(s!==((t=this.session)==null?void 0:t.topic))return;const{event:n}=i;if(n.name==="accountsChanged"){const o=n.data;o&&lt(o)&&this.events.emit("accountsChanged",o.map(Ku))}else if(n.name==="chainChanged"){const o=i.chainId,a=i.event.data,c=li(o),u=An(o)!==An(a)?`${c}:${An(a)}`:o;this.onChainChanged(u)}else this.events.emit(n.name,n.data);this.events.emit("session_event",e)}),this.client.on("session_update",({topic:e,params:t})=>{var i,s;if(e!==((i=this.session)==null?void 0:i.topic))return;const{namespaces:n}=t,o=(s=this.client)==null?void 0:s.session.get(e);this.session=Cn(ts({},o),{namespaces:n}),this.onSessionUpdate(),this.events.emit("session_update",{topic:e,params:t})}),this.client.on("session_delete",async e=>{var t;e.topic===((t=this.session)==null?void 0:t.topic)&&(await this.cleanup(),this.events.emit("session_delete",e),this.events.emit("disconnect",Cn(ts({},te("USER_DISCONNECTED")),{data:e.topic})))}),this.on(st.DEFAULT_CHAIN_CHANGED,e=>{this.onChainChanged(e,!0)})}getProvider(e){return this.rpcProviders[e]||this.rpcProviders[Rr]}onSessionUpdate(){Object.keys(this.rpcProviders).forEach(e=>{var t;this.getProvider(e).updateNamespace((t=this.session)==null?void 0:t.namespaces[e])})}setNamespaces(e){const{namespaces:t,optionalNamespaces:i,sessionProperties:s,scopedProperties:n}=e;t&&Object.keys(t).length&&(this.namespaces=t),i&&Object.keys(i).length&&(this.optionalNamespaces=i),this.sessionProperties=s,this.scopedProperties=n}validateChain(e){const[t,i]=(e==null?void 0:e.split(":"))||["",""];if(!this.namespaces||!Object.keys(this.namespaces).length)return[t,i];if(t&&!Object.keys(this.namespaces||{}).map(o=>li(o)).includes(t))throw new Error(`Namespace '${t}' is not configured. Please call connect() first with namespace config.`);if(t&&i)return[t,i];const s=li(Object.keys(this.namespaces)[0]),n=this.rpcProviders[s].getDefaultChain();return[s,n]}async requestAccounts(){const[e]=this.validateChain();return await this.getProvider(e).requestAccounts()}async onChainChanged(e,t=!1){if(!this.namespaces)return;const[i,s]=this.validateChain(e);if(!s)return;this.updateNamespaceChain(i,s),this.events.emit("chainChanged",s);const n=this.getProvider(i).getDefaultChain();t||this.getProvider(i).setDefaultChain(s),this.emitAccountsChangedOnChainChange({namespace:i,previousChainId:n,newChainId:e}),await this.persist("namespaces",this.namespaces)}emitAccountsChangedOnChainChange({namespace:e,previousChainId:t,newChainId:i}){var s,n;try{if(t===i)return;const o=(n=(s=this.session)==null?void 0:s.namespaces[e])==null?void 0:n.accounts;if(!o)return;const a=o.filter(c=>c.includes(`${i}:`)).map(Ku);if(!lt(a))return;this.events.emit("accountsChanged",a)}catch(o){this.logger.warn("Failed to emit accountsChanged on chain change",o)}}updateNamespaceChain(e,t){if(!this.namespaces)return;const i=this.namespaces[e]?e:`${e}:${t}`,s={chains:[],methods:[],events:[],defaultChain:t};this.namespaces[i]?this.namespaces[i]&&(this.namespaces[i].defaultChain=t):this.namespaces[i]=s}onConnect(){this.createProviders(),this.events.emit("connect",{session:this.session})}async cleanup(){this.namespaces=void 0,this.optionalNamespaces=void 0,this.sessionProperties=void 0,await this.deleteFromStore("namespaces"),await this.deleteFromStore("optionalNamespaces"),await this.deleteFromStore("sessionProperties"),this.session=void 0,await this.cleanupPendingPairings({deletePairings:!0}),await this.cleanupStorage()}async persist(e,t){var i;const s=((i=this.session)==null?void 0:i.topic)||"";await this.client.core.storage.setItem(`${Xi}/${e}${s}`,t)}async getFromStore(e){var t;const i=((t=this.session)==null?void 0:t.topic)||"";return await this.client.core.storage.getItem(`${Xi}/${e}${i}`)}async deleteFromStore(e){var t;const i=((t=this.session)==null?void 0:t.topic)||"";await this.client.core.storage.removeItem(`${Xi}/${e}${i}`)}async cleanupStorage(){var e;try{if(((e=this.client)==null?void 0:e.session.length)>0)return;const t=await this.client.core.storage.getKeys();for(const i of t)i.startsWith(Xi)&&await this.client.core.storage.removeItem(i)}catch(t){this.logger.warn("Failed to cleanup storage",t)}}};const BD=jD,LD="wc",UD="ethereum_provider",FD=`${LD}@2:${UD}:`,qD="https://rpc.walletconnect.org/v1/",vs=["eth_sendTransaction","personal_sign"],Ed=["eth_accounts","eth_requestAccounts","eth_sendRawTransaction","eth_sign","eth_signTransaction","eth_signTypedData","eth_signTypedData_v3","eth_signTypedData_v4","eth_sendTransaction","personal_sign","wallet_switchEthereumChain","wallet_addEthereumChain","wallet_getPermissions","wallet_requestPermissions","wallet_registerOnboarding","wallet_watchAsset","wallet_scanQRCode","wallet_sendCalls","wallet_getCapabilities","wallet_getCallsStatus","wallet_showCallsStatus"],Es=["chainChanged","accountsChanged"],_d=["chainChanged","accountsChanged","message","disconnect","connect"];var MD=Object.defineProperty,kD=Object.defineProperties,zD=Object.getOwnPropertyDescriptors,Qu=Object.getOwnPropertySymbols,HD=Object.prototype.hasOwnProperty,VD=Object.prototype.propertyIsEnumerable,_o=(r,e,t)=>e in r?MD(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Nr=(r,e)=>{for(var t in e||(e={}))HD.call(e,t)&&_o(r,t,e[t]);if(Qu)for(var t of Qu(e))VD.call(e,t)&&_o(r,t,e[t]);return r},Tn=(r,e)=>kD(r,zD(e)),ze=(r,e,t)=>_o(r,typeof e!="symbol"?e+"":e,t);function _s(r){return Number(r[0].split(":")[1])}function rs(r){return`0x${r.toString(16)}`}function KD(r){const{chains:e,optionalChains:t,methods:i,optionalMethods:s,events:n,optionalEvents:o,rpcMap:a}=r;if(!lt(e))throw new Error("Invalid chains");const c={chains:e,methods:i||vs,events:n||Es,rpcMap:Nr({},e.length?{[_s(e)]:a[_s(e)]}:{})},u=n==null?void 0:n.filter(f=>!Es.includes(f)),h=i==null?void 0:i.filter(f=>!vs.includes(f));if(!t&&!o&&!s&&!(u!=null&&u.length)&&!(h!=null&&h.length))return{required:e.length?c:void 0};const l=(u==null?void 0:u.length)&&(h==null?void 0:h.length)||!t,d={chains:[...new Set(l?c.chains.concat(t||[]):t)],methods:[...new Set(c.methods.concat(s!=null&&s.length?s:Ed))],events:[...new Set(c.events.concat(o!=null&&o.length?o:_d))],rpcMap:a};return{required:e.length?c:void 0,optional:t.length?d:void 0}}class qs{constructor(){ze(this,"events",new Ye.EventEmitter),ze(this,"namespace","eip155"),ze(this,"accounts",[]),ze(this,"signer"),ze(this,"chainId",1),ze(this,"modal"),ze(this,"rpc"),ze(this,"STORAGE_KEY",FD),ze(this,"on",(e,t)=>(this.events.on(e,t),this)),ze(this,"once",(e,t)=>(this.events.once(e,t),this)),ze(this,"removeListener",(e,t)=>(this.events.removeListener(e,t),this)),ze(this,"off",(e,t)=>(this.events.off(e,t),this)),ze(this,"parseAccount",e=>this.isCompatibleChainId(e)?this.parseAccountId(e).address:e),this.signer={},this.rpc={}}static async init(e){const t=new qs;return await t.initialize(e),t}async request(e,t){return await this.signer.request(e,this.formatChainId(this.chainId),t)}sendAsync(e,t,i){this.signer.sendAsync(e,t,this.formatChainId(this.chainId),i)}get connected(){return this.signer.client?this.signer.client.core.relayer.connected:!1}get connecting(){return this.signer.client?this.signer.client.core.relayer.connecting:!1}async enable(){return this.session||await this.connect(),await this.request({method:"eth_requestAccounts"})}async connect(e){if(!this.signer.client)throw new Error("Provider not initialized. Call init() first");this.loadConnectOpts(e);const{required:t,optional:i}=KD(this.rpc);try{const s=await new Promise(async(o,a)=>{var c;this.rpc.showQrModal&&((c=this.modal)==null||c.subscribeModal(h=>{!h.open&&!this.signer.session&&(this.signer.abortPairingAttempt(),a(new Error("Connection request reset. Please try again.")))}));const u=e!=null&&e.scopedProperties?{[this.namespace]:e.scopedProperties}:void 0;await this.signer.connect(Tn(Nr({namespaces:Nr({},t&&{[this.namespace]:t})},i&&{optionalNamespaces:{[this.namespace]:i}}),{pairingTopic:e==null?void 0:e.pairingTopic,scopedProperties:u})).then(h=>{o(h)}).catch(h=>{a(new Error(h.message))})});if(!s)return;const n=Wa(s.namespaces,[this.namespace]);this.setChainIds(this.rpc.chains.length?this.rpc.chains:n),this.setAccounts(n),this.events.emit("connect",{chainId:rs(this.chainId)})}catch(s){throw this.signer.logger.error(s),s}finally{this.modal&&this.modal.closeModal()}}async authenticate(e,t){if(!this.signer.client)throw new Error("Provider not initialized. Call init() first");this.loadConnectOpts({chains:e==null?void 0:e.chains});try{const i=await new Promise(async(n,o)=>{var a;this.rpc.showQrModal&&((a=this.modal)==null||a.subscribeModal(c=>{!c.open&&!this.signer.session&&(this.signer.abortPairingAttempt(),o(new Error("Connection request reset. Please try again.")))})),await this.signer.authenticate(Tn(Nr({},e),{chains:this.rpc.chains}),t).then(c=>{n(c)}).catch(c=>{o(new Error(c.message))})}),s=i.session;if(s){const n=Wa(s.namespaces,[this.namespace]);this.setChainIds(this.rpc.chains.length?this.rpc.chains:n),this.setAccounts(n),this.events.emit("connect",{chainId:rs(this.chainId)})}return i}catch(i){throw this.signer.logger.error(i),i}finally{this.modal&&this.modal.closeModal()}}async disconnect(){this.session&&await this.signer.disconnect(),this.reset()}get isWalletConnect(){return!0}get session(){return this.signer.session}registerEventListeners(){this.signer.on("session_event",e=>{const{params:t}=e,{event:i}=t;i.name==="accountsChanged"?(this.accounts=this.parseAccounts(i.data),this.events.emit("accountsChanged",this.accounts)):i.name==="chainChanged"?this.setChainId(this.formatChainId(i.data)):this.events.emit(i.name,i.data),this.events.emit("session_event",e)}),this.signer.on("accountsChanged",e=>{this.accounts=this.parseAccounts(e),this.events.emit("accountsChanged",this.accounts)}),this.signer.on("chainChanged",e=>{const t=parseInt(e);this.chainId=t,this.events.emit("chainChanged",rs(this.chainId)),this.persist()}),this.signer.on("session_update",e=>{this.events.emit("session_update",e)}),this.signer.on("session_delete",e=>{this.reset(),this.events.emit("session_delete",e),this.events.emit("disconnect",Tn(Nr({},te("USER_DISCONNECTED")),{data:e.topic,name:"USER_DISCONNECTED"}))}),this.signer.on("display_uri",e=>{var t,i;this.rpc.showQrModal&&((t=this.modal)==null||t.closeModal(),(i=this.modal)==null||i.openModal({uri:e})),this.events.emit("display_uri",e)})}switchEthereumChain(e){this.request({method:"wallet_switchEthereumChain",params:[{chainId:e.toString(16)}]})}isCompatibleChainId(e){return typeof e=="string"?e.startsWith(`${this.namespace}:`):!1}formatChainId(e){return`${this.namespace}:${e}`}parseChainId(e){return Number(e.split(":")[1])}setChainIds(e){const t=e.filter(i=>this.isCompatibleChainId(i)).map(i=>this.parseChainId(i));t.length&&(this.chainId=t[0],this.events.emit("chainChanged",rs(this.chainId)),this.persist())}setChainId(e){if(this.isCompatibleChainId(e)){const t=this.parseChainId(e);this.chainId=t,this.switchEthereumChain(t)}}parseAccountId(e){const[t,i,s]=e.split(":");return{chainId:`${t}:${i}`,address:s}}setAccounts(e){this.accounts=e.filter(t=>this.parseChainId(this.parseAccountId(t).chainId)===this.chainId).map(t=>this.parseAccountId(t).address),this.events.emit("accountsChanged",this.accounts)}getRpcConfig(e){var t,i;const s=(t=e==null?void 0:e.chains)!=null?t:[],n=(i=e==null?void 0:e.optionalChains)!=null?i:[],o=s.concat(n);if(!o.length)throw new Error("No chains specified in either `chains` or `optionalChains`");const a=s.length?(e==null?void 0:e.methods)||vs:[],c=s.length?(e==null?void 0:e.events)||Es:[],u=(e==null?void 0:e.optionalMethods)||[],h=(e==null?void 0:e.optionalEvents)||[],l=(e==null?void 0:e.rpcMap)||this.buildRpcMap(o,e.projectId),d=(e==null?void 0:e.qrModalOptions)||void 0;return{chains:s==null?void 0:s.map(f=>this.formatChainId(f)),optionalChains:n.map(f=>this.formatChainId(f)),methods:a,events:c,optionalMethods:u,optionalEvents:h,rpcMap:l,showQrModal:!!(e!=null&&e.showQrModal),qrModalOptions:d,projectId:e.projectId,metadata:e.metadata}}buildRpcMap(e,t){const i={};return e.forEach(s=>{i[s]=this.getRpcUrl(s,t)}),i}async initialize(e){if(this.rpc=this.getRpcConfig(e),this.chainId=this.rpc.chains.length?_s(this.rpc.chains):_s(this.rpc.optionalChains),this.signer=await BD.init({projectId:this.rpc.projectId,metadata:this.rpc.metadata,disableProviderPing:e.disableProviderPing,relayUrl:e.relayUrl,storage:e.storage,storageOptions:e.storageOptions,customStoragePrefix:e.customStoragePrefix,telemetryEnabled:e.telemetryEnabled,logger:e.logger}),this.registerEventListeners(),await this.loadPersistedSession(),this.rpc.showQrModal){let t;try{const{WalletConnectModal:i}=await eh(()=>import("./index-xF4Q8uYu.js").then(s=>s.i),__vite__mapDeps([3,1,2]));t=i}catch{throw new Error("To use QR modal, please install @walletconnect/modal package")}if(t)try{this.modal=new t(Nr({projectId:this.rpc.projectId},this.rpc.qrModalOptions))}catch(i){throw this.signer.logger.error(i),new Error("Could not generate WalletConnectModal Instance")}}}loadConnectOpts(e){if(!e)return;const{chains:t,optionalChains:i,rpcMap:s}=e;t&&lt(t)&&(this.rpc.chains=t.map(n=>this.formatChainId(n)),t.forEach(n=>{this.rpc.rpcMap[n]=(s==null?void 0:s[n])||this.getRpcUrl(n)})),i&&lt(i)&&(this.rpc.optionalChains=[],this.rpc.optionalChains=i==null?void 0:i.map(n=>this.formatChainId(n)),i.forEach(n=>{this.rpc.rpcMap[n]=(s==null?void 0:s[n])||this.getRpcUrl(n)}))}getRpcUrl(e,t){var i;return((i=this.rpc.rpcMap)==null?void 0:i[e])||`${qD}?chainId=eip155:${e}&projectId=${t||this.rpc.projectId}`}async loadPersistedSession(){if(this.session)try{const e=await this.signer.client.core.storage.getItem(`${this.STORAGE_KEY}/chainId`),t=this.session.namespaces[`${this.namespace}:${e}`]?this.session.namespaces[`${this.namespace}:${e}`]:this.session.namespaces[this.namespace];this.setChainIds(e?[this.formatChainId(e)]:t==null?void 0:t.accounts),this.setAccounts(t==null?void 0:t.accounts)}catch(e){this.signer.logger.error("Failed to load persisted session, clearing state..."),this.signer.logger.error(e),await this.disconnect().catch(t=>this.signer.logger.warn(t))}}reset(){this.chainId=1,this.accounts=[]}persist(){this.session&&this.signer.client.core.storage.setItem(`${this.STORAGE_KEY}/chainId`,this.chainId)}parseAccounts(e){return typeof e=="string"||e instanceof String?[this.parseAccount(e)]:e.map(t=>this.parseAccount(t))}}const WD=qs,LO=Object.freeze(Object.defineProperty({__proto__:null,EthereumProvider:WD,OPTIONAL_EVENTS:_d,OPTIONAL_METHODS:Ed,REQUIRED_EVENTS:Es,REQUIRED_METHODS:vs,default:qs},Symbol.toStringTag,{value:"Module"}));export{Kp as H,ba as a,Bp as b,JD as c,YD as d,$s as e,XD as f,QD as g,LO as i,ZD as r,lh as t,Wp as w};
